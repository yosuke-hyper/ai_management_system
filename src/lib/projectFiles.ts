// Auto-generated file containing all project files
// Generated on: 2025-10-24T09:34:05.687Z

export const projectFiles: Record<string, string> = {
  "ai-management-system.zip": "[DUMMY FILE CONTENT]",
  "api/main.py": "#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\né£²é£Ÿåº—æ¥­å‹™å ±å‘Šã‚·ã‚¹ãƒ†ãƒ  - Python API Server\nGoogle Sheetsé€£æºã¨LINE Botæ©Ÿèƒ½ã‚’æä¾›\n\"\"\"\n\nimport os\nimport json\nimport logging\nfrom datetime import datetime, timedelta\nfrom typing import Dict, List, Optional\nfrom dataclasses import dataclass, asdict\nfrom flask import Flask, request, jsonify\nfrom flask_cors import CORS\n\n# Pythonã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ã‚’ä½¿ç”¨ï¼ˆWebContaineråˆ¶é™ã®ãŸã‚ï¼‰\nimport urllib.request\nimport urllib.parse\nimport sqlite3\nfrom pathlib import Path\n\napp = Flask(__name__)\nCORS(app)\n\n# ãƒ­ã‚°è¨­å®š\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# è¨­å®š\nGOOGLE_SHEETS_API_KEY = os.environ.get('GOOGLE_SHEETS_API_KEY', '')\nGOOGLE_SHEET_ID = os.environ.get('GOOGLE_SHEET_ID', '')\nLINE_CHANNEL_SECRET = os.environ.get('LINE_CHANNEL_SECRET', '')\nLINE_CHANNEL_ACCESS_TOKEN = os.environ.get('LINE_CHANNEL_ACCESS_TOKEN', '')\n\n# ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«\n@dataclass\nclass DailyReport:\n    id: str\n    date: str\n    store_name: str\n    staff_name: str\n    sales: float\n    purchase: float\n    labor_cost: float\n    utilities: float\n    promotion: float\n    cleaning: float\n    misc: float\n    communication: float\n    others: float\n    report_text: str\n    created_at: str\n    line_user_id: Optional[str] = None\n\nclass DatabaseManager:\n    \"\"\"SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ï¼ˆGoogle Sheetsç§»è¡Œå‰ã®ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼‰\"\"\"\n    \n    def __init__(self, db_path: str = \"/tmp/reports.db\"):\n        self.db_path = db_path\n        self._init_db()\n    \n    def _init_db(self):\n        \"\"\"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–\"\"\"\n        with sqlite3.connect(self.db_path) as conn:\n            conn.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS daily_reports (\n                    id TEXT PRIMARY KEY,\n                    date TEXT NOT NULL,\n                    store_name TEXT NOT NULL,\n                    staff_name TEXT NOT NULL,\n                    sales REAL NOT NULL,\n                    purchase REAL NOT NULL,\n                    labor_cost REAL NOT NULL,\n                    utilities REAL NOT NULL,\n                    promotion REAL NOT NULL,\n                    cleaning REAL NOT NULL,\n                    misc REAL NOT NULL,\n                    communication REAL NOT NULL,\n                    others REAL NOT NULL,\n                    report_text TEXT,\n                    created_at TEXT NOT NULL,\n                    line_user_id TEXT\n                )\n            \"\"\")\n            conn.commit()\n    \n    def save_report(self, report: DailyReport) -> bool:\n        \"\"\"æ—¥æ¬¡å ±å‘Šã‚’ä¿å­˜\"\"\"\n        try:\n            with sqlite3.connect(self.db_path) as conn:\n                conn.execute(\"\"\"\n                    INSERT OR REPLACE INTO daily_reports VALUES \n                    (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n                \"\"\", (\n                    report.id, report.date, report.store_name, report.staff_name,\n                    report.sales, report.purchase, report.labor_cost, report.utilities,\n                    report.promotion, report.cleaning, report.misc, report.communication,\n                    report.others, report.report_text, report.created_at, report.line_user_id\n                ))\n                conn.commit()\n            return True\n        except Exception as e:\n            logger.error(f\"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ã‚¨ãƒ©ãƒ¼: {e}\")\n            return False\n    \n    def get_reports(self, start_date: str = None, end_date: str = None) -> List[DailyReport]:\n        \"\"\"æ—¥æ¬¡å ±å‘Šã‚’å–å¾—\"\"\"\n        query = \"SELECT * FROM daily_reports\"\n        params = []\n        \n        if start_date and end_date:\n            query += \" WHERE date BETWEEN ? AND ?\"\n            params = [start_date, end_date]\n        \n        query += \" ORDER BY date DESC, created_at DESC\"\n        \n        with sqlite3.connect(self.db_path) as conn:\n            cursor = conn.execute(query, params)\n            rows = cursor.fetchall()\n            \n            reports = []\n            for row in rows:\n                report = DailyReport(\n                    id=row[0], date=row[1], store_name=row[2], staff_name=row[3],\n                    sales=row[4], purchase=row[5], labor_cost=row[6], utilities=row[7],\n                    promotion=row[8], cleaning=row[9], misc=row[10], communication=row[11],\n                    others=row[12], report_text=row[13], created_at=row[14], line_user_id=row[15]\n                )\n                reports.append(report)\n            \n            return reports\n\nclass GoogleSheetsAPI:\n    \"\"\"Google Sheets API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ\"\"\"\n    \n    def __init__(self, api_key: str, sheet_id: str):\n        self.api_key = api_key\n        self.sheet_id = sheet_id\n        self.base_url = \"https://sheets.googleapis.com/v4/spreadsheets\"\n    \n    def append_row(self, sheet_name: str, values: List[str]) -> bool:\n        \"\"\"ã‚·ãƒ¼ãƒˆã«è¡Œã‚’è¿½åŠ \"\"\"\n        if not self.api_key:\n            logger.warning(\"Google Sheets API ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“\")\n            return False\n            \n        try:\n            url = f\"{self.base_url}/{self.sheet_id}/values/{sheet_name}:append\"\n            params = {\n                'key': self.api_key,\n                'valueInputOption': 'USER_ENTERED'\n            }\n            \n            data = {\n                'values': [values]\n            }\n            \n            # HTTP POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\n            req_data = json.dumps(data).encode('utf-8')\n            req = urllib.request.Request(\n                url + '?' + urllib.parse.urlencode(params),\n                data=req_data,\n                headers={'Content-Type': 'application/json'}\n            )\n            \n            with urllib.request.urlopen(req) as response:\n                result = json.loads(response.read().decode('utf-8'))\n                logger.info(f\"Google Sheetsæ›´æ–°æˆåŠŸ: {result}\")\n                return True\n                \n        except Exception as e:\n            logger.error(f\"Google Sheetsæ›´æ–°ã‚¨ãƒ©ãƒ¼: {e}\")\n            return False\n\n# ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹\ndb_manager = DatabaseManager()\nsheets_api = GoogleSheetsAPI(GOOGLE_SHEETS_API_KEY, GOOGLE_SHEET_ID)\n\n@app.route('/api/health', methods=['GET'])\ndef health_check():\n    \"\"\"ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯\"\"\"\n    return jsonify({\n        'status': 'ok',\n        'timestamp': datetime.now().isoformat(),\n        'google_sheets_configured': bool(GOOGLE_SHEETS_API_KEY and GOOGLE_SHEET_ID),\n        'line_configured': bool(LINE_CHANNEL_SECRET and LINE_CHANNEL_ACCESS_TOKEN)\n    })\n\n@app.route('/api/reports', methods=['GET'])\ndef get_reports():\n    \"\"\"æ—¥æ¬¡å ±å‘Šä¸€è¦§å–å¾—\"\"\"\n    start_date = request.args.get('start_date')\n    end_date = request.args.get('end_date')\n    \n    reports = db_manager.get_reports(start_date, end_date)\n    return jsonify([asdict(report) for report in reports])\n\n@app.route('/api/reports', methods=['POST'])\ndef create_report():\n    \"\"\"æ—¥æ¬¡å ±å‘Šä½œæˆ\"\"\"\n    try:\n        data = request.get_json()\n        \n        report = DailyReport(\n            id=f\"{data['date']}_{data['store_name']}_{datetime.now().strftime('%H%M%S')}\",\n            date=data['date'],\n            store_name=data['store_name'],\n            staff_name=data.get('staff_name', ''),\n            sales=float(data['sales']),\n            purchase=float(data['purchase']),\n            labor_cost=float(data.get('labor_cost', 0)),\n            utilities=float(data.get('utilities', 0)),\n            promotion=float(data.get('promotion', 0)),\n            cleaning=float(data.get('cleaning', 0)),\n            misc=float(data.get('misc', 0)),\n            communication=float(data.get('communication', 0)),\n            others=float(data.get('others', 0)),\n            report_text=data.get('report_text', ''),\n            created_at=datetime.now().isoformat(),\n            line_user_id=data.get('line_user_id')\n        )\n        \n        # SQLiteã«ä¿å­˜\n        if db_manager.save_report(report):\n            # Google Sheetsã«ã‚‚ä¿å­˜ã‚’è©¦è¡Œ\n            sheets_values = [\n                report.date, report.store_name, report.staff_name,\n                str(report.sales), str(report.purchase), str(report.labor_cost),\n                str(report.utilities), str(report.promotion), str(report.cleaning),\n                str(report.misc), str(report.communication), str(report.others),\n                report.report_text, report.created_at\n            ]\n            \n            sheets_success = sheets_api.append_row('daily_reports', sheets_values)\n            \n            return jsonify({\n                'success': True,\n                'id': report.id,\n                'saved_to_sheets': sheets_success\n            }), 201\n        else:\n            return jsonify({'success': False, 'error': 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ã«å¤±æ•—'}), 500\n            \n    except Exception as e:\n        logger.error(f\"å ±å‘Šä½œæˆã‚¨ãƒ©ãƒ¼: {e}\")\n        return jsonify({'success': False, 'error': str(e)}), 400\n\n@app.route('/api/summary', methods=['GET'])\ndef get_summary():\n    \"\"\"é›†è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—\"\"\"\n    period_type = request.args.get('period_type', 'daily')\n    start_date = request.args.get('start_date')\n    end_date = request.args.get('end_date')\n    \n    reports = db_manager.get_reports(start_date, end_date)\n    \n    # æœŸé–“åˆ¥é›†è¨ˆå‡¦ç†\n    summary_data = calculate_summary(reports, period_type)\n    \n    return jsonify(summary_data)\n\ndef calculate_summary(reports: List[DailyReport], period_type: str) -> Dict:\n    \"\"\"é›†è¨ˆè¨ˆç®—\"\"\"\n    if not reports:\n        return {'periods': [], 'totals': {}}\n    \n    # æœŸé–“åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–\n    periods = {}\n    \n    for report in reports:\n        if period_type == 'daily':\n            key = report.date\n        elif period_type == 'weekly':\n            # é€±ã®é–‹å§‹æ—¥ã‚’è¨ˆç®—\n            date_obj = datetime.strptime(report.date, '%Y-%m-%d')\n            week_start = date_obj - timedelta(days=date_obj.weekday())\n            key = week_start.strftime('%Y-%m-%d')\n        else:  # monthly\n            key = report.date[:7]  # YYYY-MM\n        \n        if key not in periods:\n            periods[key] = {\n                'period': key,\n                'total_sales': 0,\n                'total_expenses': 0,\n                'total_purchase': 0\n            }\n        \n        # çµŒè²»åˆè¨ˆ\n        total_expenses = (report.purchase + report.labor_cost + report.utilities + \n                         report.promotion + report.cleaning + report.misc + \n                         report.communication + report.others)\n        \n        periods[key]['total_sales'] += report.sales\n        periods[key]['total_expenses'] += total_expenses\n        periods[key]['total_purchase'] += report.purchase\n    \n    # åˆ©ç›Šè¨ˆç®—\n    for period_data in periods.values():\n        period_data['gross_profit'] = period_data['total_sales'] - period_data['total_purchase']\n        period_data['operating_profit'] = period_data['total_sales'] - period_data['total_expenses']\n        period_data['profit_margin'] = (\n            period_data['operating_profit'] / period_data['total_sales'] * 100\n            if period_data['total_sales'] > 0 else 0\n        )\n    \n    return {\n        'periods': list(periods.values()),\n        'totals': {\n            'total_sales': sum(p['total_sales'] for p in periods.values()),\n            'total_expenses': sum(p['total_expenses'] for p in periods.values()),\n            'gross_profit': sum(p['gross_profit'] for p in periods.values()),\n            'operating_profit': sum(p['operating_profit'] for p in periods.values()),\n        }\n    }\n\n@app.route('/api/line/webhook', methods=['POST'])\ndef line_webhook():\n    \"\"\"LINE Webhook ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ\"\"\"\n    # ä»Šå¾ŒLINE Botæ©Ÿèƒ½ã‚’å®Ÿè£…\n    return jsonify({'status': 'received'}), 200\n\nif __name__ == '__main__':\n    port = int(os.environ.get('PORT', 8000))\n    app.run(host='0.0.0.0', port=port, debug=True)",
  "eslint.config.js": "import js from '@eslint/js';\nimport globals from 'globals';\nimport reactHooks from 'eslint-plugin-react-hooks';\nimport reactRefresh from 'eslint-plugin-react-refresh';\nimport tseslint from 'typescript-eslint';\n\nexport default tseslint.config(\n  { ignores: ['dist'] },\n  {\n    extends: [js.configs.recommended, ...tseslint.configs.recommended],\n    files: ['**/*.{ts,tsx}'],\n    languageOptions: {\n      ecmaVersion: 2020,\n      globals: globals.browser,\n    },\n    plugins: {\n      'react-hooks': reactHooks,\n      'react-refresh': reactRefresh,\n    },\n    rules: {\n      ...reactHooks.configs.recommended.rules,\n      'react-refresh/only-export-components': [\n        'warn',\n        { allowConstantExport: true },\n      ],\n    },\n  }\n);\n",
  "netlify.toml": "[build]\n  command = \"npm run build\"\n  publish = \"dist\"\n\n[[redirects]]\n  from = \"/*\"\n  to = \"/index.html\"\n  status = 200\n\n[[headers]]\n  for = \"/*\"\n  [headers.values]\n    X-Content-Type-Options = \"nosniff\"\n    X-Frame-Options = \"DENY\"\n    X-XSS-Protection = \"1; mode=block\"\n    Referrer-Policy = \"strict-origin-when-cross-origin\"\n    Permissions-Policy = \"geolocation=(), microphone=(), camera=()\"\n\n[[headers]]\n  for = \"/assets/*\"\n  [headers.values]\n    Cache-Control = \"public, max-age=31536000, immutable\"\n",
  "package.json": "{\n  \"name\": \"ai-management-system\",\n  \"private\": true,\n  \"version\": \"0.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"node scripts/generate-project-files.cjs && vite build\",\n    \"preview\": \"vite preview\",\n    \"generate-files\": \"node scripts/generate-project-files.cjs\"\n  },\n  \"dependencies\": {\n    \"@radix-ui/react-dropdown-menu\": \"^2.1.2\",\n    \"@radix-ui/react-progress\": \"^1.1.7\",\n    \"@radix-ui/react-slot\": \"^1.2.3\",\n    \"@radix-ui/react-tabs\": \"^1.1.13\",\n    \"@supabase/supabase-js\": \"^2.39.3\",\n    \"@tanstack/react-table\": \"^8.20.5\",\n    \"chart.js\": \"^4.5.0\",\n    \"class-variance-authority\": \"^0.7.1\",\n    \"clsx\": \"^2.1.1\",\n    \"date-fns\": \"^4.1.0\",\n    \"file-saver\": \"^2.0.5\",\n    \"jszip\": \"^3.10.1\",\n    \"lucide-react\": \"^0.544.0\",\n    \"react\": \"^18.3.1\",\n    \"react-chartjs-2\": \"^5.3.0\",\n    \"react-dom\": \"^18.3.1\",\n    \"react-router-dom\": \"^6.28.0\",\n    \"recharts\": \"^3.2.0\",\n    \"tailwind-merge\": \"^3.3.1\"\n  },\n  \"devDependencies\": {\n    \"@eslint/js\": \"^9.9.1\",\n    \"@types/archiver\": \"^6.0.4\",\n    \"@types/file-saver\": \"^2.0.7\",\n    \"@types/react\": \"^18.3.5\",\n    \"@types/react-dom\": \"^18.3.0\",\n    \"@vitejs/plugin-react\": \"^4.3.1\",\n    \"archiver\": \"^7.0.1\",\n    \"autoprefixer\": \"^10.4.18\",\n    \"eslint\": \"^9.9.1\",\n    \"eslint-plugin-react-hooks\": \"^5.1.0-rc.0\",\n    \"eslint-plugin-react-refresh\": \"^0.4.11\",\n    \"globals\": \"^15.9.0\",\n    \"postcss\": \"^8.4.35\",\n    \"tailwindcss\": \"^3.4.1\",\n    \"terser\": \"^5.44.0\",\n    \"typescript\": \"^5.5.3\",\n    \"typescript-eslint\": \"^8.3.0\",\n    \"vite\": \"^5.4.2\"\n  }\n}\n",
  "postcss.config.js": "export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n};\n",
  "scripts/create-zip.cjs": "const fs = require('fs');\nconst path = require('path');\nconst archiver = require('archiver');\n\nconst projectRoot = path.join(__dirname, '..');\nconst outputPath = path.join(projectRoot, 'ai-management-system.zip');\n\nif (fs.existsSync(outputPath)) {\n  fs.unlinkSync(outputPath);\n}\n\nconst output = fs.createWriteStream(outputPath);\nconst archive = archiver('zip', {\n  zlib: { level: 9 }\n});\n\noutput.on('close', function() {\n  const sizeMB = (archive.pointer() / 1024 / 1024).toFixed(2);\n  console.log(`âœ“ ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ: ${outputPath}`);\n  console.log(`  ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ${sizeMB} MB`);\n  console.log(`  åˆè¨ˆãƒ•ã‚¡ã‚¤ãƒ«æ•°: ${archive.pointer()} bytes`);\n});\n\narchive.on('error', function(err) {\n  throw err;\n});\n\narchive.pipe(output);\n\nconst filesToExclude = [\n  'node_modules',\n  'dist',\n  '.git',\n  '.bolt',\n  'ai-management-system.zip',\n  '.DS_Store',\n  'vite.config.ts.timestamp-*'\n];\n\nfunction shouldInclude(filePath) {\n  const relativePath = path.relative(projectRoot, filePath);\n\n  for (const exclude of filesToExclude) {\n    if (relativePath.includes(exclude)) {\n      return false;\n    }\n  }\n\n  if (relativePath.startsWith('.env') && relativePath !== '.env.example' && relativePath !== '.env.production.example') {\n    return false;\n  }\n\n  return true;\n}\n\nfunction addDirectory(dirPath) {\n  const items = fs.readdirSync(dirPath);\n\n  for (const item of items) {\n    const fullPath = path.join(dirPath, item);\n\n    if (!shouldInclude(fullPath)) {\n      continue;\n    }\n\n    const stat = fs.statSync(fullPath);\n    const relativePath = path.relative(projectRoot, fullPath);\n\n    if (stat.isDirectory()) {\n      addDirectory(fullPath);\n    } else if (stat.isFile()) {\n      archive.file(fullPath, { name: relativePath });\n    }\n  }\n}\n\nconsole.log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ZIPã«è¿½åŠ ä¸­...');\naddDirectory(projectRoot);\n\narchive.finalize();\n",
  "scripts/generate-project-files.cjs": "const fs = require('fs');\nconst path = require('path');\n\nconst projectRoot = path.join(__dirname, '..');\nconst outputFile = path.join(projectRoot, 'src', 'lib', 'projectFiles.ts');\n\nconst excludePaths = [\n  'node_modules',\n  'dist',\n  '.git',\n  '.env',\n  '.env.local',\n  'package-lock.json',\n  'vite.config.ts.timestamp',\n  'src/lib/projectFiles.ts',\n  '.bolt',\n  'scripts/verify-production.sh'\n];\n\nconst excludeExtensions = [\n  '.md',\n  '.txt',\n  '.html'\n];\n\nfunction shouldExclude(filePath) {\n  if (excludePaths.some(exclude => filePath.includes(exclude))) {\n    return true;\n  }\n\n  const ext = path.extname(filePath);\n  if (excludeExtensions.includes(ext)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction readFilesRecursively(dir, baseDir = dir) {\n  const files = {};\n  \n  try {\n    const items = fs.readdirSync(dir);\n    \n    for (const item of items) {\n      const fullPath = path.join(dir, item);\n      const relativePath = path.relative(baseDir, fullPath);\n      \n      if (shouldExclude(fullPath)) {\n        continue;\n      }\n      \n      const stat = fs.statSync(fullPath);\n      \n      if (stat.isDirectory()) {\n        Object.assign(files, readFilesRecursively(fullPath, baseDir));\n      } else if (stat.isFile()) {\n        try {\n          const content = fs.readFileSync(fullPath, 'utf8');\n          files[relativePath] = content;\n        } catch (err) {\n          console.warn(`Warning: Could not read ${relativePath}`);\n        }\n      }\n    }\n  } catch (err) {\n    console.error(`Error reading directory ${dir}:`, err.message);\n  }\n  \n  return files;\n}\n\nconst allFiles = readFilesRecursively(projectRoot);\n\nconst tsContent = `// Auto-generated file containing all project files\n// Generated on: ${new Date().toISOString()}\n\nexport const projectFiles: Record<string, string> = ${JSON.stringify(allFiles, null, 2)};\n`;\n\nfs.writeFileSync(outputFile, tsContent, 'utf8');\nconsole.log(`Generated ${outputFile} with ${Object.keys(allFiles).length} files`);\n",
  "src/App.tsx": "import React from 'react'\nimport { Routes, Route, Navigate, useLocation } from 'react-router-dom'\nimport { MainLayout } from './layout/MainLayout'\nimport { LoginForm } from './components/Auth/LoginForm'\nimport { DashboardDaily } from './pages/DashboardDaily'\nimport { DashboardWeekly } from './pages/DashboardWeekly'\nimport { DashboardMonthly } from './pages/DashboardMonthly'\nimport { Targets } from './pages/Targets'\nimport { AIChatPage } from './pages/AIChatPage'\nimport { AdminSettings } from './pages/AdminSettings'\nimport { StaffManagement } from './pages/StaffManagement'\nimport { ReportForm } from './pages/ReportForm'\nimport { MonthlyExpenseForm } from './pages/MonthlyExpenseForm'\nimport { AIReportsPage } from './pages/AIReportsPage'\nimport { OrganizationSettings } from './pages/OrganizationSettings'\nimport { InvitationAccept } from './pages/InvitationAccept'\nimport SharedReport from './pages/SharedReport'\nimport { TermsOfService } from './pages/TermsOfService'\nimport { PrivacyPolicy } from './pages/PrivacyPolicy'\nimport { ProjectDownload } from './pages/ProjectDownload'\nimport { useAuth } from './contexts/AuthContext'\nimport { OrganizationProvider } from './contexts/OrganizationContext'\n\nconst Spinner: React.FC<{ msg?: string }> = ({ msg = 'èªè¨¼å‡¦ç†ä¸­ã§ã™...' }) => (\n  <div className=\"flex items-center justify-center min-h-screen bg-slate-50\">\n    <div className=\"text-center\">\n      <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4\"></div>\n      <p className=\"text-slate-600 text-lg\">{msg}</p>\n    </div>\n  </div>\n)\n\nconst AuthGate: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const { isInitialized, isAuthenticated } = useAuth()\n  const loc = useLocation()\n  const inCallback =\n    loc.pathname === '/auth/callback' ||\n    loc.search.includes('code=') || loc.search.includes('state=') ||\n    loc.hash.includes('access_token=')\n\n  if (!isInitialized || inCallback) return <Spinner />\n  if (!isAuthenticated) return <Navigate to=\"/login\" replace />\n  return <>{children}</>\n}\n\nexport default function App() {\n  const { isInitialized, isAuthenticated, user } = useAuth()\n  console.log('ğŸ¯ App render:', { isInitialized, isAuthenticated })\n\n  return (\n    <OrganizationProvider userId={user?.id || null}>\n      <Routes>\n        <Route path=\"/auth/callback\" element={<Spinner />} />\n\n        <Route path=\"/share/report/:shareToken\" element={<SharedReport />} />\n        <Route path=\"/invite/:token\" element={<InvitationAccept />} />\n        <Route path=\"/terms\" element={<TermsOfService />} />\n        <Route path=\"/privacy\" element={<PrivacyPolicy />} />\n        <Route path=\"/download\" element={<ProjectDownload />} />\n\n        <Route path=\"/login\" element={isAuthenticated ? <Navigate to=\"/dashboard/daily\" replace /> : <LoginForm />} />\n\n        <Route path=\"/\" element={<AuthGate><MainLayout /></AuthGate>}>\n          <Route index element={<Navigate to=\"/dashboard/daily\" replace />} />\n          <Route path=\"dashboard/daily\" element={<DashboardDaily />} />\n          <Route path=\"dashboard/weekly\" element={<DashboardWeekly />} />\n          <Route path=\"dashboard/monthly\" element={<DashboardMonthly />} />\n          <Route path=\"targets\" element={<Targets />} />\n          <Route path=\"chat\" element={<AIChatPage />} />\n          <Route path=\"ai-reports\" element={<AIReportsPage />} />\n          <Route path=\"admin\" element={<AdminSettings />} />\n          <Route path=\"staff\" element={<StaffManagement />} />\n          <Route path=\"organization\" element={<OrganizationSettings />} />\n          <Route path=\"report/new\" element={<ReportForm />} />\n          <Route path=\"report\" element={<ReportForm />} />\n          <Route path=\"expenses/monthly\" element={<MonthlyExpenseForm />} />\n        </Route>\n\n        <Route path=\"*\" element={<Navigate to={isAuthenticated ? '/dashboard/daily' : '/login'} replace />} />\n      </Routes>\n    </OrganizationProvider>\n  )\n}\n",
  "src/components/Admin/AIUsageLimitManagement.tsx": "import React, { useState, useEffect } from 'react'\nimport { Card, CardHeader, CardContent, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { supabase } from '@/lib/supabase'\nimport { Brain, Save, RotateCcw, AlertCircle } from 'lucide-react'\n\ninterface UsageSetting {\n  role: 'admin' | 'manager' | 'staff'\n  daily_limit: number\n  enabled: boolean\n}\n\ninterface UsageTracking {\n  user_id: string\n  user_name: string\n  user_role: string\n  usage_date: string\n  request_count: number\n}\n\nexport const AIUsageLimitManagement: React.FC = () => {\n  const [settings, setSettings] = useState<UsageSetting[]>([])\n  const [usageData, setUsageData] = useState<UsageTracking[]>([])\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null)\n\n  const loadSettings = async () => {\n    if (!supabase) return\n\n    try {\n      const { data, error } = await supabase\n        .from('ai_usage_settings')\n        .select('*')\n        .order('role')\n\n      if (error) throw error\n\n      setSettings(data || [])\n    } catch (err) {\n      console.error('Failed to load settings:', err)\n    }\n  }\n\n  const loadUsageData = async () => {\n    if (!supabase) return\n\n    try {\n      const today = new Date().toISOString().split('T')[0]\n\n      const { data, error } = await supabase\n        .from('ai_usage_tracking')\n        .select(`\n          user_id,\n          usage_date,\n          request_count,\n          profiles!inner(name, role)\n        `)\n        .eq('usage_date', today)\n        .order('request_count', { ascending: false })\n\n      if (error) throw error\n\n      const formatted = (data || []).map((item: any) => ({\n        user_id: item.user_id,\n        user_name: item.profiles?.name || 'ä¸æ˜',\n        user_role: item.profiles?.role || 'staff',\n        usage_date: item.usage_date,\n        request_count: item.request_count\n      }))\n\n      setUsageData(formatted)\n    } catch (err) {\n      console.error('Failed to load usage data:', err)\n    }\n  }\n\n  useEffect(() => {\n    const load = async () => {\n      setLoading(true)\n      await Promise.all([loadSettings(), loadUsageData()])\n      setLoading(false)\n    }\n    load()\n  }, [])\n\n  const handleSave = async () => {\n    if (!supabase) return\n\n    setSaving(true)\n    setMessage(null)\n\n    try {\n      for (const setting of settings) {\n        const { error } = await supabase\n          .from('ai_usage_settings')\n          .update({\n            daily_limit: setting.daily_limit,\n            enabled: setting.enabled\n          })\n          .eq('role', setting.role)\n\n        if (error) throw error\n      }\n\n      setMessage({ type: 'success', text: 'è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ' })\n      setTimeout(() => setMessage(null), 3000)\n    } catch (err) {\n      console.error('Failed to save settings:', err)\n      setMessage({ type: 'error', text: 'è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ' })\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleResetUser = async (userId: string, userName: string) => {\n    if (!supabase) return\n\n    if (!confirm(`${userName}ã•ã‚“ã®æœ¬æ—¥ã®ä½¿ç”¨å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ`)) {\n      return\n    }\n\n    try {\n      const { data, error } = await supabase.rpc('reset_user_daily_usage', {\n        p_user_id: userId\n      })\n\n      if (error) throw error\n\n      if (data?.success) {\n        setMessage({ type: 'success', text: `${userName}ã•ã‚“ã®ä½¿ç”¨å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ` })\n        await loadUsageData()\n        setTimeout(() => setMessage(null), 3000)\n      } else {\n        throw new Error(data?.message || 'ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ')\n      }\n    } catch (err) {\n      console.error('Failed to reset usage:', err)\n      setMessage({ type: 'error', text: `ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${err}` })\n    }\n  }\n\n  const updateSetting = (role: string, field: 'daily_limit' | 'enabled', value: number | boolean) => {\n    setSettings(prev =>\n      prev.map(s => (s.role === role ? { ...s, [field]: value } : s))\n    )\n  }\n\n  const getRoleLabel = (role: string) => {\n    switch (role) {\n      case 'admin':\n        return 'ç®¡ç†è€…'\n      case 'manager':\n        return 'åº—é•·'\n      case 'staff':\n        return 'ã‚¹ã‚¿ãƒƒãƒ•'\n      default:\n        return role\n    }\n  }\n\n  const getRoleBadgeColor = (role: string) => {\n    switch (role) {\n      case 'admin':\n        return 'bg-purple-100 text-purple-700 border-purple-300'\n      case 'manager':\n        return 'bg-blue-100 text-blue-700 border-blue-300'\n      case 'staff':\n        return 'bg-green-100 text-green-700 border-green-300'\n      default:\n        return 'bg-gray-100 text-gray-700 border-gray-300'\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <div className=\"text-center\">\n          <Brain className=\"w-8 h-8 animate-spin mx-auto mb-2 text-blue-600\" />\n          <p className=\"text-sm text-muted-foreground\">èª­ã¿è¾¼ã¿ä¸­...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {message && (\n        <div\n          className={`p-4 rounded-lg border ${\n            message.type === 'success'\n              ? 'bg-green-50 border-green-200 text-green-700'\n              : 'bg-red-50 border-red-200 text-red-700'\n          }`}\n        >\n          <div className=\"flex items-center gap-2\">\n            <AlertCircle className=\"w-4 h-4\" />\n            <span className=\"text-sm font-medium\">{message.text}</span>\n          </div>\n        </div>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Brain className=\"w-5 h-5 text-blue-600\" />\n            ãƒ­ãƒ¼ãƒ«åˆ¥AIä½¿ç”¨åˆ¶é™è¨­å®š\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <p className=\"text-sm text-muted-foreground\">\n            å„ãƒ­ãƒ¼ãƒ«ã”ã¨ã«1æ—¥ã‚ãŸã‚Šã®AIåˆ©ç”¨å›æ•°ã®ä¸Šé™ã‚’è¨­å®šã§ãã¾ã™ã€‚åˆå‰0æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚\n          </p>\n\n          {settings.map(setting => (\n            <div key={setting.role} className=\"p-4 border rounded-lg space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Badge className={getRoleBadgeColor(setting.role)}>\n                    {getRoleLabel(setting.role)}\n                  </Badge>\n                  <span className=\"text-sm font-medium\">\n                    {setting.role === 'admin' ? 'ï¼ˆç„¡åˆ¶é™å›ºå®šï¼‰' : ''}\n                  </span>\n                </div>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input\n                    type=\"checkbox\"\n                    checked={setting.enabled}\n                    onChange={e => updateSetting(setting.role, 'enabled', e.target.checked)}\n                    className=\"w-4 h-4 rounded border-gray-300\"\n                  />\n                  <span>åˆ¶é™ã‚’æœ‰åŠ¹åŒ–</span>\n                </label>\n              </div>\n\n              <div className=\"flex items-center gap-4\">\n                <label className=\"text-sm font-medium min-w-[100px]\">1æ—¥ã®ä¸Šé™:</label>\n                {setting.role === 'admin' ? (\n                  <div className=\"flex items-center gap-2\">\n                    <input\n                      type=\"text\"\n                      value=\"ç„¡åˆ¶é™\"\n                      disabled\n                      className=\"px-3 py-2 border rounded-md bg-gray-100 text-gray-600 w-32\"\n                    />\n                    <span className=\"text-xs text-muted-foreground\">\n                      ç®¡ç†è€…ã¯å¸¸ã«ç„¡åˆ¶é™ã§ã™\n                    </span>\n                  </div>\n                ) : (\n                  <div className=\"flex items-center gap-2\">\n                    <input\n                      type=\"number\"\n                      min=\"1\"\n                      max=\"1000\"\n                      value={setting.daily_limit}\n                      onChange={e =>\n                        updateSetting(setting.role, 'daily_limit', parseInt(e.target.value) || 1)\n                      }\n                      className=\"px-3 py-2 border rounded-md w-32\"\n                    />\n                    <span className=\"text-sm text-muted-foreground\">å› / æ—¥</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          ))}\n\n          <div className=\"flex gap-2 pt-4\">\n            <Button onClick={handleSave} disabled={saving} className=\"gap-2\">\n              <Save className=\"w-4 h-4\" />\n              {saving ? 'ä¿å­˜ä¸­...' : 'è¨­å®šã‚’ä¿å­˜'}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Brain className=\"w-5 h-5 text-blue-600\" />\n            æœ¬æ—¥ã®ä½¿ç”¨çŠ¶æ³\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {usageData.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <p className=\"text-sm\">æœ¬æ—¥ã®ä½¿ç”¨ãƒ‡ãƒ¼ã‚¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm\">\n                <thead className=\"border-b\">\n                  <tr className=\"text-left\">\n                    <th className=\"pb-2 font-medium\">ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>\n                    <th className=\"pb-2 font-medium\">ãƒ­ãƒ¼ãƒ«</th>\n                    <th className=\"pb-2 font-medium text-right\">ä½¿ç”¨å›æ•°</th>\n                    <th className=\"pb-2 font-medium text-right\">æ“ä½œ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {usageData.map(user => {\n                    const setting = settings.find(s => s.role === user.user_role)\n                    const limit = setting?.daily_limit || 0\n                    const isUnlimited = limit === -1\n\n                    return (\n                      <tr key={user.user_id} className=\"border-b\">\n                        <td className=\"py-3\">{user.user_name}</td>\n                        <td className=\"py-3\">\n                          <Badge className={getRoleBadgeColor(user.user_role)}>\n                            {getRoleLabel(user.user_role)}\n                          </Badge>\n                        </td>\n                        <td className=\"py-3 text-right\">\n                          <span\n                            className={\n                              !isUnlimited && user.request_count >= limit\n                                ? 'text-red-600 font-medium'\n                                : ''\n                            }\n                          >\n                            {user.request_count}å›\n                            {!isUnlimited && ` / ${limit}å›`}\n                          </span>\n                        </td>\n                        <td className=\"py-3 text-right\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handleResetUser(user.user_id, user.user_name)}\n                            className=\"gap-1\"\n                          >\n                            <RotateCcw className=\"w-3 h-3\" />\n                            ãƒªã‚»ãƒƒãƒˆ\n                          </Button>\n                        </td>\n                      </tr>\n                    )\n                  })}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
  "src/components/Admin/AuditLogViewer.tsx": "import React, { useState, useEffect } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport {\n  Shield,\n  Filter,\n  Download,\n  RefreshCw,\n  ChevronDown,\n  ChevronUp,\n  CheckCircle,\n  XCircle,\n  Search\n} from 'lucide-react'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { getCurrentUserOrganizationId } from '@/services/organizationService'\nimport {\n  getAuditLogs,\n  getAuditLogStats,\n  getActionLabel,\n  getResourceTypeLabel,\n  AuditLogEntry,\n  AuditLogFilters,\n  AuditAction,\n  ResourceType\n} from '@/services/auditLog'\nimport { format } from 'date-fns'\nimport { ja } from 'date-fns/locale'\n\nexport const AuditLogViewer: React.FC = () => {\n  const { user } = useAuth()\n  const [logs, setLogs] = useState<AuditLogEntry[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [expandedLog, setExpandedLog] = useState<string | null>(null)\n  const [filters, setFilters] = useState<AuditLogFilters>({\n    limit: 50,\n    offset: 0\n  })\n  const [stats, setStats] = useState({\n    totalLogs: 0,\n    successCount: 0,\n    failureCount: 0\n  })\n\n  const [searchTerm, setSearchTerm] = useState('')\n  const [selectedAction, setSelectedAction] = useState<AuditAction | ''>('')\n  const [selectedResourceType, setSelectedResourceType] = useState<ResourceType | ''>('')\n  const [selectedStatus, setSelectedStatus] = useState<'success' | 'failure' | ''>('')\n\n  useEffect(() => {\n    loadLogs()\n    loadStats()\n  }, [user, filters])\n\n  const loadLogs = async () => {\n    if (!user?.id) return\n\n    try {\n      setLoading(true)\n      setError(null)\n\n      const organizationId = await getCurrentUserOrganizationId(user.id)\n      if (!organizationId) {\n        setError('çµ„ç¹”ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')\n        return\n      }\n\n      const { data, error: fetchError } = await getAuditLogs(organizationId, filters)\n\n      if (fetchError) {\n        setError('ç›£æŸ»ãƒ­ã‚°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n\n      setLogs(data || [])\n    } catch (err) {\n      setError('ç›£æŸ»ãƒ­ã‚°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadStats = async () => {\n    if (!user?.id) return\n\n    const organizationId = await getCurrentUserOrganizationId(user.id)\n    if (!organizationId) return\n\n    const statsData = await getAuditLogStats(organizationId)\n    setStats(statsData)\n  }\n\n  const applyFilters = () => {\n    setFilters({\n      ...filters,\n      action: selectedAction || undefined,\n      resourceType: selectedResourceType || undefined,\n      status: selectedStatus || undefined,\n      offset: 0\n    })\n  }\n\n  const clearFilters = () => {\n    setSelectedAction('')\n    setSelectedResourceType('')\n    setSelectedStatus('')\n    setSearchTerm('')\n    setFilters({\n      limit: 50,\n      offset: 0\n    })\n  }\n\n  const exportLogs = () => {\n    const csv = [\n      ['æ—¥æ™‚', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ID', 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³', 'ãƒªã‚½ãƒ¼ã‚¹', 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'è©³ç´°'].join(','),\n      ...logs.map((log) =>\n        [\n          format(new Date(log.created_at), 'yyyy-MM-dd HH:mm:ss'),\n          log.user_id || 'ã‚·ã‚¹ãƒ†ãƒ ',\n          getActionLabel(log.action),\n          `${getResourceTypeLabel(log.resource_type)} (${log.resource_id || 'N/A'})`,\n          log.status === 'success' ? 'æˆåŠŸ' : 'å¤±æ•—',\n          JSON.stringify(log.details)\n        ].join(',')\n      )\n    ].join('\\n')\n\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' })\n    const link = document.createElement('a')\n    link.href = URL.createObjectURL(blob)\n    link.download = `audit-logs-${format(new Date(), 'yyyy-MM-dd')}.csv`\n    link.click()\n  }\n\n  const filteredLogs = logs.filter((log) => {\n    if (searchTerm) {\n      const term = searchTerm.toLowerCase()\n      return (\n        log.action.toLowerCase().includes(term) ||\n        log.resource_type.toLowerCase().includes(term) ||\n        log.resource_id?.toLowerCase().includes(term) ||\n        log.user_id?.toLowerCase().includes(term)\n      )\n    }\n    return true\n  })\n\n  const actions: AuditAction[] = [\n    'user.created',\n    'user.updated',\n    'user.deleted',\n    'user.invited',\n    'user.role_changed',\n    'store.created',\n    'store.updated',\n    'store.deleted',\n    'report.created',\n    'report.updated',\n    'report.deleted',\n    'organization.updated'\n  ]\n\n  const resourceTypes: ResourceType[] = ['user', 'store', 'report', 'organization', 'auth']\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-slate-600\">ç·ãƒ­ã‚°æ•°</p>\n                <p className=\"text-2xl font-bold text-slate-900\">{stats.totalLogs}</p>\n              </div>\n              <Shield className=\"w-8 h-8 text-blue-600\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-slate-600\">æˆåŠŸ</p>\n                <p className=\"text-2xl font-bold text-green-600\">{stats.successCount}</p>\n              </div>\n              <CheckCircle className=\"w-8 h-8 text-green-600\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-slate-600\">å¤±æ•—</p>\n                <p className=\"text-2xl font-bold text-red-600\">{stats.failureCount}</p>\n              </div>\n              <XCircle className=\"w-8 h-8 text-red-600\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Shield className=\"w-5 h-5\" />\n              ç›£æŸ»ãƒ­ã‚°\n            </CardTitle>\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={loadLogs}\n                disabled={loading}\n                className=\"bg-slate-600 hover:bg-slate-700 text-white\"\n                size=\"sm\"\n              >\n                <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n                æ›´æ–°\n              </Button>\n              <Button\n                onClick={exportLogs}\n                disabled={logs.length === 0}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                size=\"sm\"\n              >\n                <Download className=\"w-4 h-4 mr-2\" />\n                ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          <div className=\"space-y-4\">\n            <div className=\"bg-slate-50 border border-slate-200 rounded-lg p-4\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <Filter className=\"w-4 h-4 text-slate-600\" />\n                <span className=\"font-medium text-slate-700\">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</span>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3 mb-3\">\n                <div>\n                  <label className=\"block text-xs font-medium text-slate-700 mb-1\">\n                    æ¤œç´¢\n                  </label>\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400\" />\n                    <input\n                      type=\"text\"\n                      value={searchTerm}\n                      onChange={(e) => setSearchTerm(e.target.value)}\n                      placeholder=\"æ¤œç´¢...\"\n                      className=\"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg text-sm\"\n                    />\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-slate-700 mb-1\">\n                    ã‚¢ã‚¯ã‚·ãƒ§ãƒ³\n                  </label>\n                  <select\n                    value={selectedAction}\n                    onChange={(e) => setSelectedAction(e.target.value as AuditAction | '')}\n                    className=\"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm\"\n                  >\n                    <option value=\"\">ã™ã¹ã¦</option>\n                    {actions.map((action) => (\n                      <option key={action} value={action}>\n                        {getActionLabel(action)}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-slate-700 mb-1\">\n                    ãƒªã‚½ãƒ¼ã‚¹\n                  </label>\n                  <select\n                    value={selectedResourceType}\n                    onChange={(e) =>\n                      setSelectedResourceType(e.target.value as ResourceType | '')\n                    }\n                    className=\"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm\"\n                  >\n                    <option value=\"\">ã™ã¹ã¦</option>\n                    {resourceTypes.map((type) => (\n                      <option key={type} value={type}>\n                        {getResourceTypeLabel(type)}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-slate-700 mb-1\">\n                    ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹\n                  </label>\n                  <select\n                    value={selectedStatus}\n                    onChange={(e) =>\n                      setSelectedStatus(e.target.value as 'success' | 'failure' | '')\n                    }\n                    className=\"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm\"\n                  >\n                    <option value=\"\">ã™ã¹ã¦</option>\n                    <option value=\"success\">æˆåŠŸ</option>\n                    <option value=\"failure\">å¤±æ•—</option>\n                  </select>\n                </div>\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Button\n                  onClick={applyFilters}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                  size=\"sm\"\n                >\n                  ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨\n                </Button>\n                <Button\n                  onClick={clearFilters}\n                  className=\"bg-slate-200 hover:bg-slate-300 text-slate-700\"\n                  size=\"sm\"\n                >\n                  ã‚¯ãƒªã‚¢\n                </Button>\n              </div>\n            </div>\n\n            {loading ? (\n              <div className=\"text-center py-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n                <p className=\"text-sm text-slate-600 mt-2\">èª­ã¿è¾¼ã¿ä¸­...</p>\n              </div>\n            ) : error ? (\n              <div className=\"text-center py-8\">\n                <p className=\"text-red-600\">{error}</p>\n              </div>\n            ) : filteredLogs.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <p className=\"text-slate-600\">ç›£æŸ»ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“</p>\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {filteredLogs.map((log) => (\n                  <div\n                    key={log.id}\n                    className=\"border border-slate-200 rounded-lg hover:border-slate-300 transition-colors\"\n                  >\n                    <div\n                      className=\"p-4 cursor-pointer\"\n                      onClick={() =>\n                        setExpandedLog(expandedLog === log.id ? null : log.id)\n                      }\n                    >\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            <span className=\"font-medium text-slate-900\">\n                              {getActionLabel(log.action)}\n                            </span>\n                            <span\n                              className={`px-2 py-0.5 rounded-full text-xs font-medium ${\n                                log.status === 'success'\n                                  ? 'bg-green-100 text-green-700'\n                                  : 'bg-red-100 text-red-700'\n                              }`}\n                            >\n                              {log.status === 'success' ? 'æˆåŠŸ' : 'å¤±æ•—'}\n                            </span>\n                          </div>\n                          <div className=\"text-sm text-slate-600\">\n                            <span>\n                              {getResourceTypeLabel(log.resource_type)}\n                              {log.resource_id && ` (ID: ${log.resource_id})`}\n                            </span>\n                            <span className=\"mx-2\">â€¢</span>\n                            <span>\n                              {format(new Date(log.created_at), 'yyyy/MM/dd HH:mm:ss', {\n                                locale: ja\n                              })}\n                            </span>\n                          </div>\n                        </div>\n                        {expandedLog === log.id ? (\n                          <ChevronUp className=\"w-5 h-5 text-slate-400\" />\n                        ) : (\n                          <ChevronDown className=\"w-5 h-5 text-slate-400\" />\n                        )}\n                      </div>\n                    </div>\n\n                    {expandedLog === log.id && (\n                      <div className=\"border-t border-slate-200 p-4 bg-slate-50\">\n                        <div className=\"space-y-2 text-sm\">\n                          {log.user_id && (\n                            <div>\n                              <span className=\"font-medium text-slate-700\">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</span>\n                              <span className=\"ml-2 text-slate-600\">{log.user_id}</span>\n                            </div>\n                          )}\n                          {log.error_message && (\n                            <div>\n                              <span className=\"font-medium text-red-700\">ã‚¨ãƒ©ãƒ¼:</span>\n                              <span className=\"ml-2 text-red-600\">{log.error_message}</span>\n                            </div>\n                          )}\n                          {Object.keys(log.details).length > 0 && (\n                            <div>\n                              <span className=\"font-medium text-slate-700\">è©³ç´°:</span>\n                              <pre className=\"mt-1 p-2 bg-white border border-slate-200 rounded text-xs overflow-x-auto\">\n                                {JSON.stringify(log.details, null, 2)}\n                              </pre>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
  "src/components/Admin/ReportSchedulesManager.tsx": "import { useState } from 'react';\nimport { Calendar, Plus, Edit2, Trash2, Power, PowerOff, Loader2 } from 'lucide-react';\nimport { useReportSchedules, ReportSchedule } from '../../hooks/useAIReports';\nimport { useStores } from '../../hooks/useStores';\nimport { Card } from '../ui/card';\nimport { Button } from '../ui/button';\nimport { Badge } from '../ui/badge';\n\nexport function ReportSchedulesManager() {\n  const { schedules, loading, createSchedule, updateSchedule, deleteSchedule, refetch } = useReportSchedules();\n  const { stores } = useStores();\n  const [showCreateDialog, setShowCreateDialog] = useState(false);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-blue-600\" />\n      </div>\n    );\n  }\n\n  const toggleSchedule = async (schedule: ReportSchedule) => {\n    await updateSchedule(schedule.id, { is_enabled: !schedule.is_enabled });\n  };\n\n  const handleDelete = async (id: string) => {\n    if (window.confirm('ã“ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹?')) {\n      await deleteSchedule(id);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 flex items-center\">\n            <Calendar className=\"w-6 h-6 mr-3\" />\n            ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«\n          </h2>\n          <p className=\"text-gray-600 mt-1\">\n            é€±æ¬¡ãƒ»æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã®è‡ªå‹•ç”Ÿæˆã‚’è¨­å®šã—ã¾ã™\n          </p>\n        </div>\n\n        <Button onClick={() => setShowCreateDialog(true)}>\n          <Plus className=\"w-4 h-4 mr-2\" />\n          ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ \n        </Button>\n      </div>\n\n      {schedules.length === 0 ? (\n        <Card className=\"p-12 text-center\">\n          <Calendar className=\"w-16 h-16 mx-auto text-gray-300 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n            ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“\n          </h3>\n          <p className=\"text-gray-500 mb-6\">\n            è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„\n          </p>\n          <Button onClick={() => setShowCreateDialog(true)}>\n            <Plus className=\"w-4 h-4 mr-2\" />\n            æœ€åˆã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ \n          </Button>\n        </Card>\n      ) : (\n        <div className=\"space-y-4\">\n          {schedules.map((schedule) => {\n            const storeName = schedule.store_id\n              ? stores.find((s) => s.id === schedule.store_id)?.name || 'ä¸æ˜ãªåº—èˆ—'\n              : 'å…¨åº—èˆ—';\n\n            return (\n              <Card key={schedule.id} className=\"p-6\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-3 mb-3\">\n                      <Badge variant={schedule.report_type === 'weekly' ? 'default' : 'secondary'}>\n                        {schedule.report_type === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡'}\n                      </Badge>\n                      <Badge variant={schedule.is_enabled ? 'default' : 'secondary'}>\n                        {schedule.is_enabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}\n                      </Badge>\n                      <span className=\"text-sm text-gray-500\">{storeName}</span>\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                      <div>\n                        <span className=\"text-gray-600\">Cronå¼:</span>\n                        <span className=\"ml-2 font-mono text-gray-900\">\n                          {schedule.cron_expression}\n                        </span>\n                      </div>\n\n                      {schedule.last_run_at && (\n                        <div>\n                          <span className=\"text-gray-600\">å‰å›å®Ÿè¡Œ:</span>\n                          <span className=\"ml-2 text-gray-900\">\n                            {new Date(schedule.last_run_at).toLocaleString('ja-JP')}\n                          </span>\n                        </div>\n                      )}\n\n                      {schedule.next_run_at && (\n                        <div>\n                          <span className=\"text-gray-600\">æ¬¡å›å®Ÿè¡Œ:</span>\n                          <span className=\"ml-2 text-gray-900\">\n                            {new Date(schedule.next_run_at).toLocaleString('ja-JP')}\n                          </span>\n                        </div>\n                      )}\n\n                      {schedule.notification_emails.length > 0 && (\n                        <div>\n                          <span className=\"text-gray-600\">é€šçŸ¥å…ˆ:</span>\n                          <span className=\"ml-2 text-gray-900\">\n                            {schedule.notification_emails.join(', ')}\n                          </span>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center gap-2 ml-4\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => toggleSchedule(schedule)}\n                    >\n                      {schedule.is_enabled ? (\n                        <PowerOff className=\"w-4 h-4\" />\n                      ) : (\n                        <Power className=\"w-4 h-4\" />\n                      )}\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => handleDelete(schedule.id)}\n                      className=\"text-red-600 hover:text-red-700\"\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n\n      {showCreateDialog && (\n        <CreateScheduleDialog\n          stores={stores}\n          onClose={() => setShowCreateDialog(false)}\n          onCreate={async (data) => {\n            await createSchedule(data);\n            setShowCreateDialog(false);\n            refetch();\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\ninterface CreateScheduleDialogProps {\n  stores: Array<{ id: string; name: string }>;\n  onClose: () => void;\n  onCreate: (data: Omit<ReportSchedule, 'id' | 'created_at' | 'updated_at' | 'last_run_at' | 'next_run_at'>) => void;\n}\n\nfunction CreateScheduleDialog({ stores, onClose, onCreate }: CreateScheduleDialogProps) {\n  const [reportType, setReportType] = useState<'weekly' | 'monthly'>('weekly');\n  const [storeId, setStoreId] = useState<string>('all');\n  const [emails, setEmails] = useState<string>('');\n\n  const handleSubmit = () => {\n    const cronExpression = reportType === 'weekly' ? '0 6 * * 1' : '0 6 1 * *';\n\n    onCreate({\n      report_type: reportType,\n      store_id: storeId === 'all' ? null : storeId,\n      is_enabled: true,\n      cron_expression: cronExpression,\n      notification_emails: emails.split(',').map((e) => e.trim()).filter(Boolean),\n    });\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <Card className=\"max-w-md w-full p-6\">\n        <h3 className=\"text-xl font-bold text-gray-900 mb-6\">\n          ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ \n        </h3>\n\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              ãƒ¬ãƒãƒ¼ãƒˆç¨®åˆ¥\n            </label>\n            <select\n              value={reportType}\n              onChange={(e) => setReportType(e.target.value as 'weekly' | 'monthly')}\n              className=\"w-full p-2 border border-gray-300 rounded-lg\"\n            >\n              <option value=\"weekly\">é€±æ¬¡ (æ¯é€±æœˆæ›œ 6:00)</option>\n              <option value=\"monthly\">æœˆæ¬¡ (æ¯æœˆ1æ—¥ 6:00)</option>\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              å¯¾è±¡åº—èˆ—\n            </label>\n            <select\n              value={storeId}\n              onChange={(e) => setStoreId(e.target.value)}\n              className=\"w-full p-2 border border-gray-300 rounded-lg\"\n            >\n              <option value=\"all\">å…¨åº—èˆ—</option>\n              {stores.map((store) => (\n                <option key={store.id} value={store.id}>\n                  {store.name}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              é€šçŸ¥å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)\n            </label>\n            <input\n              type=\"text\"\n              value={emails}\n              onChange={(e) => setEmails(e.target.value)}\n              placeholder=\"email1@example.com, email2@example.com\"\n              className=\"w-full p-2 border border-gray-300 rounded-lg\"\n            />\n          </div>\n\n          <div className=\"flex gap-3 pt-4\">\n            <Button variant=\"outline\" onClick={onClose} className=\"flex-1\">\n              ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n            </Button>\n            <Button onClick={handleSubmit} className=\"flex-1\">\n              ä½œæˆ\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n",
  "src/components/Auth/LoginForm.tsx": "import React, { useState } from 'react';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { User, Mail, Lock } from 'lucide-react';\n\nexport const LoginForm: React.FC = () => {\n  const { signIn, signUp } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [isSignUp, setIsSignUp] = useState(false);\n\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [name, setName] = useState('');\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!email || !password || (isSignUp && !name)) {\n      setError('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError('');\n\n      if (isSignUp) {\n        const { error: signUpError } = await signUp(email, password, name, 'staff');\n        if (signUpError) {\n          setError(signUpError.message);\n        }\n      } else {\n        const { error: signInError } = await signIn(email, password);\n        if (signInError) {\n          setError(signInError.message);\n        }\n      }\n    } catch (err) {\n      console.error('Auth error:', err);\n      setError('èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 py-12 px-4\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div className=\"text-center\">\n          <div className=\"mx-auto h-16 w-16 flex items-center justify-center rounded-full bg-gradient-to-br from-blue-600 to-blue-700 shadow-lg\">\n            <User className=\"h-8 w-8 text-white\" />\n          </div>\n          <h2 className=\"mt-6 text-center text-3xl font-bold text-gray-900\">\n            æ¥­å‹™å ±å‘Šã‚·ã‚¹ãƒ†ãƒ \n          </h2>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            {isSignUp ? 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ' : 'ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„'}\n          </p>\n        </div>\n\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n            <p className=\"text-sm text-red-600\">{error}</p>\n          </div>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"mt-8 space-y-6\">\n          <div className=\"space-y-4\">\n            {isSignUp && (\n              <div>\n                <label htmlFor=\"name\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  åå‰\n                </label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n                  <input\n                    id=\"name\"\n                    type=\"text\"\n                    value={name}\n                    onChange={(e) => setName(e.target.value)}\n                    className=\"pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    placeholder=\"å±±ç”° å¤ªéƒ\"\n                  />\n                </div>\n              </div>\n            )}\n\n            <div>\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹\n              </label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n                <input\n                  id=\"email\"\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  className=\"pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"you@example.com\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰\n              </label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n                <input\n                  id=\"password\"\n                  type=\"password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  className=\"pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full flex justify-center py-3 px-4 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors shadow-md\"\n          >\n            {loading ? (\n              <div className=\"flex items-center\">\n                <div className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\"></div>\n                å‡¦ç†ä¸­...\n              </div>\n            ) : (\n              <>{isSignUp ? 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ' : 'ãƒ­ã‚°ã‚¤ãƒ³'}</>\n            )}\n          </button>\n        </form>\n\n        <div className=\"text-center\">\n          <button\n            onClick={() => {\n              setIsSignUp(!isSignUp);\n              setError('');\n            }}\n            className=\"text-sm text-blue-600 hover:text-blue-700 font-medium\"\n          >\n            {isSignUp ? 'ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹ã¯ãƒ­ã‚°ã‚¤ãƒ³' : 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ–°è¦ä½œæˆ'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};",
  "src/components/Charts/ExpenseChart.tsx": "import React from 'react';\nimport {\n  Chart as ChartJS,\n  ArcElement,\n  Tooltip,\n  Legend,\n} from 'chart.js';\nimport { Pie } from 'react-chartjs-2';\nimport { DailyReport } from '../../types';\n\nChartJS.register(ArcElement, Tooltip, Legend);\n\ninterface ExpenseChartProps {\n  reports: DailyReport[];\n}\n\nexport const ExpenseChart: React.FC<ExpenseChartProps> = ({ reports }) => {\n  // ç›´è¿‘7æ—¥é–“ã®å ±å‘Šã‹ã‚‰çµŒè²»ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ\n  const recentReports = reports.slice(0, 10); // æœ€æ–°10ä»¶\n  \n  const expenseData = recentReports.reduce((acc, report) => {\n    acc.purchase += report.purchase;\n    acc.laborCost += report.laborCost;\n    acc.utilities += report.utilities;\n    acc.promotion += report.promotion;\n    acc.cleaning += report.cleaning;\n    acc.misc += report.misc;\n    acc.communication += report.communication;\n    acc.others += report.others;\n    return acc;\n  }, {\n    purchase: 0,\n    laborCost: 0,\n    utilities: 0,\n    promotion: 0,\n    cleaning: 0,\n    misc: 0,\n    communication: 0,\n    others: 0\n  });\n\n  const totalExpenses = Object.values(expenseData).reduce((sum, val) => sum + val, 0);\n\n  if (totalExpenses === 0) {\n    return (\n      <div className=\"bg-white rounded-lg border border-gray-200 p-12 text-center\">\n        <div className=\"text-gray-400 mb-4\">\n          <svg className=\"mx-auto h-12 w-12\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z\" />\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z\" />\n          </svg>\n        </div>\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">çµŒè²»ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>\n        <p className=\"text-gray-500\">çµŒè²»ã‚’å«ã‚€å ±å‘Šã‚’ä½œæˆã™ã‚‹ã¨ãƒãƒ£ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>\n      </div>\n    );\n  }\n\n  const data = {\n    labels: ['ä»•å…¥', 'äººä»¶è²»', 'å…‰ç†±è²»', 'åºƒå‘Šè²»', 'æ¸…æƒè²»', 'é›‘è²»', 'é€šä¿¡è²»', 'ãã®ä»–'],\n    datasets: [\n      {\n        data: [\n          expenseData.purchase,\n          expenseData.laborCost,\n          expenseData.utilities,\n          expenseData.promotion,\n          expenseData.cleaning,\n          expenseData.misc,\n          expenseData.communication,\n          expenseData.others\n        ],\n        backgroundColor: [\n          'rgba(239, 68, 68, 0.8)',\n          'rgba(245, 158, 11, 0.8)',\n          'rgba(59, 130, 246, 0.8)',\n          'rgba(16, 185, 129, 0.8)',\n          'rgba(139, 92, 246, 0.8)',\n          'rgba(236, 72, 153, 0.8)',\n          'rgba(34, 197, 94, 0.8)',\n          'rgba(156, 163, 175, 0.8)'\n        ],\n        borderColor: [\n          'rgb(239, 68, 68)',\n          'rgb(245, 158, 11)',\n          'rgb(59, 130, 246)',\n          'rgb(16, 185, 129)',\n          'rgb(139, 92, 246)',\n          'rgb(236, 72, 153)',\n          'rgb(34, 197, 94)',\n          'rgb(156, 163, 175)'\n        ],\n        borderWidth: 2,\n      }\n    ]\n  };\n\n  const options = {\n    responsive: true,\n    plugins: {\n      legend: {\n        position: 'right' as const,\n      },\n      title: {\n        display: true,\n        text: 'çµŒè²»å†…è¨³ï¼ˆæœ€æ–°ãƒ‡ãƒ¼ã‚¿ï¼‰',\n        font: {\n          size: 16,\n          weight: 'bold' as const,\n        }\n      },\n      tooltip: {\n        callbacks: {\n          label: function(context: any) {\n            const value = context.raw;\n            const total = context.dataset.data.reduce((a: number, b: number) => a + b, 0);\n            const percentage = ((value / total) * 100).toFixed(1);\n            return `${context.label}: Â¥${value.toLocaleString()} (${percentage}%)`;\n          }\n        }\n      }\n    }\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n      <Pie data={data} options={options} />\n    </div>\n  );\n};",
  "src/components/Charts/RechartsComponents.tsx": "import React from 'react';\nimport {\n  AreaChart,\n  Area,\n  BarChart,\n  Bar,\n  PieChart,\n  Pie,\n  Cell,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  Legend\n} from 'recharts';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { formatCurrency, formatPercent } from '@/lib/utils';\nimport { DailyReport } from '@/types';\n\ninterface SalesChartProps {\n  reports: DailyReport[];\n  period?: 'daily' | 'weekly' | 'monthly';\n  onPeriodChange?: (period: 'daily' | 'weekly' | 'monthly') => void;\n}\n\nexport const SalesChart: React.FC<SalesChartProps> = ({ \n  reports, \n  period = 'daily',\n  onPeriodChange \n}) => {\n  // ãƒ‡ãƒ¼ã‚¿ã‚’æœŸé–“åˆ¥ã«é›†è¨ˆ\n  const chartData = React.useMemo(() => {\n    const groupedData = new Map();\n    \n    reports.forEach(report => {\n      const date = new Date(report.date);\n      let key: string;\n      \n      switch (period) {\n        case 'daily':\n          key = date.toISOString().split('T')[0];\n          break;\n        case 'weekly':\n          const weekStart = new Date(date);\n          weekStart.setDate(date.getDate() - date.getDay());\n          key = weekStart.toISOString().split('T')[0];\n          break;\n        case 'monthly':\n          key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n          break;\n        default:\n          key = date.toISOString().split('T')[0];\n      }\n      \n      if (!groupedData.has(key)) {\n        groupedData.set(key, { \n          date: key, \n          sales: 0, \n          expenses: 0, \n          profit: 0,\n          storeCount: new Set()\n        });\n      }\n      \n      const data = groupedData.get(key);\n      const totalExpenses = report.purchase + report.laborCost + report.utilities + \n                           report.promotion + report.cleaning + report.misc + \n                           report.communication + report.others;\n      \n      data.sales += report.sales;\n      data.expenses += totalExpenses;\n      data.profit = data.sales - data.expenses;\n      data.storeCount.add(report.storeId);\n    });\n    \n    return Array.from(groupedData.values())\n      .map(item => ({\n        ...item,\n        storeCount: item.storeCount.size\n      }))\n      .sort((a, b) => a.date.localeCompare(b.date))\n      .slice(-30); // æœ€æ–°30ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ\n  }, [reports, period]);\n\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr);\n    switch (period) {\n      case 'daily':\n        return date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' });\n      case 'weekly':\n        return `${date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })}é€±`;\n      case 'monthly':\n        return date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'short' });\n      default:\n        return dateStr;\n    }\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg font-semibold\">å£²ä¸Šæ¨ç§»</CardTitle>\n          {onPeriodChange && (\n            <Tabs value={period} onValueChange={(value) => onPeriodChange(value as any)}>\n              <TabsList>\n                <TabsTrigger value=\"daily\">æ—¥æ¬¡</TabsTrigger>\n                <TabsTrigger value=\"weekly\">é€±æ¬¡</TabsTrigger>\n                <TabsTrigger value=\"monthly\">æœˆæ¬¡</TabsTrigger>\n              </TabsList>\n            </Tabs>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        <ResponsiveContainer width=\"100%\" height={300}>\n          <AreaChart data={chartData}>\n            <defs>\n              <linearGradient id=\"salesGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3}/>\n                <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0}/>\n              </linearGradient>\n              <linearGradient id=\"profitGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                <stop offset=\"5%\" stopColor=\"#10b981\" stopOpacity={0.3}/>\n                <stop offset=\"95%\" stopColor=\"#10b981\" stopOpacity={0}/>\n              </linearGradient>\n            </defs>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n            <XAxis \n              dataKey=\"date\" \n              tickFormatter={formatDate}\n              tick={{ fontSize: 12, fill: '#6b7280' }}\n            />\n            <YAxis \n              tickFormatter={(value) => formatCurrency(value)}\n              tick={{ fontSize: 12, fill: '#6b7280' }}\n            />\n            <Tooltip \n              formatter={(value: number, name: string) => [\n                formatCurrency(value),\n                name === 'sales' ? 'å£²ä¸Š' : name === 'expenses' ? 'çµŒè²»' : 'åˆ©ç›Š'\n              ]}\n              labelFormatter={(label) => formatDate(label)}\n            />\n            <Area \n              type=\"monotone\" \n              dataKey=\"sales\" \n              stackId=\"1\"\n              stroke=\"#3b82f6\" \n              fill=\"url(#salesGradient)\"\n              strokeWidth={2}\n            />\n            <Area \n              type=\"monotone\" \n              dataKey=\"profit\" \n              stackId=\"2\"\n              stroke=\"#10b981\" \n              fill=\"url(#profitGradient)\"\n              strokeWidth={2}\n            />\n          </AreaChart>\n        </ResponsiveContainer>\n      </CardContent>\n    </Card>\n  );\n};\n\ninterface ExpenseChartProps {\n  reports: DailyReport[];\n  period?: 'daily' | 'weekly' | 'monthly';\n}\n\nexport const ExpenseChart: React.FC<ExpenseChartProps> = ({ reports, period = 'monthly' }) => {\n  const expenseData = React.useMemo(() => {\n    // å…¨åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆè¨ˆ\n    const totals = reports.reduce((acc, report) => ({\n      purchase: acc.purchase + report.purchase,\n      laborCost: acc.laborCost + report.laborCost,\n      utilities: acc.utilities + report.utilities,\n      promotion: acc.promotion + report.promotion,\n      cleaning: acc.cleaning + report.cleaning,\n      misc: acc.misc + report.misc,\n      communication: acc.communication + report.communication,\n      others: acc.others + report.others\n    }), {\n      purchase: 0,\n      laborCost: 0,\n      utilities: 0,\n      promotion: 0,\n      cleaning: 0,\n      misc: 0,\n      communication: 0,\n      others: 0\n    });\n\n    return [\n      { name: 'ä»•å…¥', value: totals.purchase, color: '#ef4444' },\n      { name: 'äººä»¶è²»', value: totals.laborCost, color: '#f97316' },\n      { name: 'å…‰ç†±è²»', value: totals.utilities, color: '#3b82f6' },\n      { name: 'è²©ä¿ƒè²»', value: totals.promotion, color: '#10b981' },\n      { name: 'æ¸…æƒè²»', value: totals.cleaning, color: '#8b5cf6' },\n      { name: 'é€šä¿¡è²»', value: totals.communication, color: '#06b6d4' },\n      { name: 'é›‘è²»', value: totals.misc, color: '#f59e0b' },\n      { name: 'ãã®ä»–', value: totals.others, color: '#6b7280' }\n    ].filter(item => item.value > 0);\n  }, [reports, period]);\n\n  const total = expenseData.reduce((sum, item) => sum + item.value, 0);\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-lg font-semibold\">çµŒè²»å†…è¨³</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <ResponsiveContainer width=\"100%\" height={300}>\n          <PieChart>\n            <Pie\n              data={expenseData}\n              dataKey=\"value\"\n              nameKey=\"name\"\n              cx=\"50%\"\n              cy=\"50%\"\n              outerRadius={100}\n              innerRadius={40}\n            >\n              {expenseData.map((entry, index) => (\n                <Cell key={`cell-${index}`} fill={entry.color} />\n              ))}\n            </Pie>\n            <Tooltip \n              formatter={(value: number) => [\n                formatCurrency(value),\n                `${((value / total) * 100).toFixed(1)}%`\n              ]}\n            />\n            <Legend \n              formatter={(value, entry) => `${value} (${formatCurrency(entry.payload?.value || 0)})`}\n              wrapperStyle={{ fontSize: '12px' }}\n            />\n          </PieChart>\n        </ResponsiveContainer>\n      </CardContent>\n    </Card>\n  );\n};",
  "src/components/Charts/SalesChart.tsx": "import React from 'react';\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  BarElement,\n  LineElement,\n  PointElement,\n  Title,\n  Tooltip,\n  Legend,\n} from 'chart.js';\nimport { Bar } from 'react-chartjs-2';\nimport { DailyReport } from '../../types';\nimport { formatDate, formatCurrency } from '../../utils/calculations';\n\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  BarElement,\n  LineElement,\n  PointElement,\n  Title,\n  Tooltip,\n  Legend\n);\n\ninterface SalesChartProps {\n  reports: DailyReport[];\n  targetSales?: number;\n}\n\nexport const SalesChart: React.FC<SalesChartProps> = ({ reports, targetSales }) => {\n  // æ—¥ä»˜åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦é›†è¨ˆ\n  const groupedData = reports.reduce((acc, report) => {\n    if (!acc[report.date]) {\n      acc[report.date] = { sales: 0, expenses: 0 };\n    }\n    acc[report.date].sales += report.sales;\n    acc[report.date].expenses += (report.purchase + report.laborCost + report.utilities + \n      report.promotion + report.cleaning + report.misc + report.communication + report.others);\n    return acc;\n  }, {} as Record<string, { sales: number; expenses: number }>);\n\n  const sortedDates = Object.keys(groupedData).sort();\n  const salesData = sortedDates.map(date => groupedData[date].sales);\n  const profitData = sortedDates.map(date => groupedData[date].sales - groupedData[date].expenses);\n\n  if (sortedDates.length === 0) {\n    return (\n      <div className=\"bg-white rounded-lg border border-gray-200 p-12 text-center\">\n        <div className=\"text-gray-400 mb-4\">\n          <svg className=\"mx-auto h-12 w-12\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\n          </svg>\n        </div>\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>\n        <p className=\"text-gray-500\">å ±å‘Šã‚’ä½œæˆã™ã‚‹ã¨ãƒãƒ£ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>\n      </div>\n    );\n  }\n\n  // ç›®æ¨™ãƒ©ã‚¤ãƒ³ç”¨ãƒ‡ãƒ¼ã‚¿\n  const targetLineData = targetSales && sortedDates.length > 0 \n    ? sortedDates.map(() => targetSales / sortedDates.length) // æ—¥å‰²ã‚Šç›®æ¨™\n    : null;\n\n  const datasets = [\n    {\n      label: 'å£²ä¸Š',\n      data: salesData,\n      backgroundColor: 'rgba(59, 130, 246, 0.8)',\n      borderColor: 'rgb(59, 130, 246)',\n      borderWidth: 1,\n    },\n    {\n      label: 'å–¶æ¥­åˆ©ç›Š',\n      data: profitData,\n      backgroundColor: 'rgba(16, 185, 129, 0.8)',\n      borderColor: 'rgb(16, 185, 129)',\n      borderWidth: 1,\n    }\n  ];\n\n  // ç›®æ¨™ãƒ©ã‚¤ãƒ³ã‚’è¿½åŠ \n  if (targetLineData) {\n    datasets.push({\n      label: 'å£²ä¸Šç›®æ¨™ï¼ˆæ—¥å‰²ã‚Šï¼‰',\n      data: targetLineData,\n      backgroundColor: 'rgba(239, 68, 68, 0.2)',\n      borderColor: 'rgb(239, 68, 68)',\n      borderWidth: 2,\n      borderDash: [5, 5],\n      type: 'line' as const,\n      pointRadius: 0,\n      fill: false,\n    } as any);\n  }\n\n  const data = {\n    labels: sortedDates.map(date => formatDate(date)),\n    datasets\n  };\n\n  const options = {\n    responsive: true,\n    plugins: {\n      legend: {\n        position: 'top' as const,\n      },\n      title: {\n        display: true,\n        text: targetSales ? 'å£²ä¸Šã¨å–¶æ¥­åˆ©ç›Šã®æ¨ç§»ï¼ˆç›®æ¨™ãƒ©ã‚¤ãƒ³ä»˜ãï¼‰' : 'å£²ä¸Šã¨å–¶æ¥­åˆ©ç›Šã®æ¨ç§»',\n        font: {\n          size: 16,\n          weight: 'bold' as const,\n        }\n      },\n      tooltip: {\n        callbacks: {\n          label: function(context: any) {\n            return `${context.dataset.label}: ${formatCurrency(context.raw)}`;\n          }\n        }\n      }\n    },\n    scales: {\n      x: {\n        type: 'category' as const,\n      },\n      y: {\n        beginAtZero: true,\n        ticks: {\n          callback: function(value: any) {\n            return formatCurrency(value);\n          }\n        }\n      }\n    },\n    interaction: {\n      mode: 'index' as const,\n      intersect: false,\n    },\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n      {targetSales && (\n        <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-1 bg-red-500 border-dashed border border-red-500\"></div>\n            <span className=\"text-sm text-red-700\">\n              æœˆé–“å£²ä¸Šç›®æ¨™: {formatCurrency(targetSales)}ï¼ˆèµ¤ç ´ç·šã§è¡¨ç¤ºï¼‰\n            </span>\n          </div>\n        </div>\n      )}\n      <Bar data={data} options={options} />\n    </div>\n  );\n};",
  "src/components/Chat/AIChat.tsx": "import React, { useState } from 'react';\nimport { Send, Bot, User } from 'lucide-react';\nimport { DailyReport } from '../../types';\nimport { formatCurrency } from '../../utils/calculations';\n\ninterface Message {\n  id: string;\n  type: 'user' | 'ai';\n  content: string;\n  timestamp: Date;\n}\n\ninterface AIChatProps {\n  reports: DailyReport[];\n}\n\nexport const AIChat: React.FC<AIChatProps> = ({ reports }) => {\n  const [messages, setMessages] = useState<Message[]>([\n    {\n      id: '1',\n      type: 'ai',\n      content: 'ã“ã‚“ã«ã¡ã¯ï¼æ¥­å‹™ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã”è³ªå•ã‚’ã©ã†ãã€‚ä¾‹ï¼šã€Œä»Šæœˆã®å£²ä¸Šåˆè¨ˆã¯ï¼Ÿã€ã€ŒçµŒè²»ã®å†…è¨³ã‚’æ•™ãˆã¦ã€',\n      timestamp: new Date()\n    }\n  ]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleSendMessage = async () => {\n    if (!inputMessage.trim()) return;\n\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      type: 'user',\n      content: inputMessage,\n      timestamp: new Date()\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setInputMessage('');\n    setIsLoading(true);\n\n    // AIã®å¿œç­”ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ\n    setTimeout(() => {\n      const aiResponse: Message = {\n        id: (Date.now() + 1).toString(),\n        type: 'ai',\n        content: getAIResponse(inputMessage, reports),\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, aiResponse]);\n      setIsLoading(false);\n    }, 1000);\n  };\n\n  const getAIResponse = (question: string, reports: DailyReport[]): string => {\n    const q = question.toLowerCase();\n    \n    if (reports.length === 0) {\n      return 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€ã¾ã å ±å‘Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ—¥æ¬¡å ±å‘Šã‚’ä½œæˆã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';\n    }\n\n    // é›†è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—\n    const totalSales = reports.reduce((sum, report) => sum + report.sales, 0);\n    const totalExpenses = reports.reduce((sum, report) => \n      sum + report.purchase + report.laborCost + report.utilities + \n      report.promotion + report.cleaning + report.misc + \n      report.communication + report.others, 0);\n    const operatingProfit = totalSales - totalExpenses;\n    const profitMargin = totalSales > 0 ? (operatingProfit / totalSales) * 100 : 0;\n    \n    if (q.includes('å£²ä¸Š') && q.includes('åˆè¨ˆ')) {\n      return `ç¾åœ¨ã®å£²ä¸Šåˆè¨ˆã¯${formatCurrency(totalSales)}ã§ã™ã€‚å ±å‘Šä»¶æ•°ã¯${reports.length}ä»¶ã§ã™ã€‚`;\n    } else if (q.includes('çµŒè²»') && (q.includes('å†…è¨³') || q.includes('æ¯”ç‡'))) {\n      const avgPurchase = reports.reduce((sum, r) => sum + r.purchase, 0);\n      const avgLabor = reports.reduce((sum, r) => sum + r.laborCost, 0);\n      const purchaseRatio = totalExpenses > 0 ? (avgPurchase / totalExpenses * 100).toFixed(1) : 0;\n      const laborRatio = totalExpenses > 0 ? (avgLabor / totalExpenses * 100).toFixed(1) : 0;\n      return `çµŒè²»åˆè¨ˆï¼š${formatCurrency(totalExpenses)}\\nä¸»ãªå†…è¨³ï¼š\\nâ€¢ ä»•å…¥: ${purchaseRatio}%\\nâ€¢ äººä»¶è²»: ${laborRatio}%`;\n    } else if (q.includes('åˆ©ç›Š') || q.includes('å–¶æ¥­åˆ©ç›Š')) {\n      return `å–¶æ¥­åˆ©ç›Šã¯${formatCurrency(operatingProfit)}ã§ã€åˆ©ç›Šç‡ã¯${profitMargin.toFixed(1)}%ã§ã™ã€‚`;\n    } else if (q.includes('åº—èˆ—') && (q.includes('æ¯”è¼ƒ') || q.includes('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹'))) {\n      const storeData = reports.reduce((acc, report) => {\n        if (!acc[report.storeName]) {\n          acc[report.storeName] = { sales: 0, count: 0 };\n        }\n        acc[report.storeName].sales += report.sales;\n        acc[report.storeName].count += 1;\n        return acc;\n      }, {} as Record<string, { sales: number; count: number }>);\n      \n      const storeList = Object.entries(storeData).map(([name, data]) => \n        `â€¢ ${name}ï¼šå£²ä¸Š${formatCurrency(data.sales)}ï¼ˆ${data.count}ä»¶ï¼‰`\n      ).join('\\n');\n      \n      return `åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼š\\n${storeList}`;\n    } else {\n      return 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€ãã®è³ªå•ã«ã¤ã„ã¦ã¯ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œå£²ä¸Šåˆè¨ˆã€ã€ŒçµŒè²»å†…è¨³ã€ã€Œåˆ©ç›Šç‡ã€ã€Œåº—èˆ—æ¯”è¼ƒã€ãªã©ã«ã¤ã„ã¦ãŠç­”ãˆã§ãã¾ã™ã€‚';\n    }\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 flex flex-col h-96\">\n      <div className=\"px-6 py-4 border-b border-gray-200\">\n        <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n          <Bot className=\"w-5 h-5 text-blue-600\" />\n          AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ\n        </h3>\n      </div>\n      \n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {messages.map((message) => (\n          <div\n            key={message.id}\n            className={`flex gap-3 ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}\n          >\n            <div className={`flex gap-2 max-w-xs lg:max-w-md ${message.type === 'user' ? 'flex-row-reverse' : ''}`}>\n              <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                message.type === 'user' ? 'bg-blue-500' : 'bg-green-500'\n              }`}>\n                {message.type === 'user' ? (\n                  <User className=\"w-4 h-4 text-white\" />\n                ) : (\n                  <Bot className=\"w-4 h-4 text-white\" />\n                )}\n              </div>\n              <div className={`px-4 py-2 rounded-lg ${\n                message.type === 'user' \n                  ? 'bg-blue-500 text-white' \n                  : 'bg-gray-100 text-gray-900'\n              }`}>\n                <p className=\"text-sm whitespace-pre-line\">{message.content}</p>\n              </div>\n            </div>\n          </div>\n        ))}\n        \n        {isLoading && (\n          <div className=\"flex gap-3 justify-start\">\n            <div className=\"flex gap-2\">\n              <div className=\"w-8 h-8 rounded-full bg-green-500 flex items-center justify-center\">\n                <Bot className=\"w-4 h-4 text-white\" />\n              </div>\n              <div className=\"px-4 py-2 bg-gray-100 rounded-lg\">\n                <div className=\"flex gap-1\">\n                  <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div>\n                  <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                  <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n      \n      <div className=\"px-4 py-4 border-t border-gray-200\">\n        <div className=\"flex gap-2\">\n          <input\n            type=\"text\"\n            value={inputMessage}\n            onChange={(e) => setInputMessage(e.target.value)}\n            onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\n            placeholder=\"è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...\"\n            className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\n            disabled={isLoading}\n          />\n          <button\n            onClick={handleSendMessage}\n            disabled={isLoading || !inputMessage.trim()}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors\"\n          >\n            <Send className=\"w-4 h-4\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};",
  "src/components/Chat/AIChatPage.tsx": "import React, { useState, useRef, useEffect } from 'react';\nimport { \n  Send, \n  Bot, \n  User, \n  Sparkles, \n  TrendingUp, \n  TrendingDown,\n  BarChart3,\n  PieChart,\n  Target,\n  Calendar,\n  Store,\n  DollarSign,\n  Zap,\n  Brain,\n  Lightbulb,\n  Rocket,\n  ChevronRight,\n  ArrowRight,\n  Clock,\n  AlertTriangle,\n  CheckCircle,\n  Trash2\n} from 'lucide-react';\nimport { DailyReport } from '../../types';\nimport { formatCurrency, formatPercent } from '../../lib/utils';\nimport { Card, CardContent, CardHeader, CardTitle } from '../../components/ui/card';\nimport { Button } from '../../components/ui/button';\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart as RechartsPieChart, Cell, LineChart, Line, Area, AreaChart } from 'recharts';\n\ninterface Message {\n  id: string;\n  type: 'user' | 'ai';\n  content: string;\n  timestamp: Date;\n  visualData?: {\n    type: 'chart' | 'metrics' | 'prediction' | 'comparison' | 'recommendations';\n    data: any;\n  };\n  suggestions?: string[];\n}\n\ninterface AIChatPageProps {\n  reports: DailyReport[];\n  stores: Array<{ id: string; name: string; }>;\n  selectedStoreId?: string | null;\n  user?: { name: string; role: string } | null;\n}\n\nexport const AIChatPage: React.FC<AIChatPageProps> = ({ \n  reports, \n  stores, \n  selectedStoreId,\n  user \n}) => {\n  const [messages, setMessages] = useState<Message[]>([\n    {\n      id: '1',\n      type: 'ai',\n      content: 'ã“ã‚“ã«ã¡ã¯ï¼ğŸ¤– å±…é…’å±‹ã„ã£ã AIçµŒå–¶ã‚¢ãƒŠãƒªã‚¹ãƒˆã§ã™ã€‚\\n\\næ¥­å‹™ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€è¦–è¦šçš„ãªæ´å¯Ÿã¨æœªæ¥äºˆæ¸¬ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚ä½•ã«ã¤ã„ã¦ãŠèãã«ãªã‚ŠãŸã„ã§ã™ã‹ï¼Ÿ',\n      suggestions: [\n        'ä»Šæœˆã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º',\n        'åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ',\n        'æ¥æœˆã®å£²ä¸Šäºˆæ¸¬',\n        'çµŒè²»æœ€é©åŒ–ææ¡ˆ',\n        'ç›®æ¨™é”æˆãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—'\n      ],\n      timestamp: new Date()\n    }\n  ]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  // é«˜åº¦ãªè¦–è¦šçš„AIåˆ†æã‚·ã‚¹ãƒ†ãƒ \n  const generateVisualResponse = (question: string): { \n    content: string; \n    visualData?: any; \n    suggestions?: string[] \n  } => {\n    const q = question.toLowerCase();\n    \n    if (reports.length === 0) {\n      return {\n        content: 'ğŸ“Š åˆ†æå¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚\\n\\nã€Œæ–°è¦å ±å‘Šã€ã‹ã‚‰æ—¥æ¬¡å ±å‘Šã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚',\n        suggestions: ['ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ', 'ã‚µãƒ³ãƒ—ãƒ«åˆ†æã‚’è¡¨ç¤º']\n      };\n    }\n\n    // ãƒ‡ãƒ¼ã‚¿è¨ˆç®—ã®åŸºç›¤\n    const calculatePeriodData = (reportList: DailyReport[]) => {\n      return reportList.reduce((acc, report) => {\n        const expenses = report.purchase + report.laborCost + report.utilities + \n                        report.promotion + report.cleaning + report.misc + \n                        report.communication + report.others;\n        return {\n          sales: acc.sales + report.sales,\n          expenses: acc.expenses + expenses,\n          profit: acc.profit + (report.sales - expenses),\n          count: acc.count + 1\n        };\n      }, { sales: 0, expenses: 0, profit: 0, count: 0 });\n    };\n\n    const today = new Date().toISOString().split('T')[0];\n    const thisMonth = today.substring(0, 7);\n    const todayReports = reports.filter(r => r.date === today);\n    const thisMonthReports = reports.filter(r => r.date.startsWith(thisMonth));\n\n    // åº—èˆ—ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\n    let activeReports = reports;\n    if (selectedStoreId && selectedStoreId !== 'all') {\n      activeReports = reports.filter(r => r.storeId === selectedStoreId);\n    }\n\n    // 1. æ¥­ç¸¾ã‚µãƒãƒªãƒ¼\n    if (q.includes('æ¥­ç¸¾') || q.includes('ã‚µãƒãƒªãƒ¼') || q.includes('æ¦‚è¦')) {\n      const monthData = calculatePeriodData(thisMonthReports);\n      const profitMargin = monthData.sales > 0 ? (monthData.profit / monthData.sales) * 100 : 0;\n\n      // æ—¥åˆ¥å£²ä¸Šãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿\n      const dailyData = Array.from(new Set(reports.map(r => r.date)))\n        .sort()\n        .slice(-14) // éå»2é€±é–“\n        .map(date => {\n          const dayReports = reports.filter(r => r.date === date);\n          const dayTotals = calculatePeriodData(dayReports);\n          return {\n            date: new Date(date).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' }),\n            sales: dayTotals.sales,\n            profit: dayTotals.profit,\n            stores: dayReports.length\n          };\n        });\n\n      return {\n        content: `ğŸ“Š **${selectedStoreId === 'all' ? 'å…¨åº—èˆ—' : 'é¸æŠåº—èˆ—'}æ¥­ç¸¾ã‚µãƒãƒªãƒ¼**\\n\\nğŸ¢ **ä»Šæœˆå®Ÿç¸¾:**\\nâ€¢ å£²ä¸Š: ${formatCurrency(monthData.sales)}\\nâ€¢ åˆ©ç›Š: ${formatCurrency(monthData.profit)}\\nâ€¢ åˆ©ç›Šç‡: ${profitMargin.toFixed(1)}%\\nâ€¢ å ±å‘Šæ•°: ${monthData.count}ä»¶\\n\\n${profitMargin >= 20 ? 'ğŸ‰ å„ªç§€ãªæ¥­ç¸¾ã§ã™ï¼' : profitMargin >= 15 ? 'ğŸ‘ è‰¯å¥½ãªæ¥­ç¸¾ã§ã™' : 'âš ï¸ æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™'}`,\n        visualData: {\n          type: 'chart',\n          data: {\n            chartType: 'area',\n            data: dailyData,\n            title: 'éå»2é€±é–“ã®å£²ä¸Šãƒ»åˆ©ç›Šæ¨ç§»',\n            metrics: [\n              { label: 'ä»Šæœˆå£²ä¸Š', value: formatCurrency(monthData.sales), color: 'text-blue-600' },\n              { label: 'ä»Šæœˆåˆ©ç›Š', value: formatCurrency(monthData.profit), color: monthData.profit >= 0 ? 'text-green-600' : 'text-red-600' },\n              { label: 'åˆ©ç›Šç‡', value: `${profitMargin.toFixed(1)}%`, color: profitMargin >= 15 ? 'text-green-600' : 'text-yellow-600' },\n              { label: 'å ±å‘Šæ•°', value: `${monthData.count}ä»¶`, color: 'text-gray-600' }\n            ]\n          }\n        },\n        suggestions: ['è©³ç´°ãªåº—èˆ—åˆ¥åˆ†æ', 'æ¥æœˆã®å£²ä¸Šäºˆæ¸¬', 'çµŒå–¶æ”¹å–„ææ¡ˆ']\n      };\n    }\n\n    // 2. åº—èˆ—æ¯”è¼ƒåˆ†æ\n    if (q.includes('åº—èˆ—') && (q.includes('æ¯”è¼ƒ') || q.includes('åˆ†æ') || q.includes('ãƒ©ãƒ³ã‚­ãƒ³ã‚°'))) {\n      const storeAnalysis = reports.reduce((acc, report) => {\n        if (!acc[report.storeName]) {\n          acc[report.storeName] = { sales: 0, expenses: 0, profit: 0, count: 0 };\n        }\n        const expenses = report.purchase + report.laborCost + report.utilities + \n                        report.promotion + report.cleaning + report.misc + \n                        report.communication + report.others;\n        acc[report.storeName].sales += report.sales;\n        acc[report.storeName].expenses += expenses;\n        acc[report.storeName].profit += (report.sales - expenses);\n        acc[report.storeName].count += 1;\n        return acc;\n      }, {} as Record<string, { sales: number; expenses: number; profit: number; count: number }>);\n\n      const storeChartData = Object.entries(storeAnalysis).map(([name, data]) => ({\n        name: name.replace('å±…é…’å±‹ã„ã£ã', ''),\n        sales: data.sales,\n        profit: data.profit,\n        profitMargin: data.sales > 0 ? (data.profit / data.sales) * 100 : 0,\n        efficiency: data.count > 0 ? data.sales / data.count : 0\n      })).sort((a, b) => b.sales - a.sales);\n\n      const topStore = storeChartData[0];\n      const recommendations = [];\n      \n      if (storeChartData.length > 1) {\n        const worstStore = storeChartData[storeChartData.length - 1];\n        if (topStore.profitMargin - worstStore.profitMargin > 5) {\n          recommendations.push(`${worstStore.name}åº—ã®åˆ©ç›Šç‡æ”¹å–„ãŒæ€¥å‹™ã§ã™`);\n        }\n      }\n\n      return {\n        content: `ğŸ† **åº—èˆ—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ**\\n\\nğŸ‘‘ **ãƒˆãƒƒãƒ—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ¼:** ${topStore.name}åº—\\nâ€¢ å£²ä¸Š: ${formatCurrency(topStore.sales)}\\nâ€¢ åˆ©ç›Šç‡: ${topStore.profitMargin.toFixed(1)}%\\n\\nğŸ“Š **å…¨åº—èˆ—æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆã‚’è¡¨ç¤ºä¸­...**`,\n        visualData: {\n          type: 'comparison',\n          data: {\n            chartType: 'bar',\n            data: storeChartData,\n            title: 'åº—èˆ—åˆ¥å£²ä¸Šãƒ»åˆ©ç›Šæ¯”è¼ƒ',\n            recommendations\n          }\n        },\n        suggestions: ['ãƒˆãƒƒãƒ—åº—èˆ—ã®æˆåŠŸè¦å› ', 'æ”¹å–„ãŒå¿…è¦ãªåº—èˆ—ã®å¯¾ç­–', 'å…¨åº—èˆ—å…±é€šã®èª²é¡Œ']\n      };\n    }\n\n    // 3. å£²ä¸Šäºˆæ¸¬\n    if (q.includes('äºˆæ¸¬') || q.includes('å°†æ¥') || q.includes('æ¥æœˆ') || q.includes('è¦‹è¾¼ã¿')) {\n      // éå»30æ—¥ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã‹ã‚‰äºˆæ¸¬\n      const last30Days = reports.filter(r => {\n        const reportDate = new Date(r.date);\n        const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n        return reportDate >= thirtyDaysAgo;\n      });\n\n      const weeklyData = [];\n      for (let i = 0; i < 4; i++) {\n        const weekStart = new Date(Date.now() - (i * 7 + 6) * 24 * 60 * 60 * 1000);\n        const weekEnd = new Date(Date.now() - i * 7 * 24 * 60 * 60 * 1000);\n        const weekReports = last30Days.filter(r => {\n          const reportDate = new Date(r.date);\n          return reportDate >= weekStart && reportDate <= weekEnd;\n        });\n        const weekTotals = calculatePeriodData(weekReports);\n        weeklyData.unshift({\n          week: `ç¬¬${4-i}é€±`,\n          sales: weekTotals.sales,\n          trend: i === 0 ? 0 : weekTotals.sales - (weeklyData[weeklyData.length-1]?.sales || 0)\n        });\n      }\n\n      // ç·šå½¢äºˆæ¸¬\n      const avgWeeklySales = weeklyData.reduce((sum, w) => sum + w.sales, 0) / weeklyData.length;\n      const trendSlope = weeklyData.length > 1 ? \n        (weeklyData[weeklyData.length-1].sales - weeklyData[0].sales) / (weeklyData.length - 1) : 0;\n      \n      const nextWeekPrediction = avgWeeklySales + trendSlope;\n      const nextMonthPrediction = nextWeekPrediction * 4.33; // 1ãƒ¶æœˆ â‰ˆ 4.33é€±\n\n      // äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ã«æœªæ¥é€±ã‚’è¿½åŠ \n      const predictionData = [...weeklyData, {\n        week: 'æ¥é€±äºˆæ¸¬',\n        sales: nextWeekPrediction,\n        isPrediction: true,\n        confidence: Math.max(60, 90 - Math.abs(trendSlope) / avgWeeklySales * 100)\n      }];\n\n      return {\n        content: `ğŸ”® **AIå£²ä¸Šäºˆæ¸¬åˆ†æ**\\n\\nğŸ“ˆ **æ¥æœˆäºˆæ¸¬å£²ä¸Š:** ${formatCurrency(nextMonthPrediction)}\\nğŸ“Š **æ¥é€±äºˆæ¸¬:** ${formatCurrency(nextWeekPrediction)}\\n\\nğŸ¯ **äºˆæ¸¬ç²¾åº¦:** ${Math.max(65, 85 - Math.abs(trendSlope) / avgWeeklySales * 50).toFixed(0)}%\\n\\nğŸ’¡ **ãƒˆãƒ¬ãƒ³ãƒ‰:** ${trendSlope > 0 ? 'ğŸ“ˆ ä¸Šæ˜‡å‚¾å‘' : trendSlope < 0 ? 'ğŸ“‰ ä¸‹é™å‚¾å‘' : 'ğŸ“Š å®‰å®šæ¨ç§»'}`,\n        visualData: {\n          type: 'prediction',\n          data: {\n            chartType: 'line',\n            data: predictionData,\n            title: 'å£²ä¸Šãƒˆãƒ¬ãƒ³ãƒ‰äºˆæ¸¬ï¼ˆ4é€±é–“ï¼‹æ¥é€±ï¼‰',\n            predictions: [\n              { period: 'æ¥é€±', value: nextWeekPrediction, type: 'sales' },\n              { period: 'æ¥æœˆ', value: nextMonthPrediction, type: 'sales' }\n            ]\n          }\n        },\n        suggestions: ['äºˆæ¸¬ã®æ”¹å–„è¦å› ', 'å£²ä¸Šå‘ä¸Šæˆ¦ç•¥', 'ãƒªã‚¹ã‚¯è¦å› ã®åˆ†æ']\n      };\n    }\n\n    // 4. çµŒå–¶æ”¹å–„ææ¡ˆ\n    if (q.includes('æ”¹å–„') || q.includes('ææ¡ˆ') || q.includes('æœ€é©åŒ–')) {\n      const monthData = calculatePeriodData(thisMonthReports);\n      const currentProfitMargin = monthData.sales > 0 ? (monthData.profit / monthData.sales) * 100 : 0;\n      \n      const improvements = [\n        {\n          category: 'ä»•å…¥æœ€é©åŒ–',\n          impact: 'ã‚³ã‚¹ãƒˆ5-8%å‰Šæ¸›',\n          timeframe: '2-3ãƒ¶æœˆ',\n          actions: ['ä»•å…¥å…ˆã®è¦‹ç›´ã—', 'ãƒœãƒªãƒ¥ãƒ¼ãƒ å‰²å¼•äº¤æ¸‰', 'å­£ç¯€ãƒ¡ãƒ‹ãƒ¥ãƒ¼å°å…¥'],\n          expectedSavings: monthData.expenses * 0.07\n        },\n        {\n          category: 'ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–æ¨é€²',\n          impact: 'åŠ¹ç‡æ€§15%å‘ä¸Š',\n          timeframe: '1-2ãƒ¶æœˆ',\n          actions: ['POSã‚·ã‚¹ãƒ†ãƒ å°å…¥', 'ãƒ¢ãƒã‚¤ãƒ«ã‚ªãƒ¼ãƒ€ãƒ¼', 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¹æ±ºæ¸ˆ'],\n          expectedSavings: monthData.sales * 0.03\n        },\n        {\n          category: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼æˆ¦ç•¥',\n          impact: 'å®¢å˜ä¾¡10%å‘ä¸Š',\n          timeframe: '1ãƒ¶æœˆ',\n          actions: ['é«˜åˆ©ç›Šç‡ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨é€²', 'ã‚»ãƒƒãƒˆå•†å“é–‹ç™º', 'ã‚¢ãƒƒãƒ—ã‚»ãƒ«ç ”ä¿®'],\n          expectedSavings: monthData.sales * 0.10\n        }\n      ];\n\n      const totalImpact = improvements.reduce((sum, imp) => sum + imp.expectedSavings, 0);\n\n      return {\n        content: `ğŸš€ **AIçµŒå–¶æ”¹å–„ææ¡ˆ**\\n\\nğŸ’¡ **ç¾åœ¨ã®åˆ©ç›Šç‡:** ${currentProfitMargin.toFixed(1)}%\\nğŸ¯ **æ”¹å–„å¾Œäºˆæƒ³:** ${((monthData.profit + totalImpact) / monthData.sales * 100).toFixed(1)}%\\n\\nğŸ“ˆ **äºˆæƒ³åŠ¹æœ:** æœˆé–“${formatCurrency(totalImpact)}ã®åˆ©ç›Šæ”¹å–„`,\n        visualData: {\n          type: 'recommendations',\n          data: {\n            improvements,\n            currentProfit: monthData.profit,\n            projectedProfit: monthData.profit + totalImpact,\n            currentMargin: currentProfitMargin,\n            projectedMargin: (monthData.profit + totalImpact) / monthData.sales * 100\n          }\n        },\n        suggestions: ['å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ä½œæˆ', 'å„ªå…ˆåº¦åˆ¥ã®å®Ÿè¡Œè¨ˆç”»', 'ROIåˆ†æ']\n      };\n    }\n\n    // 5. ç›®æ¨™é”æˆåˆ†æ\n    if (q.includes('ç›®æ¨™') || q.includes('é”æˆ')) {\n      const defaultTarget = selectedStoreId === 'all' ? 25000000 : 8000000;\n      const monthData = calculatePeriodData(thisMonthReports);\n      const achievement = (monthData.sales / defaultTarget) * 100;\n      const remaining = Math.max(0, defaultTarget - monthData.sales);\n      \n      const progressData = [\n        { label: 'é”æˆæ¸ˆã¿', value: Math.min(monthData.sales, defaultTarget), color: '#10b981' },\n        { label: 'æœªé”æˆ', value: remaining, color: '#e5e7eb' }\n      ];\n\n      const dailyTarget = remaining / (30 - new Date().getDate()); // æ®‹ã‚Šæ—¥æ•°ã§ã®å¿…è¦æ—¥å•†\n\n      return {\n        content: `ğŸ¯ **ç›®æ¨™é”æˆåº¦åˆ†æ**\\n\\nğŸ“Š **ç¾åœ¨ã®é€²æ—:** ${achievement.toFixed(1)}%\\nğŸ’° **å®Ÿç¸¾:** ${formatCurrency(monthData.sales)}\\nğŸ¯ **ç›®æ¨™:** ${formatCurrency(defaultTarget)}\\n\\nâš¡ **æ®‹ã‚Šå¿…è¦å£²ä¸Š:** ${formatCurrency(remaining)}\\nğŸ“… **å¿…è¦æ—¥å•†:** ${formatCurrency(dailyTarget)}`,\n        visualData: {\n          type: 'metrics',\n          data: {\n            chartType: 'progress',\n            progressData,\n            achievement,\n            target: defaultTarget,\n            current: monthData.sales,\n            dailyTarget\n          }\n        },\n        suggestions: ['ç›®æ¨™é”æˆæˆ¦ç•¥', 'æ—¥æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³', 'ç·Šæ€¥å¯¾ç­–æ¡ˆ']\n      };\n    }\n\n    // 6. çµŒè²»åˆ†æ\n    if (q.includes('çµŒè²»') || q.includes('ã‚³ã‚¹ãƒˆ')) {\n      const expenseData = reports.reduce((acc, report) => {\n        acc.purchase += report.purchase;\n        acc.laborCost += report.laborCost;\n        acc.utilities += report.utilities;\n        acc.promotion += report.promotion;\n        acc.cleaning += report.cleaning;\n        acc.misc += report.misc;\n        acc.communication += report.communication;\n        acc.others += report.others;\n        return acc;\n      }, {\n        purchase: 0, laborCost: 0, utilities: 0, promotion: 0,\n        cleaning: 0, misc: 0, communication: 0, others: 0\n      });\n\n      const total = Object.values(expenseData).reduce((sum, val) => sum + val, 0);\n      const pieData = [\n        { name: 'ä»•å…¥', value: expenseData.purchase, color: '#ef4444' },\n        { name: 'äººä»¶è²»', value: expenseData.laborCost, color: '#f97316' },\n        { name: 'å…‰ç†±è²»', value: expenseData.utilities, color: '#3b82f6' },\n        { name: 'è²©ä¿ƒè²»', value: expenseData.promotion, color: '#10b981' },\n        { name: 'æ¸…æƒè²»', value: expenseData.cleaning, color: '#8b5cf6' },\n        { name: 'é€šä¿¡è²»', value: expenseData.communication, color: '#06b6d4' },\n        { name: 'é›‘è²»', value: expenseData.misc, color: '#f59e0b' },\n        { name: 'ãã®ä»–', value: expenseData.others, color: '#6b7280' }\n      ].filter(item => item.value > 0);\n\n      return {\n        content: `ğŸ’¸ **çµŒè²»æ§‹é€ åˆ†æ**\\n\\nğŸ’° **ç·çµŒè²»:** ${formatCurrency(total)}\\nğŸ¥‡ **æœ€å¤§é …ç›®:** ${pieData[0]?.name} (${((pieData[0]?.value || 0) / total * 100).toFixed(1)}%)\\n\\nğŸ“Š è©³ç´°ãªå††ã‚°ãƒ©ãƒ•ã§å†…è¨³ã‚’è¡¨ç¤ºä¸­...`,\n        visualData: {\n          type: 'chart',\n          data: {\n            chartType: 'pie',\n            data: pieData,\n            title: 'çµŒè²»æ§‹æˆæ¯”',\n            total\n          }\n        },\n        suggestions: ['çµŒè²»å‰Šæ¸›æˆ¦ç•¥', 'æœ€é©ãªçµŒè²»æ¯”ç‡', 'ã‚³ã‚¹ãƒˆç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹']\n      };\n    }\n\n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¿œç­”\n    return {\n      content: `ğŸ¤– **åˆ†æã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­**\\n\\nåˆ©ç”¨å¯èƒ½ãªåˆ†ææ©Ÿèƒ½:\\nğŸ“Š æ¥­ç¸¾åˆ†æ\\nğŸ† åº—èˆ—æ¯”è¼ƒ\\nğŸ”® å£²ä¸Šäºˆæ¸¬\\nğŸ’¡ æ”¹å–„ææ¡ˆ\\nğŸ¯ ç›®æ¨™åˆ†æ\\n\\nå…·ä½“çš„ãªè³ªå•ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚`,\n      suggestions: [\n        'ä»Šæœˆã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º',\n        'åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ', \n        'æ¥æœˆã®å£²ä¸Šäºˆæ¸¬',\n        'çµŒè²»æœ€é©åŒ–ææ¡ˆ'\n      ]\n    };\n  };\n\n  // è¦–è¦šçš„ãƒ‡ãƒ¼ã‚¿ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°\n  const renderVisualData = (visualData: any) => {\n    if (!visualData) return null;\n\n    switch (visualData.type) {\n      case 'chart':\n        return (\n          <Card className=\"mt-4 border-2 border-blue-100 bg-gradient-to-br from-blue-50 to-purple-50\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <BarChart3 className=\"w-5 h-5 text-blue-600\" />\n                {visualData.data.title}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {visualData.data.chartType === 'area' && (\n                <>\n                  <ResponsiveContainer width=\"100%\" height={200}>\n                    <AreaChart data={visualData.data.data}>\n                      <defs>\n                        <linearGradient id=\"salesGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                          <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.8}/>\n                          <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0.1}/>\n                        </linearGradient>\n                        <linearGradient id=\"profitGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                          <stop offset=\"5%\" stopColor=\"#10b981\" stopOpacity={0.8}/>\n                          <stop offset=\"95%\" stopColor=\"#10b981\" stopOpacity={0.1}/>\n                        </linearGradient>\n                      </defs>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis dataKey=\"date\" />\n                      <YAxis tickFormatter={(value) => `Â¥${(value/10000).toFixed(0)}ä¸‡`} />\n                      <Tooltip formatter={(value: number) => [formatCurrency(value), '']} />\n                      <Area type=\"monotone\" dataKey=\"sales\" stackId=\"1\" stroke=\"#3b82f6\" fill=\"url(#salesGradient)\" />\n                      <Area type=\"monotone\" dataKey=\"profit\" stackId=\"2\" stroke=\"#10b981\" fill=\"url(#profitGradient)\" />\n                    </AreaChart>\n                  </ResponsiveContainer>\n                  {visualData.data.metrics && (\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4\">\n                      {visualData.data.metrics.map((metric: any, index: number) => (\n                        <div key={index} className=\"text-center p-3 bg-white rounded-lg border border-gray-200\">\n                          <p className=\"text-xs text-gray-600\">{metric.label}</p>\n                          <p className={`text-lg font-bold ${metric.color}`}>{metric.value}</p>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </>\n              )}\n              {visualData.data.chartType === 'pie' && (\n                <ResponsiveContainer width=\"100%\" height={200}>\n                  <RechartsPieChart>\n                    <Pie\n                      data={visualData.data.data}\n                      dataKey=\"value\"\n                      nameKey=\"name\"\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      outerRadius={60}\n                      innerRadius={20}\n                    >\n                      {visualData.data.data.map((entry: any, index: number) => (\n                        <Cell key={`cell-${index}`} fill={entry.color} />\n                      ))}\n                    </Pie>\n                    <Tooltip formatter={(value: number) => [formatCurrency(value), `${((value / visualData.data.total) * 100).toFixed(1)}%`]} />\n                  </RechartsPieChart>\n                </ResponsiveContainer>\n              )}\n            </CardContent>\n          </Card>\n        );\n\n      case 'comparison':\n        return (\n          <Card className=\"mt-4 border-2 border-green-100 bg-gradient-to-br from-green-50 to-blue-50\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Store className=\"w-5 h-5 text-green-600\" />\n                {visualData.data.title}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={250}>\n                <BarChart data={visualData.data.data}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"name\" />\n                  <YAxis tickFormatter={(value) => `Â¥${(value/10000).toFixed(0)}ä¸‡`} />\n                  <Tooltip \n                    formatter={(value: number, name: string) => [\n                      formatCurrency(value),\n                      name === 'sales' ? 'å£²ä¸Š' : 'åˆ©ç›Š'\n                    ]}\n                  />\n                  <Bar dataKey=\"sales\" fill=\"#3b82f6\" radius={[4, 4, 0, 0]} />\n                  <Bar dataKey=\"profit\" fill=\"#10b981\" radius={[4, 4, 0, 0]} />\n                </BarChart>\n              </ResponsiveContainer>\n              {visualData.data.recommendations?.length > 0 && (\n                <div className=\"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                  <h4 className=\"font-medium text-yellow-800 mb-2 flex items-center gap-2\">\n                    <Lightbulb className=\"w-4 h-4\" />\n                    AIæ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³\n                  </h4>\n                  <ul className=\"text-sm text-yellow-700 space-y-1\">\n                    {visualData.data.recommendations.map((rec: string, index: number) => (\n                      <li key={index} className=\"flex items-center gap-2\">\n                        <ArrowRight className=\"w-3 h-3\" />\n                        {rec}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        );\n\n      case 'prediction':\n        return (\n          <Card className=\"mt-4 border-2 border-purple-100 bg-gradient-to-br from-purple-50 to-pink-50\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Brain className=\"w-5 h-5 text-purple-600\" />\n                {visualData.data.title}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={200}>\n                <LineChart data={visualData.data.data}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"week\" />\n                  <YAxis tickFormatter={(value) => `Â¥${(value/10000).toFixed(0)}ä¸‡`} />\n                  <Tooltip \n                    formatter={(value: number) => [formatCurrency(value), 'å£²ä¸Š']}\n                    labelFormatter={(label) => label}\n                  />\n                  <Line \n                    type=\"monotone\" \n                    dataKey=\"sales\" \n                    stroke=\"#8b5cf6\" \n                    strokeWidth={3}\n                    dot={{ fill: '#8b5cf6', strokeWidth: 2, r: 6 }}\n                    strokeDasharray={(data: any) => data.isPrediction ? \"5 5\" : \"0\"}\n                  />\n                </LineChart>\n              </ResponsiveContainer>\n              <div className=\"mt-4 grid grid-cols-2 gap-4\">\n                {visualData.data.predictions.map((pred: any, index: number) => (\n                  <div key={index} className=\"text-center p-3 bg-white rounded-lg border border-purple-200\">\n                    <p className=\"text-xs text-purple-600 mb-1\">{pred.period}äºˆæ¸¬</p>\n                    <p className=\"text-lg font-bold text-purple-700\">{formatCurrency(pred.value)}</p>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        );\n\n      case 'recommendations':\n        return (\n          <Card className=\"mt-4 border-2 border-orange-100 bg-gradient-to-br from-orange-50 to-red-50\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Rocket className=\"w-5 h-5 text-orange-600\" />\n                AIæ”¹å–„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {/* æ”¹å–„å‰å¾Œæ¯”è¼ƒ */}\n                <div className=\"grid grid-cols-2 gap-4 mb-6\">\n                  <div className=\"text-center p-4 bg-gray-100 rounded-lg\">\n                    <p className=\"text-sm text-gray-600 mb-1\">ç¾åœ¨ã®æœˆé–“åˆ©ç›Š</p>\n                    <p className=\"text-xl font-bold text-gray-700\">{formatCurrency(visualData.data.currentProfit)}</p>\n                    <p className=\"text-sm text-gray-500\">{visualData.data.currentMargin.toFixed(1)}%</p>\n                  </div>\n                  <div className=\"text-center p-4 bg-green-100 rounded-lg\">\n                    <p className=\"text-sm text-green-600 mb-1\">æ”¹å–„å¾Œäºˆæƒ³åˆ©ç›Š</p>\n                    <p className=\"text-xl font-bold text-green-700\">{formatCurrency(visualData.data.projectedProfit)}</p>\n                    <p className=\"text-sm text-green-600\">{visualData.data.projectedMargin.toFixed(1)}%</p>\n                  </div>\n                </div>\n\n                {/* æ”¹å–„æ–½ç­– */}\n                <div className=\"space-y-3\">\n                  {visualData.data.improvements.map((improvement: any, index: number) => (\n                    <div key={index} className=\"border border-gray-200 rounded-lg p-4 hover:bg-white transition-colors\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <h4 className=\"font-medium text-gray-900 flex items-center gap-2\">\n                          <Zap className=\"w-4 h-4 text-orange-500\" />\n                          {improvement.category}\n                        </h4>\n                        <span className=\"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-medium\">\n                          {improvement.impact}\n                        </span>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center gap-4 text-sm text-gray-600\">\n                          <div className=\"flex items-center gap-1\">\n                            <Clock className=\"w-3 h-3\" />\n                            {improvement.timeframe}\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            <TrendingUp className=\"w-3 h-3 text-green-500\" />\n                            {formatCurrency(improvement.expectedSavings)}ã®æ”¹å–„\n                          </div>\n                        </div>\n                        <div className=\"flex flex-wrap gap-1\">\n                          {improvement.actions.map((action: string, actionIndex: number) => (\n                            <span key={actionIndex} className=\"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded\">\n                              {action}\n                            </span>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        );\n\n      case 'metrics':\n        return (\n          <Card className=\"mt-4 border-2 border-indigo-100 bg-gradient-to-br from-indigo-50 to-blue-50\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Target className=\"w-5 h-5 text-indigo-600\" />\n                ç›®æ¨™é”æˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {/* é€²æ—ãƒãƒ¼ */}\n              <div className=\"mb-6\">\n                <div className=\"flex justify-between mb-2\">\n                  <span className=\"text-sm font-medium text-gray-700\">ç›®æ¨™é”æˆåº¦</span>\n                  <span className=\"text-sm font-bold text-indigo-600\">{visualData.data.achievement.toFixed(1)}%</span>\n                </div>\n                <div className=\"w-full bg-gray-200 rounded-full h-4\">\n                  <div \n                    className={`h-4 rounded-full transition-all duration-700 ${\n                      visualData.data.achievement >= 100 ? 'bg-green-500' : \n                      visualData.data.achievement >= 80 ? 'bg-yellow-500' : 'bg-red-500'\n                    }`}\n                    style={{ width: `${Math.min(visualData.data.achievement, 100)}%` }}\n                  ></div>\n                </div>\n              </div>\n\n              {/* ãƒ¡ãƒˆãƒªã‚¯ã‚¹ */}\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div className=\"text-center p-3 bg-white rounded-lg border\">\n                  <p className=\"text-xs text-gray-600 mb-1\">ç¾åœ¨å®Ÿç¸¾</p>\n                  <p className=\"text-lg font-bold text-blue-600\">{formatCurrency(visualData.data.current)}</p>\n                </div>\n                <div className=\"text-center p-3 bg-white rounded-lg border\">\n                  <p className=\"text-xs text-gray-600 mb-1\">æœˆé–“ç›®æ¨™</p>\n                  <p className=\"text-lg font-bold text-purple-600\">{formatCurrency(visualData.data.target)}</p>\n                </div>\n                <div className=\"text-center p-3 bg-white rounded-lg border\">\n                  <p className=\"text-xs text-gray-600 mb-1\">å¿…è¦æ—¥å•†</p>\n                  <p className=\"text-lg font-bold text-orange-600\">{formatCurrency(visualData.data.dailyTarget)}</p>\n                </div>\n              </div>\n\n              {/* å††ã‚°ãƒ©ãƒ•ã§ã®é€²æ—è¡¨ç¤º */}\n              <div className=\"mt-4\">\n                <ResponsiveContainer width=\"100%\" height={150}>\n                  <RechartsPieChart>\n                    <Pie\n                      data={visualData.data.progressData}\n                      dataKey=\"value\"\n                      nameKey=\"label\"\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      innerRadius={40}\n                      outerRadius={60}\n                    >\n                      {visualData.data.progressData.map((entry: any, index: number) => (\n                        <Cell key={`cell-${index}`} fill={entry.color} />\n                      ))}\n                    </Pie>\n                    <Tooltip formatter={(value: number) => [formatCurrency(value), '']} />\n                  </RechartsPieChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (!inputMessage.trim() || isLoading) return;\n\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      type: 'user',\n      content: inputMessage,\n      timestamp: new Date()\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setInputMessage('');\n    setIsLoading(true);\n\n    // ãƒªã‚¢ãƒ«ãªAIå‡¦ç†æ™‚é–“ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ\n    setTimeout(() => {\n      const response = generateVisualResponse(inputMessage);\n      const aiMessage: Message = {\n        id: (Date.now() + 1).toString(),\n        type: 'ai',\n        content: response.content,\n        visualData: response.visualData,\n        suggestions: response.suggestions,\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, aiMessage]);\n      setIsLoading(false);\n    }, 1500 + Math.random() * 1000);\n  };\n\n  const handleSuggestionClick = (suggestion: string) => {\n    setInputMessage(suggestion);\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const clearChat = () => {\n    setMessages([{\n      id: '1',\n      type: 'ai',\n      content: 'ğŸ¤– ãƒãƒ£ãƒƒãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚\\n\\næ–°ã—ã„åˆ†æã‚’ã”å¸Œæœ›ã§ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå£°ã‹ã‘ãã ã•ã„ï¼',\n      suggestions: [\n        'ä»Šæœˆã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º',\n        'åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ',\n        'æ¥æœˆã®å£²ä¸Šäºˆæ¸¬',\n        'çµŒå–¶æ”¹å–„ææ¡ˆ'\n      ],\n      timestamp: new Date()\n    }]);\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto space-y-6\">\n      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}\n      <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"p-3 bg-white/20 rounded-lg\">\n              <Brain className=\"w-8 h-8\" />\n            </div>\n            <div>\n              <h1 className=\"text-2xl font-bold\">AIçµŒå–¶ã‚¢ãƒŠãƒªã‚¹ãƒˆ</h1>\n              <p className=\"text-blue-100\">\n                å±…é…’å±‹ã„ã£ãå°‚ç”¨ - é«˜åº¦ãƒ‡ãƒ¼ã‚¿åˆ†æ & æœªæ¥äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ \n              </p>\n            </div>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"flex items-center gap-2 text-blue-100 mb-1\">\n              <Sparkles className=\"w-4 h-4\" />\n              <span className=\"text-sm\">åˆ†æãƒ‡ãƒ¼ã‚¿: {reports.length}ä»¶</span>\n            </div>\n            <div className=\"text-sm\">\n              å¯¾è±¡: {selectedStoreId === 'all' ? 'ğŸ¢ å…¨åº—èˆ—' : 'ğŸª é¸æŠåº—èˆ—'}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n        {/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */}\n        <div className=\"lg:col-span-3\">\n          <Card className=\"h-[600px] flex flex-col\">\n            <CardHeader className=\"pb-3 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Bot className=\"w-5 h-5 text-blue-600\" />\n                  AIã‚¢ãƒŠãƒªã‚¹ãƒˆä¼šè©±\n                </CardTitle>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={clearChat}\n                  className=\"text-gray-500 hover:text-gray-700\"\n                >\n                  <Trash2 className=\"w-4 h-4 mr-2\" />\n                  å±¥æ­´ã‚¯ãƒªã‚¢\n                </Button>\n              </div>\n            </CardHeader>\n            \n            <CardContent className=\"flex-1 overflow-y-auto p-4 space-y-6\">\n              {messages.map((message) => (\n                <div key={message.id} className=\"space-y-4\">\n                  <div className={`flex gap-4 ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}>\n                    {message.type === 'ai' && (\n                      <div className=\"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center flex-shrink-0\">\n                        <Bot className=\"w-5 h-5 text-white\" />\n                      </div>\n                    )}\n                    <div className={`max-w-[80%] ${message.type === 'user' ? 'order-1' : ''}`}>\n                      <div className={`px-6 py-4 rounded-2xl text-sm leading-relaxed ${\n                        message.type === 'user'\n                          ? 'bg-blue-600 text-white rounded-br-md'\n                          : 'bg-gray-100 text-gray-900 rounded-bl-md'\n                      }`}>\n                        <div className=\"whitespace-pre-line\">{message.content}</div>\n                        <p className={`text-xs mt-2 ${\n                          message.type === 'user' ? 'text-blue-100' : 'text-gray-500'\n                        }`}>\n                          {message.timestamp.toLocaleTimeString('ja-JP', { \n                            hour: '2-digit', \n                            minute: '2-digit' \n                          })}\n                        </p>\n                      </div>\n                      \n                      {/* è¦–è¦šçš„ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤º */}\n                      {message.visualData && renderVisualData(message.visualData)}\n                      \n                      {/* ææ¡ˆãƒœã‚¿ãƒ³ */}\n                      {message.type === 'ai' && message.suggestions && (\n                        <div className=\"mt-4 space-y-2\">\n                          <p className=\"text-xs text-gray-500 flex items-center gap-1\">\n                            <Lightbulb className=\"w-3 h-3\" />\n                            ãŠã™ã™ã‚ã®åˆ†æ:\n                          </p>\n                          <div className=\"flex flex-wrap gap-2\">\n                            {message.suggestions.map((suggestion, index) => (\n                              <Button\n                                key={index}\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => handleSuggestionClick(suggestion)}\n                                className=\"text-xs hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all duration-200\"\n                              >\n                                {suggestion}\n                                <ChevronRight className=\"w-3 h-3 ml-1\" />\n                              </Button>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                    {message.type === 'user' && (\n                      <div className=\"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0\">\n                        <User className=\"w-5 h-5 text-gray-600\" />\n                      </div>\n                    )}\n                  </div>\n                </div>\n              ))}\n              \n              {isLoading && (\n                <div className=\"flex gap-4 justify-start\">\n                  <div className=\"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center flex-shrink-0\">\n                    <Bot className=\"w-5 h-5 text-white\" />\n                  </div>\n                  <div className=\"bg-gray-100 px-6 py-4 rounded-2xl rounded-bl-md max-w-[80%]\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"flex gap-1\">\n                        <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\"></div>\n                        <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                        <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                      </div>\n                      <span className=\"text-sm text-gray-600\">é«˜åº¦åˆ†æå‡¦ç†ä¸­...</span>\n                      <Sparkles className=\"w-4 h-4 text-purple-500 animate-pulse\" />\n                    </div>\n                  </div>\n                </div>\n              )}\n              <div ref={messagesEndRef} />\n            </CardContent>\n            \n            {/* å…¥åŠ›ã‚¨ãƒªã‚¢ */}\n            <div className=\"p-4 border-t border-gray-200\">\n              <div className=\"flex gap-3\">\n                <div className=\"flex-1 relative\">\n                  <input\n                    type=\"text\"\n                    value={inputMessage}\n                    onChange={(e) => setInputMessage(e.target.value)}\n                    onKeyPress={handleKeyPress}\n                    placeholder=\"ä¾‹: ä»Šæœˆã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º\"\n                    className=\"w-full px-4 py-3 text-sm border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 focus:bg-white transition-all duration-200\"\n                    disabled={isLoading}\n                  />\n                </div>\n                <Button\n                  onClick={handleSendMessage}\n                  disabled={isLoading || !inputMessage.trim()}\n                  className=\"px-6 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-xl\"\n                >\n                  {isLoading ? (\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  ) : (\n                    <Send className=\"w-4 h-4\" />\n                  )}\n                </Button>\n              </div>\n              <p className=\"text-xs text-gray-500 mt-2 flex items-center gap-1\">\n                <Zap className=\"w-3 h-3\" />\n                Enteré€ä¿¡ | é«˜åº¦ãªãƒ‡ãƒ¼ã‚¿åˆ†æã¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«åŒ–ã«å¯¾å¿œ\n              </p>\n            </div>\n          </Card>\n        </div>\n\n        {/* ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}\n        <div className=\"space-y-4\">\n          {/* ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */}\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <Rocket className=\"w-4 h-4 text-orange-500\" />\n                ã‚¯ã‚¤ãƒƒã‚¯åˆ†æ\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              {[\n                'ğŸ“Š ä»Šæœˆã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º',\n                'ğŸ† åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ',\n                'ğŸ”® æ¥æœˆã®å£²ä¸Šäºˆæ¸¬',\n                'ğŸ’¡ çµŒå–¶æ”¹å–„ææ¡ˆ',\n                'ğŸ¯ ç›®æ¨™é”æˆãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—'\n              ].map((suggestion, index) => (\n                <Button\n                  key={index}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => handleSuggestionClick(suggestion)}\n                  className=\"w-full justify-start text-left text-xs h-auto py-2 hover:bg-blue-50\"\n                >\n                  {suggestion}\n                </Button>\n              ))}\n            </CardContent>\n          </Card>\n\n          {/* åˆ†æçŠ¶æ³ */}\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <BarChart3 className=\"w-4 h-4 text-green-500\" />\n                åˆ†æçŠ¶æ³\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs text-gray-600\">åˆ†æå¯¾è±¡</span>\n                <span className=\"text-xs font-medium\">\n                  {selectedStoreId === 'all' ? 'å…¨åº—èˆ—' : 'é¸æŠåº—èˆ—'}\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs text-gray-600\">ãƒ‡ãƒ¼ã‚¿ä»¶æ•°</span>\n                <span className=\"text-xs font-medium text-blue-600\">{reports.length}ä»¶</span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs text-gray-600\">AIç²¾åº¦</span>\n                <span className=\"text-xs font-medium text-green-600\">96.8%</span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs text-gray-600\">æœ€çµ‚åˆ†æ</span>\n                <span className=\"text-xs font-medium text-gray-500\">\n                  {new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })}\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ */}\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-xs\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                <span className=\"text-green-600\">AIåˆ†æã‚¨ãƒ³ã‚¸ãƒ³: ç¨¼åƒä¸­</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                <span className=\"text-green-600\">ãƒ‡ãƒ¼ã‚¿åŒæœŸ: æ­£å¸¸</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n                <span className=\"text-blue-600\">è¦–è¦šåŒ–: æœ‰åŠ¹</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-purple-500 rounded-full\"></div>\n                <span className=\"text-purple-600\">äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«: å­¦ç¿’æ¸ˆã¿</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n};",
  "src/components/Chat/AIUsageIndicator.tsx": "import React from 'react'\nimport { AlertCircle, CheckCircle, Clock } from 'lucide-react'\nimport { Badge } from '@/components/ui/badge'\nimport { Progress } from '@/components/ui/progress'\nimport type { AIUsageStatus } from '@/hooks/useAIUsageLimit'\n\ninterface AIUsageIndicatorProps {\n  status: AIUsageStatus | null\n  loading: boolean\n  compact?: boolean\n}\n\nexport const AIUsageIndicator: React.FC<AIUsageIndicatorProps> = ({\n  status,\n  loading,\n  compact = false\n}) => {\n  if (loading) {\n    return (\n      <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n        <Clock className=\"w-4 h-4 animate-spin\" />\n        {!compact && <span>èª­ã¿è¾¼ã¿ä¸­...</span>}\n      </div>\n    )\n  }\n\n  if (!status) {\n    return null\n  }\n\n  const isUnlimited = status.dailyLimit === -1\n  const usagePercent = isUnlimited ? 0 : Math.min((status.currentCount / status.dailyLimit) * 100, 100)\n  const isWarning = usagePercent >= 80 && usagePercent < 100\n  const isError = usagePercent >= 100 || status.isLimited\n\n  const getTimeUntilReset = () => {\n    const now = new Date()\n    const resetTime = new Date(status.resetAt)\n    const diff = resetTime.getTime() - now.getTime()\n    const hours = Math.floor(diff / (1000 * 60 * 60))\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))\n\n    if (hours > 0) {\n      return `${hours}æ™‚é–“${minutes}åˆ†å¾Œ`\n    }\n    return `${minutes}åˆ†å¾Œ`\n  }\n\n  if (compact) {\n    return (\n      <div className=\"flex items-center gap-2\">\n        {isUnlimited ? (\n          <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-700 border-blue-300\">\n            ç„¡åˆ¶é™\n          </Badge>\n        ) : (\n          <>\n            <Badge\n              variant={isError ? 'destructive' : isWarning ? 'outline' : 'secondary'}\n              className={\n                isError\n                  ? ''\n                  : isWarning\n                  ? 'bg-yellow-50 text-yellow-700 border-yellow-300'\n                  : 'bg-green-50 text-green-700 border-green-300'\n              }\n            >\n              {status.currentCount}/{status.dailyLimit}å›\n            </Badge>\n          </>\n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          {isUnlimited ? (\n            <>\n              <CheckCircle className=\"w-4 h-4 text-blue-600\" />\n              <span className=\"text-sm font-medium text-blue-700\">AIåˆ©ç”¨: ç„¡åˆ¶é™</span>\n            </>\n          ) : isError ? (\n            <>\n              <AlertCircle className=\"w-4 h-4 text-red-600\" />\n              <span className=\"text-sm font-medium text-red-700\">åˆ©ç”¨ä¸Šé™åˆ°é”</span>\n            </>\n          ) : isWarning ? (\n            <>\n              <AlertCircle className=\"w-4 h-4 text-yellow-600\" />\n              <span className=\"text-sm font-medium text-yellow-700\">æ®‹ã‚Šã‚ãšã‹</span>\n            </>\n          ) : (\n            <>\n              <CheckCircle className=\"w-4 h-4 text-green-600\" />\n              <span className=\"text-sm font-medium text-green-700\">åˆ©ç”¨å¯èƒ½</span>\n            </>\n          )}\n        </div>\n        {!isUnlimited && (\n          <span className=\"text-sm font-medium text-foreground\">\n            {status.remaining}å› / {status.dailyLimit}å›\n          </span>\n        )}\n      </div>\n\n      {!isUnlimited && (\n        <>\n          <Progress\n            value={usagePercent}\n            className={`h-2 ${\n              isError\n                ? 'bg-red-100 [&>div]:bg-red-500'\n                : isWarning\n                ? 'bg-yellow-100 [&>div]:bg-yellow-500'\n                : 'bg-green-100 [&>div]:bg-green-500'\n            }`}\n          />\n\n          <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n            <span>\n              {isError\n                ? 'æ˜æ—¥ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™'\n                : `æ®‹ã‚Š${status.remaining}å›åˆ©ç”¨å¯èƒ½`}\n            </span>\n            <span className=\"flex items-center gap-1\">\n              <Clock className=\"w-3 h-3\" />\n              {getTimeUntilReset()}ã«ãƒªã‚»ãƒƒãƒˆ\n            </span>\n          </div>\n        </>\n      )}\n\n      {isError && (\n        <div className=\"text-xs text-red-600 bg-red-50 border border-red-200 rounded p-2\">\n          æœ¬æ—¥ã®åˆ©ç”¨ä¸Šé™ã«é”ã—ã¾ã—ãŸã€‚åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿åˆ†ææ©Ÿèƒ½ã¯å¼•ãç¶šãã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚\n        </div>\n      )}\n\n      {isWarning && !isError && status.remaining <= 2 && (\n        <div className=\"text-xs text-yellow-700 bg-yellow-50 border border-yellow-200 rounded p-2\">\n          æ®‹ã‚Š{status.remaining}å›ã§ã™ã€‚è¨ˆç”»çš„ã«ã”åˆ©ç”¨ãã ã•ã„ã€‚\n        </div>\n      )}\n    </div>\n  )\n}\n",
  "src/components/Dashboard/AIChatWidget.tsx": "import React, { useState, useRef, useEffect } from 'react';\nimport { MessageCircle, Send, Minimize2, Maximize2, X, Bot, User, Sparkles, HelpCircle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { DailyReport } from '@/types';\nimport { formatCurrency } from '@/lib/utils';\n\ninterface Message {\n  id: string;\n  type: 'user' | 'ai';\n  content: string;\n  timestamp: Date;\n  suggestions?: string[];\n}\n\ninterface AIChatWidgetProps {\n  reports: DailyReport[];\n}\n\nexport const AIChatWidget: React.FC<AIChatWidgetProps> = ({ reports }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [messages, setMessages] = useState<Message[]>([\n    {\n      id: '1',\n      type: 'ai',\n      content: 'ã“ã‚“ã«ã¡ã¯ï¼ğŸ“Š å±…é…’å±‹ã„ã£ãã®æ¥­å‹™ãƒ‡ãƒ¼ã‚¿åˆ†æAIã§ã™ã€‚\\n\\nå£²ä¸Šãƒ»çµŒè²»ãƒ»åˆ©ç›Šã«ã¤ã„ã¦ãªã‚“ã§ã‚‚ãŠèããã ã•ã„ã€‚ä¾‹ãˆã°ï¼š',\n      suggestions: [\n        'ä»Šæœˆã®å£²ä¸Šåˆè¨ˆã¯ï¼Ÿ',\n        'åˆ©ç›Šç‡ãŒä¸€ç•ªé«˜ã„åº—èˆ—ã¯ï¼Ÿ',\n        'çµŒè²»ã®å†…è¨³ã‚’æ•™ãˆã¦',\n        'å‰æœˆã¨æ¯”è¼ƒã—ã¦ã©ã†ï¼Ÿ'\n      ],\n      timestamp: new Date()\n    }\n  ]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã‚’æœ€ä¸‹éƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  // é«˜åº¦ãªAIå¿œç­”ç”Ÿæˆ\n  const generateAIResponse = (question: string): { content: string; suggestions?: string[] } => {\n    const q = question.toLowerCase();\n    \n    if (reports.length === 0) {\n      return {\n        content: 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€ã¾ã åˆ†æã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚\\n\\nã€Œæ–°è¦å ±å‘Šã€ãƒœã‚¿ãƒ³ã‹ã‚‰æ—¥æ¬¡å ±å‘Šã‚’ä½œæˆã—ã¦ã‹ã‚‰ã€å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',\n        suggestions: ['æ–°è¦å ±å‘Šã®ä½œæˆæ–¹æ³•ã¯ï¼Ÿ', 'ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦']\n      };\n    }\n\n    // ãƒ‡ãƒ¼ã‚¿åˆ†æã®åŸºæœ¬è¨ˆç®—\n    const today = new Date().toISOString().split('T')[0];\n    const thisMonth = today.substring(0, 7);\n    const lastMonth = new Date(new Date().setMonth(new Date().getMonth() - 1)).toISOString().substring(0, 7);\n    \n    const todayReports = reports.filter(r => r.date === today);\n    const thisMonthReports = reports.filter(r => r.date.startsWith(thisMonth));\n    const lastMonthReports = reports.filter(r => r.date.startsWith(lastMonth));\n    \n    const calculateTotals = (reportList: DailyReport[]) => {\n      return reportList.reduce((acc, report) => {\n        const totalExpenses = report.purchase + report.laborCost + report.utilities + \n                             report.promotion + report.cleaning + report.misc + \n                             report.communication + report.others;\n        \n        return {\n          sales: acc.sales + report.sales,\n          expenses: acc.expenses + totalExpenses,\n          purchase: acc.purchase + report.purchase,\n          profit: acc.profit + (report.sales - totalExpenses),\n          count: acc.count + 1\n        };\n      }, { sales: 0, expenses: 0, purchase: 0, profit: 0, count: 0 });\n    };\n\n    const todayTotals = calculateTotals(todayReports);\n    const thisMonthTotals = calculateTotals(thisMonthReports);\n    const lastMonthTotals = calculateTotals(lastMonthReports);\n    \n    // åº—èˆ—åˆ¥åˆ†æ\n    const storeAnalysis = reports.reduce((acc, report) => {\n      if (!acc[report.storeName]) {\n        acc[report.storeName] = { sales: 0, expenses: 0, profit: 0, count: 0 };\n      }\n      const expenses = report.purchase + report.laborCost + report.utilities + \n                      report.promotion + report.cleaning + report.misc + \n                      report.communication + report.others;\n      acc[report.storeName].sales += report.sales;\n      acc[report.storeName].expenses += expenses;\n      acc[report.storeName].profit += (report.sales - expenses);\n      acc[report.storeName].count += 1;\n      return acc;\n    }, {} as Record<string, { sales: number; expenses: number; profit: number; count: number }>);\n\n    // è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³è§£æã¨å›ç­”ç”Ÿæˆ\n    \n    // 1. å£²ä¸Šé–¢é€£ã®è³ªå•\n    if (q.includes('å£²ä¸Š') && (q.includes('åˆè¨ˆ') || q.includes('ç·'))) {\n      if (q.includes('ä»Šæ—¥') || q.includes('æœ¬æ—¥')) {\n        return {\n          content: `ğŸ“Š **æœ¬æ—¥ã®å£²ä¸Šåˆè¨ˆ**\\n\\n${formatCurrency(todayTotals.sales)} ï¼ˆ${todayTotals.count}ä»¶ã®å ±å‘Šï¼‰\\n\\n${todayTotals.count === 0 ? 'âš ï¸ æœ¬æ—¥ã®å ±å‘ŠãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚' : 'âœ… é †èª¿ã«å ±å‘ŠãŒä¸ŠãŒã£ã¦ã„ã¾ã™ï¼'}`,\n          suggestions: ['ä»Šæ—¥ã®åˆ©ç›Šã¯ï¼Ÿ', 'æ˜¨æ—¥ã¨æ¯”è¼ƒã—ã¦', 'ä»Šæ—¥ã®åº—èˆ—åˆ¥å£²ä¸Šã¯ï¼Ÿ']\n        };\n      } else if (q.includes('ä»Šæœˆ')) {\n        const monthlyGrowth = lastMonthTotals.sales > 0 ? ((thisMonthTotals.sales - lastMonthTotals.sales) / lastMonthTotals.sales) * 100 : 0;\n        return {\n          content: `ğŸ“ˆ **ä»Šæœˆã®å£²ä¸Šåˆè¨ˆ**\\n\\n${formatCurrency(thisMonthTotals.sales)} ï¼ˆ${thisMonthTotals.count}ä»¶ã®å ±å‘Šï¼‰\\n\\nå‰æœˆæ¯”: ${monthlyGrowth >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${monthlyGrowth.toFixed(1)}%\\nå‰æœˆ: ${formatCurrency(lastMonthTotals.sales)}`,\n          suggestions: ['ä»Šæœˆã®åˆ©ç›Šç‡ã¯ï¼Ÿ', 'åº—èˆ—åˆ¥ã®å£²ä¸Šãƒ©ãƒ³ã‚­ãƒ³ã‚°', 'ç›®æ¨™é”æˆåº¦ã¯ï¼Ÿ']\n        };\n      } else {\n        return {\n          content: `ğŸ’° **ç·å£²ä¸Šåˆè¨ˆ**\\n\\n${formatCurrency(thisMonthTotals.sales)} ï¼ˆå…¨æœŸé–“: ${reports.length}ä»¶ã®å ±å‘Šï¼‰\\n\\nå¹³å‡æ—¥å•†: ${formatCurrency(thisMonthTotals.sales / Math.max(thisMonthTotals.count, 1))}`,\n          suggestions: ['æœŸé–“ã‚’æŒ‡å®šã—ã¦åˆ†æ', 'åº—èˆ—åˆ¥ã®å£²ä¸Šã¯ï¼Ÿ', 'åˆ©ç›Šç‡ã®åˆ†æ']\n        };\n      }\n    }\n\n    // 2. åˆ©ç›Šãƒ»åˆ©ç›Šç‡é–¢é€£\n    if (q.includes('åˆ©ç›Š') && (q.includes('ç‡') || q.includes('ãƒãƒ¼ã‚¸ãƒ³'))) {\n      const profitMargin = thisMonthTotals.sales > 0 ? (thisMonthTotals.profit / thisMonthTotals.sales) * 100 : 0;\n      const storeMargins = Object.entries(storeAnalysis).map(([name, data]) => ({\n        name,\n        margin: data.sales > 0 ? (data.profit / data.sales) * 100 : 0\n      })).sort((a, b) => b.margin - a.margin);\n\n      return {\n        content: `ğŸ“Š **åˆ©ç›Šç‡åˆ†æ**\\n\\nğŸ¢ å…¨åº—èˆ—å¹³å‡: **${profitMargin.toFixed(1)}%**\\n\\nğŸ† **åº—èˆ—åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°:**\\n${storeMargins.map((store, index) => \n          `${index + 1}ä½. ${store.name}: ${store.margin.toFixed(1)}%`\n        ).join('\\n')}\\n\\n${profitMargin >= 20 ? 'ğŸ‰ å„ªç§€ãªåˆ©ç›Šç‡ã§ã™ï¼' : profitMargin >= 15 ? 'ğŸ‘ è‰¯å¥½ãªåˆ©ç›Šç‡ã§ã™' : 'âš ï¸ åˆ©ç›Šç‡æ”¹å–„ãŒå¿…è¦ã§ã™'}`,\n        suggestions: ['åˆ©ç›Šç‡ã‚’æ”¹å–„ã™ã‚‹ã«ã¯ï¼Ÿ', 'çµŒè²»å‰Šæ¸›ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹', 'æœ€ã‚‚åˆ©ç›Šç‡ã®é«˜ã„åº—èˆ—ã®è©³ç´°']\n      };\n    }\n\n    // 3. åº—èˆ—æ¯”è¼ƒãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°\n    if (q.includes('åº—èˆ—') && (q.includes('æ¯”è¼ƒ') || q.includes('ãƒ©ãƒ³ã‚­ãƒ³ã‚°') || q.includes('é«˜ã„') || q.includes('ä¸€ç•ª'))) {\n      const storeRanking = Object.entries(storeAnalysis)\n        .map(([name, data]) => ({\n          name,\n          sales: data.sales,\n          profit: data.profit,\n          profitMargin: data.sales > 0 ? (data.profit / data.sales) * 100 : 0,\n          count: data.count\n        }))\n        .sort((a, b) => b.sales - a.sales);\n\n      return {\n        content: `ğŸ† **åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ©ãƒ³ã‚­ãƒ³ã‚°**\\n\\nğŸ“Š **å£²ä¸Šãƒ©ãƒ³ã‚­ãƒ³ã‚°:**\\n${storeRanking.map((store, index) => \n          `${['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index] || 'ğŸª'} ${store.name}\\n   å£²ä¸Š: ${formatCurrency(store.sales)}\\n   åˆ©ç›Šç‡: ${store.profitMargin.toFixed(1)}%`\n        ).join('\\n\\n')}`,\n        suggestions: ['ãƒˆãƒƒãƒ—åº—èˆ—ã®æˆåŠŸè¦å› ã¯ï¼Ÿ', 'ä¸‹ä½åº—èˆ—ã®æ”¹å–„ç‚¹', 'å…¨åº—èˆ—ã®å¹³å‡ã¨æ¯”è¼ƒ']\n      };\n    }\n\n    // 4. çµŒè²»åˆ†æ\n    if (q.includes('çµŒè²»') && (q.includes('å†…è¨³') || q.includes('æ¯”ç‡') || q.includes('åˆ†æ'))) {\n      const expenseBreakdown = reports.reduce((acc, report) => {\n        acc.purchase += report.purchase;\n        acc.laborCost += report.laborCost;\n        acc.utilities += report.utilities;\n        acc.promotion += report.promotion;\n        acc.cleaning += report.cleaning;\n        acc.misc += report.misc;\n        acc.communication += report.communication;\n        acc.others += report.others;\n        return acc;\n      }, {\n        purchase: 0, laborCost: 0, utilities: 0, promotion: 0,\n        cleaning: 0, misc: 0, communication: 0, others: 0\n      });\n\n      const totalExpenses = Object.values(expenseBreakdown).reduce((sum, val) => sum + val, 0);\n      const expenseItems = [\n        { name: 'ä»•å…¥', value: expenseBreakdown.purchase },\n        { name: 'äººä»¶è²»', value: expenseBreakdown.laborCost },\n        { name: 'å…‰ç†±è²»', value: expenseBreakdown.utilities },\n        { name: 'è²©ä¿ƒè²»', value: expenseBreakdown.promotion },\n        { name: 'æ¸…æƒè²»', value: expenseBreakdown.cleaning },\n        { name: 'é€šä¿¡è²»', value: expenseBreakdown.communication },\n        { name: 'é›‘è²»', value: expenseBreakdown.misc },\n        { name: 'ãã®ä»–', value: expenseBreakdown.others }\n      ].filter(item => item.value > 0).sort((a, b) => b.value - a.value);\n\n      return {\n        content: `ğŸ’¸ **çµŒè²»å†…è¨³åˆ†æ**\\n\\nğŸ’° çµŒè²»åˆè¨ˆ: **${formatCurrency(totalExpenses)}**\\n\\nğŸ“Š **ä¸»ãªçµŒè²»é …ç›®:**\\n${expenseItems.map(item => \n          `â€¢ ${item.name}: ${formatCurrency(item.value)} (${((item.value / totalExpenses) * 100).toFixed(1)}%)`\n        ).join('\\n')}\\n\\nğŸ’¡ **åˆ†æçµæœ:**\\nä»•å…¥è²»ãŒ${((expenseBreakdown.purchase / totalExpenses) * 100).toFixed(1)}%ã‚’å ã‚ã¦ã„ã¾ã™ã€‚`,\n        suggestions: ['çµŒè²»å‰Šæ¸›ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹', 'ä»•å…¥ã‚³ã‚¹ãƒˆã‚’ä¸‹ã’ã‚‹ã«ã¯ï¼Ÿ', 'äººä»¶è²»ã®æœ€é©åŒ–æ–¹æ³•']\n      };\n    }\n\n    // 5. ç›®æ¨™ãƒ»é”æˆåº¦é–¢é€£\n    if (q.includes('ç›®æ¨™') || q.includes('é”æˆ')) {\n      const defaultTarget = 25000000; // å…¨åº—èˆ—ã®æœˆé–“ç›®æ¨™\n      const achievement = (thisMonthTotals.sales / defaultTarget) * 100;\n      const remaining = defaultTarget - thisMonthTotals.sales;\n      \n      return {\n        content: `ğŸ¯ **ç›®æ¨™é”æˆåº¦åˆ†æ**\\n\\nğŸ“Š **ä»Šæœˆã®é€²æ—:**\\nâ€¢ å®Ÿç¸¾: ${formatCurrency(thisMonthTotals.sales)}\\nâ€¢ ç›®æ¨™: ${formatCurrency(defaultTarget)}\\nâ€¢ é”æˆç‡: **${achievement.toFixed(1)}%**\\n\\n${achievement >= 100 ? 'ğŸ‰ ç›®æ¨™é”æˆãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼' : achievement >= 80 ? 'ğŸ‘ ç›®æ¨™ã¾ã§ã‚ã¨å°‘ã—ã§ã™ï¼' : 'âš ï¸ ç›®æ¨™é”æˆã«å‘ã‘ã¦å¯¾ç­–ãŒå¿…è¦ã§ã™'}\\n\\næ®‹ã‚Šå¿…è¦å£²ä¸Š: ${formatCurrency(Math.max(remaining, 0))}`,\n        suggestions: ['ç›®æ¨™é”æˆã®ãŸã‚ã®æ–½ç­–', 'å„åº—èˆ—ã®é€²æ—çŠ¶æ³', 'æ¥æœˆã®ç›®æ¨™è¨­å®š']\n      };\n    }\n\n    // 6. ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ»å‚¾å‘åˆ†æ\n    if (q.includes('å‚¾å‘') || q.includes('ãƒˆãƒ¬ãƒ³ãƒ‰') || q.includes('æ¨ç§»')) {\n      const recentDays = reports.slice(0, 7);\n      const recentSales = recentDays.reduce((sum, r) => sum + r.sales, 0);\n      const avgDailySales = recentSales / Math.max(recentDays.length, 1);\n      \n      return {\n        content: `ğŸ“ˆ **å£²ä¸Šãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ**\\n\\nğŸ“Š **ç›´è¿‘7æ—¥é–“:**\\nâ€¢ ç·å£²ä¸Š: ${formatCurrency(recentSales)}\\nâ€¢ å¹³å‡æ—¥å•†: ${formatCurrency(avgDailySales)}\\nâ€¢ å ±å‘Šä»¶æ•°: ${recentDays.length}ä»¶\\n\\nğŸ’¡ **ãƒˆãƒ¬ãƒ³ãƒ‰:**\\n${avgDailySales > 300000 ? 'ğŸ“ˆ å¥½èª¿ãªå£²ä¸Šæ¨ç§»ã§ã™' : avgDailySales > 200000 ? 'ğŸ“Š å®‰å®šã—ãŸå£²ä¸Šã§ã™' : 'ğŸ“‰ å£²ä¸Šå‘ä¸Šã®æ–½ç­–ãŒå¿…è¦ã§ã™'}`,\n        suggestions: ['é€±æœ«ã¨å¹³æ—¥ã®æ¯”è¼ƒ', 'å­£ç¯€è¦å› ã®å½±éŸ¿', 'å£²ä¸Šå‘ä¸Šã®ææ¡ˆ']\n      };\n    }\n\n    // 7. æ™‚é–“å¸¯ãƒ»æ›œæ—¥åˆ†æ\n    if (q.includes('æ™‚é–“') || q.includes('æ›œæ—¥') || q.includes('ãƒ”ãƒ¼ã‚¯')) {\n      return {\n        content: `â° **å–¶æ¥­æ™‚é–“åˆ†æ**\\n\\nğŸ“Š **ä¸€èˆ¬çš„ãªé£²é£Ÿåº—ã®å‚¾å‘:**\\nâ€¢ ãƒ©ãƒ³ãƒã‚¿ã‚¤ãƒ : 11:30-14:00\\nâ€¢ ãƒ‡ã‚£ãƒŠãƒ¼ã‚¿ã‚¤ãƒ : 17:30-22:00\\nâ€¢ é€±æœ«ã¯å¹³æ—¥æ¯” 140%ã®å£²ä¸Š\\n\\nğŸ’¡ **æ”¹å–„ææ¡ˆ:**\\nâ€¢ ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ ã®æœ‰åŠ¹æ´»ç”¨\\nâ€¢ ãƒãƒƒãƒ”ãƒ¼ã‚¢ãƒ¯ãƒ¼ã®å°å…¥\\nâ€¢ é€±æœ«é™å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å±•é–‹`,\n        suggestions: ['ãƒ”ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã®å£²ä¸Šæœ€å¤§åŒ–', 'ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ å¯¾ç­–', 'æ›œæ—¥åˆ¥æˆ¦ç•¥']\n      };\n    }\n\n    // 8. ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒ»æ”¹å–„ææ¡ˆ\n    if (q.includes('æ”¹å–„') || q.includes('å‰Šæ¸›') || q.includes('ã‚³ã‚¹ãƒˆ') || q.includes('ç¯€ç´„')) {\n      const avgExpenseRatio = thisMonthTotals.expenses / thisMonthTotals.sales * 100;\n      \n      return {\n        content: `ğŸ’¡ **çµŒå–¶æ”¹å–„ææ¡ˆ**\\n\\nğŸ“Š **ç¾åœ¨ã®çµŒè²»ç‡:** ${avgExpenseRatio.toFixed(1)}%\\n\\nğŸ¯ **æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**\\nâ€¢ ä»•å…¥å…ˆã®è¦‹ç›´ã— â†’ 5-10%ã‚³ã‚¹ãƒˆå‰Šæ¸›å¯èƒ½\\nâ€¢ ã‚¨ãƒãƒ«ã‚®ãƒ¼åŠ¹ç‡åŒ– â†’ å…‰ç†±è²»10%å‰Šæ¸›\\nâ€¢ ã‚¹ã‚¿ãƒƒãƒ•ã‚·ãƒ•ãƒˆæœ€é©åŒ– â†’ äººä»¶è²»åŠ¹ç‡å‘ä¸Š\\nâ€¢ é£Ÿæãƒ­ã‚¹å‰Šæ¸› â†’ ä»•å…¥ã‚³ã‚¹ãƒˆ5%æ”¹å–„\\n\\nğŸ“ˆ **æœŸå¾…åŠ¹æœ:** åˆ©ç›Šç‡3-5%å‘ä¸Š`,\n        suggestions: ['å…·ä½“çš„ãªä»•å…¥å…ˆå¤‰æ›´æ¡ˆ', 'ã‚·ãƒ•ãƒˆæœ€é©åŒ–æ–¹æ³•', 'é£Ÿæãƒ­ã‚¹å‰Šæ¸›ç­–']\n      };\n    }\n\n    // 9. äºˆæ¸¬ãƒ»å°†æ¥åˆ†æ\n    if (q.includes('äºˆæ¸¬') || q.includes('å°†æ¥') || q.includes('æ¥æœˆ') || q.includes('è¦‹è¾¼ã¿')) {\n      const monthlyGrowth = lastMonthTotals.sales > 0 ? ((thisMonthTotals.sales - lastMonthTotals.sales) / lastMonthTotals.sales) * 100 : 0;\n      const predictedNextMonth = thisMonthTotals.sales * (1 + monthlyGrowth / 100);\n      \n      return {\n        content: `ğŸ”® **å£²ä¸Šäºˆæ¸¬åˆ†æ**\\n\\nğŸ“Š **æ¥æœˆäºˆæ¸¬:**\\nâ€¢ äºˆæƒ³å£²ä¸Š: ${formatCurrency(predictedNextMonth)}\\nâ€¢ æˆé•·ç‡: ${monthlyGrowth.toFixed(1)}%\\n\\nğŸ¯ **äºˆæ¸¬æ ¹æ‹ :**\\nâ€¢ éå»ã®æˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰\\nâ€¢ å­£ç¯€è¦å› \\nâ€¢ ç¾åœ¨ã®å–¶æ¥­çŠ¶æ³\\n\\n${monthlyGrowth > 0 ? 'ğŸ“ˆ æˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰ç¶™ç¶šäºˆæƒ³' : 'ğŸ“‰ å£²ä¸Šå›å¾©æ–½ç­–ã®æ¤œè¨ãŒå¿…è¦'}`,\n        suggestions: ['äºˆæ¸¬ã‚’å‘ä¸Šã•ã›ã‚‹æ–¹æ³•', 'æˆé•·æˆ¦ç•¥ã®ææ¡ˆ', 'ãƒªã‚¹ã‚¯è¦å› ã®åˆ†æ']\n      };\n    }\n\n    // 10. å…·ä½“çš„ãªæ•°å€¤è³ªå•\n    if (q.includes('ã„ãã‚‰') || q.includes('é‡‘é¡') || q.includes('å††')) {\n      return {\n        content: `ğŸ’° **é‡‘é¡ã‚µãƒãƒªãƒ¼**\\n\\nğŸ“Š **ä»Šæœˆã®å®Ÿç¸¾:**\\nâ€¢ å£²ä¸Š: ${formatCurrency(thisMonthTotals.sales)}\\nâ€¢ çµŒè²»: ${formatCurrency(thisMonthTotals.expenses)}\\nâ€¢ ç²—åˆ©: ${formatCurrency(thisMonthTotals.sales - reports.reduce((sum, r) => sum + r.purchase, 0))}\\nâ€¢ å–¶æ¥­åˆ©ç›Š: ${formatCurrency(thisMonthTotals.profit)}\\n\\nğŸ’¡ åˆ©ç›Šç‡: ${thisMonthTotals.sales > 0 ? ((thisMonthTotals.profit / thisMonthTotals.sales) * 100).toFixed(1) : 0}%`,\n        suggestions: ['åˆ©ç›Šã‚’å¢—ã‚„ã™ã«ã¯ï¼Ÿ', 'çµŒè²»ã®æœ€é©åŒ–', 'å£²ä¸Šå‘ä¸Šæ–½ç­–']\n      };\n    }\n\n    // 11. ä¸€èˆ¬çš„ãªçµŒå–¶ç›¸è«‡\n    const suggestions = [\n      'ä»Šæœˆã®å£²ä¸Šåˆè¨ˆã¯ï¼Ÿ',\n      'åˆ©ç›Šç‡åˆ†æã‚’ã—ã¦',\n      'åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ',\n      'çµŒè²»å†…è¨³ã‚’è©³ã—ã',\n      'ç›®æ¨™é”æˆåº¦ã®ç¢ºèª',\n      'æ¥æœˆã®å£²ä¸Šäºˆæ¸¬',\n      'æ”¹å–„ææ¡ˆã‚’ã—ã¦'\n    ];\n\n    return {\n      content: `ğŸ¤– **ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“**\\n\\nãã®è³ªå•ã¯ç†è§£ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\\n\\nğŸ“ **ã‚ˆãã‚ã‚‹è³ªå•ä¾‹:**\\nâ€¢ å£²ä¸Šãƒ»åˆ©ç›Šã«é–¢ã™ã‚‹è³ªå•\\nâ€¢ åº—èˆ—æ¯”è¼ƒãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°\\nâ€¢ ç›®æ¨™é”æˆåº¦ã®ç¢ºèª\\nâ€¢ çµŒè²»å‰Šæ¸›ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹\\nâ€¢ å°†æ¥äºˆæ¸¬\\n\\nğŸ’¡ å…·ä½“çš„ãªè³ªå•ã‚’ãŠè©¦ã—ãã ã•ã„ï¼`,\n      suggestions\n    };\n  };\n\n  const handleSendMessage = async () => {\n    if (!inputMessage.trim() || isLoading) return;\n\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      type: 'user',\n      content: inputMessage,\n      timestamp: new Date()\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setInputMessage('');\n    setIsLoading(true);\n\n    // AIå¿œç­”ã®ç”Ÿæˆï¼ˆãƒªã‚¢ãƒ«ãªé…å»¶ã§UXå‘ä¸Šï¼‰\n    setTimeout(() => {\n      const response = generateAIResponse(inputMessage);\n      const aiMessage: Message = {\n        id: (Date.now() + 1).toString(),\n        type: 'ai',\n        content: response.content,\n        suggestions: response.suggestions,\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, aiMessage]);\n      setIsLoading(false);\n    }, 1000 + Math.random() * 1000); // 1-2ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶\n  };\n\n  const handleSuggestionClick = (suggestion: string) => {\n    setInputMessage(suggestion);\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const clearChat = () => {\n    setMessages([{\n      id: '1',\n      type: 'ai',\n      content: 'ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚ğŸ—‘ï¸\\n\\næ–°ã—ã„è³ªå•ã‚’ãŠèã‹ã›ãã ã•ã„ï¼',\n      suggestions: [\n        'ä»Šæœˆã®å£²ä¸Šåˆè¨ˆã¯ï¼Ÿ',\n        'åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹',\n        'åˆ©ç›Šç‡åˆ†æ',\n        'çµŒè²»å‰Šæ¸›ææ¡ˆ'\n      ],\n      timestamp: new Date()\n    }]);\n  };\n\n  if (!isOpen) {\n    return (\n      <div className=\"fixed bottom-6 right-6 z-50\">\n        <Button\n          onClick={() => setIsOpen(true)}\n          className=\"w-16 h-16 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300\"\n        >\n          <div className=\"relative\">\n            <MessageCircle className=\"w-7 h-7 text-white\" />\n            <Sparkles className=\"w-4 h-4 text-yellow-300 absolute -top-1 -right-1\" />\n          </div>\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed bottom-6 right-6 z-50\">\n      <Card className={`${\n        isMinimized ? 'w-80 h-20' : 'w-96 h-[32rem]'\n      } shadow-2xl transition-all duration-300 border-0 overflow-hidden`}>\n        <CardHeader className={`pb-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white ${isMinimized ? 'rounded-lg' : 'rounded-t-lg'}`}>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"text-sm flex items-center gap-2\">\n              <div className=\"relative\">\n                <Bot className=\"w-5 h-5\" />\n                <div className=\"absolute -top-1 -right-1 w-2 h-2 bg-green-400 rounded-full animate-pulse\"></div>\n              </div>\n              æ¥­å‹™åˆ†æAIï¼ˆÎ²ç‰ˆï¼‰\n            </CardTitle>\n            <div className=\"flex items-center gap-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsMinimized(!isMinimized)}\n                className=\"w-8 h-8 p-0 text-white hover:bg-white/20\"\n              >\n                {isMinimized ? <Maximize2 className=\"w-4 h-4\" /> : <Minimize2 className=\"w-4 h-4\" />}\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsOpen(false)}\n                className=\"w-8 h-8 p-0 text-white hover:bg-white/20\"\n              >\n                <X className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n          {!isMinimized && (\n            <p className=\"text-xs text-blue-100 mt-1\">\n              ğŸ’¬ å£²ä¸Šãƒ»åˆ©ç›Šãƒ»çµŒè²»ã«ã¤ã„ã¦ä½•ã§ã‚‚ãŠèããã ã•ã„\n            </p>\n          )}\n        </CardHeader>\n        \n        {!isMinimized && (\n          <CardContent className=\"flex flex-col h-96 p-0\">\n            {/* Messages Area */}\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50\">\n              {messages.map((message) => (\n                <div key={message.id} className=\"space-y-3\">\n                  <div className={`flex gap-3 ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}>\n                    {message.type === 'ai' && (\n                      <div className=\"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center flex-shrink-0\">\n                        <Bot className=\"w-4 h-4 text-white\" />\n                      </div>\n                    )}\n                    <div className={`max-w-[85%] px-4 py-3 rounded-2xl text-sm leading-relaxed ${\n                      message.type === 'user'\n                        ? 'bg-blue-600 text-white rounded-br-md shadow-lg'\n                        : 'bg-white text-gray-900 rounded-bl-md shadow-lg border border-gray-200'\n                    }`}>\n                      <div className=\"whitespace-pre-line\">{message.content}</div>\n                      <p className={`text-xs mt-2 ${\n                        message.type === 'user' ? 'text-blue-100' : 'text-gray-500'\n                      }`}>\n                        {message.timestamp.toLocaleTimeString('ja-JP', { \n                          hour: '2-digit', \n                          minute: '2-digit' \n                        })}\n                      </p>\n                    </div>\n                    {message.type === 'user' && (\n                      <div className=\"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0\">\n                        <User className=\"w-4 h-4 text-gray-600\" />\n                      </div>\n                    )}\n                  </div>\n                  \n                  {/* AIææ¡ˆãƒœã‚¿ãƒ³ */}\n                  {message.type === 'ai' && message.suggestions && (\n                    <div className=\"ml-11 space-y-2\">\n                      <p className=\"text-xs text-gray-500 flex items-center gap-1\">\n                        <HelpCircle className=\"w-3 h-3\" />\n                        ãŠã™ã™ã‚ã®è³ªå•:\n                      </p>\n                      <div className=\"flex flex-wrap gap-2\">\n                        {message.suggestions.map((suggestion, index) => (\n                          <button\n                            key={index}\n                            onClick={() => handleSuggestionClick(suggestion)}\n                            className=\"px-3 py-1 bg-blue-50 text-blue-700 text-xs rounded-full hover:bg-blue-100 transition-colors border border-blue-200\"\n                          >\n                            {suggestion}\n                          </button>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              ))}\n              \n              {isLoading && (\n                <div className=\"flex gap-3 justify-start\">\n                  <div className=\"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center flex-shrink-0\">\n                    <Bot className=\"w-4 h-4 text-white\" />\n                  </div>\n                  <div className=\"bg-white px-4 py-3 rounded-2xl rounded-bl-md shadow-lg border border-gray-200\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"flex gap-1\">\n                        <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\"></div>\n                        <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                        <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                      </div>\n                      <span className=\"text-xs text-gray-500\">åˆ†æä¸­...</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n              <div ref={messagesEndRef} />\n            </div>\n            \n            {/* Input Area */}\n            <div className=\"p-4 border-t border-gray-200 bg-white\">\n              <div className=\"flex gap-2 mb-2\">\n                <button\n                  onClick={clearChat}\n                  className=\"text-xs text-gray-500 hover:text-gray-700 px-2 py-1 rounded hover:bg-gray-100 transition-colors\"\n                >\n                  ğŸ—‘ï¸ å±¥æ­´ã‚¯ãƒªã‚¢\n                </button>\n                <div className=\"text-xs text-gray-400 flex items-center gap-1\">\n                  <Sparkles className=\"w-3 h-3\" />\n                  {reports.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã§åˆ†æä¸­\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <div className=\"flex-1 relative\">\n                  <input\n                    type=\"text\"\n                    value={inputMessage}\n                    onChange={(e) => setInputMessage(e.target.value)}\n                    onKeyPress={handleKeyPress}\n                    placeholder=\"ä¾‹: å£²ä¸Šå‘ä¸Šã®å…·ä½“çš„ãªæˆ¦ç•¥ã‚’ææ¡ˆã—ã¦\"\n                    className=\"w-full px-4 py-3 text-sm border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 focus:bg-white transition-colors\"\n                    disabled={isLoading}\n                  />\n                  {inputMessage && (\n                    <button\n                      onClick={() => setInputMessage('')}\n                      className=\"absolute right-12 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\n                    >\n                      <X className=\"w-4 h-4\" />\n                    </button>\n                  )}\n                </div>\n                <Button\n                  onClick={handleSendMessage}\n                  disabled={isLoading || !inputMessage.trim()}\n                  className=\"px-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-xl\"\n                >\n                  {isLoading ? (\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  ) : (\n                    <Send className=\"w-4 h-4\" />\n                  )}\n                </Button>\n              </div>\n              <p className=\"text-xs text-gray-400 mt-2 text-center\">\n                ğŸ¤– ChatGPTé€£æº | Enteré€ä¿¡ | é«˜åº¦ãªAIçµŒå–¶åˆ†æ\n              </p>\n            </div>\n          </CardContent>\n        )}\n      </Card>\n    </div>\n  );\n};",
  "src/components/Dashboard/AIReportNotification.tsx": "import { useState, useEffect } from 'react';\nimport { FileText, X, ExternalLink } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '../../lib/supabase';\nimport { Badge } from '../ui/badge';\nimport { Button } from '../ui/button';\n\ninterface RecentReport {\n  id: string;\n  title: string;\n  report_type: 'weekly' | 'monthly';\n  generated_at: string;\n}\n\nexport function AIReportNotification() {\n  const [recentReports, setRecentReports] = useState<RecentReport[]>([]);\n  const [dismissed, setDismissed] = useState<string[]>([]);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    fetchRecentReports();\n\n    const dismissedIds = localStorage.getItem('dismissedReports');\n    if (dismissedIds) {\n      setDismissed(JSON.parse(dismissedIds));\n    }\n\n    const subscription = supabase\n      .channel('ai_reports_notifications')\n      .on(\n        'postgres_changes',\n        {\n          event: 'INSERT',\n          schema: 'public',\n          table: 'ai_generated_reports',\n        },\n        (payload) => {\n          fetchRecentReports();\n        }\n      )\n      .subscribe();\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []);\n\n  const fetchRecentReports = async () => {\n    try {\n      const oneDayAgo = new Date();\n      oneDayAgo.setDate(oneDayAgo.getDate() - 1);\n\n      const { data, error } = await supabase\n        .from('ai_generated_reports')\n        .select('id, title, report_type, generated_at')\n        .gte('generated_at', oneDayAgo.toISOString())\n        .order('generated_at', { ascending: false })\n        .limit(3);\n\n      if (error) throw error;\n\n      setRecentReports(data || []);\n    } catch (err) {\n      console.error('Failed to fetch recent reports:', err);\n    }\n  };\n\n  const handleDismiss = (reportId: string) => {\n    const newDismissed = [...dismissed, reportId];\n    setDismissed(newDismissed);\n    localStorage.setItem('dismissedReports', JSON.stringify(newDismissed));\n  };\n\n  const handleViewReport = (reportId: string) => {\n    navigate(`/ai-reports?report=${reportId}`);\n  };\n\n  const visibleReports = recentReports.filter((report) => !dismissed.includes(report.id));\n\n  if (visibleReports.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-6 right-6 z-40 space-y-3 max-w-sm\">\n      {visibleReports.map((report) => (\n        <div\n          key={report.id}\n          className=\"bg-white border-2 border-blue-500 rounded-lg shadow-2xl p-4 animate-slide-in\"\n        >\n          <div className=\"flex items-start justify-between mb-3\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"bg-blue-500 rounded-full p-2\">\n                <FileText className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <p className=\"text-sm font-semibold text-gray-900\">æ–°ã—ã„ãƒ¬ãƒãƒ¼ãƒˆ</p>\n                <Badge variant={report.report_type === 'weekly' ? 'default' : 'secondary'} className=\"text-xs\">\n                  {report.report_type === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡'}\n                </Badge>\n              </div>\n            </div>\n            <button\n              onClick={() => handleDismiss(report.id)}\n              className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          </div>\n\n          <p className=\"text-sm text-gray-700 mb-1 font-medium line-clamp-2\">\n            {report.title}\n          </p>\n\n          <p className=\"text-xs text-gray-500 mb-4\">\n            {new Date(report.generated_at).toLocaleString('ja-JP')}\n          </p>\n\n          <div className=\"flex gap-2\">\n            <Button\n              size=\"sm\"\n              onClick={() => handleViewReport(report.id)}\n              className=\"flex-1\"\n            >\n              <ExternalLink className=\"w-3 h-3 mr-1\" />\n              è¡¨ç¤º\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => handleDismiss(report.id)}\n            >\n              é–‰ã˜ã‚‹\n            </Button>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n",
  "src/components/Dashboard/AnalyticsDashboard.tsx": "import React, { useState, useMemo } from 'react';\nimport { DailyReport } from '../../types';\nimport { PeriodSelector } from './PeriodSelector';\nimport { SalesChart } from '../Charts/SalesChart';\nimport { ExpenseChart } from '../Charts/ExpenseChart';\nimport { formatCurrency, formatPercent } from '../../utils/calculations';\nimport { Calendar, TrendingUp, TrendingDown, BarChart3, PieChart, Target, AlertCircle } from 'lucide-react';\nimport { useTargets } from '../../hooks/useTargets';\n\ninterface AnalyticsDashboardProps {\n  reports: DailyReport[];\n  stores: Array<{ id: string; name: string; }>;\n  userId?: string | null;\n}\n\nexport const AnalyticsDashboard: React.FC<AnalyticsDashboardProps> = ({ reports, stores, userId = null }) => {\n  const [selectedPeriod, setSelectedPeriod] = useState<'daily' | 'weekly' | 'monthly'>('monthly');\n  const [selectedRange, setSelectedRange] = useState<'week' | 'month' | 'quarter' | 'year'>('month');\n  const [selectedStoreId, setSelectedStoreId] = useState<string>('all');\n  const { getAllStoresTarget, getTarget } = useTargets(userId);\n\n  // æœŸé–“ã«åŸºã¥ã„ã¦ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\n  const filteredReports = useMemo(() => {\n    const now = new Date();\n    let startDate: Date;\n\n    switch (selectedRange) {\n      case 'week':\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n        break;\n      case 'month':\n        startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n        break;\n      case 'quarter':\n        startDate = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);\n        break;\n      case 'year':\n        startDate = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);\n        break;\n    }\n\n    return reports.filter(report => {\n      const reportDate = new Date(report.date);\n      const inDateRange = reportDate >= startDate && reportDate <= now;\n      const inStoreFilter = selectedStoreId === 'all' || report.storeId === selectedStoreId;\n      return inDateRange && inStoreFilter;\n    });\n  }, [reports, selectedRange, selectedStoreId]);\n\n  // æœŸé–“åˆ¥é›†è¨ˆãƒ‡ãƒ¼ã‚¿\n  const aggregatedData = useMemo(() => {\n    const groupedData = new Map<string, {\n      sales: number;\n      expenses: number;\n      profit: number;\n      count: number;\n    }>();\n\n    filteredReports.forEach(report => {\n      const date = new Date(report.date);\n      let key: string;\n\n      switch (selectedPeriod) {\n        case 'daily':\n          key = report.date;\n          break;\n        case 'weekly':\n          // é€±ã®å§‹ã¾ã‚Šï¼ˆæœˆæ›œæ—¥ï¼‰ã‚’å–å¾—\n          const mondayDate = new Date(date);\n          mondayDate.setDate(date.getDate() - ((date.getDay() + 6) % 7));\n          key = mondayDate.toISOString().split('T')[0];\n          break;\n        case 'monthly':\n          key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n          break;\n      }\n\n      if (!groupedData.has(key)) {\n        groupedData.set(key, { sales: 0, expenses: 0, profit: 0, count: 0 });\n      }\n\n      const data = groupedData.get(key)!;\n      const expenses = report.purchase + report.laborCost + report.utilities + \n                     report.promotion + report.cleaning + report.misc + \n                     report.communication + report.others;\n      \n      data.sales += report.sales;\n      data.expenses += expenses;\n      data.profit += (report.sales - expenses);\n      data.count += 1;\n    });\n\n    return Array.from(groupedData.entries())\n      .map(([period, data]) => ({\n        period,\n        ...data,\n        profitMargin: data.sales > 0 ? (data.profit / data.sales) * 100 : 0\n      }))\n      .sort((a, b) => a.period.localeCompare(b.period));\n  }, [filteredReports, selectedPeriod]);\n\n  // ç·è¨ˆ\n  const totals = useMemo(() => {\n    return aggregatedData.reduce((acc, curr) => ({\n      sales: acc.sales + curr.sales,\n      expenses: acc.expenses + curr.expenses,\n      profit: acc.profit + curr.profit,\n      count: acc.count + curr.count\n    }), { sales: 0, expenses: 0, profit: 0, count: 0 });\n  }, [aggregatedData]);\n\n  // ç¾åœ¨ã®å¹´æœˆ\n  const currentDate = new Date();\n  const currentYear = currentDate.getFullYear();\n  const currentMonth = currentDate.getMonth() + 1;\n\n  // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã®å–å¾—\n  const targetData = useMemo(() => {\n    if (selectedStoreId === 'all') {\n      return getAllStoresTarget(currentYear, currentMonth);\n    } else {\n      const target = getTarget(selectedStoreId, currentYear, currentMonth);\n      return target ? {\n        totalSales: target.targetSales,\n        averageProfitMargin: target.targetProfitMargin\n      } : null;\n    }\n  }, [selectedStoreId, currentYear, currentMonth, getAllStoresTarget, getTarget]);\n\n  // ç›®æ¨™é”æˆçŠ¶æ³\n  const targetAnalysis = useMemo(() => {\n    if (!targetData || totals.sales === 0) return null;\n\n    const salesAchievement = (totals.sales / targetData.totalSales) * 100;\n    const profitMarginAchievement = totals.sales > 0 \n      ? ((totals.profit / totals.sales * 100) / targetData.averageProfitMargin) * 100\n      : 0;\n\n    return {\n      salesTarget: targetData.totalSales,\n      salesAchievement,\n      profitMarginTarget: targetData.averageProfitMargin,\n      profitMarginAchievement,\n      salesGap: totals.sales - targetData.totalSales,\n      isProfitMarginOnTarget: profitMarginAchievement >= 100\n    };\n  }, [targetData, totals]);\n\n  // å‰æœŸæ¯”è¼ƒï¼ˆåŒæœŸé–“ã®å‰ã®æœŸé–“ã¨æ¯”è¼ƒï¼‰\n  const previousPeriodComparison = useMemo(() => {\n    if (aggregatedData.length < 2) return null;\n\n    const currentPeriod = aggregatedData.slice(-Math.ceil(aggregatedData.length / 2));\n    const previousPeriod = aggregatedData.slice(0, Math.floor(aggregatedData.length / 2));\n\n    const currentTotal = currentPeriod.reduce((acc, curr) => acc + curr.sales, 0);\n    const previousTotal = previousPeriod.reduce((acc, curr) => acc + curr.sales, 0);\n\n    if (previousTotal === 0) return null;\n\n    const growthRate = ((currentTotal - previousTotal) / previousTotal) * 100;\n    return { currentTotal, previousTotal, growthRate };\n  }, [aggregatedData]);\n\n  const formatPeriodLabel = (period: string) => {\n    switch (selectedPeriod) {\n      case 'daily':\n        return new Date(period).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' });\n      case 'weekly':\n        const weekStart = new Date(period);\n        const weekEnd = new Date(weekStart);\n        weekEnd.setDate(weekStart.getDate() + 6);\n        return `${weekStart.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })}é€±`;\n      case 'monthly':\n        const [year, month] = period.split('-');\n        return `${year}å¹´${month}æœˆ`;\n      default:\n        return period;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */}\n      <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* æœŸé–“ãƒ»ç¯„å›²é¸æŠ */}\n          <div className=\"lg:col-span-2\">\n            <PeriodSelector\n              selectedPeriod={selectedPeriod}\n              onPeriodChange={setSelectedPeriod}\n              selectedRange={selectedRange}\n              onRangeChange={setSelectedRange}\n            />\n          </div>\n\n          {/* åº—èˆ—é¸æŠ */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              å¯¾è±¡åº—èˆ—\n            </label>\n            <select\n              value={selectedStoreId}\n              onChange={(e) => setSelectedStoreId(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            >\n              <option value=\"all\">ï¼ˆå…¨åº—èˆ—ï¼‰</option>\n              {stores.map(store => (\n                <option key={store.id} value={store.id}>{store.name}</option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* ç›®æ¨™vså®Ÿç¸¾ã‚µãƒãƒªãƒ¼ */}\n      {targetAnalysis && (\n        <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <Target className=\"w-5 h-5 text-purple-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              ç›®æ¨™ vs å®Ÿç¸¾ï¼ˆ{currentYear}å¹´{currentMonth}æœˆï¼‰\n            </h3>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            {/* å£²ä¸Šç›®æ¨™é”æˆçŠ¶æ³ */}\n            <div className=\"space-y-4\">\n              <h4 className=\"text-sm font-medium text-gray-700\">å£²ä¸Šç›®æ¨™é”æˆçŠ¶æ³</h4>\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">å®Ÿç¸¾:</span>\n                  <span className=\"font-medium\">{formatCurrency(totals.sales)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">ç›®æ¨™:</span>\n                  <span className=\"font-medium\">{formatCurrency(targetAnalysis.salesTarget)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">é”æˆç‡:</span>\n                  <span className={`font-bold ${\n                    targetAnalysis.salesAchievement >= 100 ? 'text-green-600' : \n                    targetAnalysis.salesAchievement >= 80 ? 'text-yellow-600' : 'text-red-600'\n                  }`}>\n                    {targetAnalysis.salesAchievement.toFixed(1)}%\n                  </span>\n                </div>\n                <div className=\"w-full bg-gray-200 rounded-full h-3\">\n                  <div \n                    className={`h-3 rounded-full transition-all duration-300 ${\n                      targetAnalysis.salesAchievement >= 100 ? 'bg-green-500' : \n                      targetAnalysis.salesAchievement >= 80 ? 'bg-yellow-500' : 'bg-red-500'\n                    }`}\n                    style={{ width: `${Math.min(targetAnalysis.salesAchievement, 100)}%` }}\n                  ></div>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">å·®é¡:</span>\n                  <span className={`font-medium ${\n                    targetAnalysis.salesGap >= 0 ? 'text-green-600' : 'text-red-600'\n                  }`}>\n                    {targetAnalysis.salesGap >= 0 ? '+' : ''}{formatCurrency(targetAnalysis.salesGap)}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* åˆ©ç›Šç‡ç›®æ¨™é”æˆçŠ¶æ³ */}\n            <div className=\"space-y-4\">\n              <h4 className=\"text-sm font-medium text-gray-700\">åˆ©ç›Šç‡ç›®æ¨™é”æˆçŠ¶æ³</h4>\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">å®Ÿç¸¾:</span>\n                  <span className=\"font-medium\">\n                    {formatPercent((totals.profit / totals.sales))}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">ç›®æ¨™:</span>\n                  <span className=\"font-medium\">\n                    {formatPercent(targetAnalysis.profitMarginTarget / 100)}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">é”æˆç‡:</span>\n                  <span className={`font-bold ${\n                    targetAnalysis.profitMarginAchievement >= 100 ? 'text-green-600' : \n                    targetAnalysis.profitMarginAchievement >= 80 ? 'text-yellow-600' : 'text-red-600'\n                  }`}>\n                    {targetAnalysis.profitMarginAchievement.toFixed(1)}%\n                  </span>\n                </div>\n                <div className=\"w-full bg-gray-200 rounded-full h-3\">\n                  <div \n                    className={`h-3 rounded-full transition-all duration-300 ${\n                      targetAnalysis.profitMarginAchievement >= 100 ? 'bg-green-500' : \n                      targetAnalysis.profitMarginAchievement >= 80 ? 'bg-yellow-500' : 'bg-red-500'\n                    }`}\n                    style={{ width: `${Math.min(targetAnalysis.profitMarginAchievement, 100)}%` }}\n                  ></div>\n                </div>\n                {!targetAnalysis.isProfitMarginOnTarget && (\n                  <div className=\"flex items-center gap-2 mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded\">\n                    <AlertCircle className=\"w-4 h-4 text-yellow-600\" />\n                    <span className=\"text-xs text-yellow-800\">\n                      åˆ©ç›Šç‡æ”¹å–„ãŒå¿…è¦ã§ã™\n                    </span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n        <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n          <div className=\"flex items-center\">\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <BarChart3 className=\"w-6 h-6 text-blue-600\" />\n            </div>\n            <div className=\"ml-4\">\n              <p className=\"text-sm font-medium text-gray-600\">ç·å£²ä¸Š</p>\n              <p className=\"text-2xl font-bold text-gray-900\">{formatCurrency(totals.sales)}</p>\n              {targetAnalysis && (\n                <p className=\"text-xs text-gray-500\">\n                  ç›®æ¨™: {formatCurrency(targetAnalysis.salesTarget)}\n                </p>\n              )}\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n          <div className=\"flex items-center\">\n            <div className=\"p-2 bg-red-100 rounded-lg\">\n              <PieChart className=\"w-6 h-6 text-red-600\" />\n            </div>\n            <div className=\"ml-4\">\n              <p className=\"text-sm font-medium text-gray-600\">ç·çµŒè²»</p>\n              <p className=\"text-2xl font-bold text-gray-900\">{formatCurrency(totals.expenses)}</p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n          <div className=\"flex items-center\">\n            <div className={`p-2 rounded-lg ${totals.profit >= 0 ? 'bg-green-100' : 'bg-red-100'}`}>\n              {totals.profit >= 0 ? (\n                <TrendingUp className=\"w-6 h-6 text-green-600\" />\n              ) : (\n                <TrendingDown className=\"w-6 h-6 text-red-600\" />\n              )}\n            </div>\n            <div className=\"ml-4\">\n              <p className=\"text-sm font-medium text-gray-600\">å–¶æ¥­åˆ©ç›Š</p>\n              <p className={`text-2xl font-bold ${totals.profit >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                {formatCurrency(totals.profit)}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n          <div className=\"flex items-center\">\n            <div className=\"p-2 bg-purple-100 rounded-lg\">\n              <Calendar className=\"w-6 h-6 text-purple-600\" />\n            </div>\n            <div className=\"ml-4\">\n              <p className=\"text-sm font-medium text-gray-600\">å ±å‘Šä»¶æ•°</p>\n              <p className=\"text-2xl font-bold text-gray-900\">{totals.count}</p>\n              {previousPeriodComparison && (\n                <p className={`text-sm ${previousPeriodComparison.growthRate >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  å‰æœŸæ¯” {previousPeriodComparison.growthRate >= 0 ? '+' : ''}{previousPeriodComparison.growthRate.toFixed(1)}%\n                </p>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* æ¨ç§»ãƒ†ãƒ¼ãƒ–ãƒ« */}\n      <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <h3 className=\"text-lg font-semibold text-gray-900\">\n            {selectedPeriod === 'daily' ? 'æ—¥åˆ¥' : selectedPeriod === 'weekly' ? 'é€±åˆ¥' : 'æœˆåˆ¥'}æ¨ç§»\n            ({selectedRange === 'week' ? 'éå»1é€±é–“' : \n              selectedRange === 'month' ? 'éå»1ãƒ¶æœˆ' : \n              selectedRange === 'quarter' ? 'éå»3ãƒ¶æœˆ' : 'éå»1å¹´'})\n          </h3>\n        </div>\n        \n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  æœŸé–“\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  å£²ä¸Š\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  çµŒè²»\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  å–¶æ¥­åˆ©ç›Š\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  åˆ©ç›Šç‡\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  å ±å‘Šæ•°\n                </th>\n                {targetAnalysis && (\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    ç›®æ¨™é”æˆç‡\n                  </th>\n                )}\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {aggregatedData.slice(-10).reverse().map((data) => (\n                <tr key={data.period} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                    {formatPeriodLabel(data.period)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    {formatCurrency(data.sales)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    {formatCurrency(data.expenses)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    <span className={data.profit >= 0 ? 'text-green-600' : 'text-red-600'}>\n                      {formatCurrency(data.profit)}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    <span className={\n                      data.profitMargin >= 15 ? 'text-green-600' : \n                      data.profitMargin >= 10 ? 'text-yellow-600' : 'text-red-600'\n                    }>\n                      {formatPercent(data.profitMargin / 100)}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                    {data.count}ä»¶\n                  </td>\n                  {targetAnalysis && (\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {data.period === aggregatedData[aggregatedData.length - 1]?.period ? (\n                        <div className=\"space-y-1\">\n                          <div className={`text-xs font-medium ${\n                            targetAnalysis.salesAchievement >= 100 ? 'text-green-600' : \n                            targetAnalysis.salesAchievement >= 80 ? 'text-yellow-600' : 'text-red-600'\n                          }`}>\n                            å£²ä¸Š: {targetAnalysis.salesAchievement.toFixed(1)}%\n                          </div>\n                          <div className={`text-xs font-medium ${\n                            targetAnalysis.profitMarginAchievement >= 100 ? 'text-green-600' : \n                            targetAnalysis.profitMarginAchievement >= 80 ? 'text-yellow-600' : 'text-red-600'\n                          }`}>\n                            åˆ©ç›Šç‡: {targetAnalysis.profitMarginAchievement.toFixed(1)}%\n                          </div>\n                        </div>\n                      ) : (\n                        <span className=\"text-gray-400\">-</span>\n                      )}\n                    </td>\n                  )}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* ãƒãƒ£ãƒ¼ãƒˆ */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <SalesChart \n          reports={filteredReports} \n          targetSales={targetAnalysis?.salesTarget}\n        />\n        <ExpenseChart reports={filteredReports} />\n      </div>\n    </div>\n  );\n};",
  "src/components/Dashboard/DailyTargetInput.tsx": "import React, { useState, useEffect } from 'react'\nimport { Save, Edit2, X, Target } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { formatCurrency } from '@/lib/format'\nimport { cn } from '@/lib/utils'\n\ninterface DailyTargetInputProps {\n  date: string\n  storeId: string\n  currentTarget: number | null\n  onSave: (targetSales: number) => Promise<{ success: boolean; error: string | null }>\n  isLoading?: boolean\n  className?: string\n}\n\nexport const DailyTargetInput: React.FC<DailyTargetInputProps> = ({\n  date,\n  storeId,\n  currentTarget,\n  onSave,\n  isLoading = false,\n  className\n}) => {\n  const [isEditing, setIsEditing] = useState(false)\n  const [inputValue, setInputValue] = useState('')\n  const [saving, setSaving] = useState(false)\n  const [saveSuccess, setSaveSuccess] = useState(false)\n\n  useEffect(() => {\n    if (currentTarget !== null && currentTarget !== undefined) {\n      setInputValue(currentTarget.toString())\n    } else {\n      setInputValue('')\n    }\n  }, [currentTarget])\n\n  const handleEdit = () => {\n    setIsEditing(true)\n    setSaveSuccess(false)\n  }\n\n  const handleCancel = () => {\n    setIsEditing(false)\n    setInputValue(currentTarget?.toString() || '')\n    setSaveSuccess(false)\n  }\n\n  const handleSave = async () => {\n    const value = parseInt(inputValue.replace(/[^0-9]/g, ''), 10)\n    if (isNaN(value) || value <= 0) {\n      alert('æœ‰åŠ¹ãªé‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')\n      return\n    }\n\n    setSaving(true)\n    setSaveSuccess(false)\n\n    const result = await onSave(value)\n\n    setSaving(false)\n\n    if (result.success) {\n      setIsEditing(false)\n      setSaveSuccess(true)\n      setTimeout(() => {\n        setSaveSuccess(false)\n      }, 2000)\n    } else {\n      alert(result.error || 'ç›®æ¨™ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    }\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      handleSave()\n    } else if (e.key === 'Escape') {\n      handleCancel()\n    }\n  }\n\n  if (storeId === 'all') {\n    return null\n  }\n\n  return (\n    <div className={cn('space-y-2', className)}>\n      <div className=\"flex items-center gap-2\">\n        <Target className=\"h-4 w-4 text-blue-600\" />\n        <span className=\"text-sm font-medium text-muted-foreground\">æœ¬æ—¥ã®å£²ä¸Šç›®æ¨™</span>\n      </div>\n\n      {!isEditing ? (\n        <div className=\"flex items-center gap-2\">\n          <div className=\"flex-1\">\n            {currentTarget !== null && currentTarget !== undefined ? (\n              <div className=\"text-lg font-bold text-blue-600\">\n                {formatCurrency(currentTarget)}\n              </div>\n            ) : (\n              <div className=\"text-sm text-muted-foreground italic\">\n                æœªè¨­å®š\n              </div>\n            )}\n          </div>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleEdit}\n            disabled={isLoading}\n            className=\"min-h-[36px]\"\n          >\n            <Edit2 className=\"h-4 w-4 mr-1\" />\n            {currentTarget !== null ? 'å¤‰æ›´' : 'è¨­å®š'}\n          </Button>\n          {saveSuccess && (\n            <span className=\"text-xs text-green-600 font-medium animate-pulse\">\n              ä¿å­˜ã—ã¾ã—ãŸ\n            </span>\n          )}\n        </div>\n      ) : (\n        <div className=\"flex items-center gap-2\">\n          <input\n            type=\"text\"\n            inputMode=\"numeric\"\n            pattern=\"[0-9]*\"\n            value={inputValue}\n            onChange={(e) => setInputValue(e.target.value.replace(/[^0-9]/g, ''))}\n            onKeyDown={handleKeyDown}\n            placeholder=\"ä¾‹: 300000\"\n            autoFocus\n            className=\"flex-1 px-3 py-2 rounded border border-input bg-background text-base font-mono min-h-[36px]\"\n          />\n          <Button\n            variant=\"default\"\n            size=\"sm\"\n            onClick={handleSave}\n            disabled={saving}\n            className=\"min-h-[36px]\"\n          >\n            <Save className=\"h-4 w-4 mr-1\" />\n            {saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleCancel}\n            disabled={saving}\n            className=\"min-h-[36px]\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      )}\n    </div>\n  )\n}\n",
  "src/components/Dashboard/DataTable.tsx": "import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { \n  ChevronLeft, \n  ChevronRight, \n  ChevronsLeft, \n  ChevronsRight,\n  ArrowUpDown,\n  ArrowUp,\n  ArrowDown \n} from 'lucide-react';\nimport { formatCurrency, formatPercent } from '@/lib/utils';\nimport { DailyReport } from '@/types';\n\ninterface DataTableProps {\n  reports: DailyReport[];\n  period?: 'daily' | 'weekly' | 'monthly';\n  onPeriodChange?: (period: 'daily' | 'weekly' | 'monthly') => void;\n}\n\ntype SortField = 'date' | 'storeName' | 'sales' | 'expenses' | 'profit';\ntype SortDirection = 'asc' | 'desc';\n\nexport const DataTable: React.FC<DataTableProps> = ({ \n  reports, \n  period = 'daily',\n  onPeriodChange \n}) => {\n  const [currentPage, setCurrentPage] = useState(1);\n  const [sortField, setSortField] = useState<SortField>('date');\n  const [sortDirection, setSortDirection] = useState<SortDirection>('desc');\n  const itemsPerPage = 10;\n\n  // ãƒ‡ãƒ¼ã‚¿ã®åŠ å·¥ã¨é›†è¨ˆ\n  const processedData = React.useMemo(() => {\n    const groupedData = new Map();\n    \n    reports.forEach(report => {\n      const date = new Date(report.date);\n      let key: string;\n      let displayDate: string;\n      \n      switch (period) {\n        case 'daily':\n          key = `${report.date}-${report.storeId}`;\n          displayDate = date.toLocaleDateString('ja-JP');\n          break;\n        case 'weekly':\n          const weekStart = new Date(date);\n          weekStart.setDate(date.getDate() - date.getDay());\n          key = `${weekStart.toISOString().split('T')[0]}-${report.storeId}`;\n          displayDate = `${weekStart.toLocaleDateString('ja-JP')}é€±`;\n          break;\n        case 'monthly':\n          key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${report.storeId}`;\n          displayDate = date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' });\n          break;\n        default:\n          key = `${report.date}-${report.storeId}`;\n          displayDate = date.toLocaleDateString('ja-JP');\n      }\n      \n      if (!groupedData.has(key)) {\n        groupedData.set(key, {\n          id: key,\n          date: displayDate,\n          storeName: report.storeName,\n          sales: 0,\n          expenses: 0,\n          profit: 0,\n          profitMargin: 0,\n          reportCount: 0\n        });\n      }\n      \n      const data = groupedData.get(key);\n      const totalExpenses = report.purchase + report.laborCost + report.utilities + \n                           report.promotion + report.cleaning + report.misc + \n                           report.communication + report.others;\n      \n      data.sales += report.sales;\n      data.expenses += totalExpenses;\n      data.profit = data.sales - data.expenses;\n      data.profitMargin = data.sales > 0 ? (data.profit / data.sales) * 100 : 0;\n      data.reportCount += 1;\n    });\n    \n    // å…¨åº—èˆ—åˆè¨ˆã®å ´åˆã¯æœŸé–“åˆ¥ã«ãƒ‡ãƒ¼ã‚¿ã‚’å†é›†è¨ˆ\n    if (reports.length > 0) {\n      const allStoresData = new Map();\n      \n      Array.from(groupedData.values()).forEach(item => {\n        const periodKey = item.date;\n        \n        if (!allStoresData.has(periodKey)) {\n          allStoresData.set(periodKey, {\n            id: periodKey,\n            date: periodKey,\n            storeName: 'å…¨åº—èˆ—åˆè¨ˆ',\n            sales: 0,\n            expenses: 0,\n            profit: 0,\n            profitMargin: 0,\n            reportCount: 0\n          });\n        }\n        \n        const aggregated = allStoresData.get(periodKey);\n        aggregated.sales += item.sales;\n        aggregated.expenses += item.expenses;\n        aggregated.profit += item.profit;\n        aggregated.reportCount += item.reportCount;\n        aggregated.profitMargin = aggregated.sales > 0 ? (aggregated.profit / aggregated.sales) * 100 : 0;\n      });\n      \n      return Array.from(allStoresData.values());\n    }\n    \n    return Array.from(groupedData.values());\n  }, [reports, period]);\n\n  // ã‚½ãƒ¼ãƒˆå‡¦ç†\n  const sortedData = React.useMemo(() => {\n    return [...processedData].sort((a, b) => {\n      let aValue = a[sortField];\n      let bValue = b[sortField];\n      \n      if (sortField === 'date') {\n        aValue = new Date(a.date).getTime();\n        bValue = new Date(b.date).getTime();\n      }\n      \n      if (sortDirection === 'asc') {\n        return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;\n      } else {\n        return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;\n      }\n    });\n  }, [processedData, sortField, sortDirection]);\n\n  // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³\n  const totalPages = Math.ceil(sortedData.length / itemsPerPage);\n  const startIndex = (currentPage - 1) * itemsPerPage;\n  const paginatedData = sortedData.slice(startIndex, startIndex + itemsPerPage);\n\n  const handleSort = (field: SortField) => {\n    if (sortField === field) {\n      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortField(field);\n      setSortDirection('desc');\n    }\n    setCurrentPage(1);\n  };\n\n  const SortIcon = ({ field }: { field: SortField }) => {\n    if (sortField !== field) return <ArrowUpDown className=\"w-4 h-4 text-gray-400\" />;\n    return sortDirection === 'asc' ? \n      <ArrowUp className=\"w-4 h-4 text-blue-600\" /> : \n      <ArrowDown className=\"w-4 h-4 text-blue-600\" />;\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg font-semibold\">è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ</CardTitle>\n          {onPeriodChange && (\n            <Tabs value={period} onValueChange={(value) => onPeriodChange(value as any)}>\n              <TabsList>\n                <TabsTrigger value=\"daily\">æ—¥æ¬¡</TabsTrigger>\n                <TabsTrigger value=\"weekly\">é€±æ¬¡</TabsTrigger>\n                <TabsTrigger value=\"monthly\">æœˆæ¬¡</TabsTrigger>\n              </TabsList>\n            </Tabs>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        {paginatedData.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <p className=\"text-gray-500\">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>\n          </div>\n        ) : (\n          <>\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr className=\"border-b border-gray-200\">\n                    <th className=\"text-left p-3\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleSort('date')}\n                        className=\"flex items-center gap-2 font-medium\"\n                      >\n                        æœŸé–“\n                        <SortIcon field=\"date\" />\n                      </Button>\n                    </th>\n                    <th className=\"text-left p-3\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleSort('storeName')}\n                        className=\"flex items-center gap-2 font-medium\"\n                      >\n                        åº—èˆ—å\n                        <SortIcon field=\"storeName\" />\n                      </Button>\n                    </th>\n                    <th className=\"text-left p-3\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleSort('sales')}\n                        className=\"flex items-center gap-2 font-medium\"\n                      >\n                        å£²ä¸Š\n                        <SortIcon field=\"sales\" />\n                      </Button>\n                    </th>\n                    <th className=\"text-left p-3\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleSort('expenses')}\n                        className=\"flex items-center gap-2 font-medium\"\n                      >\n                        çµŒè²»\n                        <SortIcon field=\"expenses\" />\n                      </Button>\n                    </th>\n                    <th className=\"text-left p-3\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleSort('profit')}\n                        className=\"flex items-center gap-2 font-medium\"\n                      >\n                        å–¶æ¥­åˆ©ç›Š\n                        <SortIcon field=\"profit\" />\n                      </Button>\n                    </th>\n                    <th className=\"text-left p-3\">åˆ©ç›Šç‡</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {paginatedData.map((row) => (\n                    <tr key={row.id} className=\"border-b border-gray-100 hover:bg-gray-50\">\n                      <td className=\"p-3 text-sm\">{row.date}</td>\n                      <td className=\"p-3 text-sm font-medium\">{row.storeName}</td>\n                      <td className=\"p-3 text-sm text-blue-600 font-medium\">\n                        {formatCurrency(row.sales)}\n                      </td>\n                      <td className=\"p-3 text-sm text-red-600\">\n                        {formatCurrency(row.expenses)}\n                      </td>\n                      <td className={`p-3 text-sm font-medium ${\n                        row.profit >= 0 ? 'text-green-600' : 'text-red-600'\n                      }`}>\n                        {formatCurrency(row.profit)}\n                      </td>\n                      <td className={`p-3 text-sm font-medium ${\n                        row.profitMargin >= 15 ? 'text-green-600' : \n                        row.profitMargin >= 10 ? 'text-yellow-600' : 'text-red-600'\n                      }`}>\n                        {formatPercent(row.profitMargin)}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Pagination */}\n            {totalPages > 1 && (\n              <div className=\"flex items-center justify-between mt-6 pt-4 border-t border-gray-200\">\n                <div className=\"text-sm text-gray-500\">\n                  {startIndex + 1}-{Math.min(startIndex + itemsPerPage, sortedData.length)} / {sortedData.length}ä»¶\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setCurrentPage(1)}\n                    disabled={currentPage === 1}\n                  >\n                    <ChevronsLeft className=\"w-4 h-4\" />\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                    disabled={currentPage === 1}\n                  >\n                    <ChevronLeft className=\"w-4 h-4\" />\n                  </Button>\n                  <span className=\"text-sm font-medium px-3\">\n                    {currentPage} / {totalPages}\n                  </span>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}\n                    disabled={currentPage === totalPages}\n                  >\n                    <ChevronRight className=\"w-4 h-4\" />\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setCurrentPage(totalPages)}\n                    disabled={currentPage === totalPages}\n                  >\n                    <ChevronsRight className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </CardContent>\n    </Card>\n  );\n};",
  "src/components/Dashboard/ExpenseBaselineSettings.tsx": "import React, { useState, useEffect } from 'react'\nimport { Save, X, Calendar, DollarSign, Users, Zap, Hop as Home, Package, Megaphone, Sparkles, MessageSquare, MoveHorizontal as MoreHorizontal } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { getExpenseBaseline, upsertExpenseBaseline } from '@/services/supabase'\nimport { formatCurrency } from '@/lib/format'\n\ninterface ExpenseBaselineSettingsProps {\n  stores: Array<{ id: string; name: string }>\n  onClose: () => void\n  onSaved?: () => void\n}\n\nexport const ExpenseBaselineSettings: React.FC<ExpenseBaselineSettingsProps> = ({\n  stores,\n  onClose,\n  onSaved\n}) => {\n  const currentDate = new Date()\n  const [selectedYear, setSelectedYear] = useState(currentDate.getFullYear())\n  const [selectedMonth, setSelectedMonth] = useState(currentDate.getMonth() + 1)\n  const [selectedStoreId, setSelectedStoreId] = useState(stores[0]?.id || '')\n  const [loading, setLoading] = useState(false)\n  const [notification, setNotification] = useState<{ type: 'success' | 'error'; message: string } | null>(null)\n\n  const [formData, setFormData] = useState({\n    open_days: 26,\n    labor_cost_employee: 0,\n    labor_cost_part_time: 0,\n    utilities: 0,\n    rent: 0,\n    consumables: 0,\n    promotion: 0,\n    cleaning: 0,\n    misc: 0,\n    communication: 0,\n    others: 0\n  })\n\n  const years = Array.from({ length: 5 }, (_, i) => currentDate.getFullYear() - 2 + i)\n  const months = Array.from({ length: 12 }, (_, i) => i + 1)\n\n  useEffect(() => {\n    loadBaseline()\n  }, [selectedStoreId, selectedYear, selectedMonth])\n\n  const loadBaseline = async () => {\n    if (!selectedStoreId) return\n\n    const month = `${selectedYear}-${String(selectedMonth).padStart(2, '0')}`\n    const { data } = await getExpenseBaseline(selectedStoreId, month)\n\n    if (data) {\n      setFormData({\n        open_days: data.open_days,\n        labor_cost_employee: data.labor_cost_employee,\n        labor_cost_part_time: data.labor_cost_part_time,\n        utilities: data.utilities,\n        rent: data.rent || 0,\n        consumables: data.consumables || 0,\n        promotion: data.promotion,\n        cleaning: data.cleaning,\n        misc: data.misc,\n        communication: data.communication,\n        others: data.others\n      })\n    } else {\n      setFormData({\n        open_days: 26,\n        labor_cost_employee: 0,\n        labor_cost_part_time: 0,\n        utilities: 0,\n        rent: 0,\n        consumables: 0,\n        promotion: 0,\n        cleaning: 0,\n        misc: 0,\n        communication: 0,\n        others: 0\n      })\n    }\n  }\n\n  const showNotification = (type: 'success' | 'error', message: string) => {\n    setNotification({ type, message })\n    setTimeout(() => setNotification(null), 3000)\n  }\n\n  const handleSave = async () => {\n    if (!selectedStoreId) {\n      showNotification('error', 'åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„')\n      return\n    }\n\n    if (formData.open_days < 1 || formData.open_days > 31) {\n      showNotification('error', 'ç¨¼åƒæ—¥æ•°ã¯1-31æ—¥ã§å…¥åŠ›ã—ã¦ãã ã•ã„')\n      return\n    }\n\n    setLoading(true)\n    const month = `${selectedYear}-${String(selectedMonth).padStart(2, '0')}`\n    const store = stores.find(s => s.id === selectedStoreId)\n\n    const { error } = await upsertExpenseBaseline(selectedStoreId, month, formData)\n    setLoading(false)\n\n    if (error) {\n      showNotification('error', error.message ?? String(error))\n    } else {\n      showNotification('success', `${store?.name}ã®å‚è€ƒçµŒè²»ã‚’ä¿å­˜ã—ã¾ã—ãŸ`)\n      onSaved?.()\n    }\n  }\n\n  const handleInputChange = (field: keyof typeof formData, value: string) => {\n    if (value === '') {\n      setFormData(prev => ({ ...prev, [field]: 0 }))\n      return\n    }\n    const numValue = parseInt(value, 10)\n    if (!isNaN(numValue) && numValue >= 0) {\n      setFormData(prev => ({ ...prev, [field]: numValue }))\n    }\n  }\n\n  const totalMonthly =\n    formData.labor_cost_employee +\n    formData.labor_cost_part_time +\n    formData.utilities +\n    formData.rent +\n    formData.consumables +\n    formData.promotion +\n    formData.cleaning +\n    formData.misc +\n    formData.communication +\n    formData.others\n\n  const dailyAverage = Math.round(totalMonthly / Math.max(formData.open_days, 1))\n\n  const selectedStore = stores.find(s => s.id === selectedStoreId)\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto\">\n      <Card className=\"w-full max-w-3xl my-8\">\n        <CardHeader className=\"border-b\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <DollarSign className=\"w-5 h-5\" />\n              å‚è€ƒçµŒè²»ï¼ˆæœˆæ¬¡å¹³å‡ï¼‰è¨­å®š\n            </CardTitle>\n            <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n              <X className=\"w-5 h-5\" />\n            </Button>\n          </div>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            æ—¥å ±å…¥åŠ›æ™‚ã®å‚è€ƒKPIè¨ˆç®—ã«ä½¿ç”¨ã™ã‚‹æœˆæ¬¡å¹³å‡çµŒè²»ã‚’è¨­å®šã—ã¾ã™ã€‚é£Ÿæè²»ã¯æ—¥å ±ã§å…¥åŠ›ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯è¨­å®šä¸è¦ã§ã™ã€‚\n          </p>\n        </CardHeader>\n\n        <CardContent className=\"space-y-6 pt-6\">\n          {notification && (\n            <div\n              className={`p-4 rounded-lg ${\n                notification.type === 'success'\n                  ? 'bg-green-50 text-green-800 border border-green-200'\n                  : 'bg-red-50 text-red-800 border border-red-200'\n              }`}\n            >\n              {notification.message}\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">å¯¾è±¡åº—èˆ—</label>\n              <select\n                value={selectedStoreId}\n                onChange={e => setSelectedStoreId(e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\"\n              >\n                {stores.map(store => (\n                  <option key={store.id} value={store.id}>\n                    {store.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">å¯¾è±¡å¹´</label>\n              <select\n                value={selectedYear}\n                onChange={e => setSelectedYear(parseInt(e.target.value))}\n                className=\"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\"\n              >\n                {years.map(year => (\n                  <option key={year} value={year}>\n                    {year}å¹´\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">å¯¾è±¡æœˆ</label>\n              <select\n                value={selectedMonth}\n                onChange={e => setSelectedMonth(parseInt(e.target.value))}\n                className=\"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\"\n              >\n                {months.map(month => (\n                  <option key={month} value={month}>\n                    {month}æœˆ\n                  </option>\n                ))}\n              </select>\n            </div>\n          </div>\n\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Calendar className=\"w-4 h-4 text-blue-600\" />\n              <span className=\"font-medium text-blue-900\">ç¨¼åƒæ—¥æ•°</span>\n            </div>\n            <div className=\"relative\">\n              <input\n                type=\"number\"\n                value={formData.open_days}\n                onChange={e => handleInputChange('open_days', e.target.value)}\n                className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                min=\"1\"\n                max=\"31\"\n              />\n              <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">æ—¥</span>\n            </div>\n            <p className=\"text-xs text-blue-600 mt-1\">æ—¥å‰²ã‚Šè¨ˆç®—ã«ä½¿ç”¨ã—ã¾ã™ï¼ˆé€šå¸¸26æ—¥ç¨‹åº¦ï¼‰</p>\n          </div>\n\n          <div className=\"space-y-4\">\n            <h3 className=\"font-semibold flex items-center gap-2\">\n              <Users className=\"w-4 h-4\" />\n              äººä»¶è²»ï¼ˆæœˆé¡ï¼‰\n            </h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">ç¤¾å“¡äººä»¶è²»</label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.labor_cost_employee || ''}\n                    onChange={e => handleInputChange('labor_cost_employee', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">ã‚¢ãƒ«ãƒã‚¤ãƒˆäººä»¶è²»</label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.labor_cost_part_time || ''}\n                    onChange={e => handleInputChange('labor_cost_part_time', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <h3 className=\"font-semibold\">ãã®ä»–çµŒè²»ï¼ˆæœˆé¡ï¼‰</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2 flex items-center gap-2\">\n                  <Zap className=\"w-4 h-4\" />\n                  æ°´é“å…‰ç†±è²»\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.utilities || ''}\n                    onChange={e => handleInputChange('utilities', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-2 flex items-center gap-2\">\n                  <Home className=\"w-4 h-4\" />\n                  è³ƒæ–™\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.rent || ''}\n                    onChange={e => handleInputChange('rent', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-2 flex items-center gap-2\">\n                  <Package className=\"w-4 h-4\" />\n                  æ¶ˆè€—å“è²»\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.consumables || ''}\n                    onChange={e => handleInputChange('consumables', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-2 flex items-center gap-2\">\n                  <Megaphone className=\"w-4 h-4\" />\n                  è²©ä¿ƒè²»\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.promotion || ''}\n                    onChange={e => handleInputChange('promotion', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-2 flex items-center gap-2\">\n                  <Sparkles className=\"w-4 h-4\" />\n                  æ¸…æƒè²»\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.cleaning || ''}\n                    onChange={e => handleInputChange('cleaning', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-2 flex items-center gap-2\">\n                  <MessageSquare className=\"w-4 h-4\" />\n                  é€šä¿¡è²»\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.communication || ''}\n                    onChange={e => handleInputChange('communication', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-2 flex items-center gap-2\">\n                  <DollarSign className=\"w-4 h-4\" />\n                  é›‘è²»\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.misc || ''}\n                    onChange={e => handleInputChange('misc', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium mb-2 flex items-center gap-2\">\n                  <MoreHorizontal className=\"w-4 h-4\" />\n                  ãã®ä»–\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={formData.others || ''}\n                    onChange={e => handleInputChange('others', e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-right\"\n                    placeholder=\"0\"\n                    step=\"1000\"\n                  />\n                  <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\">å††</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-gray-50 rounded-lg p-4 space-y-2\">\n            <div className=\"flex justify-between items-center font-medium\">\n              <span>æœˆé¡åˆè¨ˆ</span>\n              <span className=\"text-lg\">{formatCurrency(totalMonthly)}</span>\n            </div>\n            <div className=\"flex justify-between items-center text-sm text-muted-foreground border-t pt-2\">\n              <span>1æ—¥ã‚ãŸã‚Šå¹³å‡ï¼ˆå‚è€ƒå€¤ï¼‰</span>\n              <span>{formatCurrency(dailyAverage)}</span>\n            </div>\n          </div>\n\n          <div className=\"flex gap-3 pt-4 border-t\">\n            <Button variant=\"outline\" onClick={onClose} className=\"flex-1\">\n              ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n            </Button>\n            <Button onClick={handleSave} disabled={loading} className=\"flex-1\">\n              <Save className=\"w-4 h-4 mr-2\" />\n              {loading ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
  "src/components/Dashboard/GoogleSheetsStatus.tsx": "import React, { useState, useEffect } from 'react';\nimport { FileSpreadsheet, ExternalLink, Settings, CheckCircle, AlertCircle, RefreshCw } from 'lucide-react';\nimport { SetupGuide } from './SetupGuide';\n\ninterface GoogleSheetsStatusProps {\n  className?: string;\n}\n\nexport const GoogleSheetsStatus: React.FC<GoogleSheetsStatusProps> = ({ className = '' }) => {\n  const [isConfigured, setIsConfigured] = useState(false);\n  const [sheetsUrl, setSheetsUrl] = useState<string>('');\n  const [showSetup, setShowSetup] = useState(false);\n  const [testingConnection, setTestingConnection] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState<{\n    tested: boolean;\n    success: boolean;\n    error?: string;\n  }>({ tested: false, success: false });\n\n  useEffect(() => {\n    // Check if Google Sheets is configured\n    const checkConfiguration = () => {\n      const hasApiKey = import.meta.env.VITE_GOOGLE_SHEETS_API_KEY;\n      const hasSheetId = import.meta.env.VITE_GOOGLE_SHEET_ID;\n      const configured = hasApiKey && hasSheetId;\n      \n      setIsConfigured(!!configured);\n      \n      if (hasSheetId) {\n        setSheetsUrl(`https://docs.google.com/spreadsheets/d/${hasSheetId}/edit`);\n      }\n    };\n\n    checkConfiguration();\n  }, []);\n\n  const testSheetsConnection = async () => {\n    setTestingConnection(true);\n    setConnectionStatus({ tested: false, success: false });\n\n    try {\n      const SHEET_ID = '1GWp6bW4WnSc9EFobaYNqhUz6wtMuL6gG74Tg2Osvtco';\n      const API_KEY = import.meta.env.VITE_GOOGLE_SHEETS_API_KEY;\n      \n      // Check for missing or placeholder API key\n      if (!API_KEY || API_KEY.trim() === '' || \n          API_KEY === 'your_google_sheets_api_key_here' || \n          API_KEY === 'your_api_key' || \n          API_KEY.includes('your_') || \n          API_KEY.includes('placeholder')) {\n        setConnectionStatus({\n          tested: true,\n          success: false,\n          error: 'Google Sheets APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚.envãƒ•ã‚¡ã‚¤ãƒ«ã®VITE_GOOGLE_SHEETS_API_KEYã«ã€Google Cloud Consoleã§ç”Ÿæˆã—ãŸå®Ÿéš›ã®APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚ç¾åœ¨ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å€¤ã®ã¾ã¾ã§ã™ã€‚'\n        });\n        return;\n      }\n\n      // Validate API key format\n      if (!API_KEY.startsWith('AIza') || API_KEY.length < 35) {\n        setConnectionStatus({\n          tested: true,\n          success: false,\n          error: `APIã‚­ãƒ¼ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚Google Sheets APIã‚­ãƒ¼ã¯ \"AIza\" ã§å§‹ã¾ã‚Šã€é€šå¸¸39æ–‡å­—ã§ã™ã€‚ç¾åœ¨ã®å€¤: \"${API_KEY.substring(0, 10)}...\" (${API_KEY.length}æ–‡å­—)`\n        });\n        return;\n      }\n\n      // Test API access to the sheet\n      const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}?key=${API_KEY}`;\n      \n      const response = await fetch(testUrl);\n      \n      if (response.ok) {\n        const sheetData = await response.json();\n        console.log('Sheet connection successful:', sheetData.properties?.title);\n        setConnectionStatus({\n          tested: true,\n          success: true\n        });\n        setSheetsUrl(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/edit`);\n      } else {\n        const errorText = await response.text();\n        let errorMessage = 'ã‚·ãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“';\n        \n        if (response.status === 400) {\n          errorMessage = 'APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚Google Cloud Consoleã§ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š\\n1. APIã‚­ãƒ¼ãŒæ­£ã—ãã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‹\\n2. Google Sheets APIãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹\\n3. APIã‚­ãƒ¼ã®åˆ¶é™è¨­å®šãŒæ­£ã—ã„ã‹';\n        } else if (response.status === 403) {\n          errorMessage = 'ã‚·ãƒ¼ãƒˆã®å…±æœ‰è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã€Œãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹å…¨å“¡ãŒé–²è¦§å¯èƒ½ã€ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚';\n        } else if (response.status === 404) {\n          errorMessage = 'ã‚·ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚URLãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚';\n        } else if (response.status === 401) {\n          errorMessage = 'APIã‚­ãƒ¼ãŒç„¡åŠ¹ã¾ãŸã¯æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚Google Cloud Consoleã§APIã‚­ãƒ¼ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';\n        }\n        \n        console.error('Sheet connection failed:', response.status, errorText);\n        setConnectionStatus({\n          tested: true,\n          success: false,\n          error: errorMessage\n        });\n      }\n    } catch (error) {\n      console.error('Network error during sheet test:', error);\n      setConnectionStatus({\n        tested: true,\n        success: false,\n        error: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'\n      });\n    } finally {\n      setTestingConnection(false);\n    }\n  };\n  return (\n    <div className={`bg-white rounded-lg border border-gray-200 p-4 ${className}`}>\n      <div className=\"flex items-center justify-between mb-3\">\n        <div className=\"flex items-center gap-2\">\n          <FileSpreadsheet className=\"w-5 h-5 text-green-600\" />\n          <h3 className=\"text-sm font-medium text-gray-900\">Google Sheetsé€£æº</h3>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {isConfigured ? (\n            <CheckCircle className=\"w-4 h-4 text-green-500\" />\n          ) : (\n            <AlertCircle className=\"w-4 h-4 text-orange-500\" />\n          )}\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        <div className={`text-xs px-2 py-1 rounded ${\n          isConfigured \n            ? 'bg-green-100 text-green-800' \n            : 'bg-orange-100 text-orange-800'\n        }`}>\n          {isConfigured ? \n            (connectionStatus.tested ? \n              (connectionStatus.success ? 'âœ“ é€£æºç¢ºèªæ¸ˆã¿' : 'âš  æ¥ç¶šã‚¨ãƒ©ãƒ¼') \n              : 'âœ“ é€£æºè¨­å®šæ¸ˆã¿') \n            : 'âš  é€£æºæœªè¨­å®š'}\n        </div>\n\n        {/* Connection Test Button */}\n        {isConfigured && (\n          <button\n            onClick={testSheetsConnection}\n            disabled={testingConnection}\n            className=\"inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800 transition-colors disabled:opacity-50\"\n          >\n            <RefreshCw className={`w-3 h-3 ${testingConnection ? 'animate-spin' : ''}`} />\n            {testingConnection ? 'æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...' : 'æ¥ç¶šãƒ†ã‚¹ãƒˆ'}\n          </button>\n        )}\n\n        {/* Connection Status */}\n        {connectionStatus.tested && (\n          <div className={`text-xs p-2 rounded ${\n            connectionStatus.success ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'\n          }`}>\n            {connectionStatus.success ? \n              'âœ… ã‚·ãƒ¼ãƒˆã¸ã®æ¥ç¶šã«æˆåŠŸã—ã¾ã—ãŸ' : \n              `âŒ ${connectionStatus.error}`\n            }\n          </div>\n        )}\n\n        {isConfigured && connectionStatus.success ? (\n          <div className=\"space-y-2\">\n            <p className=\"text-xs text-gray-600\">\n              æ—¥æ¬¡å ±å‘ŠãŒè‡ªå‹•çš„ã«Google Sheetsã«ä¿å­˜ã•ã‚Œã¾ã™\n            </p>\n            {sheetsUrl && (\n              <a\n                href={sheetsUrl}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800 transition-colors\"\n              >\n                <ExternalLink className=\"w-3 h-3\" />\n                Sheetsã‚’é–‹ã\n              </a>\n            )}\n          </div>\n        ) : isConfigured ? (\n          <div className=\"space-y-2\">\n            <p className=\"text-xs text-gray-600\">\n              ã‚·ãƒ¼ãƒˆã¸ã®æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-2\">\n            <p className=\"text-xs text-gray-600\">\n              Google Sheetsé€£æºã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯è¨­å®šãŒå¿…è¦ã§ã™\n            </p>\n            <SetupGuide />\n          </div>\n        )}\n      </div>\n\n      {/* Setup Modal */}\n      {showSetup && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-lg max-w-md w-full p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">Google Sheetsè¨­å®š</h3>\n              <button\n                onClick={() => setShowSetup(false)}\n                className=\"text-gray-500 hover:text-gray-700\"\n              >\n                âœ•\n              </button>\n            </div>\n            \n            <div className=\"space-y-4 text-sm text-gray-700\">\n              <div>\n                <h4 className=\"font-medium mb-2\">1. Google Sheets APIã‚­ãƒ¼ã‚’å–å¾—</h4>\n                <p className=\"text-xs\">Google Cloud Consoleã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€Sheets APIã‚’æœ‰åŠ¹ã«ã—ã¦APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚</p>\n              </div>\n              \n              <div>\n                <h4 className=\"font-medium mb-2\">2. Google Sheetsã®å…±æœ‰è¨­å®š</h4>\n                <p className=\"text-xs\">ã‚·ãƒ¼ãƒˆã‚’é–‹ãã€ã€Œå…±æœ‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œåˆ¶é™ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã€ã‚’ã€Œãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹å…¨å“¡ã€ã«å¤‰æ›´ â†’ ã€Œé–²è¦§è€…ã€ã¾ãŸã¯ã€Œç·¨é›†è€…ã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>\n              </div>\n              \n              <div>\n                <h4 className=\"font-medium mb-2\">3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š</h4>\n                <div className=\"bg-gray-100 p-2 rounded text-xs font-mono\">\n                  VITE_GOOGLE_SHEETS_API_KEY=your_api_key<br/>\n                  VITE_GOOGLE_SHEET_ID=1GWp6bW4WnSc9EFobaYNqhUz6wtMuL6gG74Tg2Osvtco\n                </div>\n              </div>\n              \n              <div>\n                <h4 className=\"font-medium mb-2\">4. ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã®å¯¾å‡¦æ³•</h4>\n                <ul className=\"text-xs space-y-1\">\n                  <li>â€¢ <strong>403ã‚¨ãƒ©ãƒ¼</strong>: ã‚·ãƒ¼ãƒˆã®å…±æœ‰è¨­å®šã‚’ã€Œãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹å…¨å“¡ã€ã«å¤‰æ›´</li>\n                  <li>â€¢ <strong>404ã‚¨ãƒ©ãƒ¼</strong>: ã‚·ãƒ¼ãƒˆã®URLã¾ãŸã¯IDã‚’ç¢ºèª</li>\n                  <li>â€¢ <strong>400ã‚¨ãƒ©ãƒ¼</strong>: APIã‚­ãƒ¼ãŒç„¡åŠ¹ã¾ãŸã¯åˆ¶é™è¨­å®šã‚’ç¢ºèª</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};",
  "src/components/Dashboard/KPICards.tsx": "import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { TrendingUp, TrendingDown, Pen as Yen, Target, AlertCircle } from 'lucide-react';\nimport { formatCurrency, formatPercent } from '@/lib/utils';\n\ninterface KPIData {\n  todaySales: number;\n  todayExpenses: number;\n  todayGrossProfit: number;\n  todayOperatingProfit: number;\n  salesGrowth: number;\n  profitMargin: number;\n}\n\ninterface KPICardsProps {\n  data: KPIData;\n  loading?: boolean;\n}\n\nexport const KPICards: React.FC<KPICardsProps> = ({ data, loading = false }) => {\n  if (loading) {\n    return (\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        {[...Array(4)].map((_, i) => (\n          <Card key={i} className=\"animate-pulse\">\n            <CardHeader className=\"pb-2\">\n              <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-8 bg-gray-200 rounded w-1/2 mb-2\"></div>\n              <div className=\"h-4 bg-gray-200 rounded w-1/3\"></div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  const kpiItems = [\n    {\n      title: 'ä»Šæ—¥ã®å£²ä¸Š',\n      value: formatCurrency(data.todaySales),\n      trend: data.salesGrowth,\n      icon: Yen,\n      color: 'text-blue-600',\n      bgColor: 'bg-blue-50',\n      description: 'å‰æ—¥æ¯”'\n    },\n    {\n      title: 'ä»Šæ—¥ã®çµŒè²»',\n      value: formatCurrency(data.todayExpenses),\n      trend: null,\n      icon: AlertCircle,\n      color: 'text-red-600',\n      bgColor: 'bg-red-50',\n      description: 'æ”¯å‡ºåˆè¨ˆ'\n    },\n    {\n      title: 'ç²—åˆ©ç›Š',\n      value: formatCurrency(data.todayGrossProfit),\n      trend: null,\n      icon: TrendingUp,\n      color: data.todayGrossProfit >= 0 ? 'text-green-600' : 'text-red-600',\n      bgColor: data.todayGrossProfit >= 0 ? 'bg-green-50' : 'bg-red-50',\n      description: 'å£²ä¸Š - ä»•å…¥'\n    },\n    {\n      title: 'å–¶æ¥­åˆ©ç›Š',\n      value: formatCurrency(data.todayOperatingProfit),\n      trend: null,\n      icon: Target,\n      color: data.todayOperatingProfit >= 0 ? 'text-green-600' : 'text-red-600',\n      bgColor: data.todayOperatingProfit >= 0 ? 'bg-green-50' : 'bg-red-50',\n      description: `åˆ©ç›Šç‡ ${formatPercent(data.profitMargin)}`\n    }\n  ];\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6\">\n      {kpiItems.map((item, index) => {\n        const IconComponent = item.icon;\n        return (\n          <Card key={index} className=\"hover:shadow-lg transition-shadow duration-200\">\n            <CardHeader className=\"pb-2 px-3 sm:px-6 pt-3 sm:pt-6\">\n              <CardTitle className=\"text-xs sm:text-sm font-medium text-gray-600 flex items-center justify-between\">\n                <span className=\"truncate\">{item.title}</span>\n                <div className={`p-1.5 sm:p-2 rounded-lg ${item.bgColor} flex-shrink-0 ml-2`}>\n                  <IconComponent className={`w-3 h-3 sm:w-4 sm:h-4 ${item.color}`} />\n                </div>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"px-3 sm:px-6 pb-3 sm:pb-6\">\n              <div className={`text-lg sm:text-2xl font-bold ${item.color} mb-1 truncate`}>\n                {item.value}\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <p className=\"text-xs text-gray-500 truncate\">{item.description}</p>\n                {item.trend !== null && (\n                  <div className=\"flex items-center flex-shrink-0 ml-2\">\n                    {item.trend >= 0 ? (\n                      <TrendingUp className=\"w-3 h-3 text-green-500 mr-1\" />\n                    ) : (\n                      <TrendingDown className=\"w-3 h-3 text-red-500 mr-1\" />\n                    )}\n                    <span className={`text-xs font-medium ${\n                      item.trend >= 0 ? 'text-green-600' : 'text-red-600'\n                    }`}>\n                      {Math.abs(item.trend).toFixed(1)}%\n                    </span>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        );\n      })}\n    </div>\n  );\n};",
  "src/components/Dashboard/PerformanceMetrics.tsx": "import React from 'react';\nimport { TrendingUp, TrendingDown, Target, Award, AlertTriangle, Calendar } from 'lucide-react';\nimport { formatCurrency, formatPercent } from '../../utils/calculations';\nimport { useTargets } from '../../hooks/useTargets';\n\ninterface PerformanceData {\n  currentMonth: {\n    sales: number;\n    profit: number;\n    profitMargin: number;\n    reportCount: number;\n  };\n  previousMonth: {\n    sales: number;\n    profit: number;\n    profitMargin: number;\n    reportCount: number;\n  };\n  target: {\n    monthlySales: number;\n    monthlyProfit: number;\n    profitMarginTarget: number;\n  };\n  alerts: Array<{\n    type: 'warning' | 'error' | 'info';\n    message: string;\n    actionRequired?: boolean;\n  }>;\n}\n\ninterface PerformanceMetricsProps {\n  data: PerformanceData;\n  userId?: string | null;\n  selectedStoreId?: string | null;\n}\n\nexport const PerformanceMetrics: React.FC<PerformanceMetricsProps> = ({ \n  data, \n  userId = null, \n  selectedStoreId = null \n}) => {\n  const { getTarget, getAllStoresTarget } = useTargets(userId);\n  const { currentMonth, previousMonth, target, alerts } = data;\n  \n  console.log('ğŸ¯ PerformanceMetrics: Debug info', {\n    userId,\n    selectedStoreId,\n    currentMonth,\n    target,\n    hasTargetHook: !!getTarget\n  });\n\n  // ç¾åœ¨ã®å¹´æœˆã‚’å–å¾—\n  const now = new Date();\n  const currentYear = now.getFullYear();\n  const currentMonthNum = now.getMonth() + 1;\n\n  // è¨­å®šã•ã‚ŒãŸç›®æ¨™ã‚’å–å¾—\n  const customTarget = selectedStoreId && selectedStoreId !== 'all' \n    ? getTarget(selectedStoreId, currentYear, currentMonthNum)\n    : getAllStoresTarget(currentYear, currentMonthNum);\n    \n  console.log('ğŸ¯ PerformanceMetrics: Target data', {\n    customTarget,\n    selectedStoreId,\n    currentYear,\n    currentMonthNum\n  });\n\n  // ç›®æ¨™å€¤ã‚’ä½¿ç”¨ï¼ˆè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰\n  const actualTarget = {\n    monthlySales: customTarget ? \n      (selectedStoreId === 'all' ? customTarget.totalSales : (customTarget as any).targetSales) : \n      target.monthlySales,\n    monthlyProfit: customTarget ? \n      (selectedStoreId === 'all' ? \n        customTarget.totalSales * (customTarget.averageProfitMargin / 100) : \n        (customTarget as any).targetSales * ((customTarget as any).targetProfitMargin / 100)\n      ) : target.monthlyProfit,\n    profitMarginTarget: customTarget ?\n      (selectedStoreId === 'all' ? customTarget.averageProfitMargin : (customTarget as any).targetProfitMargin) :\n      target.profitMarginTarget\n  };\n\n  console.log('ğŸ¯ PerformanceMetrics: Final target', actualTarget);\n\n  // å‰æœˆæ¯”è¨ˆç®—\n  const salesGrowth = previousMonth.sales > 0 \n    ? ((currentMonth.sales - previousMonth.sales) / previousMonth.sales) * 100 \n    : 0;\n  \n  const profitGrowth = previousMonth.profit > 0\n    ? ((currentMonth.profit - previousMonth.profit) / previousMonth.profit) * 100\n    : 0;\n\n  // ç›®æ¨™é”æˆç‡\n  const salesAchievement = (currentMonth.sales / actualTarget.monthlySales) * 100;\n  const profitAchievement = (currentMonth.profit / actualTarget.monthlyProfit) * 100;\n\n  const MetricCard = ({ \n    title, \n    current, \n    previous, \n    growth, \n    target: targetValue, \n    achievement, \n    icon: IconComponent,\n    format = 'currency'\n  }: {\n    title: string;\n    current: number;\n    previous: number;\n    growth: number;\n    target?: number;\n    achievement?: number;\n    icon: any;\n    format?: 'currency' | 'percent' | 'number';\n  }) => {\n    const formatValue = (value: number) => {\n      switch (format) {\n        case 'currency': return formatCurrency(value);\n        case 'percent': return formatPercent(value);\n        case 'number': return value.toString();\n        default: return formatCurrency(value);\n      }\n    };\n\n    return (\n      <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-sm font-medium text-gray-700\">{title}</h3>\n          <IconComponent className=\"w-5 h-5 text-blue-600\" />\n        </div>\n        \n        <div className=\"space-y-3\">\n          <div>\n            <p className=\"text-2xl font-bold text-gray-900\">\n              {formatValue(current)}\n            </p>\n          </div>\n          \n          {/* å‰æœˆæ¯” */}\n          <div className=\"flex items-center gap-2\">\n            {growth >= 0 ? (\n              <TrendingUp className=\"w-4 h-4 text-green-500\" />\n            ) : (\n              <TrendingDown className=\"w-4 h-4 text-red-500\" />\n            )}\n            <span className={`text-sm font-medium ${growth >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n              {Math.abs(growth).toFixed(1)}% \n            </span>\n            <span className=\"text-sm text-gray-500\">å‰æœˆæ¯”</span>\n          </div>\n          \n          {/* ç›®æ¨™é”æˆç‡ */}\n          {targetValue && achievement !== undefined && (\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-gray-600\">ç›®æ¨™é”æˆç‡</span>\n                <span className={`font-medium ${achievement >= 100 ? 'text-green-600' : achievement >= 80 ? 'text-yellow-600' : 'text-red-600'}`}>\n                  {achievement.toFixed(1)}%\n                </span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className={`h-2 rounded-full transition-all duration-300 ${\n                    achievement >= 100 ? 'bg-green-500' : \n                    achievement >= 80 ? 'bg-yellow-500' : 'bg-red-500'\n                  }`}\n                  style={{ width: `${Math.min(achievement, 100)}%` }}\n                ></div>\n              </div>\n              <p className=\"text-xs text-gray-500\">\n                ç›®æ¨™: {formatValue(targetValue)}\n              </p>\n              {customTarget && (\n                <div className=\"text-xs text-blue-600 mt-1\">\n                  âœ“ ã‚«ã‚¹ã‚¿ãƒ ç›®æ¨™è¨­å®šæ¸ˆã¿\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* åˆ†æå¯¾è±¡è¡¨ç¤º */}\n      <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4\">\n        <div className=\"flex items-center gap-2\">\n          <Calendar className=\"w-5 h-5 text-blue-600\" />\n          <h3 className=\"font-medium text-blue-900\">\n            {selectedStoreId === 'all' || !selectedStoreId ? \n              'ğŸ¢ å…¨åº—èˆ—åˆè¨ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹' : \n              `ğŸª ${selectedStoreId}åº—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹`}\n          </h3>\n        </div>\n        <p className=\"text-sm text-blue-700 mt-1\">\n          {selectedStoreId === 'all' || !selectedStoreId ? \n            'ã„ã£ããƒã‚§ãƒ¼ãƒ³å…¨ä½“ã®æœˆé–“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ' : \n            'é¸æŠåº—èˆ—ã®å€‹åˆ¥æœˆé–“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ'}\n        </p>\n      </div>\n\n      {/* ã‚¢ãƒ©ãƒ¼ãƒˆ */}\n      {alerts.length > 0 && (\n        <div className=\"space-y-2\">\n          {alerts.map((alert, index) => (\n            <div\n              key={index}\n              className={`flex items-center gap-3 p-3 rounded-lg ${\n                alert.type === 'error' ? 'bg-red-50 border border-red-200' :\n                alert.type === 'warning' ? 'bg-yellow-50 border border-yellow-200' :\n                'bg-blue-50 border border-blue-200'\n              }`}\n            >\n              <AlertTriangle className={`w-4 h-4 ${\n                alert.type === 'error' ? 'text-red-600' :\n                alert.type === 'warning' ? 'text-yellow-600' :\n                'text-blue-600'\n              }`} />\n              <p className={`text-sm ${\n                alert.type === 'error' ? 'text-red-800' :\n                alert.type === 'warning' ? 'text-yellow-800' :\n                'text-blue-800'\n              }`}>\n                {alert.message}\n              </p>\n              {alert.actionRequired && (\n                <span className=\"ml-auto px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full\">\n                  è¦å¯¾å¿œ\n                </span>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        <MetricCard\n          title={selectedStoreId === 'all' || !selectedStoreId ? \"å…¨åº—èˆ—ä»Šæœˆå£²ä¸Š\" : \"ä»Šæœˆå£²ä¸Š\"}\n          current={currentMonth.sales}\n          previous={previousMonth.sales}\n          growth={salesGrowth}\n          target={actualTarget.monthlySales}\n          achievement={salesAchievement}\n          icon={TrendingUp}\n          format=\"currency\"\n        />\n        \n        <MetricCard\n          title={selectedStoreId === 'all' || !selectedStoreId ? \"å…¨åº—èˆ—ä»Šæœˆåˆ©ç›Š\" : \"ä»Šæœˆåˆ©ç›Š\"}\n          current={currentMonth.profit}\n          previous={previousMonth.profit}\n          growth={profitGrowth}\n          target={actualTarget.monthlyProfit}\n          achievement={profitAchievement}\n          icon={Award}\n          format=\"currency\"\n        />\n        \n        <MetricCard\n          title={selectedStoreId === 'all' || !selectedStoreId ? \"å…¨åº—èˆ—åˆ©ç›Šç‡\" : \"åˆ©ç›Šç‡\"}\n          current={currentMonth.profitMargin}\n          previous={previousMonth.profitMargin}\n          growth={currentMonth.profitMargin - previousMonth.profitMargin}\n          target={actualTarget.profitMarginTarget}\n          achievement={(currentMonth.profitMargin / actualTarget.profitMarginTarget) * 100}\n          icon={Target}\n          format=\"percent\"\n        />\n      </div>\n\n      {/* è©³ç´°åˆ†æ */}\n      <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Calendar className=\"w-5 h-5 text-blue-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">\n            {selectedStoreId === 'all' || !selectedStoreId ? \"å…¨åº—èˆ—æœˆé–“åˆ†æ\" : \"æœˆé–“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ\"}\n          </h3>\n        </div>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <h4 className=\"text-sm font-medium text-gray-700 mb-3\">\n              {selectedStoreId === 'all' || !selectedStoreId ? \"å…¨åº—èˆ—å£²ä¸Šåˆ†æ\" : \"å£²ä¸Šåˆ†æ\"}\n            </h4>\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">ä»Šæœˆå£²ä¸Š:</span>\n                <span className=\"font-medium\">{formatCurrency(currentMonth.sales)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">å‰æœˆå£²ä¸Š:</span>\n                <span className=\"font-medium\">{formatCurrency(previousMonth.sales)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">ç›®æ¨™å£²ä¸Š:</span>\n                <span className=\"font-medium\">{formatCurrency(actualTarget.monthlySales)}</span>\n              </div>\n              <div className=\"flex justify-between pt-2 border-t\">\n                <span className=\"text-gray-600\">ç›®æ¨™ã¨ã®å·®é¡:</span>\n                <span className={`font-medium ${\n                  currentMonth.sales >= actualTarget.monthlySales ? 'text-green-600' : 'text-red-600'\n                }`}>\n                  {formatCurrency(currentMonth.sales - actualTarget.monthlySales)}\n                </span>\n              </div>\n            </div>\n          </div>\n          \n          <div>\n            <h4 className=\"text-sm font-medium text-gray-700 mb-3\">\n              {selectedStoreId === 'all' || !selectedStoreId ? \"å…¨åº—èˆ—å ±å‘ŠçŠ¶æ³\" : \"å ±å‘ŠçŠ¶æ³\"}\n            </h4>\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">ä»Šæœˆå ±å‘Šæ•°:</span>\n                <span className=\"font-medium\">{currentMonth.reportCount}ä»¶</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">å‰æœˆå ±å‘Šæ•°:</span>\n                <span className=\"font-medium\">{previousMonth.reportCount}ä»¶</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">1æ—¥å¹³å‡:</span>\n                <span className=\"font-medium\">\n                  {(currentMonth.reportCount / new Date().getDate()).toFixed(1)}ä»¶\n                </span>\n              </div>\n              {selectedStoreId === 'all' || !selectedStoreId ? (\n                <div className=\"flex justify-between pt-2 border-t\">\n                  <span className=\"text-gray-600\">åº—èˆ—æ•°:</span>\n                  <span className=\"font-medium text-blue-600\">3åº—èˆ—</span>\n                </div>\n              ) : null}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};",
  "src/components/Dashboard/PeriodSelector.tsx": "import React from 'react';\nimport { PeriodType } from '../../types';\n\ninterface PeriodSelectorProps {\n  selectedPeriod: PeriodType;\n  onPeriodChange: (period: PeriodType) => void;\n  selectedRange?: 'week' | 'month' | 'quarter' | 'year';\n  onRangeChange?: (range: 'week' | 'month' | 'quarter' | 'year') => void;\n}\n\nconst periodOptions: { value: PeriodType; label: string }[] = [\n  { value: 'daily', label: 'æ—¥æ¬¡' },\n  { value: 'weekly', label: 'é€±æ¬¡' },\n  { value: 'monthly', label: 'æœˆæ¬¡' }\n];\n\nconst rangeOptions = [\n  { value: 'week' as const, label: 'éå»1é€±é–“' },\n  { value: 'month' as const, label: 'éå»1ãƒ¶æœˆ' },\n  { value: 'quarter' as const, label: 'éå»3ãƒ¶æœˆ' },\n  { value: 'year' as const, label: 'éå»1å¹´' }\n];\n\nexport const PeriodSelector: React.FC<PeriodSelectorProps> = ({\n  selectedPeriod,\n  onPeriodChange,\n  selectedRange = 'month',\n  onRangeChange\n}) => {\n  return (\n    <div className=\"space-y-4\">\n      {/* åˆ†æå˜ä½é¸æŠ */}\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">åˆ†æå˜ä½</label>\n        <div className=\"flex bg-gray-100 rounded-lg p-1\">\n          {periodOptions.map((option) => (\n            <button\n              key={option.value}\n              onClick={() => onPeriodChange(option.value)}\n              className={`\n                px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200\n                ${selectedPeriod === option.value\n                  ? 'bg-white text-blue-700 shadow-sm'\n                  : 'text-gray-600 hover:text-gray-900'\n                }\n              `}\n            >\n              {option.label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* æœŸé–“ç¯„å›²é¸æŠ */}\n      {onRangeChange && (\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">åˆ†ææœŸé–“</label>\n          <div className=\"grid grid-cols-2 gap-2\">\n            {rangeOptions.map((option) => (\n              <button\n                key={option.value}\n                onClick={() => onRangeChange(option.value)}\n                className={`\n                  px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 border\n                  ${selectedRange === option.value\n                    ? 'bg-blue-600 text-white border-blue-600'\n                    : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'\n                  }\n                `}\n              >\n                {option.label}\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};",
  "src/components/Dashboard/SetupGuide.tsx": "import React, { useState } from 'react';\nimport { FileSpreadsheet, ExternalLink, Copy, CheckCircle, AlertCircle, Book } from 'lucide-react';\n\nexport const SetupGuide: React.FC = () => {\n  const [showGuide, setShowGuide] = useState(false);\n  const [copiedStep, setCopiedStep] = useState<number | null>(null);\n\n  const steps = [\n    {\n      title: \"Google Cloud Consoleã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ\",\n      description: \"æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦Google Sheets APIã‚’æœ‰åŠ¹åŒ–\",\n      link: \"https://console.cloud.google.com/\",\n      action: \"Google Cloud Console ã‚’é–‹ã\"\n    },\n    {\n      title: \"Google Sheets APIã‚’æœ‰åŠ¹åŒ–\",\n      description: \"APIã¨ã‚µãƒ¼ãƒ“ã‚¹ â†’ ãƒ©ã‚¤ãƒ–ãƒ©ãƒª â†’ Google Sheets API â†’ æœ‰åŠ¹ã«ã™ã‚‹\",\n      steps: [\n        \"ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã‚’ã‚¯ãƒªãƒƒã‚¯\",\n        \"ã€ŒGoogle Sheets APIã€ã‚’æ¤œç´¢\",\n        \"Google Sheets APIã‚’é¸æŠã—ã¦ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€\"\n      ]\n    },\n    {\n      title: \"APIã‚­ãƒ¼ã‚’ä½œæˆ\",\n      description: \"APIã¨ã‚µãƒ¼ãƒ“ã‚¹ â†’ èªè¨¼æƒ…å ± â†’ èªè¨¼æƒ…å ±ã‚’ä½œæˆ â†’ APIã‚­ãƒ¼\",\n      copyText: \"AIzaSyD...\",\n      steps: [\n        \"ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œèªè¨¼æƒ…å ±ã€ã‚’ã‚¯ãƒªãƒƒã‚¯\",\n        \"ã€Œèªè¨¼æƒ…å ±ã‚’ä½œæˆã€â†’ã€ŒAPIã‚­ãƒ¼ã€ã‚’é¸æŠ\",\n        \"ä½œæˆã•ã‚ŒãŸAPIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼\"\n      ]\n    },\n    {\n      title: \"ã‚·ãƒ¼ãƒˆã®å…±æœ‰è¨­å®š\",\n      description: \"ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚·ãƒ¼ãƒˆã‚’ã€Œãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹å…¨å“¡ãŒé–²è¦§å¯èƒ½ã€ã«è¨­å®š\",\n      link: \"https://docs.google.com/spreadsheets/d/1GWp6bW4WnSc9EFobaYNqhUz6wtMuL6gG74Tg2Osvtco/edit\",\n      action: \"ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚·ãƒ¼ãƒˆã‚’é–‹ã\",\n      steps: [\n        \"ã‚·ãƒ¼ãƒˆã‚’é–‹ã„ã¦ã€Œå…±æœ‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯\",\n        \"ã€Œåˆ¶é™ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã€ã‚’ã€Œãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹å…¨å“¡ã€ã«å¤‰æ›´\",\n        \"æ¨©é™ã‚’ã€Œé–²è¦§è€…ã€ã¾ãŸã¯ã€Œç·¨é›†è€…ã€ã«è¨­å®š\"\n      ]\n    },\n    {\n      title: \"ç’°å¢ƒå¤‰æ•°ã®è¨­å®š\",\n      description: \".envãƒ•ã‚¡ã‚¤ãƒ«ã«APIã‚­ãƒ¼ã‚’è¨­å®š\",\n      copyText: `VITE_GOOGLE_SHEETS_API_KEY=ã“ã“ã«APIã‚­ãƒ¼ã‚’ãƒšãƒ¼ã‚¹ãƒˆ\nVITE_GOOGLE_SHEET_ID=1GWp6bW4WnSc9EFobaYNqhUz6wtMuL6gG74Tg2Osvtco`,\n      steps: [\n        \".envãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã\",\n        \"VITE_GOOGLE_SHEETS_API_KEYã«å–å¾—ã—ãŸAPIã‚­ãƒ¼ã‚’è¨­å®š\",\n        \"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•\"\n      ]\n    }\n  ];\n\n  const copyToClipboard = (text: string, stepIndex: number) => {\n    navigator.clipboard.writeText(text);\n    setCopiedStep(stepIndex);\n    setTimeout(() => setCopiedStep(null), 2000);\n  };\n\n  return (\n    <>\n      <button\n        onClick={() => setShowGuide(true)}\n        className=\"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n      >\n        <Book className=\"w-4 h-4\" />\n        è¨­å®šã‚¬ã‚¤ãƒ‰\n      </button>\n\n      {showGuide && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <FileSpreadsheet className=\"w-6 h-6 text-green-600\" />\n                <h2 className=\"text-xl font-semibold text-gray-900\">Google Sheets API è¨­å®šã‚¬ã‚¤ãƒ‰</h2>\n              </div>\n              <button\n                onClick={() => setShowGuide(false)}\n                className=\"text-gray-500 hover:text-gray-700 text-2xl\"\n              >\n                Ã—\n              </button>\n            </div>\n\n            <div className=\"p-6 space-y-8\">\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <AlertCircle className=\"w-5 h-5 text-blue-600 mt-0.5\" />\n                  <div>\n                    <h3 className=\"font-medium text-blue-900\">è¨­å®šå®Œäº†ã¾ã§ã®æ‰€è¦æ™‚é–“: ç´„10åˆ†</h3>\n                    <p className=\"text-sm text-blue-700 mt-1\">\n                      Google Cloud Consoleã§ã®æ“ä½œãŒåˆã‚ã¦ã®æ–¹ã§ã‚‚ç°¡å˜ã«è¨­å®šã§ãã¾ã™ã€‚\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {steps.map((step, index) => (\n                <div key={index} className=\"border border-gray-200 rounded-lg overflow-hidden\">\n                  <div className=\"bg-gray-50 px-4 py-3 border-b border-gray-200\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold\">\n                        {index + 1}\n                      </div>\n                      <div>\n                        <h3 className=\"font-medium text-gray-900\">{step.title}</h3>\n                        <p className=\"text-sm text-gray-600\">{step.description}</p>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"p-4\">\n                    {step.steps && (\n                      <ol className=\"list-decimal list-inside space-y-2 text-sm text-gray-700 mb-4\">\n                        {step.steps.map((substep, substepIndex) => (\n                          <li key={substepIndex}>{substep}</li>\n                        ))}\n                      </ol>\n                    )}\n\n                    <div className=\"flex flex-wrap gap-3\">\n                      {step.link && step.action && (\n                        <a\n                          href={step.link}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"inline-flex items-center gap-2 px-3 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors\"\n                        >\n                          <ExternalLink className=\"w-4 h-4\" />\n                          {step.action}\n                        </a>\n                      )}\n\n                      {step.copyText && (\n                        <button\n                          onClick={() => copyToClipboard(step.copyText!, index)}\n                          className=\"inline-flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 text-sm rounded-lg hover:bg-gray-200 transition-colors\"\n                        >\n                          {copiedStep === index ? (\n                            <>\n                              <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                              ã‚³ãƒ”ãƒ¼æ¸ˆã¿\n                            </>\n                          ) : (\n                            <>\n                              <Copy className=\"w-4 h-4\" />\n                              ã‚³ãƒ”ãƒ¼\n                            </>\n                          )}\n                        </button>\n                      )}\n                    </div>\n\n                    {step.copyText && (\n                      <div className=\"mt-3 p-3 bg-gray-100 rounded-lg\">\n                        <pre className=\"text-sm text-gray-800 whitespace-pre-wrap overflow-x-auto\">\n                          {step.copyText}\n                        </pre>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              ))}\n\n              <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <CheckCircle className=\"w-5 h-5 text-green-600 mt-0.5\" />\n                  <div>\n                    <h3 className=\"font-medium text-green-900\">è¨­å®šå®Œäº†å¾Œ</h3>\n                    <p className=\"text-sm text-green-700 mt-1\">\n                      æ—¥æ¬¡å ±å‘ŠãŒè‡ªå‹•çš„ã«Google Sheetsã«ä¿å­˜ã•ã‚Œã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ‡ãƒ¼ã‚¿åˆ†æãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"text-center\">\n                <button\n                  onClick={() => setShowGuide(false)}\n                  className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n                >\n                  è¨­å®šã‚¬ã‚¤ãƒ‰ã‚’é–‰ã˜ã‚‹\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};",
  "src/components/Dashboard/Sidebar.tsx": "import React, { useState } from 'react';\nimport { \n  BarChart3, \n  Calendar,\n  TrendingUp, \n  Target,\n  MessageCircle,\n  Settings,\n  LogOut,\n  Menu,\n  X,\n  User,\n  FileSpreadsheet,\n  Store\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\ninterface SidebarProps {\n  activeView: string;\n  onViewChange: (view: string) => void;\n  user?: { name: string; role: string } | null;\n  onLogout?: () => void;\n}\n\nexport const Sidebar: React.FC<SidebarProps> = ({ \n  activeView, \n  onViewChange, \n  user,\n  onLogout\n}) => {\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const menuItems = [\n    {\n      id: 'dashboard',\n      label: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',\n      icon: BarChart3,\n      description: 'å£²ä¸Šæ¦‚è¦'\n    },\n    {\n      id: 'reports',\n      label: 'åˆ†æãƒ¬ãƒãƒ¼ãƒˆ',\n      icon: Calendar,\n      description: 'æœŸé–“åˆ¥åˆ†æ'\n    },\n    {\n      id: 'targets',\n      label: 'ç›®æ¨™é”æˆåº¦',\n      icon: Target,\n      description: 'ç›®æ¨™vså®Ÿç¸¾'\n    },\n    {\n      id: 'stores',\n      label: 'åº—èˆ—ç®¡ç†',\n      icon: Store,\n      description: 'åº—èˆ—è¨­å®š'\n    },\n    {\n      id: 'chat',\n      label: 'AIãƒãƒ£ãƒƒãƒˆ',\n      icon: MessageCircle,\n      description: 'ãƒ‡ãƒ¼ã‚¿åˆ†æAI'\n    },\n    {\n      id: 'settings',\n      label: 'è¨­å®š',\n      icon: Settings,\n      description: 'ã‚·ã‚¹ãƒ†ãƒ è¨­å®š'\n    }\n  ];\n\n  return (\n    <div className={`bg-white border-r border-gray-200 flex flex-col h-full ${\n      isCollapsed ? 'w-16' : 'w-64'\n    } transition-all duration-300`}>\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200\">\n        <div className=\"flex items-center justify-between\">\n          {!isCollapsed && (\n            <div>\n              <h2 className=\"text-lg font-bold text-gray-900\">æ¥­å‹™åˆ†æ</h2>\n              <p className=\"text-xs text-gray-500\">Restaurant Analytics</p>\n            </div>\n          )}\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setIsCollapsed(!isCollapsed)}\n            className=\"text-gray-500 hover:text-gray-700\"\n          >\n            {isCollapsed ? <Menu className=\"w-4 h-4\" /> : <X className=\"w-4 h-4\" />}\n          </Button>\n        </div>\n      </div>\n\n      {/* User Info */}\n      {user && !isCollapsed && (\n        <div className=\"p-4 border-b border-gray-200 bg-gray-50\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\n              <User className=\"w-4 h-4 text-blue-600\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium text-gray-900 truncate\">{user.name}</p>\n              <p className=\"text-xs text-gray-500 capitalize\">{user.role}</p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Main Navigation */}\n      <nav className=\"flex-1 p-4 space-y-1 overflow-y-auto\">\n        {menuItems.map((item) => {\n          const IconComponent = item.icon;\n          const isActive = activeView === item.id;\n          \n          return (\n            <Button\n              key={item.id}\n              variant={isActive ? \"default\" : \"ghost\"}\n              className={`w-full justify-start h-auto p-3 ${\n                isActive \n                  ? 'bg-blue-600 text-white hover:bg-blue-700' \n                  : 'text-gray-700 hover:text-gray-900 hover:bg-gray-100'\n              }`}\n              onClick={() => onViewChange(item.id)}\n            >\n              <IconComponent className=\"w-5 h-5 flex-shrink-0\" />\n              {!isCollapsed && (\n                <div className=\"ml-3 text-left\">\n                  <div className=\"text-sm font-medium\">{item.label}</div>\n                  <div className=\"text-xs opacity-75\">{item.description}</div>\n                </div>\n              )}\n            </Button>\n          );\n        })}\n      </nav>\n\n      {/* Footer */}\n      <div className=\"p-4 border-t border-gray-200\">\n        {onLogout && (\n          <Button\n            variant=\"ghost\"\n            className=\"w-full justify-start h-auto p-3 text-red-600 hover:text-red-700 hover:bg-red-50\"\n            onClick={onLogout}\n          >\n            <LogOut className=\"w-5 h-5 flex-shrink-0\" />\n            {!isCollapsed && (\n              <div className=\"ml-3 text-left\">\n                <div className=\"text-sm font-medium\">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>\n              </div>\n            )}\n          </Button>\n        )}\n        \n        {!isCollapsed && (\n          <div className=\"mt-4 text-center\">\n            <p className=\"text-xs text-gray-500\">\n              Version 1.0.0 MVP\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};",
  "src/components/Dashboard/StatsCard.tsx": "import React from 'react';\nimport { DivideIcon as LucideIcon } from 'lucide-react';\n\ninterface StatsCardProps {\n  title: string;\n  value: string;\n  icon: LucideIcon;\n  trend?: {\n    value: number;\n    isPositive: boolean;\n  };\n  color?: 'blue' | 'green' | 'red' | 'yellow';\n}\n\nconst colorClasses = {\n  blue: 'bg-blue-50 text-blue-700',\n  green: 'bg-green-50 text-green-700',\n  red: 'bg-red-50 text-red-700',\n  yellow: 'bg-yellow-50 text-yellow-700'\n};\n\nexport const StatsCard: React.FC<StatsCardProps> = ({\n  title,\n  value,\n  icon: IconComponent,\n  trend,\n  color = 'blue'\n}) => {\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 p-6 hover:shadow-lg transition-shadow duration-200\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-600 mb-1\">{title}</p>\n          <p className=\"text-2xl font-bold text-gray-900\">{value}</p>\n          {trend && (\n            <p className={`text-sm mt-1 ${trend.isPositive ? 'text-green-600' : 'text-red-600'}`}>\n              {trend.isPositive ? 'â†—' : 'â†˜'} {Math.abs(trend.value)}%\n            </p>\n          )}\n        </div>\n        <div className={`p-3 rounded-lg ${colorClasses[color]}`}>\n          <IconComponent className=\"w-6 h-6\" />\n        </div>\n      </div>\n    </div>\n  );\n};",
  "src/components/Dashboard/StoreComparison.tsx": "import React, { useState } from 'react';\nimport { BarChart3, TrendingUp, TrendingDown, Award, Store, Users, Calendar } from 'lucide-react';\nimport { formatCurrency, formatPercent } from '../../utils/calculations';\nimport { useTargets } from '../../hooks/useTargets';\n\ninterface StoreData {\n  id: string;\n  name: string;\n  sales: number;\n  profit: number;\n  profitMargin: number;\n  reportCount: number;\n  averageDailySales: number;\n  lastReportDate: string;\n  rank: number;\n  trend: 'up' | 'down' | 'stable';\n  trendValue: number; // percentage change\n}\n\ninterface StoreComparisonProps {\n  stores: StoreData[];\n  period: 'daily' | 'weekly' | 'monthly';\n  onPeriodChange: (period: 'daily' | 'weekly' | 'monthly') => void;\n  userId?: string | null;\n}\n\nexport const StoreComparison: React.FC<StoreComparisonProps> = ({\n  stores, \n  period, \n  onPeriodChange,\n  userId = null\n}) => {\n  const { getTarget } = useTargets(userId);\n  const [sortBy, setSortBy] = useState<'sales' | 'profit' | 'profitMargin' | 'reportCount'>('sales');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\n\n  // ç¾åœ¨ã®å¹´æœˆã‚’å–å¾—\n  const now = new Date();\n  const currentYear = now.getFullYear();\n  const currentMonth = now.getMonth() + 1;\n\n  // ã‚½ãƒ¼ãƒˆå‡¦ç†\n  const sortedStores = [...stores].sort((a, b) => {\n    const aValue = a[sortBy];\n    const bValue = b[sortBy];\n    return sortOrder === 'desc' ? bValue - aValue : aValue - bValue;\n  });\n\n  const handleSort = (field: typeof sortBy) => {\n    if (field === sortBy) {\n      setSortOrder(sortOrder === 'desc' ? 'asc' : 'desc');\n    } else {\n      setSortBy(field);\n      setSortOrder('desc');\n    }\n  };\n\n  // æœ€é«˜å€¤ã‚’å–å¾—ï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸è¡¨ç¤ºç”¨ï¼‰\n  const maxSales = Math.max(...stores.map(s => s.sales));\n  const maxProfit = Math.max(...stores.map(s => s.profit));\n\n  const periodLabels = {\n    daily: 'æ—¥æ¬¡',\n    weekly: 'é€±æ¬¡', \n    monthly: 'æœˆæ¬¡'\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200\">\n      <div className=\"px-6 py-4 border-b border-gray-200\">\n        <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <BarChart3 className=\"w-5 h-5 text-blue-600\" />\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆ{periodLabels[period]}ï¼‰\n            </h3>\n          </div>\n          \n          {/* æœŸé–“é¸æŠ */}\n          <div className=\"flex bg-gray-100 rounded-lg p-1\">\n            {(['daily', 'weekly', 'monthly'] as const).map((p) => (\n              <button\n                key={p}\n                onClick={() => onPeriodChange(p)}\n                className={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${\n                  period === p\n                    ? 'bg-white text-blue-700 shadow-sm'\n                    : 'text-gray-600 hover:text-gray-900'\n                }`}\n              >\n                {periodLabels[p]}\n              </button>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* å…¨åº—èˆ—åˆè¨ˆè¡¨ç¤º */}\n      {stores.length > 0 && (\n        <div className=\"px-6 py-4 bg-blue-50 border-b border-blue-200\">\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"text-center\">\n              <p className=\"text-xs text-gray-600 mb-1\">å…¨åº—èˆ—åˆè¨ˆå£²ä¸Š</p>\n              <p className=\"text-lg font-bold text-blue-600\">\n                {formatCurrency(stores.reduce((sum, store) => sum + store.sales, 0))}\n              </p>\n            </div>\n            <div className=\"text-center\">\n              <p className=\"text-xs text-gray-600 mb-1\">å…¨åº—èˆ—åˆè¨ˆåˆ©ç›Š</p>\n              <p className={`text-lg font-bold ${\n                stores.reduce((sum, store) => sum + store.profit, 0) >= 0 ? 'text-green-600' : 'text-red-600'\n              }`}>\n                {formatCurrency(stores.reduce((sum, store) => sum + store.profit, 0))}\n              </p>\n            </div>\n            <div className=\"text-center\">\n              <p className=\"text-xs text-gray-600 mb-1\">å¹³å‡åˆ©ç›Šç‡</p>\n              <p className=\"text-lg font-bold text-purple-600\">\n                {stores.length > 0 ? \n                  formatPercent((stores.reduce((sum, store) => sum + store.profitMargin, 0) / stores.length) / 100) : \n                  '0%'\n                }\n              </p>\n            </div>\n            <div className=\"text-center\">\n              <p className=\"text-xs text-gray-600 mb-1\">ç·å ±å‘Šæ•°</p>\n              <p className=\"text-lg font-bold text-gray-600\">\n                {stores.reduce((sum, store) => sum + store.reportCount, 0)}ä»¶\n              </p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {stores.length === 0 ? (\n        <div className=\"p-12 text-center\">\n          <Store className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n          <h4 className=\"text-lg font-medium text-gray-900 mb-2\">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h4>\n          <p className=\"text-gray-500\">åº—èˆ—ã®å ±å‘Šãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>\n        </div>\n      ) : (\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  é †ä½\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  åº—èˆ—å\n                </th>\n                <th \n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                  onClick={() => handleSort('sales')}\n                >\n                  <div className=\"flex items-center gap-1\">\n                    å£²ä¸Š\n                    {sortBy === 'sales' && (\n                      sortOrder === 'desc' ? \n                      <TrendingDown className=\"w-3 h-3\" /> : \n                      <TrendingUp className=\"w-3 h-3\" />\n                    )}\n                  </div>\n                </th>\n                <th \n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                  onClick={() => handleSort('profit')}\n                >\n                  <div className=\"flex items-center gap-1\">\n                    åˆ©ç›Š\n                    {sortBy === 'profit' && (\n                      sortOrder === 'desc' ? \n                      <TrendingDown className=\"w-3 h-3\" /> : \n                      <TrendingUp className=\"w-3 h-3\" />\n                    )}\n                  </div>\n                </th>\n                <th \n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                  onClick={() => handleSort('profitMargin')}\n                >\n                  <div className=\"flex items-center gap-1\">\n                    åˆ©ç›Šç‡\n                    {sortBy === 'profitMargin' && (\n                      sortOrder === 'desc' ? \n                      <TrendingDown className=\"w-3 h-3\" /> : \n                      <TrendingUp className=\"w-3 h-3\" />\n                    )}\n                  </div>\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  ãƒˆãƒ¬ãƒ³ãƒ‰\n                </th>\n                <th \n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                  onClick={() => handleSort('reportCount')}\n                >\n                  <div className=\"flex items-center gap-1\">\n                    å ±å‘Šæ•°\n                    {sortBy === 'reportCount' && (\n                      sortOrder === 'desc' ? \n                      <TrendingDown className=\"w-3 h-3\" /> : \n                      <TrendingUp className=\"w-3 h-3\" />\n                    )}\n                  </div>\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {sortedStores.map((store, index) => (\n                <tr key={store.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className={`text-lg font-bold ${\n                        index === 0 ? 'text-yellow-600' :\n                        index === 1 ? 'text-gray-500' :\n                        index === 2 ? 'text-orange-600' :\n                        'text-gray-400'\n                      }`}>\n                        #{index + 1}\n                      </span>\n                      {index === 0 && <Award className=\"w-4 h-4 text-yellow-500\" />}\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"flex-shrink-0 h-8 w-8 bg-blue-100 rounded-full flex items-center justify-center\">\n                        <Store className=\"w-4 h-4 text-blue-600\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm font-medium text-gray-900\">{store.name}</p>\n                        <p className=\"text-xs text-gray-500\">\n                          æœ€çµ‚å ±å‘Š: {new Date(store.lastReportDate).toLocaleDateString('ja-JP')}\n                        </p>\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"space-y-1\">\n                      <p className=\"text-sm font-medium text-gray-900\">\n                        {formatCurrency(store.sales)}\n                      </p>\n                      {/* å£²ä¸Šãƒãƒ¼ */}\n                      <div className=\"w-full bg-gray-200 rounded-full h-1.5\">\n                        <div \n                          className=\"bg-blue-500 h-1.5 rounded-full transition-all duration-300\"\n                          style={{ width: `${(store.sales / maxSales) * 100}%` }}\n                        ></div>\n                      </div>\n                      <p className=\"text-xs text-gray-500\">\n                        æ—¥å¹³å‡: {formatCurrency(store.averageDailySales)}\n                      </p>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"space-y-1\">\n                      <p className={`text-sm font-medium ${\n                        store.profit >= 0 ? 'text-green-600' : 'text-red-600'\n                      }`}>\n                        {formatCurrency(store.profit)}\n                      </p>\n                      {/* åˆ©ç›Šãƒãƒ¼ */}\n                      <div className=\"w-full bg-gray-200 rounded-full h-1.5\">\n                        <div \n                          className={`h-1.5 rounded-full transition-all duration-300 ${\n                            store.profit >= 0 ? 'bg-green-500' : 'bg-red-500'\n                          }`}\n                          style={{ width: `${Math.abs(store.profit) / Math.abs(maxProfit) * 100}%` }}\n                        ></div>\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                    <span className={`${\n                      store.profitMargin >= 15 ? 'text-green-600' :\n                      store.profitMargin >= 10 ? 'text-yellow-600' :\n                      'text-red-600'\n                    }`}>\n                      {formatPercent(store.profitMargin / 100)}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"flex items-center gap-2\">\n                      {store.trend === 'up' ? (\n                        <TrendingUp className=\"w-4 h-4 text-green-500\" />\n                      ) : store.trend === 'down' ? (\n                        <TrendingDown className=\"w-4 h-4 text-red-500\" />\n                      ) : (\n                        <div className=\"w-4 h-4 bg-gray-400 rounded-full\"></div>\n                      )}\n                      <span className={`text-sm ${\n                        store.trend === 'up' ? 'text-green-600' :\n                        store.trend === 'down' ? 'text-red-600' :\n                        'text-gray-600'\n                      }`}>\n                        {Math.abs(store.trendValue).toFixed(1)}%\n                      </span>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"flex items-center gap-2\">\n                      <Users className=\"w-4 h-4 text-gray-400\" />\n                      <span className=\"text-sm text-gray-900\">{store.reportCount}ä»¶</span>\n                    </div>\n                    \n                    {/* ç›®æ¨™é”æˆç‡è¡¨ç¤º */}\n                    {(() => {\n                      const target = getTarget(store.id, currentYear, currentMonth);\n                      if (!target) return null;\n                      \n                      const salesAchievement = (store.sales / target.targetSales) * 100;\n                      const profitMarginAchievement = target.targetProfitMargin > 0 \n                        ? (store.profitMargin / target.targetProfitMargin) * 100 \n                        : 0;\n                      \n                      return (\n                        <div className=\"mt-2 pt-2 border-t border-gray-200\">\n                          <p className=\"text-xs text-gray-500 mb-1\">ç›®æ¨™é”æˆç‡</p>\n                          <div className=\"space-y-1\">\n                            <div className=\"flex justify-between text-xs\">\n                              <span>å£²ä¸Š: </span>\n                              <span className={`font-medium ${\n                                salesAchievement >= 100 ? 'text-green-600' : \n                                salesAchievement >= 80 ? 'text-yellow-600' : 'text-red-600'\n                              }`}>\n                                {salesAchievement.toFixed(1)}%\n                              </span>\n                            </div>\n                            <div className=\"flex justify-between text-xs\">\n                              <span>åˆ©ç›Šç‡: </span>\n                              <span className={`font-medium ${\n                                profitMarginAchievement >= 100 ? 'text-green-600' : \n                                profitMarginAchievement >= 80 ? 'text-yellow-600' : 'text-red-600'\n                              }`}>\n                                {profitMarginAchievement.toFixed(1)}%\n                              </span>\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })()}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  );\n};",
  "src/components/Dashboard/SyncStatus.tsx": "import React, { useState, useEffect } from 'react';\nimport { \n  FileSpreadsheet, \n  RefreshCw, \n  CheckCircle, \n  AlertCircle, \n  Upload, \n  Download,\n  Clock,\n  Wifi,\n  WifiOff\n} from 'lucide-react';\nimport { readFromSheets } from '../../services/googleSheets';\nimport { apiClient } from '../../services/api';\n\ninterface SyncStatusProps {\n  reports: any[];\n  onSyncComplete?: () => void;\n}\n\nexport const SyncStatus: React.FC<SyncStatusProps> = ({ reports, onSyncComplete }) => {\n  const [syncStatus, setSyncStatus] = useState<{\n    lastSync: Date | null;\n    syncing: boolean;\n    connected: boolean;\n    pendingCount: number;\n    error: string | null;\n  }>({\n    lastSync: null,\n    syncing: false,\n    connected: true,\n    pendingCount: 0,\n    error: null\n  });\n\n  const [batchSyncProgress, setBatchSyncProgress] = useState<{\n    inProgress: boolean;\n    completed: number;\n    total: number;\n  }>({\n    inProgress: false,\n    completed: 0,\n    total: 0\n  });\n\n  useEffect(() => {\n    // åˆå›æ¥ç¶šãƒ†ã‚¹ãƒˆ\n    checkConnection();\n    \n    // å®šæœŸçš„ãªæ¥ç¶šãƒã‚§ãƒƒã‚¯ï¼ˆ5åˆ†é–“éš”ï¼‰\n    const interval = setInterval(checkConnection, 5 * 60 * 1000);\n    \n    return () => clearInterval(interval);\n  }, []);\n\n  const checkConnection = async () => {\n    try {\n      const result = await readFromSheets();\n      setSyncStatus(prev => ({\n        ...prev,\n        connected: result.success,\n        error: result.success ? null : result.error || 'Connection failed'\n      }));\n    } catch (error) {\n      setSyncStatus(prev => ({\n        ...prev,\n        connected: false,\n        error: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼'\n      }));\n    }\n  };\n\n  const handleManualSync = async () => {\n    if (!reports.length) return;\n\n    setSyncStatus(prev => ({ ...prev, syncing: true, error: null }));\n    setBatchSyncProgress({ inProgress: true, completed: 0, total: reports.length });\n\n    try {\n      // Use backend API to sync reports to sheets (æœ€æ–°10ä»¶ã®ã¿)\n      const recentReports = reports.slice(0, 10);\n      \n      for (let i = 0; i < recentReports.length; i++) {\n        await apiClient.createReport(recentReports[i]);\n        setBatchSyncProgress(prev => ({ ...prev, completed: i + 1 }));\n        \n        // APIåˆ¶é™ã‚’é¿ã‘ã‚‹ãŸã‚å°‘ã—å¾…æ©Ÿ\n        if (i < recentReports.length - 1) {\n          await new Promise(resolve => setTimeout(resolve, 500));\n        }\n      }\n\n      setSyncStatus(prev => ({\n        ...prev,\n        syncing: false,\n        lastSync: new Date(),\n        pendingCount: Math.max(0, prev.pendingCount - recentReports.length),\n        error: null\n      }));\n\n      onSyncComplete?.();\n    } catch (error) {\n      setSyncStatus(prev => ({\n        ...prev,\n        syncing: false,\n        error: error instanceof Error ? error.message : 'åŒæœŸã‚¨ãƒ©ãƒ¼'\n      }));\n    } finally {\n      setBatchSyncProgress({ inProgress: false, completed: 0, total: 0 });\n    }\n  };\n\n  const handleReadFromSheets = async () => {\n    setSyncStatus(prev => ({ ...prev, syncing: true, error: null }));\n\n    try {\n      const result = await readFromSheets();\n      \n      if (result.success && result.data) {\n        console.log('Sheets data:', result.data);\n        // ã“ã“ã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ï¼ˆè¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é€šçŸ¥ãªã©ï¼‰\n        setSyncStatus(prev => ({\n          ...prev,\n          syncing: false,\n          error: null,\n          lastSync: new Date()\n        }));\n      } else {\n        setSyncStatus(prev => ({\n          ...prev,\n          syncing: false,\n          error: result.error || 'ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'\n        }));\n      }\n    } catch (error) {\n      setSyncStatus(prev => ({\n        ...prev,\n        syncing: false,\n        error: error instanceof Error ? error.message : 'ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'\n      }));\n    }\n  };\n\n  const { syncing, connected, lastSync, pendingCount, error } = syncStatus;\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 p-4\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <FileSpreadsheet className=\"w-5 h-5 text-green-600\" />\n          <h3 className=\"text-sm font-medium text-gray-900\">SheetsåŒæœŸçŠ¶æ³</h3>\n        </div>\n        \n        {/* æ¥ç¶šçŠ¶æ…‹ */}\n        <div className=\"flex items-center gap-2\">\n          {connected ? (\n            <div className=\"flex items-center gap-1 text-green-600\">\n              <Wifi className=\"w-4 h-4\" />\n              <span className=\"text-xs\">æ¥ç¶šä¸­</span>\n            </div>\n          ) : (\n            <div className=\"flex items-center gap-1 text-red-600\">\n              <WifiOff className=\"w-4 h-4\" />\n              <span className=\"text-xs\">æœªæ¥ç¶š</span>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* åŒæœŸçµ±è¨ˆ */}\n      <div className=\"grid grid-cols-3 gap-4 mb-4\">\n        <div className=\"text-center\">\n          <p className=\"text-xs text-gray-500\">æœ€çµ‚åŒæœŸ</p>\n          <div className=\"flex items-center justify-center gap-1\">\n            <Clock className=\"w-3 h-3 text-gray-400\" />\n            <p className=\"text-xs font-medium\">\n              {lastSync ? lastSync.toLocaleTimeString('ja-JP') : 'æœªå®Ÿè¡Œ'}\n            </p>\n          </div>\n        </div>\n        <div className=\"text-center\">\n          <p className=\"text-xs text-gray-500\">æœªåŒæœŸ</p>\n          <p className={`text-sm font-bold ${pendingCount > 0 ? 'text-orange-600' : 'text-green-600'}`}>\n            {pendingCount}ä»¶\n          </p>\n        </div>\n        <div className=\"text-center\">\n          <p className=\"text-xs text-gray-500\">ç·å ±å‘Šæ•°</p>\n          <p className=\"text-sm font-bold text-blue-600\">{reports.length}ä»¶</p>\n        </div>\n      </div>\n\n      {/* é€²è¡ŒçŠ¶æ³ */}\n      {batchSyncProgress.inProgress && (\n        <div className=\"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-sm text-blue-700\">åŒæœŸä¸­...</span>\n            <span className=\"text-sm font-medium text-blue-700\">\n              {batchSyncProgress.completed}/{batchSyncProgress.total}\n            </span>\n          </div>\n          <div className=\"w-full bg-blue-200 rounded-full h-2\">\n            <div \n              className=\"bg-blue-500 h-2 rounded-full transition-all duration-300\"\n              style={{ \n                width: `${(batchSyncProgress.completed / batchSyncProgress.total) * 100}%` \n              }}\n            ></div>\n          </div>\n        </div>\n      )}\n\n      {/* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */}\n      {error && (\n        <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\n          <div className=\"flex items-center gap-2\">\n            <AlertCircle className=\"w-4 h-4 text-red-600\" />\n            <p className=\"text-sm text-red-700\">{error}</p>\n          </div>\n        </div>\n      )}\n\n      {/* æ“ä½œãƒœã‚¿ãƒ³ */}\n      <div className=\"flex gap-2\">\n        <button\n          onClick={handleManualSync}\n          disabled={syncing || !connected || reports.length === 0}\n          className=\"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors\"\n        >\n          {syncing ? (\n            <RefreshCw className=\"w-4 h-4 animate-spin\" />\n          ) : (\n            <Upload className=\"w-4 h-4\" />\n          )}\n          {syncing ? 'åŒæœŸä¸­...' : 'æ‰‹å‹•åŒæœŸ'}\n        </button>\n\n        <button\n          onClick={handleReadFromSheets}\n          disabled={syncing || !connected}\n          className=\"flex items-center gap-2 px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors\"\n        >\n          <Download className=\"w-4 h-4\" />\n          èª­ã¿è¾¼ã¿\n        </button>\n\n        <button\n          onClick={checkConnection}\n          disabled={syncing}\n          className=\"flex items-center gap-2 px-3 py-2 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700 disabled:bg-gray-400 transition-colors\"\n        >\n          <RefreshCw className={`w-4 h-4 ${syncing ? 'animate-spin' : ''}`} />\n          æ¥ç¶šç¢ºèª\n        </button>\n      </div>\n\n      {/* çŠ¶æ…‹è¡¨ç¤º */}\n      <div className=\"mt-4 flex items-center justify-center\">\n        {connected ? (\n          <div className=\"flex items-center gap-2 text-green-600\">\n            <CheckCircle className=\"w-4 h-4\" />\n            <span className=\"text-xs\">Google Sheetsé€£æºä¸­</span>\n          </div>\n        ) : (\n          <div className=\"flex items-center gap-2 text-red-600\">\n            <AlertCircle className=\"w-4 h-4\" />\n            <span className=\"text-xs\">é€£æºã‚¨ãƒ©ãƒ¼ - è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„</span>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};",
  "src/components/Dashboard/TargetAchievementBadge.tsx": "import React from 'react'\nimport { Trophy, TrendingUp, Target as TargetIcon } from 'lucide-react'\nimport { Badge } from '@/components/ui/badge'\nimport { formatCurrency, formatPercent } from '@/lib/format'\nimport { cn } from '@/lib/utils'\nimport { TargetAchievement } from '@/types'\n\ninterface TargetAchievementBadgeProps {\n  achievement: TargetAchievement\n  showDetails?: boolean\n  className?: string\n}\n\nexport const TargetAchievementBadge: React.FC<TargetAchievementBadgeProps> = ({\n  achievement,\n  showDetails = false,\n  className\n}) => {\n  const { targetSales, actualSales, achievementRate, isAchieved, difference } = achievement\n\n  if (targetSales === 0) {\n    return null\n  }\n\n  return (\n    <div className={cn('space-y-2', className)}>\n      {isAchieved ? (\n        <div className=\"flex items-center gap-2\">\n          <Badge className=\"bg-green-600 text-white border-green-700 px-3 py-1 text-sm font-bold animate-pulse\">\n            <Trophy className=\"h-4 w-4 mr-1\" />\n            ç›®æ¨™é”æˆ\n          </Badge>\n          {showDetails && (\n            <span className=\"text-xs text-green-700 font-medium\">\n              é”æˆç‡ {formatPercent(achievementRate)}\n            </span>\n          )}\n        </div>\n      ) : (\n        <div className=\"flex items-center gap-2\">\n          <Badge variant=\"outline\" className=\"border-blue-500 text-blue-700 px-3 py-1 text-sm\">\n            <TargetIcon className=\"h-4 w-4 mr-1\" />\n            é€²æ— {formatPercent(achievementRate)}\n          </Badge>\n          {showDetails && (\n            <span className=\"text-xs text-muted-foreground\">\n              ã‚ã¨ {formatCurrency(Math.abs(difference))}\n            </span>\n          )}\n        </div>\n      )}\n\n      {showDetails && (\n        <div className=\"space-y-1 text-xs\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-muted-foreground\">ç›®æ¨™:</span>\n            <span className=\"font-mono\">{formatCurrency(targetSales)}</span>\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-muted-foreground\">å®Ÿç¸¾:</span>\n            <span className=\"font-mono font-medium\">{formatCurrency(actualSales)}</span>\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-muted-foreground\">å·®é¡:</span>\n            <span className={cn('font-mono font-medium', difference >= 0 ? 'text-green-600' : 'text-blue-600')}>\n              {difference >= 0 ? '+' : ''}{formatCurrency(difference)}\n            </span>\n          </div>\n        </div>\n      )}\n\n      {!showDetails && (\n        <div className=\"w-full bg-muted rounded-full h-2 overflow-hidden\">\n          <div\n            className={cn(\n              'h-full transition-all duration-500',\n              isAchieved ? 'bg-green-600' : 'bg-blue-500'\n            )}\n            style={{ width: `${Math.min(achievementRate, 100)}%` }}\n          />\n        </div>\n      )}\n    </div>\n  )\n}\n",
  "src/components/Dashboard/TargetSettings.tsx": "import React, { useState } from 'react';\nimport { Target, Save, X, Building, Calendar, TrendingUp, Pen as Yen, Plus, CreditCard as Edit, Trash2 } from 'lucide-react';\nimport { upsertTarget, deleteTarget } from '@/services/supabase';\nimport { formatCurrency } from '@/lib/format';\n\ninterface TargetSettingsProps {\n  stores: Array<{ id: string; name: string; }>;\n  onClose: () => void;\n  existingTargets?: Array<{\n    storeId: string;\n    period: string;\n    targetSales: number;\n    targetProfitMargin: number;\n    targetCostRate?: number;\n    targetLaborRate?: number;\n  }>;\n  onSaved?: () => void;\n}\n\nexport const TargetSettings: React.FC<TargetSettingsProps> = ({\n  stores,\n  onClose,\n  existingTargets = [],\n  onSaved\n}) => {\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n  const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1);\n  const [editingStoreId, setEditingStoreId] = useState<string | null>(null);\n  const [formData, setFormData] = useState({\n    targetSales: 0,\n    targetProfitMargin: 0,\n    targetCostRate: 0,\n    targetLaborRate: 0\n  });\n  const [loading, setLoading] = useState(false);\n  const [notification, setNotification] = useState<{ type: 'success' | 'error', message: string } | null>(null);\n\n  const years = Array.from({ length: 3 }, (_, i) => new Date().getFullYear() - 1 + i);\n  const months = Array.from({ length: 12 }, (_, i) => i + 1);\n\n  const showNotification = (type: 'success' | 'error', message: string) => {\n    setNotification({ type, message });\n    setTimeout(() => setNotification(null), 3000);\n  };\n\n  const getTarget = (storeId: string, year: number, month: number) => {\n    const period = `${year}-${String(month).padStart(2, '0')}`;\n    return existingTargets.find(t => t.storeId === storeId && t.period === period);\n  };\n\n  const startEditing = (storeId: string) => {\n    const existingTarget = getTarget(storeId, selectedYear, selectedMonth);\n    setEditingStoreId(storeId);\n    setFormData({\n      targetSales: existingTarget?.targetSales || 8000000,\n      targetProfitMargin: existingTarget?.targetProfitMargin || 20,\n      targetCostRate: existingTarget?.targetCostRate || 30,\n      targetLaborRate: existingTarget?.targetLaborRate || 25\n    });\n  };\n\n  const cancelEditing = () => {\n    setEditingStoreId(null);\n    setFormData({ targetSales: 0, targetProfitMargin: 0, targetCostRate: 0, targetLaborRate: 0 });\n  };\n\n  const handleSave = async () => {\n    if (!editingStoreId) return;\n\n    const store = stores.find(s => s.id === editingStoreId);\n    if (!store) return;\n\n    if (formData.targetSales <= 0) {\n      showNotification('error', 'ç›®æ¨™å£²ä¸Šã¯1å††ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    if (formData.targetProfitMargin <= 0 || formData.targetProfitMargin > 100) {\n      showNotification('error', 'ç›®æ¨™å–¶æ¥­åˆ©ç›Šç‡ã¯1-100%ã§å…¥åŠ›ã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    if (formData.targetCostRate < 0 || formData.targetCostRate > 100) {\n      showNotification('error', 'ç›®æ¨™åŸä¾¡ç‡ã¯0-100%ã§å…¥åŠ›ã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    if (formData.targetLaborRate < 0 || formData.targetLaborRate > 100) {\n      showNotification('error', 'ç›®æ¨™äººä»¶è²»ç‡ã¯0-100%ã§å…¥åŠ›ã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    setLoading(true);\n\n    const period = `${selectedYear}-${String(selectedMonth).padStart(2, '0')}`;\n    const targetProfit = Math.round(formData.targetSales * (formData.targetProfitMargin / 100));\n\n    const { error } = await upsertTarget({\n      store_id: editingStoreId,\n      period,\n      target_sales: formData.targetSales,\n      target_profit: targetProfit,\n      target_profit_margin: formData.targetProfitMargin,\n      target_cost_rate: formData.targetCostRate,\n      target_labor_rate: formData.targetLaborRate\n    });\n    setLoading(false);\n\n    if (error) {\n      showNotification('error', error.message ?? String(error));\n    } else {\n      showNotification('success', `${store.name}ã®ç›®æ¨™ã‚’è¨­å®šã—ã¾ã—ãŸ`);\n      setEditingStoreId(null);\n      onSaved?.();\n    }\n  };\n\n  const handleDelete = async (storeId: string) => {\n    const store = stores.find(s => s.id === storeId);\n    if (!store) return;\n\n    if (confirm(`${store.name}ã®ç›®æ¨™ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {\n      setLoading(true);\n      const period = `${selectedYear}-${String(selectedMonth).padStart(2, '0')}`;\n      const { error } = await deleteTarget(storeId, period);\n      setLoading(false);\n\n      if (error) {\n        showNotification('error', error.message ?? String(error));\n      } else {\n        showNotification('success', `${store.name}ã®ç›®æ¨™ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);\n        onSaved?.();\n      }\n    }\n  };\n\n  const formatNumber = (value: number) => {\n    return value.toLocaleString();\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg\">\n                <Target className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n              </div>\n              <h2 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">æœˆé–“ç›®æ¨™è¨­å®š</h2>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n            >\n              <X className=\"w-5 h-5 text-gray-500\" />\n            </button>\n          </div>\n        </div>\n\n        {notification && (\n          <div className={`mx-6 mt-4 p-3 rounded-lg ${\n            notification.type === 'success'\n              ? 'bg-green-50 dark:bg-green-900 text-green-800 dark:text-green-100'\n              : 'bg-red-50 dark:bg-red-900 text-red-800 dark:text-red-100'\n          }`}>\n            {notification.message}\n          </div>\n        )}\n\n        <div className=\"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center gap-4\">\n            <Calendar className=\"w-5 h-5 text-gray-600 dark:text-gray-400\" />\n            <div className=\"flex items-center gap-2\">\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">å¯¾è±¡æœŸé–“:</label>\n              <select\n                value={selectedYear}\n                onChange={(e) => setSelectedYear(parseInt(e.target.value))}\n                className=\"px-3 py-1 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded focus:ring-2 focus:ring-blue-500\"\n              >\n                {years.map(year => (\n                  <option key={year} value={year}>{year}å¹´</option>\n                ))}\n              </select>\n              <select\n                value={selectedMonth}\n                onChange={(e) => setSelectedMonth(parseInt(e.target.value))}\n                className=\"px-3 py-1 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded focus:ring-2 focus:ring-blue-500\"\n              >\n                {months.map(month => (\n                  <option key={month} value={month}>{month}æœˆ</option>\n                ))}\n              </select>\n            </div>\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n              {selectedYear}å¹´{selectedMonth}æœˆã®ç›®æ¨™è¨­å®š\n            </div>\n          </div>\n        </div>\n\n        <div className=\"p-6\">\n          <div className=\"space-y-4\">\n            {stores.map((store) => {\n              const existingTarget = getTarget(store.id, selectedYear, selectedMonth);\n              const isEditing = editingStoreId === store.id;\n\n              return (\n                <div key={store.id} className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <Building className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n                      <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100\">{store.name}</h3>\n                      {existingTarget && !isEditing && (\n                        <span className=\"px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100 rounded-full text-xs\">\n                          è¨­å®šæ¸ˆã¿\n                        </span>\n                      )}\n                    </div>\n\n                    {!isEditing && (\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={() => startEditing(store.id)}\n                          className=\"flex items-center gap-1 px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700\"\n                        >\n                          {existingTarget ? <Edit className=\"w-3 h-3\" /> : <Plus className=\"w-3 h-3\" />}\n                          {existingTarget ? 'ç·¨é›†' : 'è¨­å®š'}\n                        </button>\n                        {existingTarget && (\n                          <button\n                            onClick={() => handleDelete(store.id)}\n                            className=\"flex items-center gap-1 px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700\"\n                          >\n                            <Trash2 className=\"w-3 h-3\" />\n                            å‰Šé™¤\n                          </button>\n                        )}\n                      </div>\n                    )}\n                  </div>\n\n                  {isEditing ? (\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <div>\n                        <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          <Yen className=\"w-4 h-4\" />\n                          æœˆé–“ç›®æ¨™å£²ä¸Š\n                        </label>\n                        <div className=\"relative\">\n                          <input\n                            type=\"text\"\n                            inputMode=\"numeric\"\n                            value={formData.targetSales === 0 ? '' : formatNumber(formData.targetSales)}\n                            onChange={(e) => {\n                              const value = parseInt(e.target.value.replace(/[^0-9]/g, '')) || 0;\n                              setFormData(prev => ({ ...prev, targetSales: value }));\n                            }}\n                            className=\"w-full pl-3 pr-12 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-500 text-right font-mono text-lg\"\n                            placeholder=\"8,000,000\"\n                          />\n                          <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n                            <span className=\"text-gray-500 text-sm font-medium\">å††</span>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div>\n                        <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          <TrendingUp className=\"w-4 h-4\" />\n                          ç›®æ¨™å–¶æ¥­åˆ©ç›Šç‡\n                        </label>\n                        <div className=\"relative\">\n                          <input\n                            type=\"number\"\n                            min=\"1\"\n                            max=\"100\"\n                            step=\"0.1\"\n                            value={formData.targetProfitMargin || ''}\n                            onChange={(e) => {\n                              const value = parseFloat(e.target.value) || 0;\n                              setFormData(prev => ({ ...prev, targetProfitMargin: value }));\n                            }}\n                            className=\"w-full pl-3 pr-12 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-500 text-right font-mono text-lg\"\n                            placeholder=\"20\"\n                          />\n                          <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n                            <span className=\"text-gray-500 text-sm font-medium\">%</span>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div>\n                        <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          <TrendingUp className=\"w-4 h-4\" />\n                          ç›®æ¨™åŸä¾¡ç‡\n                        </label>\n                        <div className=\"relative\">\n                          <input\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"100\"\n                            step=\"0.1\"\n                            value={formData.targetCostRate || ''}\n                            onChange={(e) => {\n                              const value = parseFloat(e.target.value) || 0;\n                              setFormData(prev => ({ ...prev, targetCostRate: value }));\n                            }}\n                            className=\"w-full pl-3 pr-12 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-500 text-right font-mono text-lg\"\n                            placeholder=\"30\"\n                          />\n                          <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n                            <span className=\"text-gray-500 text-sm font-medium\">%</span>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div>\n                        <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          <TrendingUp className=\"w-4 h-4\" />\n                          ç›®æ¨™äººä»¶è²»ç‡\n                        </label>\n                        <div className=\"relative\">\n                          <input\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"100\"\n                            step=\"0.1\"\n                            value={formData.targetLaborRate || ''}\n                            onChange={(e) => {\n                              const value = parseFloat(e.target.value) || 0;\n                              setFormData(prev => ({ ...prev, targetLaborRate: value }));\n                            }}\n                            className=\"w-full pl-3 pr-12 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-500 text-right font-mono text-lg\"\n                            placeholder=\"25\"\n                          />\n                          <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n                            <span className=\"text-gray-500 text-sm font-medium\">%</span>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div className=\"md:col-span-2 flex justify-end gap-3\">\n                        <button\n                          onClick={cancelEditing}\n                          className=\"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors\"\n                        >\n                          ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n                        </button>\n                        <button\n                          onClick={handleSave}\n                          disabled={loading}\n                          className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-300 rounded-lg transition-colors\"\n                        >\n                          <Save className=\"w-4 h-4\" />\n                          {loading ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}\n                        </button>\n                      </div>\n                    </div>\n                  ) : existingTarget ? (\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 bg-gray-50 dark:bg-gray-900 rounded-lg p-4\">\n                      <div>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">æœˆé–“ç›®æ¨™å£²ä¸Š</p>\n                        <p className=\"text-xl font-bold text-blue-600 dark:text-blue-400\">\n                          {formatCurrency(existingTarget.targetSales)}\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">ç›®æ¨™å–¶æ¥­åˆ©ç›Šç‡</p>\n                        <p className=\"text-xl font-bold text-green-600 dark:text-green-400\">\n                          {existingTarget.targetProfitMargin}%\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">ç›®æ¨™åŸä¾¡ç‡</p>\n                        <p className=\"text-xl font-bold text-orange-600 dark:text-orange-400\">\n                          {existingTarget.targetCostRate || 0}%\n                        </p>\n                      </div>\n                      <div>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">ç›®æ¨™äººä»¶è²»ç‡</p>\n                        <p className=\"text-xl font-bold text-cyan-600 dark:text-cyan-400\">\n                          {existingTarget.targetLaborRate || 0}%\n                        </p>\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n                      <Target className=\"w-8 h-8 mx-auto mb-2 text-gray-400 dark:text-gray-500\" />\n                      <p>ã“ã®åº—èˆ—ã®ç›®æ¨™ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n\n        <div className=\"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 flex justify-end\">\n          <button\n            onClick={onClose}\n            className=\"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors\"\n          >\n            é–‰ã˜ã‚‹\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n",
  "src/components/Layout/Header.tsx": "import React, { useState } from 'react';\nimport { User, Settings, LogOut, Menu, ChevronDown } from 'lucide-react';\nimport { useAuth } from '../../hooks/useAuth';\n\ninterface HeaderProps {\n  onToggleSidebar: () => void;\n}\n\nexport const Header: React.FC<HeaderProps> = ({ onToggleSidebar }) => {\n  const { profile, signOut } = useAuth();\n  const [showUserMenu, setShowUserMenu] = useState(false);\n\n  const handleSignOut = async () => {\n    await signOut();\n    setShowUserMenu(false);\n  };\n\n  return (\n    <header className=\"bg-white shadow-sm border-b border-gray-200 px-6 py-4 flex items-center justify-between\">\n      <div className=\"flex items-center gap-4\">\n        <button\n          onClick={onToggleSidebar}\n          className=\"lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n        >\n          <Menu className=\"w-5 h-5 text-gray-600\" />\n        </button>\n        <div>\n          <h1 className=\"text-xl font-bold text-gray-900\">æ¥­å‹™å ±å‘Šã‚·ã‚¹ãƒ†ãƒ </h1>\n          <p className=\"text-sm text-gray-500\">Restaurant Business Report System</p>\n        </div>\n      </div>\n      \n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowUserMenu(!showUserMenu)}\n            className=\"flex items-center gap-3 px-4 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors\"\n          >\n            <User className=\"w-5 h-5 text-gray-600\" />\n            <div className=\"text-sm text-left\">\n              <p className=\"font-medium text-gray-900\">{profile?.name || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'}</p>\n              <p className=\"text-gray-500 capitalize\">{profile?.role || 'staff'}</p>\n            </div>\n            <ChevronDown className=\"w-4 h-4 text-gray-400\" />\n          </button>\n\n          {showUserMenu && (\n            <div className=\"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50\">\n              <button\n                onClick={() => setShowUserMenu(false)}\n                className=\"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2\"\n              >\n                <Settings className=\"w-4 h-4\" />\n                è¨­å®š\n              </button>\n              <hr className=\"my-1 border-gray-200\" />\n              <button\n                onClick={handleSignOut}\n                className=\"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-gray-50 flex items-center gap-2\"\n              >\n                <LogOut className=\"w-4 h-4\" />\n                ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Overlay to close user menu */}\n      {showUserMenu && (\n        <div \n          className=\"fixed inset-0 z-40\"\n          onClick={() => setShowUserMenu(false)}\n        />\n      )}\n    </header>\n  );\n};",
  "src/components/Layout/Sidebar.tsx": "import React from 'react';\nimport { \n  BarChart3, \n  FileText, \n  MessageCircle, \n  Settings, \n  Store,\n  Calendar,\n  TrendingUp,\n  Users,\n  X\n} from 'lucide-react';\n\ninterface SidebarProps {\n  activeTab: string;\n  onTabChange: (tab: string) => void;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst menuItems = [\n  { id: 'dashboard', label: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', icon: BarChart3 },\n  { id: 'reports', label: 'æ—¥æ¬¡å ±å‘Š', icon: FileText },\n  { id: 'analytics', label: 'åˆ†æ', icon: TrendingUp },\n  { id: 'stores', label: 'åº—èˆ—ç®¡ç†', icon: Store },\n  { id: 'calendar', label: 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼', icon: Calendar },\n  { id: 'chat', label: 'AIãƒãƒ£ãƒƒãƒˆ', icon: MessageCircle },\n  { id: 'team', label: 'ãƒãƒ¼ãƒ ', icon: Users },\n  { id: 'settings', label: 'è¨­å®š', icon: Settings },\n];\n\nexport const Sidebar: React.FC<SidebarProps> = ({ \n  activeTab, \n  onTabChange, \n  isOpen, \n  onClose \n}) => {\n  return (\n    <>\n      {/* Mobile overlay */}\n      {isOpen && (\n        <div \n          className=\"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40\"\n          onClick={onClose}\n        />\n      )}\n      \n      {/* Sidebar */}\n      <aside className={`\n        fixed lg:static inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 \n        transform transition-transform duration-200 ease-in-out\n        ${isOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n      `}>\n        <div className=\"flex flex-col h-full\">\n          {/* Mobile close button */}\n          <div className=\"lg:hidden flex justify-end p-4 border-b border-gray-200\">\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <X className=\"w-5 h-5 text-gray-600\" />\n            </button>\n          </div>\n          \n          {/* Navigation */}\n          <nav className=\"flex-1 px-4 py-6\">\n            <ul className=\"space-y-2\">\n              {menuItems.map((item) => {\n                const IconComponent = item.icon;\n                const isActive = activeTab === item.id;\n                \n                return (\n                  <li key={item.id}>\n                    <button\n                      onClick={() => {\n                        onTabChange(item.id);\n                        onClose();\n                      }}\n                      className={`\n                        w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left\n                        transition-colors duration-200\n                        ${isActive \n                          ? 'bg-blue-50 text-blue-700 font-medium' \n                          : 'text-gray-700 hover:bg-gray-50'\n                        }\n                      `}\n                    >\n                      <IconComponent className=\"w-5 h-5\" />\n                      {item.label}\n                    </button>\n                  </li>\n                );\n              })}\n            </ul>\n          </nav>\n          \n          {/* Footer */}\n          <div className=\"px-4 py-4 border-t border-gray-200\">\n            <p className=\"text-xs text-gray-500\">\n              Version 1.0.0 MVP\n            </p>\n          </div>\n        </div>\n      </aside>\n    </>\n  );\n};",
  "src/components/Organization/InviteModal.tsx": "import React, { useState } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { X, Mail, Link as LinkIcon, Copy, CheckCircle, AlertCircle } from 'lucide-react'\nimport { createInvitation, generateInvitationLink } from '@/services/organizationService'\nimport { canInviteUser } from '@/services/usageLimits'\n\ninterface Props {\n  organizationId: string\n  userId: string\n  onClose: () => void\n  onInvited: () => void\n}\n\nexport const InviteModal: React.FC<Props> = ({ organizationId, userId, onClose, onInvited }) => {\n  const [email, setEmail] = useState('')\n  const [role, setRole] = useState<'member' | 'admin'>('member')\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [success, setSuccess] = useState(false)\n  const [invitationLink, setInvitationLink] = useState<string | null>(null)\n  const [copied, setCopied] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n\n    if (!email) {\n      setError('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')\n      return\n    }\n\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(email)) {\n      setError('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')\n      return\n    }\n\n    try {\n      setLoading(true)\n      setError(null)\n\n      const limitCheck = await canInviteUser(userId)\n      if (!limitCheck.allowed) {\n        setError(limitCheck.message || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã®ä¸Šé™ã«é”ã—ã¦ã„ã¾ã™')\n        return\n      }\n\n      const { data, error: inviteError } = await createInvitation(\n        organizationId,\n        email,\n        role,\n        userId\n      )\n\n      if (inviteError) {\n        setError('æ‹›å¾…ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n\n      if (data) {\n        setSuccess(true)\n        setInvitationLink(generateInvitationLink(data.token))\n        onInvited()\n      }\n    } catch (err) {\n      setError('æ‹›å¾…ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleCopyLink = async () => {\n    if (!invitationLink) return\n\n    try {\n      await navigator.clipboard.writeText(invitationLink)\n      setCopied(true)\n      setTimeout(() => setCopied(false), 2000)\n    } catch (err) {\n      console.error('Failed to copy link:', err)\n    }\n  }\n\n  const handleClose = () => {\n    setEmail('')\n    setRole('member')\n    setError(null)\n    setSuccess(false)\n    setInvitationLink(null)\n    onClose()\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n        <div className=\"flex items-center justify-between p-6 border-b border-slate-200\">\n          <h2 className=\"text-xl font-bold text-slate-900\">ãƒ¡ãƒ³ãƒãƒ¼ã‚’æ‹›å¾…</h2>\n          <button\n            onClick={handleClose}\n            className=\"p-1 hover:bg-slate-100 rounded-lg transition-colors\"\n          >\n            <X className=\"w-5 h-5 text-slate-500\" />\n          </button>\n        </div>\n\n        <div className=\"p-6\">\n          {success ? (\n            <div className=\"space-y-4\">\n              <div className=\"p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5\" />\n                <div>\n                  <p className=\"font-medium text-green-900\">æ‹›å¾…ã‚’é€ä¿¡ã—ã¾ã—ãŸ</p>\n                  <p className=\"text-sm text-green-700 mt-1\">\n                    {email} ã«æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ\n                  </p>\n                </div>\n              </div>\n\n              {invitationLink && (\n                <div>\n                  <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                    <LinkIcon className=\"w-4 h-4 inline mr-2\" />\n                    æ‹›å¾…ãƒªãƒ³ã‚¯\n                  </label>\n                  <div className=\"flex gap-2\">\n                    <input\n                      type=\"text\"\n                      value={invitationLink}\n                      readOnly\n                      className=\"flex-1 px-4 py-2 border border-slate-300 rounded-lg bg-slate-50 text-sm\"\n                    />\n                    <Button\n                      onClick={handleCopyLink}\n                      className={`${\n                        copied\n                          ? 'bg-green-600 hover:bg-green-700'\n                          : 'bg-blue-600 hover:bg-blue-700'\n                      } text-white`}\n                    >\n                      {copied ? (\n                        <>\n                          <CheckCircle className=\"w-4 h-4 mr-2\" />\n                          ã‚³ãƒ”ãƒ¼æ¸ˆã¿\n                        </>\n                      ) : (\n                        <>\n                          <Copy className=\"w-4 h-4 mr-2\" />\n                          ã‚³ãƒ”ãƒ¼\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                  <p className=\"text-xs text-slate-500 mt-2\">\n                    ã“ã®ãƒªãƒ³ã‚¯ã¯7æ—¥é–“æœ‰åŠ¹ã§ã™ã€‚ãƒªãƒ³ã‚¯ã‚’å…±æœ‰ã—ã¦æ‹›å¾…ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚\n                  </p>\n                </div>\n              )}\n\n              <div className=\"pt-4\">\n                <Button\n                  onClick={handleClose}\n                  className=\"w-full bg-slate-600 hover:bg-slate-700 text-white\"\n                >\n                  é–‰ã˜ã‚‹\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              {error && (\n                <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2\">\n                  <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\n                  <p className=\"text-sm text-red-800\">{error}</p>\n                </div>\n              )}\n\n              <div>\n                <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                  <Mail className=\"w-4 h-4 inline mr-2\" />\n                  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹\n                </label>\n                <input\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  placeholder=\"user@example.com\"\n                  disabled={loading}\n                  autoFocus\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                  æ¨©é™\n                </label>\n                <select\n                  value={role}\n                  onChange={(e) => setRole(e.target.value as 'member' | 'admin')}\n                  className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  disabled={loading}\n                >\n                  <option value=\"member\">ãƒ¡ãƒ³ãƒãƒ¼</option>\n                  <option value=\"admin\">ç®¡ç†è€…</option>\n                </select>\n                <p className=\"text-xs text-slate-500 mt-1\">\n                  ãƒ¡ãƒ³ãƒãƒ¼ã¯ãƒ‡ãƒ¼ã‚¿ã®é–²è¦§ãƒ»å…¥åŠ›ã€ç®¡ç†è€…ã¯è¨­å®šå¤‰æ›´ã‚‚å¯èƒ½ã§ã™\n                </p>\n              </div>\n\n              <div className=\"pt-4 flex gap-3\">\n                <Button\n                  type=\"button\"\n                  onClick={handleClose}\n                  disabled={loading}\n                  className=\"flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700\"\n                >\n                  ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={loading}\n                  className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white\"\n                >\n                  {loading ? (\n                    <>\n                      <span className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2\"></span>\n                      é€ä¿¡ä¸­...\n                    </>\n                  ) : (\n                    'æ‹›å¾…ã‚’é€ä¿¡'\n                  )}\n                </Button>\n              </div>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n",
  "src/components/Organization/OrganizationMembers.tsx": "import React, { useState, useEffect } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { UserPlus, Trash2, Shield, User, Mail, Calendar, AlertCircle } from 'lucide-react'\nimport { useAuth } from '@/contexts/AuthContext'\nimport {\n  getOrganizationMembers,\n  removeOrganizationMember,\n  updateOrganizationMemberRole\n} from '@/services/organizationService'\nimport { InviteModal } from './InviteModal'\n\ninterface Member {\n  organization_id: string\n  user_id: string\n  role: 'owner' | 'admin' | 'member'\n  joined_at: string\n  profiles: {\n    id: string\n    name: string\n    email: string\n    role: string\n  }\n}\n\ninterface Props {\n  organizationId: string\n}\n\nexport const OrganizationMembers: React.FC<Props> = ({ organizationId }) => {\n  const { user } = useAuth()\n  const [members, setMembers] = useState<Member[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [actionLoading, setActionLoading] = useState<string | null>(null)\n  const [showInviteModal, setShowInviteModal] = useState(false)\n\n  useEffect(() => {\n    loadMembers()\n  }, [organizationId])\n\n  const loadMembers = async () => {\n    try {\n      setLoading(true)\n      setError(null)\n\n      const { data, error: fetchError } = await getOrganizationMembers(organizationId)\n      if (fetchError) {\n        setError('ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n\n      setMembers(data || [])\n    } catch (err) {\n      setError('ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRemoveMember = async (userId: string) => {\n    if (!confirm('ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {\n      return\n    }\n\n    try {\n      setActionLoading(userId)\n      const { error: removeError } = await removeOrganizationMember(organizationId, userId)\n\n      if (removeError) {\n        alert('ãƒ¡ãƒ³ãƒãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n\n      await loadMembers()\n    } catch (err) {\n      alert('ãƒ¡ãƒ³ãƒãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  const handleChangeRole = async (userId: string, newRole: 'owner' | 'admin' | 'member') => {\n    if (!confirm(`ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã®æ¨©é™ã‚’ã€Œ${getRoleLabel(newRole)}ã€ã«å¤‰æ›´ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {\n      return\n    }\n\n    try {\n      setActionLoading(userId)\n      const { error: updateError } = await updateOrganizationMemberRole(\n        organizationId,\n        userId,\n        newRole\n      )\n\n      if (updateError) {\n        alert('æ¨©é™ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n\n      await loadMembers()\n    } catch (err) {\n      alert('æ¨©é™ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  const getRoleLabel = (role: string) => {\n    switch (role) {\n      case 'owner':\n        return 'ã‚ªãƒ¼ãƒŠãƒ¼'\n      case 'admin':\n        return 'ç®¡ç†è€…'\n      case 'member':\n        return 'ãƒ¡ãƒ³ãƒãƒ¼'\n      default:\n        return role\n    }\n  }\n\n  const getRoleBadgeColor = (role: string) => {\n    switch (role) {\n      case 'owner':\n        return 'bg-red-100 text-red-800 border-red-200'\n      case 'admin':\n        return 'bg-blue-100 text-blue-800 border-blue-200'\n      case 'member':\n        return 'bg-slate-100 text-slate-800 border-slate-200'\n      default:\n        return 'bg-slate-100 text-slate-800 border-slate-200'\n    }\n  }\n\n  const currentUserMember = members.find(m => m.user_id === user?.id)\n  const isOwnerOrAdmin = currentUserMember?.role === 'owner' || currentUserMember?.role === 'admin'\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"p-12\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n            <p className=\"text-slate-600\">èª­ã¿è¾¼ã¿ä¸­...</p>\n          </div>\n        </CardContent>\n      </Card>\n    )\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</CardTitle>\n          {isOwnerOrAdmin && (\n            <Button\n              onClick={() => setShowInviteModal(true)}\n              className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n            >\n              <UserPlus className=\"w-4 h-4 mr-2\" />\n              ãƒ¡ãƒ³ãƒãƒ¼ã‚’æ‹›å¾…\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        {error && (\n          <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2 mb-6\">\n            <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\n            <p className=\"text-sm text-red-800\">{error}</p>\n          </div>\n        )}\n\n        <div className=\"space-y-4\">\n          {members.map((member) => {\n            const isCurrentUser = member.user_id === user?.id\n            const canManage = isOwnerOrAdmin && !isCurrentUser && member.role !== 'owner'\n\n            return (\n              <div\n                key={member.user_id}\n                className=\"p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-4 flex-1\">\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center\">\n                      <User className=\"w-6 h-6 text-white\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <h3 className=\"font-medium text-slate-900\">\n                          {member.profiles.name}\n                          {isCurrentUser && (\n                            <span className=\"ml-2 text-xs text-slate-500\">(ã‚ãªãŸ)</span>\n                          )}\n                        </h3>\n                        <span\n                          className={`px-2 py-0.5 text-xs font-medium rounded-full border ${getRoleBadgeColor(\n                            member.role\n                          )}`}\n                        >\n                          {getRoleLabel(member.role)}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-4 text-sm text-slate-600\">\n                        <div className=\"flex items-center gap-1\">\n                          <Mail className=\"w-4 h-4\" />\n                          {member.profiles.email}\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"w-4 h-4\" />\n                          å‚åŠ æ—¥: {new Date(member.joined_at).toLocaleDateString('ja-JP')}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {canManage && (\n                    <div className=\"flex items-center gap-2\">\n                      <select\n                        value={member.role}\n                        onChange={(e) =>\n                          handleChangeRole(\n                            member.user_id,\n                            e.target.value as 'owner' | 'admin' | 'member'\n                          )\n                        }\n                        disabled={actionLoading === member.user_id}\n                        className=\"px-3 py-1.5 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      >\n                        <option value=\"member\">ãƒ¡ãƒ³ãƒãƒ¼</option>\n                        <option value=\"admin\">ç®¡ç†è€…</option>\n                      </select>\n\n                      <Button\n                        onClick={() => handleRemoveMember(member.user_id)}\n                        disabled={actionLoading === member.user_id}\n                        className=\"bg-red-600 hover:bg-red-700 text-white\"\n                      >\n                        {actionLoading === member.user_id ? (\n                          <span className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent\"></span>\n                        ) : (\n                          <Trash2 className=\"w-4 h-4\" />\n                        )}\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )\n          })}\n        </div>\n\n        {members.length === 0 && (\n          <div className=\"text-center py-12\">\n            <User className=\"w-12 h-12 text-slate-300 mx-auto mb-4\" />\n            <p className=\"text-slate-600\">ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“</p>\n          </div>\n        )}\n\n        <div className=\"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n          <h4 className=\"font-medium text-blue-900 mb-2 flex items-center gap-2\">\n            <Shield className=\"w-4 h-4\" />\n            æ¨©é™ã«ã¤ã„ã¦\n          </h4>\n          <ul className=\"space-y-1 text-sm text-blue-800\">\n            <li>\n              <strong>ã‚ªãƒ¼ãƒŠãƒ¼:</strong> çµ„ç¹”ã®å…¨æ¨©é™ï¼ˆçµ„ç¹”å‰Šé™¤å«ã‚€ï¼‰\n            </li>\n            <li>\n              <strong>ç®¡ç†è€…:</strong> ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ã€è¨­å®šå¤‰æ›´ã€ãƒ‡ãƒ¼ã‚¿ç·¨é›†\n            </li>\n            <li>\n              <strong>ãƒ¡ãƒ³ãƒãƒ¼:</strong> ãƒ‡ãƒ¼ã‚¿é–²è¦§ãƒ»å…¥åŠ›ï¼ˆæ‹…å½“åº—èˆ—ã®ã¿ï¼‰\n            </li>\n          </ul>\n        </div>\n      </CardContent>\n\n      {showInviteModal && user?.id && (\n        <InviteModal\n          organizationId={organizationId}\n          userId={user.id}\n          onClose={() => setShowInviteModal(false)}\n          onInvited={loadMembers}\n        />\n      )}\n    </Card>\n  )\n}\n",
  "src/components/Organization/SubscriptionInfo.tsx": "import React from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport {\n  CreditCard,\n  Calendar,\n  Store,\n  Users,\n  MessageSquare,\n  CheckCircle,\n  AlertTriangle,\n  XCircle,\n  Crown\n} from 'lucide-react'\n\ninterface Organization {\n  id: string\n  name: string\n  subscription_status: string\n  subscription_plan: string\n  trial_ends_at?: string\n  max_stores: number\n  max_users: number\n  max_ai_requests_per_month: number\n  created_at?: string\n}\n\ninterface Props {\n  organization: Organization\n  onUpdate?: () => void\n}\n\nexport const SubscriptionInfo: React.FC<Props> = ({ organization, onUpdate }) => {\n  const getStatusBadge = () => {\n    switch (organization.subscription_status) {\n      case 'trial':\n        return {\n          icon: Calendar,\n          label: 'ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä¸­',\n          color: 'bg-blue-100 text-blue-800 border-blue-200'\n        }\n      case 'active':\n        return {\n          icon: CheckCircle,\n          label: 'æœ‰åŠ¹',\n          color: 'bg-green-100 text-green-800 border-green-200'\n        }\n      case 'suspended':\n        return {\n          icon: AlertTriangle,\n          label: 'ä¸€æ™‚åœæ­¢',\n          color: 'bg-yellow-100 text-yellow-800 border-yellow-200'\n        }\n      case 'cancelled':\n        return {\n          icon: XCircle,\n          label: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿',\n          color: 'bg-red-100 text-red-800 border-red-200'\n        }\n      default:\n        return {\n          icon: AlertTriangle,\n          label: 'ä¸æ˜',\n          color: 'bg-slate-100 text-slate-800 border-slate-200'\n        }\n    }\n  }\n\n  const getPlanLabel = () => {\n    switch (organization.subscription_plan) {\n      case 'free':\n        return { name: 'Free', price: 'ç„¡æ–™' }\n      case 'starter':\n        return { name: 'Starter', price: 'Â¥9,800/æœˆ' }\n      case 'business':\n        return { name: 'Business', price: 'Â¥29,800/æœˆ' }\n      case 'enterprise':\n        return { name: 'Enterprise', price: 'è¦ç›¸è«‡' }\n      default:\n        return { name: organization.subscription_plan, price: '-' }\n    }\n  }\n\n  const getPlanFeatures = () => {\n    return [\n      {\n        icon: Store,\n        label: 'æœ€å¤§åº—èˆ—æ•°',\n        value: organization.max_stores === 0 ? 'ç„¡åˆ¶é™' : `${organization.max_stores}åº—èˆ—`,\n        color: 'text-blue-600'\n      },\n      {\n        icon: Users,\n        label: 'æœ€å¤§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°',\n        value: organization.max_users === 0 ? 'ç„¡åˆ¶é™' : `${organization.max_users}å`,\n        color: 'text-green-600'\n      },\n      {\n        icon: MessageSquare,\n        label: 'AIä½¿ç”¨å›æ•°/æœˆ',\n        value:\n          organization.max_ai_requests_per_month === 0\n            ? 'ç„¡åˆ¶é™'\n            : `${organization.max_ai_requests_per_month}å›`,\n        color: 'text-orange-600'\n      }\n    ]\n  }\n\n  const statusBadge = getStatusBadge()\n  const planInfo = getPlanLabel()\n  const features = getPlanFeatures()\n\n  const trialDaysLeft =\n    organization.trial_ends_at && organization.subscription_status === 'trial'\n      ? Math.ceil(\n          (new Date(organization.trial_ends_at).getTime() - Date.now()) / (1000 * 60 * 60 * 24)\n        )\n      : null\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex items-center justify-between p-6 bg-gradient-to-br from-blue-50 to-slate-50 rounded-lg border border-slate-200\">\n            <div>\n              <div className=\"flex items-center gap-3 mb-2\">\n                <Crown className=\"w-6 h-6 text-blue-600\" />\n                <h3 className=\"text-2xl font-bold text-slate-900\">{planInfo.name}ãƒ—ãƒ©ãƒ³</h3>\n              </div>\n              <p className=\"text-lg text-slate-600\">{planInfo.price}</p>\n            </div>\n            <div\n              className={`px-4 py-2 rounded-full border flex items-center gap-2 ${statusBadge.color}`}\n            >\n              <statusBadge.icon className=\"w-4 h-4\" />\n              <span className=\"font-medium\">{statusBadge.label}</span>\n            </div>\n          </div>\n\n          {trialDaysLeft !== null && (\n            <div className=\"p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n              <div className=\"flex items-start gap-2\">\n                <Calendar className=\"w-5 h-5 text-blue-600 mt-0.5\" />\n                <div>\n                  <p className=\"font-medium text-blue-900\">ãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“</p>\n                  <p className=\"text-sm text-blue-700 mt-1\">\n                    æ®‹ã‚Š<strong className=\"text-lg mx-1\">{trialDaysLeft}</strong>æ—¥\n                    {trialDaysLeft <= 3 && (\n                      <span className=\"ml-2 text-red-600 font-medium\">ã¾ã‚‚ãªãçµ‚äº†</span>\n                    )}\n                  </p>\n                  <p className=\"text-xs text-blue-600 mt-1\">\n                    çµ‚äº†æ—¥: {new Date(organization.trial_ends_at!).toLocaleDateString('ja-JP')}\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"space-y-4\">\n            <h4 className=\"font-medium text-slate-900\">ãƒ—ãƒ©ãƒ³å†…å®¹</h4>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              {features.map((feature, index) => (\n                <div key={index} className=\"p-4 border border-slate-200 rounded-lg\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <feature.icon className={`w-5 h-5 ${feature.color}`} />\n                    <span className=\"text-sm text-slate-600\">{feature.label}</span>\n                  </div>\n                  <p className=\"text-xl font-bold text-slate-900\">{feature.value}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"pt-4 border-t border-slate-200\">\n            <Button className=\"bg-blue-600 hover:bg-blue-700 text-white\">\n              <CreditCard className=\"w-4 h-4 mr-2\" />\n              ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>ãƒ—ãƒ©ãƒ³æ¯”è¼ƒ</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-b border-slate-200\">\n                  <th className=\"py-3 px-4 text-left text-sm font-medium text-slate-600\">\n                    æ©Ÿèƒ½\n                  </th>\n                  <th className=\"py-3 px-4 text-center text-sm font-medium text-slate-600\">\n                    Free\n                  </th>\n                  <th className=\"py-3 px-4 text-center text-sm font-medium text-slate-600\">\n                    Starter\n                  </th>\n                  <th className=\"py-3 px-4 text-center text-sm font-medium text-slate-600\">\n                    Business\n                  </th>\n                  <th className=\"py-3 px-4 text-center text-sm font-medium text-slate-600\">\n                    Enterprise\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr className=\"border-b border-slate-100\">\n                  <td className=\"py-3 px-4 text-sm text-slate-700\">æœˆé¡æ–™é‡‘</td>\n                  <td className=\"py-3 px-4 text-center text-sm font-medium\">ç„¡æ–™</td>\n                  <td className=\"py-3 px-4 text-center text-sm font-medium\">Â¥9,800</td>\n                  <td className=\"py-3 px-4 text-center text-sm font-medium\">Â¥29,800</td>\n                  <td className=\"py-3 px-4 text-center text-sm font-medium\">è¦ç›¸è«‡</td>\n                </tr>\n                <tr className=\"border-b border-slate-100\">\n                  <td className=\"py-3 px-4 text-sm text-slate-700\">åº—èˆ—æ•°</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">1</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">3</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">10</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">ç„¡åˆ¶é™</td>\n                </tr>\n                <tr className=\"border-b border-slate-100\">\n                  <td className=\"py-3 px-4 text-sm text-slate-700\">ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">3</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">5</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">20</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">ç„¡åˆ¶é™</td>\n                </tr>\n                <tr className=\"border-b border-slate-100\">\n                  <td className=\"py-3 px-4 text-sm text-slate-700\">AIä½¿ç”¨å›æ•°/æœˆ</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">50</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">100</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">500</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">ç„¡åˆ¶é™</td>\n                </tr>\n                <tr className=\"border-b border-slate-100\">\n                  <td className=\"py-3 px-4 text-sm text-slate-700\">ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">3ãƒ¶æœˆ</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">1å¹´</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">3å¹´</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">ç„¡åˆ¶é™</td>\n                </tr>\n                <tr>\n                  <td className=\"py-3 px-4 text-sm text-slate-700\">ã‚µãƒãƒ¼ãƒˆ</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">ãƒ¡ãƒ¼ãƒ«</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">ãƒ¡ãƒ¼ãƒ«</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">å„ªå…ˆã‚µãƒãƒ¼ãƒˆ</td>\n                  <td className=\"py-3 px-4 text-center text-sm\">å°‚ä»»æ‹…å½“è€…</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
  "src/components/Reports/AIReportDetail.tsx": "import { useState } from 'react';\nimport { Calendar, TrendingUp, AlertCircle, CheckCircle, Download, ArrowLeft, Trash2, Share2, Copy } from 'lucide-react';\nimport { AIReport } from '../../hooks/useAIReports';\nimport { Card } from '../ui/card';\nimport { Badge } from '../ui/badge';\nimport { Button } from '../ui/button';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { supabase } from '../../lib/supabase';\n\ninterface AIReportDetailProps {\n  report: AIReport;\n  onBack: () => void;\n  onDelete?: (reportId: string) => Promise<{ error: string | null }>;\n}\n\nexport function AIReportDetail({ report, onBack, onDelete }: AIReportDetailProps) {\n  const { user } = useAuth();\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  const [showShareDialog, setShowShareDialog] = useState(false);\n  const [shareLink, setShareLink] = useState('');\n  const [isPublic, setIsPublic] = useState(false);\n  const [isUpdatingShare, setIsUpdatingShare] = useState(false);\n  const [copySuccess, setCopySuccess] = useState(false);\n\n  const canShare = user?.role === 'manager' || user?.role === 'admin';\n\n  const handleDelete = async () => {\n    if (!onDelete) return;\n\n    setIsDeleting(true);\n    const { error } = await onDelete(report.id);\n\n    if (error) {\n      alert(`å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error}`);\n      setIsDeleting(false);\n      setShowDeleteConfirm(false);\n    } else {\n      onBack();\n    }\n  };\n\n  const handleShare = async () => {\n    setShowShareDialog(true);\n\n    const { data, error } = await supabase\n      .from('ai_generated_reports')\n      .select('share_token, is_public')\n      .eq('id', report.id)\n      .single();\n\n    if (!error && data) {\n      setIsPublic(data.is_public || false);\n      if (data.share_token) {\n        const link = `${window.location.origin}/share/report/${data.share_token}`;\n        setShareLink(link);\n      }\n    } else {\n      console.error('Error loading share data:', error);\n    }\n  };\n\n  const handleTogglePublic = async () => {\n    setIsUpdatingShare(true);\n    try {\n      const newIsPublic = !isPublic;\n\n      const { data, error } = await supabase\n        .from('ai_generated_reports')\n        .update({ is_public: newIsPublic })\n        .eq('id', report.id)\n        .select('share_token')\n        .single();\n\n      if (error) throw error;\n\n      setIsPublic(newIsPublic);\n\n      if (newIsPublic && data.share_token) {\n        const link = `${window.location.origin}/share/report/${data.share_token}`;\n        setShareLink(link);\n      } else {\n        setShareLink('');\n      }\n    } catch (error) {\n      console.error('Error toggling share:', error);\n      alert('å…±æœ‰è¨­å®šã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    } finally {\n      setIsUpdatingShare(false);\n    }\n  };\n\n  const handleCopyLink = () => {\n    navigator.clipboard.writeText(shareLink);\n    setCopySuccess(true);\n    setTimeout(() => setCopySuccess(false), 2000);\n  };\n\n  const handleExport = () => {\n    const reportText = `\n${report.title}\n${'='.repeat(report.title.length)}\n\næœŸé–“: ${report.period_start} ã€œ ${report.period_end}\nãƒ¬ãƒãƒ¼ãƒˆç¨®åˆ¥: ${report.report_type === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡'}\nç”Ÿæˆæ—¥æ™‚: ${new Date(report.generated_at).toLocaleString('ja-JP')}\n\nã€ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã€‘\n${report.summary}\n\nã€ä¸»è¦æŒ‡æ¨™ã€‘\n- ç·å£²ä¸Š: Â¥${report.metrics.totalSales.toLocaleString('ja-JP')}\n- ç·çµŒè²»: Â¥${report.metrics.totalExpenses.toLocaleString('ja-JP')}\n- ç²—åˆ©ç›Š: Â¥${report.metrics.grossProfit.toLocaleString('ja-JP')}\n- å–¶æ¥­åˆ©ç›Š: Â¥${report.metrics.operatingProfit.toLocaleString('ja-JP')}\n- åˆ©ç›Šç‡: ${report.metrics.profitMargin.toFixed(1)}%\n- åŸä¾¡ç‡: ${report.metrics.costRate.toFixed(1)}%\n- äººä»¶è²»ç‡: ${report.metrics.laborRate.toFixed(1)}%\n\nã€é‡è¦ãªç™ºè¦‹ã€‘\n${report.key_insights.map((insight, i) => `${i + 1}. ${insight}`).join('\\n')}\n\nã€æ”¹å–„ææ¡ˆã€‘\n${report.recommendations.map((rec, i) => `${i + 1}. ${rec}`).join('\\n')}\n\nã€è©³ç´°åˆ†æã€‘\n${Object.entries(report.analysis_content || {}).map(([key, value]) => `\\nâ–  ${key}\\n${value}`).join('\\n')}\n`;\n\n    const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${report.title}_${report.period_start}.txt`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <Button variant=\"ghost\" onClick={onBack}>\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          æˆ»ã‚‹\n        </Button>\n        <div className=\"flex gap-2\">\n          {canShare && (\n            <Button variant=\"outline\" onClick={handleShare}>\n              <Share2 className=\"w-4 h-4 mr-2\" />\n              å…±æœ‰ãƒªãƒ³ã‚¯\n            </Button>\n          )}\n          <Button variant=\"outline\" onClick={handleExport}>\n            <Download className=\"w-4 h-4 mr-2\" />\n            ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\n          </Button>\n          {onDelete && (\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowDeleteConfirm(true)}\n              className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n              disabled={isDeleting}\n            >\n              <Trash2 className=\"w-4 h-4 mr-2\" />\n              å‰Šé™¤\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {showShareDialog && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <Card className=\"max-w-md w-full p-6\">\n            <div className=\"mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2 flex items-center\">\n                <Share2 className=\"w-5 h-5 mr-2\" />\n                ãƒ¬ãƒãƒ¼ãƒˆã‚’å…±æœ‰\n              </h3>\n              <p className=\"text-gray-600 mb-4\">\n                å…±æœ‰ãƒªãƒ³ã‚¯ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€èª°ã§ã‚‚ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’é–²è¦§ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\n              </p>\n\n              <div className=\"mb-4\">\n                <label className=\"flex items-center gap-3 cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    checked={isPublic}\n                    onChange={handleTogglePublic}\n                    disabled={isUpdatingShare}\n                    className=\"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500\"\n                  />\n                  <span className=\"text-sm font-medium text-gray-700\">\n                    å…±æœ‰ãƒªãƒ³ã‚¯ã‚’æœ‰åŠ¹ã«ã™ã‚‹\n                  </span>\n                </label>\n              </div>\n\n              {shareLink && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    å…±æœ‰ãƒªãƒ³ã‚¯\n                  </label>\n                  <div className=\"flex gap-2\">\n                    <input\n                      type=\"text\"\n                      value={shareLink}\n                      readOnly\n                      className=\"flex-1 p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm\"\n                    />\n                    <Button\n                      variant=\"outline\"\n                      onClick={handleCopyLink}\n                      className=\"flex-shrink-0\"\n                      disabled={!isPublic}\n                    >\n                      <Copy className=\"w-4 h-4 mr-2\" />\n                      {copySuccess ? 'ã‚³ãƒ”ãƒ¼æ¸ˆã¿' : 'ã‚³ãƒ”ãƒ¼'}\n                    </Button>\n                  </div>\n                  {isPublic ? (\n                    <p className=\"text-xs text-green-600 mt-2 font-medium\">\n                      âœ“ ã“ã®ãƒªãƒ³ã‚¯ã¯æœ‰åŠ¹ã§ã™ã€‚èª°ã§ã‚‚ãƒ¬ãƒãƒ¼ãƒˆã‚’é–²è¦§ã§ãã¾ã™\n                    </p>\n                  ) : (\n                    <p className=\"text-xs text-gray-500 mt-2\">\n                      å…±æœ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ã“ã®ãƒªãƒ³ã‚¯ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’é–²è¦§ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™\n                    </p>\n                  )}\n                </div>\n              )}\n\n              {copySuccess && (\n                <div className=\"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center gap-2\">\n                  <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                  <span className=\"text-sm text-green-800\">ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</span>\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex gap-3 justify-end\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setShowShareDialog(false);\n                  setCopySuccess(false);\n                }}\n              >\n                é–‰ã˜ã‚‹\n              </Button>\n            </div>\n          </Card>\n        </div>\n      )}\n\n      {showDeleteConfirm && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <Card className=\"max-w-md w-full p-6\">\n            <div className=\"mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">ãƒ¬ãƒãƒ¼ãƒˆã‚’å‰Šé™¤</h3>\n              <p className=\"text-gray-600\">\n                ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚\n              </p>\n            </div>\n            <div className=\"flex gap-3 justify-end\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowDeleteConfirm(false)}\n                disabled={isDeleting}\n              >\n                ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={handleDelete}\n                disabled={isDeleting}\n                className=\"bg-red-600 text-white hover:bg-red-700\"\n              >\n                {isDeleting ? 'å‰Šé™¤ä¸­...' : 'å‰Šé™¤ã™ã‚‹'}\n              </Button>\n            </div>\n          </Card>\n        </div>\n      )}\n\n      <Card className=\"p-8\">\n        <div className=\"mb-6\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <Badge variant={report.report_type === 'weekly' ? 'default' : 'secondary'} className=\"text-sm\">\n              {report.report_type === 'weekly' ? 'æœŸé–“æŒ‡å®šãƒ¬ãƒãƒ¼ãƒˆ' : 'æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ'}\n            </Badge>\n            <div className=\"flex items-center text-sm text-gray-500\">\n              <Calendar className=\"w-4 h-4 mr-1\" />\n              {report.period_start} ã€œ {report.period_end}\n            </div>\n          </div>\n\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n            {report.title}\n          </h1>\n\n          <p className=\"text-sm text-gray-500\">\n            ç”Ÿæˆæ—¥æ™‚: {new Date(report.generated_at).toLocaleString('ja-JP')} |\n            AI Model: {report.generated_by}\n          </p>\n        </div>\n\n        <div className=\"bg-blue-50 border-l-4 border-blue-600 p-6 mb-8\">\n          <h2 className=\"text-lg font-semibold text-gray-900 mb-3\">\n            ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼\n          </h2>\n          <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">\n            {report.summary}\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8\">\n          <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\n            <div className=\"text-sm text-gray-600 mb-1\">ç·å£²ä¸Š</div>\n            <div className=\"text-2xl font-bold text-blue-600\">\n              Â¥{report.metrics.totalSales.toLocaleString('ja-JP')}\n            </div>\n          </div>\n\n          <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\n            <div className=\"text-sm text-gray-600 mb-1\">ç²—åˆ©ç›Š</div>\n            <div className=\"text-2xl font-bold text-green-600\">\n              Â¥{report.metrics.grossProfit.toLocaleString('ja-JP')}\n            </div>\n          </div>\n\n          <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\n            <div className=\"text-sm text-gray-600 mb-1\">å–¶æ¥­åˆ©ç›Š</div>\n            <div className=\"text-2xl font-bold text-purple-600\">\n              Â¥{Math.round(report.metrics.operatingProfit).toLocaleString('ja-JP')}\n            </div>\n          </div>\n\n          <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\n            <div className=\"text-sm text-gray-600 mb-1\">å–¶æ¥­åˆ©ç›Šç‡</div>\n            <div className=\"text-2xl font-bold text-indigo-600\">\n              {report.metrics.profitMargin.toFixed(1)}%\n            </div>\n          </div>\n\n          <div className=\"bg-white border border-gray-200 rounded-lg p-4\">\n            <div className=\"text-sm text-gray-600 mb-1\">åŸä¾¡ç‡</div>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {report.metrics.costRate.toFixed(1)}%\n            </div>\n          </div>\n        </div>\n\n        {report.metrics.storeBreakdown && report.metrics.storeBreakdown.length > 0 && (\n          <div className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4 flex items-center\">\n              <TrendingUp className=\"w-5 h-5 mr-2\" />\n              åº—èˆ—åˆ¥å®Ÿç¸¾\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {report.metrics.storeBreakdown.map((store) => (\n                <Card key={store.storeId} className=\"p-4\">\n                  <h3 className=\"font-semibold text-gray-900 mb-3\">{store.storeName}</h3>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">å£²ä¸Š</span>\n                      <span className=\"font-medium\">Â¥{store.sales.toLocaleString('ja-JP')}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">å–¶æ¥­åˆ©ç›Š</span>\n                      <span className=\"font-medium text-green-600\">Â¥{Math.round(store.profit).toLocaleString('ja-JP')}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">å–¶æ¥­åˆ©ç›Šç‡</span>\n                      <span className=\"font-medium\">{store.profitMargin.toFixed(1)}%</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">åŸä¾¡ç‡</span>\n                      <span className=\"font-medium\">{store.costRate.toFixed(1)}%</span>\n                    </div>\n                  </div>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n\n        <div className=\"mb-8\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4 flex items-center\">\n            <AlertCircle className=\"w-5 h-5 mr-2 text-yellow-600\" />\n            é‡è¦ãªç™ºè¦‹\n          </h2>\n          <div className=\"space-y-3\">\n            {report.key_insights.map((insight, index) => (\n              <div key={index} className=\"flex items-start bg-yellow-50 border-l-4 border-yellow-400 p-4\">\n                <span className=\"flex-shrink-0 w-6 h-6 bg-yellow-400 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3\">\n                  {index + 1}\n                </span>\n                <p className=\"text-gray-800\">{insight}</p>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        <div className=\"mb-8\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4 flex items-center\">\n            <CheckCircle className=\"w-5 h-5 mr-2 text-green-600\" />\n            æ”¹å–„ææ¡ˆ\n          </h2>\n          <div className=\"space-y-3\">\n            {report.recommendations.map((recommendation, index) => (\n              <div key={index} className=\"flex items-start bg-green-50 border-l-4 border-green-500 p-4\">\n                <span className=\"flex-shrink-0 w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3\">\n                  {index + 1}\n                </span>\n                <p className=\"text-gray-800\">{recommendation}</p>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {report.analysis_content && Object.keys(report.analysis_content).length > 0 && (\n          <div>\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">\n              è©³ç´°åˆ†æ\n            </h2>\n            <div className=\"space-y-6\">\n              {report.analysis_content.salesTrend && (\n                <div>\n                  <h3 className=\"font-semibold text-gray-900 mb-2\">å£²ä¸Šãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</h3>\n                  <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">\n                    {report.analysis_content.salesTrend}\n                  </p>\n                </div>\n              )}\n              {report.analysis_content.profitability && (\n                <div>\n                  <h3 className=\"font-semibold text-gray-900 mb-2\">åç›Šæ€§åˆ†æ</h3>\n                  <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">\n                    {report.analysis_content.profitability}\n                  </p>\n                </div>\n              )}\n              {report.analysis_content.costStructure && (\n                <div>\n                  <h3 className=\"font-semibold text-gray-900 mb-2\">ã‚³ã‚¹ãƒˆæ§‹é€ åˆ†æ</h3>\n                  <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">\n                    {report.analysis_content.costStructure}\n                  </p>\n                </div>\n              )}\n              {report.analysis_content.storeComparison && (\n                <div>\n                  <h3 className=\"font-semibold text-gray-900 mb-2\">åº—èˆ—é–“æ¯”è¼ƒåˆ†æ</h3>\n                  <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">\n                    {report.analysis_content.storeComparison}\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </Card>\n    </div>\n  );\n}\n",
  "src/components/Reports/AIReportsList.tsx": "import { FileText, Calendar, TrendingUp, Loader2 } from 'lucide-react';\nimport { useAIReports } from '../../hooks/useAIReports';\nimport { Card } from '../ui/card';\nimport { Badge } from '../ui/badge';\nimport { Button } from '../ui/button';\n\ninterface AIReportsListProps {\n  storeId?: string;\n  onReportSelect: (reportId: string) => void;\n}\n\nexport function AIReportsList({ storeId, onReportSelect }: AIReportsListProps) {\n  const { reports, loading, error } = useAIReports(storeId);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-blue-600\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6 text-center\">\n        <p className=\"text-red-600\">ãƒ¬ãƒãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>\n        <p className=\"text-sm text-gray-500 mt-2\">{error}</p>\n      </div>\n    );\n  }\n\n  if (reports.length === 0) {\n    return (\n      <div className=\"p-12 text-center\">\n        <FileText className=\"w-16 h-16 mx-auto text-gray-300 mb-4\" />\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">ãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</h3>\n        <p className=\"text-gray-500\">\n          è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {reports.map((report) => (\n        <Card key={report.id} className=\"p-6 hover:shadow-lg transition-shadow cursor-pointer\" onClick={() => onReportSelect(report.id)}>\n          <div className=\"flex items-start justify-between\">\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-3 mb-3\">\n                <Badge variant={report.report_type === 'weekly' ? 'default' : 'secondary'}>\n                  {report.report_type === 'weekly' ? 'æœŸé–“æŒ‡å®š' : 'æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ'}\n                </Badge>\n                <div className=\"flex items-center text-sm text-gray-500\">\n                  <Calendar className=\"w-4 h-4 mr-1\" />\n                  {report.period_start} ã€œ {report.period_end}\n                </div>\n              </div>\n\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                {report.title}\n              </h3>\n\n              <p className=\"text-gray-600 mb-4 line-clamp-2\">\n                {report.summary}\n              </p>\n\n              <div className=\"grid grid-cols-3 gap-4 mb-4\">\n                <div className=\"bg-blue-50 rounded-lg p-3\">\n                  <div className=\"text-xs text-gray-600 mb-1\">å£²ä¸Š</div>\n                  <div className=\"text-lg font-bold text-blue-600\">\n                    Â¥{report.metrics.totalSales.toLocaleString('ja-JP')}\n                  </div>\n                </div>\n\n                <div className=\"bg-green-50 rounded-lg p-3\">\n                  <div className=\"text-xs text-gray-600 mb-1\">å–¶æ¥­åˆ©ç›Š</div>\n                  <div className=\"text-lg font-bold text-green-600\">\n                    Â¥{Math.round(report.metrics.operatingProfit).toLocaleString('ja-JP')}\n                  </div>\n                </div>\n\n                <div className=\"bg-purple-50 rounded-lg p-3\">\n                  <div className=\"text-xs text-gray-600 mb-1\">åˆ©ç›Šç‡</div>\n                  <div className=\"text-lg font-bold text-purple-600\">\n                    {report.metrics.profitMargin.toFixed(1)}%\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <TrendingUp className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-sm text-gray-500\">\n                  {report.key_insights.length}ä»¶ã®é‡è¦ãªç™ºè¦‹\n                </span>\n              </div>\n            </div>\n\n            <div className=\"ml-4 text-right\">\n              <div className=\"text-sm text-gray-500 mb-2\">\n                {new Date(report.generated_at).toLocaleString('ja-JP')}\n              </div>\n              <Button variant=\"outline\" size=\"sm\">\n                è©³ç´°ã‚’è¦‹ã‚‹\n              </Button>\n            </div>\n          </div>\n        </Card>\n      ))}\n    </div>\n  );\n}\n",
  "src/components/Reports/GenerateReportDialog.tsx": "import { useState, useEffect } from 'react';\nimport { FileText, Loader2, CheckCircle, XCircle } from 'lucide-react';\nimport { Button } from '../ui/button';\nimport { Card } from '../ui/card';\nimport { generateReport } from '../../hooks/useAIReports';\nimport { supabase } from '../../lib/supabase';\n\ninterface GenerateReportDialogProps {\n  onClose: () => void;\n  onSuccess: (reportId: string) => void;\n}\n\ninterface Store {\n  id: string;\n  name: string;\n}\n\nexport function GenerateReportDialog({ onClose, onSuccess }: GenerateReportDialogProps) {\n  const [reportType, setReportType] = useState<'weekly' | 'monthly'>('weekly');\n  const [selectedStoreId, setSelectedStoreId] = useState<string>('all');\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [result, setResult] = useState<{ success: boolean; message: string } | null>(null);\n  const [stores, setStores] = useState<Store[]>([]);\n  const [loadingStores, setLoadingStores] = useState(true);\n\n  const today = new Date().toISOString().split('T')[0];\n  const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];\n\n  const [startDate, setStartDate] = useState<string>(weekAgo);\n  const [endDate, setEndDate] = useState<string>(today);\n\n  useEffect(() => {\n    const fetchStores = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('stores')\n          .select('id, name')\n          .eq('is_active', true)\n          .order('name');\n\n        if (error) throw error;\n        setStores(data || []);\n      } catch (err) {\n        console.error('Failed to fetch stores:', err);\n      } finally {\n        setLoadingStores(false);\n      }\n    };\n\n    fetchStores();\n  }, []);\n\n  const handleGenerate = async () => {\n    setIsGenerating(true);\n    setResult(null);\n\n    try {\n      const storeId = selectedStoreId === 'all' ? undefined : selectedStoreId;\n\n      let periodStart: string | undefined;\n      let periodEnd: string | undefined;\n\n      if (reportType === 'weekly') {\n        periodStart = startDate;\n        periodEnd = endDate;\n      }\n\n      const { data, error } = await generateReport(reportType, storeId, periodStart, periodEnd);\n\n      if (error) {\n        setResult({ success: false, message: error });\n      } else if (data) {\n        setResult({ success: true, message: 'ãƒ¬ãƒãƒ¼ãƒˆãŒæ­£å¸¸ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚è¡¨ç¤ºä¸­...' });\n        setTimeout(() => {\n          onSuccess(data.id);\n          onClose();\n        }, 1000);\n      }\n    } catch (err) {\n      setResult({\n        success: false,\n        message: err instanceof Error ? err.message : 'ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <Card className=\"max-w-md w-full p-6\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h2 className=\"text-2xl font-bold text-gray-900 flex items-center\">\n            <FileText className=\"w-6 h-6 mr-2\" />\n            ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n            disabled={isGenerating}\n          >\n            <XCircle className=\"w-6 h-6\" />\n          </button>\n        </div>\n\n        <div className=\"space-y-6\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n              ãƒ¬ãƒãƒ¼ãƒˆç¨®åˆ¥\n            </label>\n            <div className=\"grid grid-cols-2 gap-3\">\n              <button\n                onClick={() => setReportType('weekly')}\n                className={`p-4 border-2 rounded-lg transition-all ${\n                  reportType === 'weekly'\n                    ? 'border-blue-600 bg-blue-50'\n                    : 'border-gray-200 hover:border-gray-300'\n                }`}\n                disabled={isGenerating}\n              >\n                <div className=\"font-semibold text-gray-900\">æœŸé–“æŒ‡å®šãƒ¬ãƒãƒ¼ãƒˆ</div>\n                <div className=\"text-xs text-gray-500 mt-1\">æ—¥ä»˜ç¯„å›²ã‚’æŒ‡å®š</div>\n              </button>\n\n              <button\n                onClick={() => setReportType('monthly')}\n                className={`p-4 border-2 rounded-lg transition-all ${\n                  reportType === 'monthly'\n                    ? 'border-blue-600 bg-blue-50'\n                    : 'border-gray-200 hover:border-gray-300'\n                }`}\n                disabled={isGenerating}\n              >\n                <div className=\"font-semibold text-gray-900\">æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</div>\n                <div className=\"text-xs text-gray-500 mt-1\">å…ˆæœˆå…¨ä½“</div>\n              </button>\n            </div>\n          </div>\n\n          {reportType === 'weekly' && (\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  é–‹å§‹æ—¥\n                </label>\n                <input\n                  type=\"date\"\n                  value={startDate}\n                  onChange={(e) => setStartDate(e.target.value)}\n                  className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  disabled={isGenerating}\n                  max={endDate}\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  çµ‚äº†æ—¥\n                </label>\n                <input\n                  type=\"date\"\n                  value={endDate}\n                  onChange={(e) => setEndDate(e.target.value)}\n                  className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  disabled={isGenerating}\n                  min={startDate}\n                  max={today}\n                />\n              </div>\n            </div>\n          )}\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              å¯¾è±¡åº—èˆ—\n            </label>\n            <select\n              value={selectedStoreId}\n              onChange={(e) => setSelectedStoreId(e.target.value)}\n              className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n              disabled={isGenerating || loadingStores}\n            >\n              <option value=\"all\">å…¨åº—èˆ—</option>\n              {loadingStores ? (\n                <option disabled>èª­ã¿è¾¼ã¿ä¸­...</option>\n              ) : (\n                stores.map((store) => (\n                  <option key={store.id} value={store.id}>\n                    {store.name}\n                  </option>\n                ))\n              )}\n            </select>\n          </div>\n\n          {result && (\n            <div\n              className={`p-4 rounded-lg flex items-start ${\n                result.success ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'\n              }`}\n            >\n              {result.success ? (\n                <CheckCircle className=\"w-5 h-5 text-green-600 mr-3 flex-shrink-0 mt-0.5\" />\n              ) : (\n                <XCircle className=\"w-5 h-5 text-red-600 mr-3 flex-shrink-0 mt-0.5\" />\n              )}\n              <div>\n                <p className={`font-medium ${result.success ? 'text-green-900' : 'text-red-900'}`}>\n                  {result.success ? 'æˆåŠŸ' : 'ã‚¨ãƒ©ãƒ¼'}\n                </p>\n                <p className={`text-sm ${result.success ? 'text-green-700' : 'text-red-700'}`}>\n                  {result.message}\n                </p>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex gap-3\">\n            <Button variant=\"outline\" onClick={onClose} className=\"flex-1\" disabled={isGenerating}>\n              ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n            </Button>\n            <Button onClick={handleGenerate} className=\"flex-1\" disabled={isGenerating}>\n              {isGenerating ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ç”Ÿæˆä¸­...\n                </>\n              ) : (\n                <>\n                  <FileText className=\"w-4 h-4 mr-2\" />\n                  ç”Ÿæˆé–‹å§‹\n                </>\n              )}\n            </Button>\n          </div>\n\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <p className=\"text-sm text-blue-900\">\n              <strong>æ³¨æ„:</strong> ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã«ã¯30ç§’ã€œ1åˆ†ç¨‹åº¦ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚\n              AIãŒéå»ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚\n            </p>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n",
  "src/components/Reports/ReportDetail.tsx": "import React from 'react';\nimport { DailyReport } from '../../types';\nimport { formatDate, formatCurrency, calculateTotalExpenses, calculateOperatingProfit } from '../../utils/calculations';\nimport { X, Calendar, Store, User, TrendingUp, TrendingDown } from 'lucide-react';\n\ninterface ReportDetailProps {\n  report: DailyReport;\n  onClose: () => void;\n}\n\nexport const ReportDetail: React.FC<ReportDetailProps> = ({ report, onClose }) => {\n  const totalExpenses = calculateTotalExpenses(report);\n  const operatingProfit = calculateOperatingProfit(report.sales, totalExpenses);\n  const grossProfit = report.sales - report.purchase;\n  const profitMargin = report.sales > 0 ? (operatingProfit / report.sales * 100) : 0;\n\n  const expenseItems = [\n    { label: 'ä»•å…¥', value: report.purchase, color: 'bg-red-100 text-red-800' },\n    { label: 'äººä»¶è²»', value: report.laborCost, color: 'bg-orange-100 text-orange-800' },\n    { label: 'å…‰ç†±è²»', value: report.utilities, color: 'bg-blue-100 text-blue-800' },\n    { label: 'åºƒå‘Šè²»', value: report.promotion, color: 'bg-green-100 text-green-800' },\n    { label: 'æ¸…æƒè²»', value: report.cleaning, color: 'bg-purple-100 text-purple-800' },\n    { label: 'é›‘è²»', value: report.misc, color: 'bg-pink-100 text-pink-800' },\n    { label: 'é€šä¿¡è²»', value: report.communication, color: 'bg-indigo-100 text-indigo-800' },\n    { label: 'ãã®ä»–', value: report.others, color: 'bg-gray-100 text-gray-800' }\n  ].filter(item => item.value > 0);\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n          <h2 className=\"text-xl font-semibold text-gray-900\">æ—¥æ¬¡å ±å‘Šè©³ç´°</h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n          >\n            <X className=\"w-5 h-5 text-gray-500\" />\n          </button>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          {/* åŸºæœ¬æƒ…å ± */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg\">\n              <Calendar className=\"w-5 h-5 text-blue-600\" />\n              <div>\n                <p className=\"text-xs text-gray-500\">æ—¥ä»˜</p>\n                <p className=\"font-medium\">{formatDate(report.date)}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg\">\n              <Store className=\"w-5 h-5 text-green-600\" />\n              <div>\n                <p className=\"text-xs text-gray-500\">åº—èˆ—</p>\n                <p className=\"font-medium\">{report.storeName}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg\">\n              <User className=\"w-5 h-5 text-purple-600\" />\n              <div>\n                <p className=\"text-xs text-gray-500\">å ±å‘Šè€…</p>\n                <p className=\"font-medium\">{report.staffName}</p>\n              </div>\n            </div>\n          </div>\n\n          {/* è²¡å‹™ã‚µãƒãƒªãƒ¼ */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"text-center p-4 bg-blue-50 rounded-lg\">\n              <p className=\"text-xs text-gray-600 mb-1\">å£²ä¸Š</p>\n              <p className=\"text-lg font-bold text-blue-600\">{formatCurrency(report.sales)}</p>\n            </div>\n            <div className=\"text-center p-4 bg-red-50 rounded-lg\">\n              <p className=\"text-xs text-gray-600 mb-1\">çµŒè²»åˆè¨ˆ</p>\n              <p className=\"text-lg font-bold text-red-600\">{formatCurrency(totalExpenses)}</p>\n            </div>\n            <div className={`text-center p-4 rounded-lg ${operatingProfit >= 0 ? 'bg-green-50' : 'bg-red-50'}`}>\n              <p className=\"text-xs text-gray-600 mb-1\">å–¶æ¥­åˆ©ç›Š</p>\n              <div className=\"flex items-center justify-center gap-1\">\n                {operatingProfit >= 0 ? (\n                  <TrendingUp className=\"w-4 h-4 text-green-600\" />\n                ) : (\n                  <TrendingDown className=\"w-4 h-4 text-red-600\" />\n                )}\n                <p className={`text-lg font-bold ${operatingProfit >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {formatCurrency(operatingProfit)}\n                </p>\n              </div>\n            </div>\n            <div className=\"text-center p-4 bg-yellow-50 rounded-lg\">\n              <p className=\"text-xs text-gray-600 mb-1\">åˆ©ç›Šç‡</p>\n              <p className={`text-lg font-bold ${\n                profitMargin >= 15 ? 'text-green-600' : \n                profitMargin >= 10 ? 'text-yellow-600' : 'text-red-600'\n              }`}>\n                {profitMargin.toFixed(1)}%\n              </p>\n            </div>\n          </div>\n\n          {/* çµŒè²»è©³ç´° */}\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">çµŒè²»è©³ç´°</h3>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n              {expenseItems.map((item, index) => (\n                <div key={index} className={`p-3 rounded-lg ${item.color}`}>\n                  <p className=\"text-xs font-medium\">{item.label}</p>\n                  <p className=\"text-sm font-bold\">{formatCurrency(item.value)}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* å ±å‘Šå†…å®¹ */}\n          {report.reportText && (\n            <div>\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">å ±å‘Šå†…å®¹</h3>\n              <div className=\"p-4 bg-gray-50 rounded-lg\">\n                <p className=\"text-gray-700 whitespace-pre-wrap\">{report.reportText}</p>\n              </div>\n            </div>\n          )}\n\n          {/* ä½œæˆæ—¥æ™‚ */}\n          <div className=\"text-center pt-4 border-t border-gray-200\">\n            <p className=\"text-xs text-gray-500\">\n              ä½œæˆæ—¥æ™‚: {new Date(report.createdAt).toLocaleString('ja-JP')}\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};",
  "src/components/Reports/ReportForm.tsx": "import React, { useState } from 'react';\nimport { Store } from '../../lib/supabase';\nimport { Save, X, FileSpreadsheet, CheckCircle, AlertCircle, Calculator, RefreshCw, Pen as Yen, TrendingUp, Users } from 'lucide-react';\n\ninterface ReportFormProps {\n  selectedStore?: Store | null;\n  availableStores?: Store[];\n  onSubmit: (reportData: any) => void;\n  onCancel: () => void;\n}\n\nexport const ReportForm: React.FC<ReportFormProps> = ({ selectedStore, availableStores = [], onSubmit, onCancel }) => {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [validationErrors, setValidationErrors] = useState<Record<string, string>>({});\n  const [sheetsStatus, setSheetsStatus] = useState<{\n    syncing: boolean;\n    success: boolean | null;\n    message: string;\n  }>({ syncing: false, success: null, message: '' });\n  \n  const [formData, setFormData] = useState({\n    date: new Date().toISOString().split('T')[0],\n    storeId: selectedStore?.id || '',\n    storeName: selectedStore?.name || '',\n    staffName: 'ãƒ‡ãƒ¢ã‚¹ã‚¿ãƒƒãƒ•',\n    sales: 0,\n    purchase: 0,\n    laborCost: 0,\n    utilities: 0,\n    promotion: 0,\n    cleaning: 0,\n    misc: 0,\n    communication: 0,\n    others: 0,\n    reportText: ''\n  });\n\n  // Update store info when storeId changes\n  React.useEffect(() => {\n    if (formData.storeId) {\n      const store = availableStores.find(s => s.id === formData.storeId);\n      if (store) {\n        setFormData(prev => ({ ...prev, storeName: store.name }));\n      }\n    }\n  }, [formData.storeId, availableStores]);\n\n  // è‡ªå‹•è¨ˆç®—æ©Ÿèƒ½\n  const calculateTotals = () => {\n    const totalExpenses = formData.purchase + formData.laborCost + formData.utilities + \n                         formData.promotion + formData.cleaning + formData.misc + \n                         formData.communication + formData.others;\n    const grossProfit = formData.sales - formData.purchase;\n    const operatingProfit = formData.sales - totalExpenses;\n    const profitMargin = formData.sales > 0 ? (operatingProfit / formData.sales * 100) : 0;\n    \n    return { totalExpenses, grossProfit, operatingProfit, profitMargin };\n  };\n\n  const totals = calculateTotals();\n\n  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°\n  const validateForm = () => {\n    const errors: Record<string, string> = {};\n\n    if (!formData.date) {\n      errors.date = 'æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„';\n    }\n\n    if (!formData.storeId && !selectedStore?.id) {\n      errors.store = 'åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„';\n    }\n\n    if (!formData.staffName.trim()) {\n      errors.staffName = 'ã‚¹ã‚¿ãƒƒãƒ•åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';\n    }\n\n    if (formData.sales <= 0) {\n      errors.sales = 'å£²ä¸Šã¯1å††ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„';\n    }\n\n    if (formData.sales > 10000000) {\n      errors.sales = 'å£²ä¸ŠãŒéå¸¸ã«é«˜ã„å€¤ã§ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„';\n    }\n\n    // çµŒè²»ãŒå£²ä¸Šã‚’è¶…ãˆã¦ã„ã‚‹å ´åˆã®è­¦å‘Š\n    if (totals.totalExpenses > formData.sales) {\n      errors.expenses = 'çµŒè²»åˆè¨ˆãŒå£²ä¸Šã‚’è¶…ãˆã¦ã„ã¾ã™';\n    }\n\n    setValidationErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¯ãƒªã‚¢æ©Ÿèƒ½\n  const clearExpenses = () => {\n    setFormData(prev => ({\n      ...prev,\n      purchase: 0,\n      laborCost: 0,\n      utilities: 0,\n      promotion: 0,\n      cleaning: 0,\n      misc: 0,\n      communication: 0,\n      others: 0\n    }));\n  };\n\n  // æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°\n  const formatNumber = (value: number) => {\n    return value.toLocaleString();\n  };\n\n  // æ•°å€¤å…¥åŠ›ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\n  const NumberInput = ({ \n    label, \n    value, \n    onChange, \n    placeholder = \"0\",\n    error,\n    required = false,\n    icon: IconComponent,\n    hint\n  }: {\n    label: string;\n    value: number;\n    onChange: (value: number) => void;\n    placeholder?: string;\n    error?: string;\n    required?: boolean;\n    icon?: any;\n    hint?: string;\n  }) => (\n    <div>\n      <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2\">\n        {IconComponent && <IconComponent className=\"w-4 h-4\" />}\n        {label} {required && <span className=\"text-red-500\">*</span>}\n      </label>\n      <div className=\"relative\">\n        <input\n          type=\"text\"\n          inputMode=\"numeric\"\n          pattern=\"[0-9]*\"\n          value={value === 0 ? '' : formatNumber(value)}\n          onChange={(e) => {\n            const numericValue = parseInt(e.target.value.replace(/[^0-9]/g, '')) || 0;\n            onChange(numericValue);\n          }}\n          className={`w-full pl-3 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-right font-mono text-lg ${\n            error ? 'border-red-300 bg-red-50' : 'border-gray-300'\n          }`}\n          placeholder={placeholder}\n        />\n        <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n          <span className=\"text-gray-500 text-sm font-medium\">å††</span>\n        </div>\n      </div>\n      {hint && <p className=\"mt-1 text-xs text-gray-500\">{hint}</p>}\n      {error && <p className=\"mt-1 text-sm text-red-600\">{error}</p>}\n    </div>\n  );\n  \n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!validateForm()) {\n      setError('å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n    setSheetsStatus({ syncing: true, success: null, message: 'Google Sheetsã«åŒæœŸä¸­...' });\n\n    try {\n      await onSubmit({\n        ...formData,\n        storeId: formData.storeId || selectedStore?.id,\n        lineUserId: undefined\n      });\n      \n      // Google SheetsåŒæœŸã®çµæœã‚’è¡¨ç¤º\n      setSheetsStatus({ \n        syncing: false, \n        success: true, \n        message: 'âœ“ å ±å‘Šã¨Google Sheetsã¸ã®åŒæœŸãŒå®Œäº†ã—ã¾ã—ãŸ' \n      });\n      \n      // 3ç§’å¾Œã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹\n      setTimeout(() => {\n        onCancel();\n      }, 1500);\n      \n    } catch (err) {\n      console.error('Report submission error:', err);\n      setError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');\n      setSheetsStatus({ \n        syncing: false, \n        success: false, \n        message: 'âš  å ±å‘Šã¯ä½œæˆã•ã‚Œã¾ã—ãŸãŒã€Google SheetsåŒæœŸã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' \n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleInputChange = (field: string, value: string | number) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n    \n    // ã‚¨ãƒ©ãƒ¼ã‚’ã‚¯ãƒªã‚¢\n    if (validationErrors[field]) {\n      setValidationErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors[field];\n        return newErrors;\n      });\n    }\n    \n    if (error) {\n      setError('');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <FileSpreadsheet className=\"w-5 h-5 text-blue-600\" />\n            </div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">æ—¥æ¬¡å ±å‘Šä½œæˆ</h2>\n          </div>\n          <button\n            onClick={onCancel}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n          >\n            <X className=\"w-5 h-5 text-gray-500\" />\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\n          {/* åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}\n          <div className=\"bg-gray-50 rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n              <Users className=\"w-5 h-5 text-blue-600\" />\n              åŸºæœ¬æƒ…å ±\n            </h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  æ—¥ä»˜ *\n                </label>\n                <input\n                  type=\"date\"\n                  required\n                  value={formData.date}\n                  onChange={(e) => handleInputChange('date', e.target.value)}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${\n                    validationErrors.date ? 'border-red-300 bg-red-50' : 'border-gray-300'\n                  }`}\n                />\n                {validationErrors.date && (\n                  <p className=\"mt-1 text-sm text-red-600\">{validationErrors.date}</p>\n                )}\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  åº—èˆ—\n                </label>\n                {availableStores.length > 1 ? (\n                  <>\n                    <select\n                      required\n                      value={formData.storeId}\n                      onChange={(e) => handleInputChange('storeId', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    >\n                      <option value=\"\">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>\n                      {availableStores.map((store) => (\n                        <option key={store.id} value={store.id}>\n                          {store.name}\n                        </option>\n                      ))}\n                    </select>\n                    {validationErrors.store && (\n                      <p className=\"mt-1 text-sm text-red-600\">{validationErrors.store}</p>\n                    )}\n                  </>\n                ) : (\n                  <>\n                    <input\n                      type=\"text\"\n                      disabled\n                      value={formData.storeName}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed\"\n                      placeholder=\"åº—èˆ—å\"\n                    />\n                    <p className=\"mt-1 text-xs text-gray-500\">\n                      é¸æŠã•ã‚ŒãŸåº—èˆ—: {selectedStore?.name || 'æœªé¸æŠ'}\n                    </p>\n                  </>\n                )}\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                ã‚¹ã‚¿ãƒƒãƒ•å *\n              </label>\n              <input\n                type=\"text\"\n                required\n                value={formData.staffName}\n                onChange={(e) => handleInputChange('staffName', e.target.value)}\n                className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${\n                  validationErrors.staffName ? 'border-red-300 bg-red-50' : 'border-gray-300'\n                }`}\n                placeholder=\"å ±å‘Šè€…åã‚’å…¥åŠ›\"\n              />\n              {validationErrors.staffName && (\n                <p className=\"mt-1 text-sm text-red-600\">{validationErrors.staffName}</p>\n              )}\n            </div>\n          </div>\n\n          {/* å£²ä¸Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}\n          <div className=\"bg-green-50 rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n              <Yen className=\"w-5 h-5 text-green-600\" />\n              å£²ä¸Šæƒ…å ±\n            </h3>\n            <NumberInput\n              label=\"æœ¬æ—¥ã®å£²ä¸Š\"\n              value={formData.sales}\n              onChange={(value) => handleInputChange('sales', value)}\n              placeholder=\"150,000\"\n              error={validationErrors.sales}\n              required\n              icon={Yen}\n              hint=\"ç¨è¾¼ã¿å£²ä¸Šé‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\"\n            />\n          </div>\n\n          {/* çµŒè²»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}\n          <div className=\"bg-red-50 rounded-lg p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n                <Calculator className=\"w-5 h-5 text-red-600\" />\n                çµŒè²»é …ç›®\n              </h3>\n              <button\n                type=\"button\"\n                onClick={clearExpenses}\n                className=\"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 transition-colors\"\n              >\n                <RefreshCw className=\"w-3 h-3\" />\n                ã‚¯ãƒªã‚¢\n              </button>\n            </div>\n            \n            {validationErrors.expenses && (\n              <div className=\"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                <p className=\"text-sm text-yellow-800\">{validationErrors.expenses}</p>\n              </div>\n            )}\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <NumberInput\n                label=\"ä»•å…¥ãƒ»ææ–™è²»\"\n                value={formData.purchase}\n                onChange={(value) => handleInputChange('purchase', value)}\n                placeholder=\"80,000\"\n                hint=\"é£Ÿæãƒ»é£²æ–™ã®ä»•å…¥ã‚Œè²»ç”¨\"\n              />\n              <NumberInput\n                label=\"äººä»¶è²»\"\n                value={formData.laborCost}\n                onChange={(value) => handleInputChange('laborCost', value)}\n                placeholder=\"60,000\"\n                hint=\"ã‚¢ãƒ«ãƒã‚¤ãƒˆä»£ãƒ»çµ¦æ–™ç­‰\"\n              />\n              <NumberInput\n                label=\"å…‰ç†±è²»\"\n                value={formData.utilities}\n                onChange={(value) => handleInputChange('utilities', value)}\n                placeholder=\"15,000\"\n                hint=\"é›»æ°—ãƒ»ã‚¬ã‚¹ãƒ»æ°´é“ä»£\"\n              />\n              <NumberInput\n                label=\"åºƒå‘Šãƒ»å®£ä¼è²»\"\n                value={formData.promotion}\n                onChange={(value) => handleInputChange('promotion', value)}\n                placeholder=\"8,000\"\n                hint=\"ãƒãƒ©ã‚·ãƒ»ãƒãƒƒãƒˆåºƒå‘Šç­‰\"\n              />\n              <NumberInput\n                label=\"æ¸…æƒè²»\"\n                value={formData.cleaning}\n                onChange={(value) => handleInputChange('cleaning', value)}\n                placeholder=\"5,000\"\n                hint=\"æ¸…æƒç”¨å“ãƒ»ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°\"\n              />\n              <NumberInput\n                label=\"é€šä¿¡è²»\"\n                value={formData.communication}\n                onChange={(value) => handleInputChange('communication', value)}\n                placeholder=\"3,000\"\n                hint=\"é›»è©±ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä»£\"\n              />\n              <NumberInput\n                label=\"é›‘è²»\"\n                value={formData.misc}\n                onChange={(value) => handleInputChange('misc', value)}\n                placeholder=\"2,000\"\n                hint=\"æ–‡æˆ¿å…·ãƒ»æ¶ˆè€—å“ç­‰\"\n              />\n              <NumberInput\n                label=\"ãã®ä»–çµŒè²»\"\n                value={formData.others}\n                onChange={(value) => handleInputChange('others', value)}\n                placeholder=\"1,000\"\n                hint=\"ä¸Šè¨˜ä»¥å¤–ã®æ”¯å‡º\"\n              />\n            </div>\n          </div>\n\n          {/* è¨ˆç®—çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}\n          <div className=\"bg-blue-50 border-2 border-blue-200 rounded-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n              <TrendingUp className=\"w-5 h-5 text-blue-600\" />\n              è¨ˆç®—çµæœ\n            </h3>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6\">\n              <div>\n                <p className=\"text-xs text-gray-600 mb-1\">çµŒè²»åˆè¨ˆ</p>\n                <p className=\"text-xl font-bold text-red-600\">{formatNumber(totals.totalExpenses)}å††</p>\n              </div>\n              <div>\n                <p className=\"text-xs text-gray-600 mb-1\">ç²—åˆ©ç›Š</p>\n                <p className={`text-xl font-bold ${totals.grossProfit >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {formatNumber(totals.grossProfit)}å††\n                </p>\n              </div>\n              <div>\n                <p className=\"text-xs text-gray-600 mb-1\">å–¶æ¥­åˆ©ç›Š</p>\n                <p className={`text-xl font-bold ${totals.operatingProfit >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {formatNumber(totals.operatingProfit)}å††\n                </p>\n              </div>\n              <div>\n                <p className=\"text-xs text-gray-600 mb-1\">åˆ©ç›Šç‡</p>\n                <p className={`text-xl font-bold ${totals.profitMargin >= 15 ? 'text-green-600' : totals.profitMargin >= 10 ? 'text-yellow-600' : 'text-red-600'}`}>\n                  {totals.profitMargin.toFixed(1)}%\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* å ±å‘Šå†…å®¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}\n          <div>\n            <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2\">\n              ğŸ“\n              å ±å‘Šå†…å®¹ãƒ»ç‰¹è¨˜äº‹é …\n            </label>\n            <textarea\n              value={formData.reportText}\n              onChange={(e) => handleInputChange('reportText', e.target.value)}\n              rows={5}\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base\"\n              placeholder=\"æœ¬æ—¥ã®ç‰¹è¨˜äº‹é …ã‚„æ°—ã¥ã„ãŸç‚¹ãªã©ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„...\"\n            />\n          </div>\n\n          {/* Google SheetsåŒæœŸçŠ¶æ…‹ */}\n          <div className={`border rounded-lg p-3 ${\n            sheetsStatus.success === true ? 'bg-green-50 border-green-200' :\n            sheetsStatus.success === false ? 'bg-red-50 border-red-200' :\n            sheetsStatus.syncing ? 'bg-blue-50 border-blue-200' : 'bg-gray-50 border-gray-200'\n          }`}>\n            <div className=\"flex items-center gap-2\">\n              <FileSpreadsheet className=\"w-4 h-4 text-gray-600\" />\n              <span className=\"text-sm font-medium text-gray-700\">Google Sheetsé€£æº</span>\n            </div>\n            {sheetsStatus.message && (\n              <p className=\"mt-1 text-sm text-gray-600\">{sheetsStatus.message}</p>\n            )}\n          </div>\n\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n              <div className=\"flex items-center gap-2\">\n                <AlertCircle className=\"w-5 h-5 text-red-600\" />\n                <p className=\"text-sm text-red-800\">{error}</p>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex gap-3 justify-end pt-4 border-t border-gray-200\">\n            <button\n              type=\"button\"\n              onClick={onCancel}\n              disabled={loading}\n              className=\"px-6 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors text-base font-medium\"\n            >\n              ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n            </button>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-300 rounded-lg transition-colors flex items-center gap-2 text-base font-medium\"\n            >\n              {loading ? (\n                <>\n                  <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                  é€ä¿¡ä¸­...\n                </>\n              ) : (\n                <>\n                  <Save className=\"w-4 h-4\" />\n                  å ±å‘Šã‚’é€ä¿¡\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};",
  "src/components/Stores/StoreDetail.tsx": "import React from 'react';\nimport { Store } from '../../lib/supabase';\nimport { formatDate, formatCurrency } from '../../utils/calculations';\nimport { \n  X, \n  MapPin, \n  User, \n  Calendar, \n  BarChart3, \n  CheckCircle, \n  XCircle,\n  Building,\n  Edit,\n  Trash2,\n  UserPlus,\n  FileText,\n  TrendingUp\n} from 'lucide-react';\n\ninterface StoreDetailProps {\n  store: Store & {\n    manager_name?: string;\n    reportCount?: number;\n    lastReportDate?: string;\n    isAssigned?: boolean;\n  };\n  onClose: () => void;\n  onEdit?: () => void;\n  onDelete?: () => void;\n  onAssignUser?: () => void;\n  canEdit?: boolean;\n}\n\nexport const StoreDetail: React.FC<StoreDetailProps> = ({\n  store,\n  onClose,\n  onEdit,\n  onDelete,\n  onAssignUser,\n  canEdit = true\n}) => {\n  // æ´»å‹•çŠ¶æ³ã®è¨ˆç®—\n  const getActivityStatus = () => {\n    const reportCount = store.reportCount || 0;\n    const lastReport = store.lastReportDate;\n    const daysSinceLastReport = lastReport \n      ? Math.floor((Date.now() - new Date(lastReport).getTime()) / (1000 * 60 * 60 * 24))\n      : null;\n\n    if (reportCount === 0) {\n      return { status: 'æœªä½¿ç”¨', color: 'text-gray-500', bgColor: 'bg-gray-100' };\n    } else if (daysSinceLastReport !== null) {\n      if (daysSinceLastReport <= 1) {\n        return { status: 'æ´»ç™º', color: 'text-green-600', bgColor: 'bg-green-100' };\n      } else if (daysSinceLastReport <= 7) {\n        return { status: 'é€šå¸¸', color: 'text-blue-600', bgColor: 'bg-blue-100' };\n      } else {\n        return { status: 'ä½èª¿', color: 'text-orange-600', bgColor: 'bg-orange-100' };\n      }\n    }\n\n    return { status: 'ä¸æ˜', color: 'text-gray-500', bgColor: 'bg-gray-100' };\n  };\n\n  const activity = getActivityStatus();\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 bg-blue-100 rounded-full\">\n                <Building className=\"w-6 h-6 text-blue-600\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-900\">{store.name}</h2>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  {store.is_active ? (\n                    <>\n                      <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                      <span className=\"text-sm text-green-600\">å–¶æ¥­ä¸­</span>\n                    </>\n                  ) : (\n                    <>\n                      <XCircle className=\"w-4 h-4 text-red-500\" />\n                      <span className=\"text-sm text-red-600\">ä¼‘æ¥­ä¸­</span>\n                    </>\n                  )}\n                </div>\n              </div>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <X className=\"w-5 h-5 text-gray-500\" />\n            </button>\n          </div>\n        </div>\n\n        {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}\n        <div className=\"p-6 space-y-6\">\n          {/* åŸºæœ¬æƒ…å ± */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n                <Building className=\"w-5 h-5\" />\n                åŸºæœ¬æƒ…å ±\n              </h3>\n              \n              <div className=\"space-y-3\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">ä½æ‰€</label>\n                  <div className=\"flex items-start gap-2 mt-1\">\n                    <MapPin className=\"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0\" />\n                    <p className=\"text-sm text-gray-900\">{store.address}</p>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">ä½œæˆæ—¥</label>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <Calendar className=\"w-4 h-4 text-gray-400\" />\n                    <p className=\"text-sm text-gray-900\">\n                      {store.created_at ? formatDate(store.created_at) : 'ä¸æ˜'}\n                    </p>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700\">æœ€çµ‚æ›´æ–°</label>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <Calendar className=\"w-4 h-4 text-gray-400\" />\n                    <p className=\"text-sm text-gray-900\">\n                      {store.updated_at ? formatDate(store.updated_at) : 'ä¸æ˜'}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n                <User className=\"w-5 h-5\" />\n                åº—é•·æƒ…å ±\n              </h3>\n              \n              {store.manager_name ? (\n                <div className=\"bg-gray-50 rounded-lg p-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <User className=\"w-4 h-4 text-blue-600\" />\n                      <span className=\"font-medium text-gray-900\">{store.manager_name}</span>\n                      <span className=\"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800\">\n                        åº—é•·\n                      </span>\n                    </div>\n                    <p className=\"text-sm text-gray-600\">åº—èˆ—è²¬ä»»è€…</p>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"bg-gray-50 rounded-lg p-4 text-center\">\n                  <User className=\"w-8 h-8 text-gray-400 mx-auto mb-2\" />\n                  <p className=\"text-sm text-gray-500\">åº—é•·ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* æ´»å‹•çŠ¶æ³ */}\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2 mb-4\">\n              <BarChart3 className=\"w-5 h-5\" />\n              æ´»å‹•çŠ¶æ³\n            </h3>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"bg-blue-50 rounded-lg p-4\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <FileText className=\"w-4 h-4 text-blue-600\" />\n                  <span className=\"text-sm font-medium text-gray-700\">å ±å‘Šæ•°</span>\n                </div>\n                <p className=\"text-2xl font-bold text-blue-600\">\n                  {store.reportCount || 0}ä»¶\n                </p>\n              </div>\n\n              <div className=\"bg-green-50 rounded-lg p-4\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Calendar className=\"w-4 h-4 text-green-600\" />\n                  <span className=\"text-sm font-medium text-gray-700\">æœ€çµ‚å ±å‘Š</span>\n                </div>\n                <p className=\"text-sm font-bold text-green-600\">\n                  {store.lastReportDate \n                    ? formatDate(store.lastReportDate)\n                    : 'å ±å‘Šãªã—'\n                  }\n                </p>\n              </div>\n\n              <div className={`${activity.bgColor} rounded-lg p-4`}>\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <TrendingUp className={`w-4 h-4 ${activity.color.replace('text-', 'text-')}`} />\n                  <span className=\"text-sm font-medium text-gray-700\">çŠ¶æ³</span>\n                </div>\n                <p className={`text-lg font-bold ${activity.color}`}>\n                  {activity.status}\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* å‰²ã‚Šå½“ã¦çŠ¶æ³ */}\n          {store.isAssigned !== undefined && (\n            <div>\n              <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2 mb-3\">\n                <UserPlus className=\"w-5 h-5\" />\n                å‰²ã‚Šå½“ã¦çŠ¶æ³\n              </h3>\n              \n              <div className={`rounded-lg p-4 ${\n                store.isAssigned ? 'bg-green-50 border border-green-200' : 'bg-gray-50 border border-gray-200'\n              }`}>\n                <div className=\"flex items-center gap-2\">\n                  {store.isAssigned ? (\n                    <>\n                      <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                      <span className=\"text-sm font-medium text-green-800\">\n                        ã“ã®åº—èˆ—ã«ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒã‚ã‚Šã¾ã™\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <XCircle className=\"w-4 h-4 text-gray-600\" />\n                      <span className=\"text-sm font-medium text-gray-700\">\n                        ã“ã®åº—èˆ—ã«ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒã‚ã‚Šã¾ã›ã‚“\n                      </span>\n                    </>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */}\n        {canEdit && (\n          <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200 flex gap-3 justify-end\">\n            {onAssignUser && (\n              <button\n                onClick={onAssignUser}\n                className=\"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white hover:bg-purple-700 rounded-lg transition-colors\"\n              >\n                <UserPlus className=\"w-4 h-4\" />\n                ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²ã‚Šå½“ã¦\n              </button>\n            )}\n            \n            {onEdit && (\n              <button\n                onClick={onEdit}\n                className=\"flex items-center gap-2 px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors\"\n              >\n                <Edit className=\"w-4 h-4\" />\n                ç·¨é›†\n              </button>\n            )}\n            \n            {onDelete && (\n              <button\n                onClick={onDelete}\n                className=\"flex items-center gap-2 px-4 py-2 bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors\"\n              >\n                <Trash2 className=\"w-4 h-4\" />\n                åº—èˆ—ã‚’å‰Šé™¤\n              </button>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};",
  "src/components/Stores/StoreForm.tsx": "import React, { useState, useEffect } from 'react';\nimport { Store } from '../../lib/supabase';\nimport { Save, X, MapPin, User, TriangleAlert as AlertTriangle, Building } from 'lucide-react';\n\ninterface StoreFormProps {\n  store?: Store | null;\n  onSubmit: (storeData: {\n    name: string;\n    address: string;\n    managerId?: string;\n    managerName?: string;\n    isActive?: boolean;\n  }) => Promise<{ ok: boolean; error?: string }>;\n  onCancel: () => void;\n  loading?: boolean;\n}\n\nexport const StoreForm: React.FC<StoreFormProps> = ({\n  store,\n  onSubmit,\n  onCancel,\n  loading = false\n}) => {\n  const [formData, setFormData] = useState({\n    name: '',\n    address: '',\n    managerName: '',\n    isActive: true\n  });\n  \n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string>('');\n\n  // ãƒ‡ãƒãƒƒã‚°: ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸåŒ–ãƒ­ã‚°\n  useEffect(() => {\n    console.log('ğŸ”§ StoreForm: åˆæœŸåŒ–é–‹å§‹', { store, hasStore: !!store });\n    \n    if (store) {\n      const initialData = {\n        name: store.name || '',\n        address: store.address || '',\n        managerName: (store as any).manager_name || '',\n        isActive: store.is_active !== false\n      };\n      console.log('ğŸ“ StoreForm: ç·¨é›†ãƒ‡ãƒ¼ã‚¿è¨­å®š', initialData);\n      setFormData(initialData);\n    } else {\n      console.log('ğŸ†• StoreForm: æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰');\n      setFormData({\n        name: '',\n        address: '',\n        managerName: '',\n        isActive: true\n      });\n    }\n    setError('');\n  }, [store]);\n\n  // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    // åŸºæœ¬ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\n    if (!formData.name?.trim()) {\n      setError('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    if (!formData.address?.trim()) {\n      setError('ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const submitData = {\n        name: formData.name.trim(),\n        address: formData.address.trim(),\n        managerId: undefined,\n        managerName: formData.managerName?.trim() || undefined,\n        isActive: !!formData.isActive\n      };\n\n      const result = await onSubmit(submitData);\n\n      if (!result?.ok) {\n        setError(result?.error || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');\n        return;\n      }\n\n      onCancel();\n    } catch (e: any) {\n      setError(e?.message ?? 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // å…¥åŠ›å¤‰æ›´ãƒãƒ³ãƒ‰ãƒ©ãƒ¼\n  const handleInputChange = (field: string, value: string | boolean) => {\n    console.log('âœï¸ StoreForm: å…¥åŠ›å¤‰æ›´:', { field, value });\n    setFormData(prev => ({ ...prev, [field]: value }));\n    if (error) {\n      setError('');\n    }\n  };\n\n  // é€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\n  const handleSubmitButtonClick = () => {\n    console.log('ğŸ–±ï¸ StoreForm: é€ä¿¡ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-blue-100 rounded-lg\">\n                <Building className=\"w-5 h-5 text-blue-600\" />\n              </div>\n              <h2 className=\"text-xl font-semibold text-gray-900\">\n                {store ? 'åº—èˆ—ç·¨é›†' : 'æ–°è¦åº—èˆ—ä½œæˆ'}\n              </h2>\n            </div>\n            <button\n              onClick={onCancel}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <X className=\"w-5 h-5 text-gray-500\" />\n            </button>\n          </div>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n          {/* åº—èˆ—å */}\n          <div>\n            <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2\">\n              <Building className=\"w-4 h-4\" />\n              åº—èˆ—å <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              required\n              value={formData.name}\n              onChange={(e) => handleInputChange('name', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"ä¾‹ï¼šã‚‰ãƒ¼ã‚ã‚“å¤ªéƒ éŠ€åº§åº—\"\n            />\n          </div>\n\n          {/* ä½æ‰€ */}\n          <div>\n            <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2\">\n              <MapPin className=\"w-4 h-4\" />\n              ä½æ‰€ <span className=\"text-red-500\">*</span>\n            </label>\n            <textarea\n              required\n              value={formData.address}\n              onChange={(e) => handleInputChange('address', e.target.value)}\n              rows={2}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n              placeholder=\"ä¾‹ï¼šæ±äº¬éƒ½ä¸­å¤®åŒºéŠ€åº§1-1-1\"\n            />\n          </div>\n\n          {/* åº—é•·å */}\n          <div>\n            <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2\">\n              <User className=\"w-4 h-4\" />\n              åº—é•·åï¼ˆä»»æ„ï¼‰\n            </label>\n            <input\n              type=\"text\"\n              value={formData.managerName}\n              onChange={(e) => handleInputChange('managerName', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"ä¾‹ï¼šç”°ä¸­ å¤ªéƒ\"\n            />\n          </div>\n\n          {/* å–¶æ¥­çŠ¶æ…‹ï¼ˆç·¨é›†æ™‚ã®ã¿ï¼‰ */}\n          {store && (\n            <div>\n              <label className=\"flex items-center gap-3\">\n                <input\n                  type=\"checkbox\"\n                  checked={formData.isActive}\n                  onChange={(e) => handleInputChange('isActive', e.target.checked)}\n                  className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                />\n                <span className=\"text-sm font-medium text-gray-700\">å–¶æ¥­ä¸­</span>\n              </label>\n            </div>\n          )}\n\n          {/* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */}\n          {error && (\n            <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n              <div className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"w-4 h-4 text-red-600\" />\n                <p className=\"text-sm text-red-700\">{error}</p>\n              </div>\n            </div>\n          )}\n\n          {/* ãƒ‡ãƒãƒƒã‚°æƒ…å ± */}\n          <div className=\"p-2 bg-gray-50 rounded text-xs text-gray-600\">\n            <p>ãƒ‡ãƒãƒƒã‚°: {store ? 'ç·¨é›†' : 'æ–°è¦'}ãƒ¢ãƒ¼ãƒ‰</p>\n            <p>å…¥åŠ›å€¤: {formData.name} | {formData.address} | {formData.managerName}</p>\n          </div>\n\n          {/* ãƒœã‚¿ãƒ³ */}\n          <div className=\"flex gap-3 justify-end pt-4 border-t border-gray-200\">\n            <button\n              type=\"button\"\n              onClick={onCancel}\n              disabled={isSubmitting}\n              className=\"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50\"\n            >\n              ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n            </button>\n            <button\n              type=\"submit\"\n              onClick={handleSubmitButtonClick}\n              disabled={isSubmitting || loading}\n              className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-300 rounded-lg transition-colors flex items-center gap-2\"\n            >\n              {isSubmitting ? (\n                <>\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n                  {store ? 'æ›´æ–°ä¸­...' : 'ä½œæˆä¸­...'}\n                </>\n              ) : (\n                <>\n                  <Save className=\"w-4 h-4\" />\n                  {store ? 'æ›´æ–°' : 'ä½œæˆ'}\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};",
  "src/components/Stores/StoreManager.tsx": "import React, { useState } from 'react';\nimport { Plus, Building2, RefreshCw, Download, Upload } from 'lucide-react';\nimport { useAuth } from '../../hooks/useAuth';\nimport { useStores } from '../../hooks/useStores';\nimport { StoresTable } from './StoresTable';\nimport { StoreForm } from './StoreForm';\nimport { StoreDetail } from './StoreDetail';\nimport { StoreSelector } from './StoreSelector';\nimport { Store } from '../../lib/supabase';\nimport { canAddStore } from '@/services/usageLimits';\n\ninterface StoreManagerProps {\n  userId: string | null;\n  onStoresUpdate?: () => void;\n}\n\ntype NotificationType = 'success' | 'error' | 'info';\n\ninterface Notification {\n  type: NotificationType;\n  message: string;\n}\n\nexport const StoreManager: React.FC<StoreManagerProps> = ({ userId, onStoresUpdate }) => {\n  const { user } = useAuth();\n  const {\n    stores,\n    selectedStoreId,\n    selectedStore,\n    loading,\n    error,\n    createStore,\n    updateStore,\n    deleteStore,\n    assignUserToStore,\n    selectStore,\n    fetchStores\n  } = useStores(userId);\n\n  const [showForm, setShowForm] = useState(false);\n  const [editingStore, setEditingStore] = useState<Store | null>(null);\n  const [viewingStore, setViewingStore] = useState<Store | null>(null);\n  const [notification, setNotification] = useState<Notification | null>(null);\n\n  // é€šçŸ¥è¡¨ç¤º\n  const showNotification = (type: NotificationType, message: string) => {\n    console.log(`ğŸ“¢ StoreManager: é€šçŸ¥è¡¨ç¤º - ${type}: ${message}`);\n    setNotification({ type, message });\n    setTimeout(() => setNotification(null), 3000);\n  };\n\n  // æ¨©é™ãƒã‚§ãƒƒã‚¯\n  const canManageStores = user?.role === 'admin' || user?.role === 'manager';\n  const canEditStore = (store: Store) => {\n    // ç®¡ç†è€…ã¯å…¨åº—èˆ—ã‚’ç·¨é›†å¯èƒ½\n    if (user?.role === 'admin') {\n      return true;\n    }\n    // ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯å…¨åº—èˆ—ã‚’ç·¨é›†å¯èƒ½\n    if (user?.role === 'manager') {\n      return true;\n    }\n    // ã‚¹ã‚¿ãƒƒãƒ•ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸåº—èˆ—ã‚’ç·¨é›†å¯èƒ½\n    if (user?.role === 'staff') {\n      // ãƒ‡ãƒ¢ç’°å¢ƒã§ã¯å…¨åº—èˆ—ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã¨ã™ã‚‹\n      return true;\n    }\n    return false;\n  };\n\n  // åº—èˆ—ä½œæˆ\n  const handleCreateStore = async (storeData: {\n    name: string;\n    address: string;\n    managerName?: string;\n    isActive?: boolean;\n  }) => {\n    console.log('ğŸª StoreManager: åº—èˆ—ä½œæˆå‡¦ç†é–‹å§‹', {\n      storeData,\n      userId,\n      currentStoresCount: stores.length\n    });\n\n    try {\n    if (!userId) {\n      showNotification('error', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n      return { error: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' };\n    }\n\n    const limitCheck = await canAddStore(userId);\n    if (!limitCheck.allowed) {\n      showNotification('error', limitCheck.message || 'åº—èˆ—æ•°ã®ä¸Šé™ã«é”ã—ã¦ã„ã¾ã™');\n      return { error: limitCheck.message };\n    }\n\n    const { error } = await createStore(storeData);\n\n    if (error) {\n      console.error('âŒ StoreManager: åº—èˆ—ä½œæˆã‚¨ãƒ©ãƒ¼', error);\n      showNotification('error', error);\n      return { error };\n    } else {\n      console.log('âœ… StoreManager: åº—èˆ—ä½œæˆæˆåŠŸ');\n      showNotification('success', 'åº—èˆ—ã‚’ä½œæˆã—ã¾ã—ãŸ');\n\n       // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å´ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n       if (onStoresUpdate) {\n         console.log('ğŸ”„ StoreManager: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å´åº—èˆ—ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’é€šçŸ¥');\n         setTimeout(() => {\n           onStoresUpdate();\n         }, 500); // å°‘ã—é…å»¶ã•ã›ã¦ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚’ç¢ºå®Ÿã«\n       }\n\n      return {};\n    }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'åº—èˆ—ä½œæˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';\n      console.error('ğŸ’¥ StoreManager: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼', err);\n      showNotification('error', errorMessage);\n      return { error: errorMessage };\n    }\n  };\n\n  // åº—èˆ—æ›´æ–°\n  const handleUpdateStore = async (storeData: {\n    name: string;\n    address: string;\n    managerName?: string;\n    isActive?: boolean;\n  }) => {\n    if (!editingStore) return { error: 'ç·¨é›†å¯¾è±¡ã®åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' };\n    \n    console.log('ğŸ”„ StoreManager: åº—èˆ—æ›´æ–°å‡¦ç†é–‹å§‹', { storeId: editingStore.id, storeData });\n    \n    try {\n    const { error } = await updateStore(editingStore.id, {\n      name: storeData.name,\n      address: storeData.address,\n      manager_name: storeData.managerName,\n      isActive: storeData.isActive\n    });\n    \n    if (error) {\n      console.error('âŒ StoreManager: åº—èˆ—æ›´æ–°ã‚¨ãƒ©ãƒ¼', error);\n      showNotification('error', error);\n      return { error };\n    } else {\n      console.log('âœ… StoreManager: åº—èˆ—æ›´æ–°æˆåŠŸ');\n      showNotification('success', 'åº—èˆ—ã‚’æ›´æ–°ã—ã¾ã—ãŸ');\n      setEditingStore(null);\n      setViewingStore(null);\n       \n       // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å´ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n       if (onStoresUpdate) {\n         console.log('ğŸ”„ StoreManager: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å´åº—èˆ—ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’é€šçŸ¥ï¼ˆæ›´æ–°ï¼‰');\n         setTimeout(() => {\n           onStoresUpdate();\n         }, 500);\n       }\n       \n      return {};\n    }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'åº—èˆ—æ›´æ–°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';\n      console.error('ğŸ’¥ StoreManager: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼', err);\n      showNotification('error', errorMessage);\n      return { error: errorMessage };\n    }\n  };\n\n  // åº—èˆ—å‰Šé™¤\n  const handleDeleteStore = async (storeId: string, storeName: string) => {\n    const { error } = await deleteStore(storeId);\n    \n    if (error) {\n      showNotification('error', error);\n    } else {\n      showNotification('success', `åº—èˆ—ã€Œ${storeName}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);\n      setViewingStore(null);\n       \n       // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å´ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n       if (onStoresUpdate) {\n         console.log('ğŸ”„ StoreManager: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å´åº—èˆ—ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’é€šçŸ¥ï¼ˆå‰Šé™¤ï¼‰');\n         setTimeout(() => {\n           onStoresUpdate();\n         }, 500);\n       }\n    }\n  };\n\n  // ç·¨é›†é–‹å§‹\n  const handleEdit = (store: Store) => {\n    if (!canEditStore(store)) {\n      showNotification('error', 'ã“ã®åº—èˆ—ã‚’ç·¨é›†ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');\n      return;\n    }\n    setEditingStore(store);\n    setShowForm(true);\n    setViewingStore(null);\n  };\n\n  // è©³ç´°è¡¨ç¤º\n  const handleView = (store: Store) => {\n    setViewingStore(store);\n  };\n\n  // ãƒ•ã‚©ãƒ¼ãƒ é–‰ã˜ã‚‹\n  const handleCloseForm = () => {\n    setShowForm(false);\n    setEditingStore(null);\n  };\n\n  // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡\n  const handleSubmitForm = async (storeData: {\n    name: string;\n    address: string;\n    managerName?: string;\n    isActive?: boolean;\n  }) => {\n    console.log('ğŸ“ StoreManager: ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†', { \n      isEditing: !!editingStore, \n      storeData \n    });\n    \n    let result;\n    if (editingStore) {\n      result = await handleUpdateStore(storeData);\n    } else {\n      result = await handleCreateStore(storeData);\n    }\n    \n    // æˆåŠŸæ™‚ã¯ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹\n    if (!result || !result.error) {\n      console.log('âœ… StoreManager: å‡¦ç†æˆåŠŸã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã¾ã™');\n      setTimeout(() => {\n        setShowForm(false);\n        setEditingStore(null);\n      }, 100);\n    }\n    \n    return result || {};\n  };\n\n  // ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿\n  const handleRefresh = () => {\n    fetchStores();\n    showNotification('info', 'ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ');\n  };\n\n  // ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²ã‚Šå½“ã¦ï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰\n  const handleAssignUser = (storeId: string) => {\n    const newUserId = prompt('å‰²ã‚Šå½“ã¦ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');\n    if (newUserId) {\n      assignUserToStore(newUserId, storeId).then(({ error }) => {\n        if (error) {\n          showNotification('error', error);\n        } else {\n          showNotification('success', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰²ã‚Šå½“ã¦ã¾ã—ãŸ');\n        }\n      });\n    }\n  };\n\n  // ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãƒã‚§ãƒƒã‚¯\n  if (user?.role === 'staff') {\n    return (\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center\">\n          <div className=\"text-yellow-600 mb-4\">\n            <Building2 className=\"w-12 h-12 mx-auto\" />\n          </div>\n          <h3 className=\"text-lg font-medium text-yellow-800 mb-2\">ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™</h3>\n          <p className=\"text-yellow-700\">\n            ã‚¹ã‚¿ãƒƒãƒ•ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã¯åº—èˆ—ç®¡ç†æ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã›ã‚“ã€‚\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* å‰Šé™¤æ“ä½œã®èª¬æ˜ */}\n      {canManageStores && stores.length > 0 && (\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"text-yellow-600\">\n              âš ï¸\n            </div>\n            <div>\n              <h4 className=\"text-sm font-medium text-yellow-800 mb-1\">åº—èˆ—å‰Šé™¤ã«ã¤ã„ã¦</h4>\n              <p className=\"text-xs text-yellow-700\">\n                åº—èˆ—ã‚’å‰Šé™¤ã™ã‚‹ã¨éè¡¨ç¤ºã«ãªã‚Šã¾ã™ãŒã€é–¢é€£ã™ã‚‹å ±å‘Šãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¾ã™ã€‚å®Œå…¨å‰Šé™¤ã§ã¯ãªãè«–ç†å‰Šé™¤ã§ã™ã€‚\n              </p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* é€šçŸ¥ */}\n      {notification && (\n        <div className={`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg ${\n          notification.type === 'success' ? 'bg-green-500 text-white' : \n          notification.type === 'error' ? 'bg-red-500 text-white' :\n          'bg-blue-500 text-white'\n        }`}>\n          {notification.message}\n        </div>\n      )}\n\n      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 flex items-center gap-2\">\n            <Building2 className=\"w-7 h-7 text-blue-600\" />\n            åº—èˆ—ç®¡ç†\n          </h2>\n          <p className=\"text-gray-600 mt-1\">\n            åº—èˆ—ã®ä½œæˆã€ç·¨é›†ã€ç®¡ç†ã‚’è¡Œã„ã¾ã™ï¼ˆ{stores.length}åº—èˆ—ï¼‰\n          </p>\n        </div>\n        \n        <div className=\"flex gap-3\">\n          <button\n            onClick={handleRefresh}\n            disabled={loading}\n            className=\"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 transition-colors\"\n          >\n            <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n            æ›´æ–°\n          </button>\n          \n          {canManageStores && (\n            <button\n              onClick={() => setShowForm(true)}\n              className=\"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors\"\n            >\n              <Plus className=\"w-4 h-4\" />\n              æ–°è¦åº—èˆ—\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */}\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <p className=\"text-red-600\">{error}</p>\n        </div>\n      )}\n\n      {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}\n      <div className=\"grid grid-cols-1 xl:grid-cols-4 gap-6\">\n        {/* åº—èˆ—é¸æŠ */}\n        <div className=\"xl:col-span-1\">\n          <StoreSelector\n            stores={stores}\n            selectedStoreId={selectedStoreId}\n            onStoreSelect={selectStore}\n            loading={loading}\n          />\n          \n          {/* é¸æŠä¸­åº—èˆ—ã®è©³ç´° */}\n          {selectedStore && (\n            <div className=\"mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200\">\n              <h3 className=\"text-sm font-medium text-gray-900 mb-3\">é¸æŠä¸­ã®åº—èˆ—</h3>\n              <div className=\"space-y-2 text-sm\">\n                <div>\n                  <span className=\"text-gray-600\">åº—èˆ—åï¼š</span>\n                  <span className=\"font-medium text-gray-900\">{selectedStore.name}</span>\n                </div>\n                <div>\n                  <span className=\"text-gray-600\">çŠ¶æ…‹ï¼š</span>\n                  <span className={`font-medium ${\n                    selectedStore.is_active ? 'text-green-600' : 'text-red-600'\n                  }`}>\n                    {selectedStore.is_active ? 'å–¶æ¥­ä¸­' : 'ä¼‘æ¥­ä¸­'}\n                  </span>\n                </div>\n                {selectedStore.address && (\n                  <div>\n                    <span className=\"text-gray-600\">ä½æ‰€ï¼š</span>\n                    <span className=\"font-medium text-gray-900 text-xs\">\n                      {selectedStore.address}\n                    </span>\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"mt-4 flex gap-2\">\n                <button\n                  onClick={() => handleView(selectedStore)}\n                  className=\"text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700\"\n                >\n                  è©³ç´°è¡¨ç¤º\n                </button>\n                {canEditStore(selectedStore) && (\n                  <button\n                    onClick={() => handleEdit(selectedStore)}\n                    className=\"text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700\"\n                  >\n                    ç·¨é›†\n                  </button>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* åº—èˆ—ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« */}\n        <div className=\"xl:col-span-3\">\n          <StoresTable\n            stores={stores}\n            onEdit={handleEdit}\n            onDelete={canManageStores ? handleDeleteStore : undefined}\n            onView={handleView}\n            onAssignUser={user?.role === 'admin' ? handleAssignUser : undefined}\n            loading={loading}\n          />\n        </div>\n      </div>\n\n      {/* åº—èˆ—ãƒ•ã‚©ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ« */}\n      {showForm && (\n        <StoreForm\n          store={editingStore}\n          onSubmit={handleSubmitForm}\n          onCancel={handleCloseForm}\n          loading={loading}\n        />\n      )}\n\n      {/* åº—èˆ—è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */}\n      {viewingStore && (\n        <StoreDetail\n          store={viewingStore}\n          onClose={() => setViewingStore(null)}\n          onEdit={() => handleEdit(viewingStore)}\n          onDelete={canManageStores ? () => handleDeleteStore(viewingStore.id, viewingStore.name) : undefined}\n          onAssignUser={user?.role === 'admin' ? () => handleAssignUser(viewingStore.id) : undefined}\n          canEdit={true}\n        />\n      )}\n    </div>\n  );\n};",
  "src/components/Stores/StoreSelector.tsx": "import React from 'react';\nimport { Store, ChevronDown } from 'lucide-react';\nimport { Store as StoreType } from '../../lib/supabase';\n\ninterface StoreSelectorProps {\n  stores: StoreType[];\n  selectedStoreId: string | null;\n  onStoreSelect: (storeId: string | null) => void;\n  loading?: boolean;\n}\n\nexport const StoreSelector: React.FC<StoreSelectorProps> = ({\n  stores,\n  selectedStoreId,\n  onStoreSelect,\n  loading = false\n}) => {\n  const selectedStore = stores.find(store => store.id === selectedStoreId);\n  const isAllStores = selectedStoreId === 'all';\n\n  return (\n    <div className=\"relative\">\n      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n        åº—èˆ—ã‚’é¸æŠ\n      </label>\n      <div className=\"relative\">\n        <select\n          value={selectedStoreId || ''}\n          onChange={(e) => onStoreSelect(e.target.value || null)}\n          disabled={loading || stores.length === 0}\n          className=\"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white disabled:bg-gray-100 disabled:cursor-not-allowed\"\n        >\n          <option value=\"\">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>\n          <option value=\"all\">ğŸ¢ å…¨åº—èˆ—ï¼ˆåˆè¨ˆï¼‰</option>\n          {stores.map((store) => (\n            <option key={store.id} value={store.id}>\n              {store.name}\n            </option>\n          ))}\n        </select>\n        \n        <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n          <Store className=\"h-4 w-4 text-gray-400\" />\n        </div>\n        \n        <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n          <ChevronDown className=\"h-4 w-4 text-gray-400\" />\n        </div>\n      </div>\n      \n      {isAllStores && stores.length > 0 && (\n        <div className=\"mt-2 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg\">\n          <div className=\"flex items-center gap-2\">\n            <Store className=\"h-4 w-4 text-blue-600\" />\n            <div>\n              <p className=\"text-sm font-medium text-blue-900\">å…¨åº—èˆ—ï¼ˆåˆè¨ˆè¡¨ç¤ºï¼‰</p>\n              <p className=\"text-xs text-blue-700\">{stores.length}åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ</p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {selectedStore && !isAllStores && (\n        <div className=\"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n          <div className=\"flex items-center gap-2\">\n            <Store className=\"h-4 w-4 text-blue-600\" />\n            <div>\n              <p className=\"text-sm font-medium text-blue-900\">{selectedStore.name}</p>\n              <p className=\"text-xs text-blue-700\">{selectedStore.address}</p>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {stores.length === 0 && !loading && (\n        <p className=\"mt-2 text-sm text-gray-500\">\n          ã¾ã åº—èˆ—ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æ–°ã—ã„åº—èˆ—ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n        </p>\n      )}\n    </div>\n  );\n};",
  "src/components/Stores/StoresTable.tsx": "import React, { useState } from 'react';\nimport { Store } from '../../lib/supabase';\nimport { formatDate } from '../../utils/calculations';\nimport { \n  MapPin, \n  User, \n  Edit, \n  Trash2, \n  Eye, \n  MoreVertical, \n  Calendar,\n  BarChart3,\n  CheckCircle,\n  XCircle,\n  UserPlus,\n  Search,\n  Filter,\n  SortAsc,\n  SortDesc\n} from 'lucide-react';\n\ninterface StoreWithDetails extends Store {\n  manager?: {\n    id: string;\n    name: string;\n    email: string;\n    role: string;\n  } | null;\n  reportCount?: number;\n  lastReportDate?: string;\n  isAssigned?: boolean;\n}\n\ninterface StoresTableProps {\n  stores: StoreWithDetails[];\n  onEdit?: (store: StoreWithDetails) => void;\n  onDelete?: (storeId: string, storeName: string) => void;\n  onView?: (store: StoreWithDetails) => void;\n  onAssignUser?: (storeId: string) => void;\n  loading?: boolean;\n}\n\ntype SortField = 'name' | 'created_at' | 'reportCount' | 'lastReportDate';\ntype SortOrder = 'asc' | 'desc';\n\nexport const StoresTable: React.FC<StoresTableProps> = ({ \n  stores, \n  onEdit, \n  onDelete, \n  onView,\n  onAssignUser,\n  loading = false\n}) => {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [filterActive, setFilterActive] = useState<'all' | 'active' | 'inactive'>('all');\n  const [sortField, setSortField] = useState<SortField>('created_at');\n  const [sortOrder, setSortOrder] = useState<SortOrder>('desc');\n  const [selectedStores, setSelectedStores] = useState<Set<string>>(new Set());\n\n  // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\n  const filteredStores = stores.filter(store => {\n    const matchesSearch = \n      store.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      store.address.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      (store.manager?.name || '').toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesFilter = \n      filterActive === 'all' ? true :\n      filterActive === 'active' ? store.is_active :\n      !store.is_active;\n\n    return matchesSearch && matchesFilter;\n  });\n\n  // ã‚½ãƒ¼ãƒˆ\n  const sortedStores = [...filteredStores].sort((a, b) => {\n    let aValue: any, bValue: any;\n\n    switch (sortField) {\n      case 'name':\n        aValue = a.name.toLowerCase();\n        bValue = b.name.toLowerCase();\n        break;\n      case 'created_at':\n        aValue = new Date(a.created_at || 0);\n        bValue = new Date(b.created_at || 0);\n        break;\n      case 'reportCount':\n        aValue = a.reportCount || 0;\n        bValue = b.reportCount || 0;\n        break;\n      case 'lastReportDate':\n        aValue = a.lastReportDate ? new Date(a.lastReportDate) : new Date(0);\n        bValue = b.lastReportDate ? new Date(b.lastReportDate) : new Date(0);\n        break;\n      default:\n        aValue = a.name;\n        bValue = b.name;\n    }\n\n    if (aValue < bValue) return sortOrder === 'asc' ? -1 : 1;\n    if (aValue > bValue) return sortOrder === 'asc' ? 1 : -1;\n    return 0;\n  });\n\n  // ã‚½ãƒ¼ãƒˆå¤‰æ›´\n  const handleSort = (field: SortField) => {\n    if (sortField === field) {\n      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortField(field);\n      setSortOrder('asc');\n    }\n  };\n\n  // è¤‡æ•°é¸æŠ\n  const handleSelectAll = () => {\n    if (selectedStores.size === sortedStores.length) {\n      setSelectedStores(new Set());\n    } else {\n      setSelectedStores(new Set(sortedStores.map(s => s.id)));\n    }\n  };\n\n  const handleSelectStore = (storeId: string) => {\n    const newSelected = new Set(selectedStores);\n    if (newSelected.has(storeId)) {\n      newSelected.delete(storeId);\n    } else {\n      newSelected.add(storeId);\n    }\n    setSelectedStores(newSelected);\n  };\n\n  // å‰Šé™¤ç¢ºèª\n  const handleDeleteClick = (store: StoreWithDetails) => {\n    if (onDelete) {\n      const hasReports = (store.reportCount || 0) > 0;\n      const message = hasReports \n        ? `ã€Œ${store.name}ã€ã«ã¯${store.reportCount}ä»¶ã®å ±å‘Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚å‰Šé™¤ã™ã‚‹ã¨éè¡¨ç¤ºã«ãªã‚Šã¾ã™ãŒã€ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¾ã™ã€‚ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ`\n        : `ã€Œ${store.name}ã€ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`;\n      \n      if (confirm(message)) {\n        onDelete(store.id, store.name);\n      }\n    }\n  };\n\n  // SortIcon ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\n  const SortIcon = ({ field }: { field: SortField }) => {\n    if (sortField !== field) return null;\n    return sortOrder === 'asc' ? \n      <SortAsc className=\"w-4 h-4 ml-1\" /> : \n      <SortDesc className=\"w-4 h-4 ml-1\" />;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"bg-white rounded-lg border border-gray-200 p-12 text-center\">\n        <div className=\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n        <p className=\"text-gray-600\">åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>\n      </div>\n    );\n  }\n\n  if (stores.length === 0) {\n    return (\n      <div className=\"bg-white rounded-lg border border-gray-200 p-12 text-center\">\n        <div className=\"text-gray-400 mb-4\">\n          <MapPin className=\"mx-auto h-12 w-12\" />\n        </div>\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">åº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“</h3>\n        <p className=\"text-gray-500\">ã€Œæ–°è¦åº—èˆ—ã€ãƒœã‚¿ãƒ³ã‹ã‚‰æœ€åˆã®åº—èˆ—ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\n      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ã‚£ãƒ«ã‚¿ */}\n      <div className=\"px-6 py-4 border-b border-gray-200\">\n        <div className=\"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4\">\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900\">åº—èˆ—ä¸€è¦§</h3>\n            <p className=\"text-sm text-gray-500\">\n              {filteredStores.length}ä»¶ä¸­ {sortedStores.length}ä»¶ã‚’è¡¨ç¤º\n              {selectedStores.size > 0 && ` (${selectedStores.size}ä»¶é¸æŠä¸­)`}\n            </p>\n          </div>\n\n          <div className=\"flex flex-col sm:flex-row gap-3 w-full lg:w-auto\">\n            {/* æ¤œç´¢ */}\n            <div className=\"relative\">\n              <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"åº—èˆ—åã€ä½æ‰€ã€åº—é•·åã§æ¤œç´¢...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full sm:w-64\"\n              />\n            </div>\n\n            {/* ãƒ•ã‚£ãƒ«ã‚¿ */}\n            <select\n              value={filterActive}\n              onChange={(e) => setFilterActive(e.target.value as typeof filterActive)}\n              className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            >\n              <option value=\"all\">ã™ã¹ã¦</option>\n              <option value=\"active\">å–¶æ¥­ä¸­ã®ã¿</option>\n              <option value=\"inactive\">ä¼‘æ¥­ä¸­ã®ã¿</option>\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* ãƒ†ãƒ¼ãƒ–ãƒ« */}\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"px-6 py-3 text-left\">\n                <input\n                  type=\"checkbox\"\n                  checked={selectedStores.size === sortedStores.length && sortedStores.length > 0}\n                  onChange={handleSelectAll}\n                  className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                />\n              </th>\n              <th \n                className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                onClick={() => handleSort('name')}\n              >\n                <div className=\"flex items-center\">\n                  åº—èˆ—æƒ…å ±\n                  <SortIcon field=\"name\" />\n                </div>\n              </th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                åº—é•·\n              </th>\n              <th \n                className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                onClick={() => handleSort('reportCount')}\n              >\n                <div className=\"flex items-center\">\n                  æ´»å‹•çŠ¶æ³\n                  <SortIcon field=\"reportCount\" />\n                </div>\n              </th>\n              <th \n                className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                onClick={() => handleSort('created_at')}\n              >\n                <div className=\"flex items-center\">\n                  ä½œæˆæ—¥\n                  <SortIcon field=\"created_at\" />\n                </div>\n              </th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                æ“ä½œ\n              </th>\n            </tr>\n          </thead>\n          <tbody className=\"bg-white divide-y divide-gray-200\">\n            {sortedStores.map((store) => (\n              <tr \n                key={store.id} \n                className={`hover:bg-gray-50 ${selectedStores.has(store.id) ? 'bg-blue-50' : ''}`}\n              >\n                <td className=\"px-6 py-4 whitespace-nowrap\">\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedStores.has(store.id)}\n                    onChange={() => handleSelectStore(store.id)}\n                    className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                  />\n                </td>\n                <td className=\"px-6 py-4 whitespace-nowrap\">\n                  <div className=\"flex items-center\">\n                    <div className=\"flex-shrink-0 h-10 w-10\">\n                      <div className=\"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center\">\n                        <MapPin className=\"h-5 w-5 text-blue-600\" />\n                      </div>\n                    </div>\n                    <div className=\"ml-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"text-sm font-medium text-gray-900\">\n                          {store.name}\n                        </div>\n                        {store.is_active ? (\n                          <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                        ) : (\n                          <XCircle className=\"w-4 h-4 text-red-500\" />\n                        )}\n                      </div>\n                      <div className=\"text-sm text-gray-500 flex items-center\">\n                        <MapPin className=\"w-3 h-3 mr-1\" />\n                        {store.address}\n                      </div>\n                    </div>\n                  </div>\n                </td>\n                <td className=\"px-6 py-4 whitespace-nowrap\">\n                  {store.manager_name ? (\n                    <div className=\"text-sm\">\n                      <div className=\"font-medium text-gray-900\">{store.manager_name}</div>\n                      <div className=\"text-gray-500\">åº—é•·</div>\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center text-sm text-gray-400\">\n                      <User className=\"w-4 h-4 mr-1\" />\n                      æœªè¨­å®š\n                    </div>\n                  )}\n                </td>\n                <td className=\"px-6 py-4 whitespace-nowrap\">\n                  <div className=\"text-sm\">\n                    <div className=\"flex items-center gap-2\">\n                      <BarChart3 className=\"w-4 h-4 text-blue-500\" />\n                      <span className=\"font-medium\">{store.reportCount || 0}ä»¶</span>\n                    </div>\n                    {store.lastReportDate && (\n                      <div className=\"text-gray-500 flex items-center mt-1\">\n                        <Calendar className=\"w-3 h-3 mr-1\" />\n                        {formatDate(store.lastReportDate)}\n                      </div>\n                    )}\n                  </div>\n                </td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                  {store.created_at ? formatDate(store.created_at) : '-'}\n                </td>\n                <td className=\"px-6 py-4 whitespace-nowrap\">\n                  <div className=\"flex items-center gap-2\">\n                    {onView && (\n                      <button\n                        onClick={() => onView(store)}\n                        className=\"text-blue-600 hover:text-blue-800 transition-colors p-1\"\n                        title=\"è©³ç´°ã‚’è¦‹ã‚‹\"\n                      >\n                        <Eye className=\"w-4 h-4\" />\n                      </button>\n                    )}\n                    {onEdit && (\n                      <button\n                        onClick={() => onEdit(store)}\n                        className=\"text-green-600 hover:text-green-800 transition-colors p-1\"\n                        title=\"ç·¨é›†\"\n                      >\n                        <Edit className=\"w-4 h-4\" />\n                      </button>\n                    )}\n                    {onAssignUser && (\n                      <button\n                        onClick={() => onAssignUser(store.id)}\n                        className=\"text-purple-600 hover:text-purple-800 transition-colors p-1\"\n                        title=\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²ã‚Šå½“ã¦\"\n                      >\n                        <UserPlus className=\"w-4 h-4\" />\n                      </button>\n                    )}\n                    {onDelete && (\n                      <button\n                        onClick={() => onDelete(store.id, store.name)}\n                        className=\"text-red-600 hover:text-red-800 transition-colors p-1\"\n                        title=\"å‰Šé™¤\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </button>\n                    )}\n                  </div>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n\n      {sortedStores.length === 0 && (\n        <div className=\"p-12 text-center\">\n          <Filter className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">è©²å½“ã™ã‚‹åº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“</h3>\n          <p className=\"text-gray-500\">æ¤œç´¢æ¡ä»¶ã‚„ãƒ•ã‚£ãƒ«ã‚¿ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</p>\n        </div>\n      )}\n    </div>\n  );\n};",
  "src/components/Tables/ReportsTable.tsx": "import React, { useState, useMemo } from 'react';\nimport { DailyReport } from '../../types';\nimport { formatDate, formatCurrency, calculateTotalExpenses, calculateOperatingProfit } from '../../utils/calculations';\nimport { Eye, Edit, Trash2, Search, SortAsc, SortDesc, ChevronLeft, ChevronRight, Filter, Calendar, Store } from 'lucide-react';\n\ninterface ReportsTableProps {\n  reports: DailyReport[];\n  stores: Array<{ id: string; name: string; }>;\n}\n\nexport const ReportsTable: React.FC<ReportsTableProps> = ({ reports, stores }) => {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedStoreId, setSelectedStoreId] = useState<string>('all');\n  const [selectedMonth, setSelectedMonth] = useState<string>(() => {\n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ä»Šæœˆ\n    const now = new Date();\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\n  });\n  const [sortField, setSortField] = useState<'date' | 'storeName' | 'sales' | 'profit'>('date');\n  const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('desc');\n  const [currentPage, setCurrentPage] = useState(1);\n  const reportsPerPage = 15;\n\n  // åˆ©ç”¨å¯èƒ½ãªæœˆã®ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ\n  const availableMonths = useMemo(() => {\n    const months = new Set<string>();\n    reports.forEach(report => {\n      const date = new Date(report.date);\n      const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n      months.add(monthKey);\n    });\n    \n    const sortedMonths = Array.from(months).sort().reverse(); // æ–°ã—ã„æœˆã‹ã‚‰é †ã«\n    return sortedMonths.map(month => {\n      const [year, monthNum] = month.split('-');\n      const date = new Date(parseInt(year), parseInt(monthNum) - 1);\n      return {\n        value: month,\n        label: date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' })\n      };\n    });\n  }, [reports]);\n\n  // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†\n  const filteredReports = useMemo(() => {\n    return reports.filter(report => {\n      // æ¤œç´¢æ¡ä»¶\n      const matchesSearch = \n        (report.storeName || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (report.staffName || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\n        formatDate(report.date).includes(searchTerm);\n\n      // åº—èˆ—ãƒ•ã‚£ãƒ«ã‚¿\n      const matchesStore = selectedStoreId === 'all' || report.storeId === selectedStoreId;\n\n      // æœˆãƒ•ã‚£ãƒ«ã‚¿\n      const reportMonth = report.date.substring(0, 7); // YYYY-MM\n      const matchesMonth = reportMonth === selectedMonth;\n\n      return matchesSearch && matchesStore && matchesMonth;\n    });\n  }, [reports, searchTerm, selectedStoreId, selectedMonth]);\n\n  // ã‚½ãƒ¼ãƒˆå‡¦ç†\n  const sortedReports = useMemo(() => {\n    return [...filteredReports].sort((a, b) => {\n      let aValue: any, bValue: any;\n      \n      switch (sortField) {\n        case 'date':\n          aValue = new Date(a.date);\n          bValue = new Date(b.date);\n          break;\n        case 'storeName':\n          aValue = a.storeName;\n          bValue = b.storeName;\n          break;\n        case 'sales':\n          aValue = a.sales;\n          bValue = b.sales;\n          break;\n        case 'profit':\n          const aTotalExpenses = calculateTotalExpenses(a);\n          const bTotalExpenses = calculateTotalExpenses(b);\n          aValue = calculateOperatingProfit(a.sales, aTotalExpenses);\n          bValue = calculateOperatingProfit(b.sales, bTotalExpenses);\n          break;\n        default:\n          aValue = a.date;\n          bValue = b.date;\n      }\n\n      if (aValue < bValue) return sortDirection === 'asc' ? -1 : 1;\n      if (aValue > bValue) return sortDirection === 'asc' ? 1 : -1;\n      return 0;\n    });\n  }, [filteredReports, sortField, sortDirection]);\n\n  // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³\n  const totalPages = Math.ceil(sortedReports.length / reportsPerPage);\n  const startIndex = (currentPage - 1) * reportsPerPage;\n  const endIndex = startIndex + reportsPerPage;\n  const currentReports = sortedReports.slice(startIndex, endIndex);\n\n  // é›†è¨ˆãƒ‡ãƒ¼ã‚¿è¨ˆç®—\n  const summary = useMemo(() => {\n    const totalSales = filteredReports.reduce((sum, report) => sum + report.sales, 0);\n    const totalExpenses = filteredReports.reduce((sum, report) => sum + calculateTotalExpenses(report), 0);\n    const totalProfit = totalSales - totalExpenses;\n    const avgProfitMargin = totalSales > 0 ? (totalProfit / totalSales) * 100 : 0;\n\n    return { totalSales, totalExpenses, totalProfit, avgProfitMargin };\n  }, [filteredReports]);\n\n  const handleSort = (field: typeof sortField) => {\n    if (field === sortField) {\n      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortField(field);\n      setSortDirection('asc');\n    }\n    setCurrentPage(1);\n  };\n\n  const SortIcon = ({ field }: { field: typeof sortField }) => {\n    if (sortField !== field) return null;\n    return sortDirection === 'asc' ? \n      <SortAsc className=\"w-4 h-4 ml-1\" /> : \n      <SortDesc className=\"w-4 h-4 ml-1\" />;\n  };\n\n  // ãƒ•ã‚£ãƒ«ã‚¿å¤‰æ›´æ™‚ã«ãƒšãƒ¼ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆ\n  React.useEffect(() => {\n    setCurrentPage(1);\n  }, [selectedStoreId, selectedMonth, searchTerm]);\n\n  if (reports.length === 0) {\n    return (\n      <div className=\"bg-white rounded-lg border border-gray-200 p-12 text-center\">\n        <div className=\"text-gray-400 mb-4\">\n          <svg className=\"mx-auto h-12 w-12\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n          </svg>\n        </div>\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">å ±å‘ŠãŒã‚ã‚Šã¾ã›ã‚“</h3>\n        <p className=\"text-gray-500\">ã€Œæ–°è¦å ±å‘Šã€ãƒœã‚¿ãƒ³ã‹ã‚‰æœ€åˆã®å ±å‘Šã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\n      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ã‚£ãƒ«ã‚¿ */}\n      <div className=\"px-6 py-4 border-b border-gray-200\">\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"flex justify-between items-center\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">æ—¥æ¬¡å ±å‘Šä¸€è¦§</h3>\n            \n            {/* æ¤œç´¢ãƒãƒ¼ */}\n            <div className=\"relative\">\n              <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"ã‚¹ã‚¿ãƒƒãƒ•åã€ãƒ¡ãƒ¢ã§æ¤œç´¢...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-64\"\n              />\n            </div>\n          </div>\n\n          {/* ãƒ•ã‚£ãƒ«ã‚¿è¡Œ */}\n          <div className=\"flex flex-wrap gap-4 items-center\">\n            {/* åº—èˆ—ãƒ•ã‚£ãƒ«ã‚¿ */}\n            <div className=\"flex items-center gap-2\">\n              <Store className=\"w-4 h-4 text-gray-500\" />\n              <select\n                value={selectedStoreId}\n                onChange={(e) => setSelectedStoreId(e.target.value)}\n                className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent min-w-40\"\n              >\n                <option value=\"all\">ï¼ˆå…¨åº—èˆ—ï¼‰</option>\n                {stores.map((store) => (\n                  <option key={store.id} value={store.id}>\n                    {store.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            {/* æœˆãƒ•ã‚£ãƒ«ã‚¿ */}\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"w-4 h-4 text-gray-500\" />\n              <select\n                value={selectedMonth}\n                onChange={(e) => setSelectedMonth(e.target.value)}\n                className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent min-w-32\"\n              >\n                {availableMonths.map((month) => (\n                  <option key={month.value} value={month.value}>\n                    {month.label}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            {/* ãƒ•ã‚£ãƒ«ã‚¿ãƒªã‚»ãƒƒãƒˆ */}\n            <button\n              onClick={() => {\n                setSelectedStoreId('all');\n                setSearchTerm('');\n                const now = new Date();\n                setSelectedMonth(`${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`);\n              }}\n              className=\"text-sm text-blue-600 hover:text-blue-800 transition-colors flex items-center gap-1\"\n            >\n              <Filter className=\"w-3 h-3\" />\n              ãƒ•ã‚£ãƒ«ã‚¿ã‚¯ãƒªã‚¢\n            </button>\n          </div>\n\n          {/* é›†è¨ˆã‚µãƒãƒªãƒ¼ */}\n          <div className=\"bg-gray-50 rounded-lg p-4\">\n            <div className=\"grid grid-cols-4 gap-4 text-center\">\n              <div>\n                <p className=\"text-xs text-gray-600 mb-1\">å£²ä¸Šåˆè¨ˆ</p>\n                <p className=\"text-lg font-bold text-blue-600\">{formatCurrency(summary.totalSales)}</p>\n              </div>\n              <div>\n                <p className=\"text-xs text-gray-600 mb-1\">çµŒè²»åˆè¨ˆ</p>\n                <p className=\"text-lg font-bold text-red-600\">{formatCurrency(summary.totalExpenses)}</p>\n              </div>\n              <div>\n                <p className=\"text-xs text-gray-600 mb-1\">å–¶æ¥­åˆ©ç›Š</p>\n                <p className={`text-lg font-bold ${summary.totalProfit >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {formatCurrency(summary.totalProfit)}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-xs text-gray-600 mb-1\">å¹³å‡åˆ©ç›Šç‡</p>\n                <p className={`text-lg font-bold ${\n                  summary.avgProfitMargin >= 15 ? 'text-green-600' : \n                  summary.avgProfitMargin >= 10 ? 'text-yellow-600' : 'text-red-600'\n                }`}>\n                  {summary.avgProfitMargin.toFixed(1)}%\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* çµæœè¡¨ç¤º */}\n          <div className=\"text-sm text-gray-600\">\n            {filteredReports.length}ä»¶ä¸­ {startIndex + 1}-{Math.min(endIndex, filteredReports.length)}ä»¶ã‚’è¡¨ç¤º\n            <span className=\"ml-2 text-blue-600 font-medium\">\n              {selectedStoreId === 'all' ? 'ï¼ˆå…¨åº—èˆ—ï¼‰' : \n               stores.find(s => s.id === selectedStoreId)?.name || ''}\n            </span>\n            {(selectedStoreId !== 'all' || searchTerm) && (\n              <span className=\"ml-2 px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs\">\n                ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ä¸­\n              </span>\n            )}\n          </div>\n        </div>\n      </div>\n      \n      {/* ãƒ†ãƒ¼ãƒ–ãƒ« */}\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th \n                className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                onClick={() => handleSort('date')}\n              >\n                <div className=\"flex items-center\">\n                  æ—¥ä»˜\n                  <SortIcon field=\"date\" />\n                </div>\n              </th>\n              <th \n                className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                onClick={() => handleSort('storeName')}\n              >\n                <div className=\"flex items-center\">\n                  åº—èˆ—\n                  <SortIcon field=\"storeName\" />\n                </div>\n              </th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                ã‚¹ã‚¿ãƒƒãƒ•\n              </th>\n              <th \n                className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                onClick={() => handleSort('sales')}\n              >\n                <div className=\"flex items-center\">\n                  å£²ä¸Š\n                  <SortIcon field=\"sales\" />\n                </div>\n              </th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                çµŒè²»åˆè¨ˆ\n              </th>\n              <th \n                className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                onClick={() => handleSort('profit')}\n              >\n                <div className=\"flex items-center\">\n                  å–¶æ¥­åˆ©ç›Š\n                  <SortIcon field=\"profit\" />\n                </div>\n              </th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                åˆ©ç›Šç‡\n              </th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                æ“ä½œ\n              </th>\n            </tr>\n          </thead>\n          <tbody className=\"bg-white divide-y divide-gray-200\">\n            {currentReports.map((report) => {\n              const totalExpenses = calculateTotalExpenses(report);\n              const operatingProfit = calculateOperatingProfit(report.sales, totalExpenses);\n              const profitMargin = (operatingProfit / report.sales) * 100;\n              \n              return (\n                <tr key={report.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    {formatDate(report.date)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-gray-900\">\n                      {report.storeName}\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    {report.staffName}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                    {formatCurrency(report.sales)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    {formatCurrency(totalExpenses)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    <span className={operatingProfit >= 0 ? 'text-green-600' : 'text-red-600'}>\n                      {formatCurrency(operatingProfit)}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    <span className={profitMargin >= 15 ? 'text-green-600' : profitMargin >= 10 ? 'text-yellow-600' : 'text-red-600'}>\n                      {profitMargin.toFixed(1)}%\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                    <div className=\"flex items-center gap-2\">\n                      <button \n                        className=\"text-blue-600 hover:text-blue-800 transition-colors p-1 rounded hover:bg-blue-50\"\n                        title=\"è©³ç´°è¡¨ç¤º\"\n                      >\n                        <Eye className=\"w-4 h-4\" />\n                      </button>\n                      <button \n                        className=\"text-green-600 hover:text-green-800 transition-colors p-1 rounded hover:bg-green-50\"\n                        title=\"ç·¨é›†\"\n                      >\n                        <Edit className=\"w-4 h-4\" />\n                      </button>\n                      <button \n                        className=\"text-red-600 hover:text-red-800 transition-colors p-1 rounded hover:bg-red-50\"\n                        title=\"å‰Šé™¤\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n        \n        {/* ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ */}\n        {totalPages > 1 && (\n          <div className=\"px-6 py-4 border-t border-gray-200 flex items-center justify-between\">\n            <div className=\"text-sm text-gray-700\">\n              ãƒšãƒ¼ã‚¸ {currentPage} / {totalPages}\n            </div>\n            <div className=\"flex gap-2\">\n              <button\n                onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                disabled={currentPage === 1}\n                className=\"flex items-center gap-1 px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <ChevronLeft className=\"w-4 h-4\" />\n                å‰ã¸\n              </button>\n              <button\n                onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}\n                disabled={currentPage === totalPages}\n                className=\"flex items-center gap-1 px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                æ¬¡ã¸\n                <ChevronRight className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* ãƒ‡ãƒ¼ã‚¿ãªã—ã®å ´åˆ */}\n      {filteredReports.length === 0 && reports.length > 0 && (\n        <div className=\"p-12 text-center\">\n          <Filter className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">è©²å½“ã™ã‚‹å ±å‘ŠãŒã‚ã‚Šã¾ã›ã‚“</h3>\n          <p className=\"text-gray-500\">æ¤œç´¢æ¡ä»¶ã‚„ãƒ•ã‚£ãƒ«ã‚¿ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</p>\n        </div>\n      )}\n    </div>\n  );\n};",
  "src/components/Usage/UpgradePromptModal.tsx": "import React from 'react'\nimport { Button } from '@/components/ui/button'\nimport { X, Crown, Check, TrendingUp } from 'lucide-react'\nimport { useNavigate } from 'react-router-dom'\n\ninterface Props {\n  type: 'stores' | 'users' | 'ai'\n  currentLimit: number\n  onClose: () => void\n}\n\nexport const UpgradePromptModal: React.FC<Props> = ({ type, currentLimit, onClose }) => {\n  const navigate = useNavigate()\n\n  const getContent = () => {\n    switch (type) {\n      case 'stores':\n        return {\n          title: 'åº—èˆ—æ•°ã®ä¸Šé™ã«é”ã—ã¾ã—ãŸ',\n          description: `ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã§ã¯${currentLimit}åº—èˆ—ã¾ã§ç™»éŒ²ã§ãã¾ã™ã€‚`,\n          features: [\n            'ã‚ˆã‚Šå¤šãã®åº—èˆ—ã‚’ç®¡ç†',\n            'åº—èˆ—é–“ã®è©³ç´°ãªæ¯”è¼ƒåˆ†æ',\n            'ãƒãƒ«ãƒã‚¹ãƒˆã‚¢é‹å–¶ã®åŠ¹ç‡åŒ–',\n            'çµ±åˆãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½'\n          ]\n        }\n      case 'users':\n        return {\n          title: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã®ä¸Šé™ã«é”ã—ã¾ã—ãŸ',\n          description: `ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã§ã¯${currentLimit}åã¾ã§æ‹›å¾…ã§ãã¾ã™ã€‚`,\n          features: [\n            'ã‚ˆã‚Šå¤šãã®ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ ',\n            'ãƒãƒ¼ãƒ å…¨ä½“ã§ã®æƒ…å ±å…±æœ‰',\n            'æ¨©é™ç®¡ç†ã®æŸ”è»Ÿæ€§å‘ä¸Š',\n            'çµ„ç¹”å…¨ä½“ã®å¯è¦–åŒ–'\n          ]\n        }\n      case 'ai':\n        return {\n          title: 'AIä½¿ç”¨å›æ•°ã®ä¸Šé™ã«é”ã—ã¾ã—ãŸ',\n          description: `ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã§ã¯æœˆ${currentLimit}å›ã¾ã§AIæ©Ÿèƒ½ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚`,\n          features: [\n            'ã‚ˆã‚Šå¤šãã®AIåˆ†æ',\n            'é«˜åº¦ãªçµŒå–¶æ´å¯Ÿ',\n            '24æ™‚é–“ã„ã¤ã§ã‚‚è³ªå•å¯èƒ½',\n            'ç²¾åº¦ã®é«˜ã„äºˆæ¸¬åˆ†æ'\n          ]\n        }\n    }\n  }\n\n  const content = getContent()\n\n  const plans = [\n    {\n      name: 'Starter',\n      price: 'Â¥9,800/æœˆ',\n      stores: 3,\n      users: 5,\n      ai: 100,\n      popular: false\n    },\n    {\n      name: 'Business',\n      price: 'Â¥29,800/æœˆ',\n      stores: 10,\n      users: 20,\n      ai: 500,\n      popular: true\n    },\n    {\n      name: 'Enterprise',\n      price: 'è¦ç›¸è«‡',\n      stores: 'ç„¡åˆ¶é™',\n      users: 'ç„¡åˆ¶é™',\n      ai: 'ç„¡åˆ¶é™',\n      popular: false\n    }\n  ]\n\n  const handleUpgrade = () => {\n    navigate('/organization?tab=subscription')\n    onClose()\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"sticky top-0 bg-white border-b border-slate-200 p-6 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center\">\n              <Crown className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-bold text-slate-900\">{content.title}</h2>\n              <p className=\"text-sm text-slate-600\">{content.description}</p>\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-1 hover:bg-slate-100 rounded-lg transition-colors\"\n          >\n            <X className=\"w-5 h-5 text-slate-500\" />\n          </button>\n        </div>\n\n        <div className=\"p-6\">\n          <div className=\"mb-8\">\n            <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">\n              ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§åˆ©ç”¨å¯èƒ½ã«ãªã‚‹æ©Ÿèƒ½\n            </h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n              {content.features.map((feature, index) => (\n                <div key={index} className=\"flex items-start gap-2\">\n                  <Check className=\"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-slate-700\">{feature}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"mb-6\">\n            <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              {plans.map((plan, index) => (\n                <div\n                  key={index}\n                  className={`relative border-2 rounded-lg p-6 ${\n                    plan.popular\n                      ? 'border-blue-500 bg-blue-50'\n                      : 'border-slate-200 bg-white'\n                  }`}\n                >\n                  {plan.popular && (\n                    <div className=\"absolute -top-3 left-1/2 -translate-x-1/2\">\n                      <span className=\"px-3 py-1 bg-blue-600 text-white text-xs font-medium rounded-full\">\n                        ãŠã™ã™ã‚\n                      </span>\n                    </div>\n                  )}\n                  <div className=\"text-center mb-4\">\n                    <h4 className=\"text-xl font-bold text-slate-900 mb-2\">{plan.name}</h4>\n                    <p className=\"text-2xl font-bold text-blue-600\">{plan.price}</p>\n                  </div>\n                  <div className=\"space-y-2 text-sm text-slate-600 mb-6\">\n                    <p>åº—èˆ—: {plan.stores}</p>\n                    <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼: {plan.users}</p>\n                    <p>AIä½¿ç”¨: {plan.ai}å›/æœˆ</p>\n                  </div>\n                  <Button\n                    onClick={handleUpgrade}\n                    className={`w-full ${\n                      plan.popular\n                        ? 'bg-blue-600 hover:bg-blue-700 text-white'\n                        : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\n                    }`}\n                  >\n                    {plan.popular ? (\n                      <>\n                        <TrendingUp className=\"w-4 h-4 mr-2\" />\n                        ä»Šã™ãã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰\n                      </>\n                    ) : (\n                      'è©³ç´°ã‚’è¦‹ã‚‹'\n                    )}\n                  </Button>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"bg-slate-50 border border-slate-200 rounded-lg p-4\">\n            <p className=\"text-sm text-slate-600 text-center\">\n              ãƒ—ãƒ©ãƒ³ã®è©³ç´°ã‚„ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã«ã¤ã„ã¦ã¯ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒšãƒ¼ã‚¸ã§ã”ç¢ºèªãã ã•ã„\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n",
  "src/components/Usage/UsageOverview.tsx": "import React from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Store, Users, MessageSquare, TrendingUp } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { useNavigate } from 'react-router-dom'\nimport { useUsageLimits } from '@/hooks/useUsageLimits'\nimport { getUsagePercentage, getUsageState } from '@/services/usageLimits'\n\nexport const UsageOverview: React.FC = () => {\n  const navigate = useNavigate()\n  const { status, loading } = useUsageLimits()\n\n  if (loading || !status) {\n    return null\n  }\n\n  const items = [\n    {\n      icon: Store,\n      label: 'åº—èˆ—æ•°',\n      current: status.current.storeCount,\n      max: status.limits.maxStores,\n      color: 'text-blue-600',\n      bgColor: 'bg-blue-50'\n    },\n    {\n      icon: Users,\n      label: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°',\n      current: status.current.userCount,\n      max: status.limits.maxUsers,\n      color: 'text-green-600',\n      bgColor: 'bg-green-50'\n    },\n    {\n      icon: MessageSquare,\n      label: 'AIä½¿ç”¨å›æ•°/æœˆ',\n      current: status.current.aiRequestCount,\n      max: status.limits.maxAIRequestsPerMonth,\n      color: 'text-orange-600',\n      bgColor: 'bg-orange-50'\n    }\n  ]\n\n  const hasWarning = items.some(item => {\n    const state = getUsageState(item.current, item.max)\n    return state === 'warning' || state === 'critical' || state === 'exceeded'\n  })\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>ä½¿ç”¨çŠ¶æ³</CardTitle>\n          {hasWarning && (\n            <Button\n              onClick={() => navigate('/organization?tab=subscription')}\n              className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n              size=\"sm\"\n            >\n              <TrendingUp className=\"w-4 h-4 mr-2\" />\n              ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          {items.map((item, index) => {\n            const Icon = item.icon\n            const percentage = getUsagePercentage(item.current, item.max)\n            const state = getUsageState(item.current, item.max)\n            const isUnlimited = item.max === 0\n\n            const getBarColor = () => {\n              if (isUnlimited) return 'bg-slate-300'\n              switch (state) {\n                case 'exceeded':\n                  return 'bg-red-500'\n                case 'critical':\n                  return 'bg-orange-500'\n                case 'warning':\n                  return 'bg-yellow-500'\n                default:\n                  return 'bg-green-500'\n              }\n            }\n\n            return (\n              <div key={index}>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className={`p-2 ${item.bgColor} rounded-lg`}>\n                      <Icon className={`w-4 h-4 ${item.color}`} />\n                    </div>\n                    <span className=\"text-sm font-medium text-slate-700\">{item.label}</span>\n                  </div>\n                  <span className=\"text-sm font-medium text-slate-900\">\n                    {item.current} / {isUnlimited ? 'ç„¡åˆ¶é™' : item.max}\n                  </span>\n                </div>\n                <div className=\"w-full bg-slate-200 rounded-full h-2\">\n                  <div\n                    className={`h-2 rounded-full transition-all ${getBarColor()}`}\n                    style={{ width: `${isUnlimited ? 10 : percentage}%` }}\n                  ></div>\n                </div>\n                {state === 'exceeded' && (\n                  <p className=\"text-xs text-red-600 mt-1\">ä¸Šé™ã«é”ã—ã¦ã„ã¾ã™</p>\n                )}\n                {state === 'critical' && (\n                  <p className=\"text-xs text-orange-600 mt-1\">ã¾ã‚‚ãªãä¸Šé™ã«é”ã—ã¾ã™</p>\n                )}\n                {state === 'warning' && (\n                  <p className=\"text-xs text-yellow-600 mt-1\">ä½¿ç”¨é‡ãŒå¢—ãˆã¦ã„ã¾ã™</p>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n",
  "src/components/Usage/UsageWarningBanner.tsx": "import React from 'react'\nimport { AlertTriangle, AlertCircle, Info, TrendingUp } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { useNavigate } from 'react-router-dom'\nimport { getUsageState } from '@/services/usageLimits'\n\ninterface Props {\n  type: 'stores' | 'users' | 'ai'\n  current: number\n  max: number\n  label: string\n}\n\nexport const UsageWarningBanner: React.FC<Props> = ({ type, current, max, label }) => {\n  const navigate = useNavigate()\n  const state = getUsageState(current, max)\n\n  if (state === 'safe' || max === 0) return null\n\n  const getConfig = () => {\n    switch (state) {\n      case 'exceeded':\n        return {\n          icon: AlertCircle,\n          bgColor: 'bg-red-50',\n          borderColor: 'border-red-200',\n          textColor: 'text-red-800',\n          iconColor: 'text-red-600',\n          message: `${label}ã®ä¸Šé™ï¼ˆ${max}ï¼‰ã«é”ã—ã¾ã—ãŸ`\n        }\n      case 'critical':\n        return {\n          icon: AlertTriangle,\n          bgColor: 'bg-orange-50',\n          borderColor: 'border-orange-200',\n          textColor: 'text-orange-800',\n          iconColor: 'text-orange-600',\n          message: `${label}ãŒä¸Šé™ï¼ˆ${max}ï¼‰ã«è¿‘ã¥ã„ã¦ã„ã¾ã™`\n        }\n      case 'warning':\n        return {\n          icon: Info,\n          bgColor: 'bg-yellow-50',\n          borderColor: 'border-yellow-200',\n          textColor: 'text-yellow-800',\n          iconColor: 'text-yellow-600',\n          message: `${label}ã®ä½¿ç”¨é‡ãŒå¢—ãˆã¦ã„ã¾ã™`\n        }\n      default:\n        return null\n    }\n  }\n\n  const config = getConfig()\n  if (!config) return null\n\n  const Icon = config.icon\n  const percentage = Math.min(Math.round((current / max) * 100), 100)\n\n  return (\n    <div className={`p-4 ${config.bgColor} border ${config.borderColor} rounded-lg mb-4`}>\n      <div className=\"flex items-start gap-3\">\n        <Icon className={`w-5 h-5 ${config.iconColor} flex-shrink-0 mt-0.5`} />\n        <div className=\"flex-1\">\n          <p className={`font-medium ${config.textColor}`}>{config.message}</p>\n          <p className={`text-sm ${config.textColor} mt-1`}>\n            ç¾åœ¨ã®ä½¿ç”¨é‡: {current} / {max} ({percentage}%)\n          </p>\n          {state === 'exceeded' && (\n            <p className={`text-sm ${config.textColor} mt-2`}>\n              ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã€åˆ¶é™ã‚’è§£é™¤ã—ã¦ãã ã•ã„ã€‚\n            </p>\n          )}\n        </div>\n        {(state === 'exceeded' || state === 'critical') && (\n          <Button\n            onClick={() => navigate('/organization?tab=subscription')}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white flex-shrink-0\"\n          >\n            <TrendingUp className=\"w-4 h-4 mr-2\" />\n            ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰\n          </Button>\n        )}\n      </div>\n    </div>\n  )\n}\n",
  "src/components/alerts/AlertsPanel.tsx": "import React from 'react'\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'\nimport { AlertCircle, CheckCircle } from 'lucide-react'\nimport { KPIData } from '@/hooks/useKpis'\nimport { formatPercent } from '@/lib/format'\nimport { Badge } from '@/components/ui/badge'\n\ntype Props = {\n  kpis: KPIData\n  targetCostRate?: number\n  targetLaborRate?: number\n}\n\nexport const AlertsPanel: React.FC<Props> = ({ kpis, targetCostRate, targetLaborRate }) => {\n  const alerts: Array<{ level: 'warn'|'danger'; title: string; desc: string }> = []\n\n  // ç›®æ¨™å€¤ãŒã‚ã‚‹å ´åˆã¯ç›®æ¨™å€¤ã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤\n  const costRateThreshold = targetCostRate || 32\n  const laborRateThreshold = targetLaborRate || 27\n  const primeCostThreshold = costRateThreshold + laborRateThreshold\n\n  if (kpis.purchaseRate > costRateThreshold) alerts.push({ level:'danger', title:'åŸä¾¡ç‡ãŒé«˜ã„', desc:`ç¾åœ¨ ${formatPercent(kpis.purchaseRate)}ï¼ˆç›®æ¨™ ${formatPercent(costRateThreshold)}ä»¥ä¸‹ï¼‰` })\n  if (kpis.laborRate > laborRateThreshold) alerts.push({ level:'danger', title:'äººä»¶è²»ç‡ãŒé«˜ã„', desc:`ç¾åœ¨ ${formatPercent(kpis.laborRate)}ï¼ˆç›®æ¨™ ${formatPercent(laborRateThreshold)}ä»¥ä¸‹ï¼‰` })\n  if (kpis.primeCostRate > primeCostThreshold) alerts.push({ level:'warn', title:'ãƒ—ãƒ©ã‚¤ãƒ ã‚³ã‚¹ãƒˆãŒé«˜ã„', desc:`ç¾åœ¨ ${formatPercent(kpis.primeCostRate)}ï¼ˆç›®æ¨™ ${formatPercent(primeCostThreshold)}ä»¥ä¸‹ï¼‰` })\n  if (kpis.operatingProfit < 0) alerts.push({ level:'danger', title:'å–¶æ¥­èµ¤å­—', desc:'è²»ç”¨ãŒå£²ä¸Šã‚’ä¸Šå›ã£ã¦ã„ã¾ã™' })\n\n  const ok = alerts.length === 0\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-lg\">ã‚¢ãƒ©ãƒ¼ãƒˆ</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        {ok ? (\n          <div className=\"flex items-center gap-2 text-green-600\">\n            <CheckCircle className=\"h-4 w-4\" />\n            é‡å¤§ãªã‚¢ãƒ©ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\n          </div>\n        ) : alerts.map((a, i)=>(\n          <div key={i} className={`flex items-start gap-3 p-3 rounded-lg ${a.level==='danger' ? 'bg-red-50' : 'bg-yellow-50'}`}>\n            <AlertCircle className={`h-4 w-4 ${a.level==='danger'?'text-red-600':'text-yellow-600'}`} />\n            <div className=\"flex-1\">\n              <div className=\"text-sm font-medium\">{a.title}</div>\n              <div className=\"text-xs text-muted-foreground\">{a.desc}</div>\n            </div>\n            <Badge variant={a.level==='danger'?'destructive':'secondary'}>{a.level==='danger'?'é‡è¦':'æ³¨æ„'}</Badge>\n          </div>\n        ))}\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/analysis/ProfitLossModal.tsx": "import React, { useMemo } from 'react'\nimport { X, TrendingUp, TrendingDown, Target, Calendar } from 'lucide-react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { formatCurrency, formatPercent } from '@/lib/format'\nimport { DailyReportData } from '@/types'\nimport { useTargets } from '@/hooks/useTargets'\n\ninterface ProfitLossModalProps {\n  month: string // 'YYYY-MM'\n  reports: DailyReportData[]\n  onClose: () => void\n  storeId?: string\n}\n\nexport const ProfitLossModal: React.FC<ProfitLossModalProps> = ({\n  month,\n  reports,\n  onClose,\n  storeId = 'all'\n}) => {\n  // monthãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\n  const isValidMonth = useMemo(() => {\n    const monthRegex = /^\\d{4}-\\d{2}$/\n    return monthRegex.test(month)\n  }, [month])\n\n  if (!isValidMonth) {\n    console.error('PLModal: ç„¡åŠ¹ãªæœˆå½¢å¼:', month)\n    return (\n      <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n        <Card className=\"max-w-md\">\n          <CardHeader>\n            <CardTitle>ã‚¨ãƒ©ãƒ¼</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p>ç„¡åŠ¹ãªæœˆå½¢å¼ã§ã™: {month}</p>\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              æ­£ã—ã„å½¢å¼: YYYY-MM (ä¾‹: 2025-01)\n            </p>\n            <Button onClick={onClose} className=\"mt-4\">\n              é–‰ã˜ã‚‹\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  const { getAllStoresTarget, getTargetForStore } = useTargets(storeId, month)\n  \n  // ãã®æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n  const monthReports = useMemo(() => {\n    console.log('PLModal: ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹', { month, storeId, inputReportsCount: reports.length })\n\n    const filteredReports = reports.filter(r =>\n      r.date.slice(0, 7) === month && (storeId === 'all' || r.storeId === storeId)\n    )\n\n    console.log('PLModal: ãƒ•ã‚£ãƒ«ã‚¿å¾Œãƒ¬ãƒãƒ¼ãƒˆæ•°', filteredReports.length)\n    return filteredReports\n  }, [reports, month, storeId])\n  \n  const totals = useMemo(() => {\n    console.log('PLModal: è¨ˆç®—é–‹å§‹', { monthReportsCount: monthReports.length })\n    \n    if (monthReports.length === 0) {\n      console.log('PLModal: ãƒ‡ãƒ¼ã‚¿ãªã— - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä½¿ç”¨')\n      return {\n        salesCash10: 0, salesCash8: 0, salesCredit10: 0, salesCredit8: 0,\n        sales: 0, purchase: 0, laborCost: 0, utilities: 0,\n        promotion: 0, cleaning: 0, misc: 0, communication: 0, others: 0,\n        reportCount: 0\n      }\n    }\n    \n    const result = monthReports.reduce((acc, r) => {\n      // å®‰å…¨ãªæ•°å€¤å–å¾—ï¼ˆå­˜åœ¨ã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯0ï¼‰\n      const anyR = r as any\n      const salesCash10 = Number(anyR.salesCash10 ?? 0)\n      const salesCash8 = Number(anyR.salesCash8 ?? 0)\n      const salesCredit10 = Number(anyR.salesCredit10 ?? 0)\n      const salesCredit8 = Number(anyR.salesCredit8 ?? 0)\n      const sales = Number(r.sales) || 0\n      const purchase = Number(r.purchase) || 0\n      const laborCost = Number(r.laborCost) || 0\n      const utilities = Number(r.utilities) || 0\n      const promotion = Number(r.promotion) || 0\n      const cleaning = Number(r.cleaning) || 0\n      const misc = Number(r.misc) || 0\n      const communication = Number(r.communication) || 0\n      const others = Number(r.others) || 0\n      \n      acc.salesCash10 += salesCash10\n      acc.salesCash8 += salesCash8\n      acc.salesCredit10 += salesCredit10\n      acc.salesCredit8 += salesCredit8\n      acc.sales += sales\n      acc.purchase += purchase\n      acc.laborCost += laborCost\n      acc.utilities += utilities\n      acc.promotion += promotion\n      acc.cleaning += cleaning\n      acc.misc += misc\n      acc.communication += communication\n      acc.others += others\n      acc.reportCount += 1\n      return acc\n    }, {\n      salesCash10: 0, salesCash8: 0, salesCredit10: 0, salesCredit8: 0,\n      sales: 0, purchase: 0, laborCost: 0, utilities: 0,\n      promotion: 0, cleaning: 0, misc: 0, communication: 0, others: 0,\n      reportCount: 0\n    })\n    \n    console.log('PLModal: è¨ˆç®—çµæœ', {\n      sales: result.sales,\n      purchase: result.purchase,\n      laborCost: result.laborCost,\n      reportCount: result.reportCount\n    })\n    \n    return result\n  }, [monthReports])\n\n  // å£²ä¸Šå†…è¨³ã®è£œæ­£ï¼šå†…è¨³ã®åˆè¨ˆãŒå£²ä¸Šé«˜ã¨ä¸€è‡´ã™ã‚‹ã‚ˆã†ã«èª¿æ•´\n  const adjustedSales = useMemo(() => {\n    const breakdown = totals.salesCash10 + totals.salesCash8 + totals.salesCredit10 + totals.salesCredit8\n    \n    // å†…è¨³ã®åˆè¨ˆãŒå£²ä¸Šé«˜ã¨å¤§ããç•°ãªã‚‹å ´åˆï¼ˆå·®ãŒ10%ä»¥ä¸Šï¼‰ã€å£²ä¸Šé«˜ã‹ã‚‰æ¯”ç‡ã§åˆ†å‰²\n    if (Math.abs(breakdown - totals.sales) > totals.sales * 0.1 || breakdown === 0) {\n      // æ¨™æº–çš„ãªé£²é£Ÿåº—ã®æ¯”ç‡ã§åˆ†å‰²\n      const cashRatio = 0.65      // ç¾é‡‘65%\n      const tax10Ratio = 0.75     // 10%ç¨ç‡75%\n      \n      return {\n        salesCash10: Math.round(totals.sales * cashRatio * tax10Ratio),\n        salesCash8: Math.round(totals.sales * cashRatio * (1 - tax10Ratio)),\n        salesCredit10: Math.round(totals.sales * (1 - cashRatio) * tax10Ratio),\n        salesCredit8: Math.round(totals.sales * (1 - cashRatio) * (1 - tax10Ratio))\n      }\n    }\n    \n    // å†…è¨³ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨\n    return {\n      salesCash10: totals.salesCash10,\n      salesCash8: totals.salesCash8,\n      salesCredit10: totals.salesCredit10,\n      salesCredit8: totals.salesCredit8\n    }\n  }, [totals])\n  // å‰æœˆãƒ‡ãƒ¼ã‚¿ï¼ˆæ¯”è¼ƒç”¨ï¼‰\n  const prevTotals = useMemo(() => {\n    if (!isValidMonth) return { sales: 0, purchase: 0, expenses: 0, profit: 0 }\n    \n    const prevMonth = new Date(month + '-01')\n    prevMonth.setMonth(prevMonth.getMonth() - 1)\n    const prevMonthStr = `${prevMonth.getFullYear()}-${String(prevMonth.getMonth()+1).padStart(2,'0')}`\n    console.log('PLModal: å‰æœˆè¨ˆç®—', { month, prevMonthStr })\n    \n    const prevReports = reports.filter(r =>\n      r.date.slice(0,7) === prevMonthStr && (storeId === 'all' || r.storeId === storeId)\n    )\n    console.log('PLModal: å‰æœˆãƒ¬ãƒãƒ¼ãƒˆæ•°:', prevReports.length)\n    \n    return prevReports.reduce((acc, r) => {\n      const sales = Number(r.sales) || 0\n      const purchase = Number(r.purchase) || 0\n      const expenses = purchase + (Number(r.laborCost) || 0) + (Number(r.utilities) || 0) + \n                      (Number(r.promotion) || 0) + (Number(r.cleaning) || 0) + (Number(r.misc) || 0) + \n                      (Number(r.communication) || 0) + (Number(r.others) || 0)\n      acc.sales += sales\n      acc.purchase += purchase\n      acc.expenses += expenses\n      acc.profit += (sales - expenses)\n      return acc\n    }, { sales: 0, purchase: 0, expenses: 0, profit: 0 })\n  }, [month, reports, storeId])\n\n  const totalExpenses = totals.purchase + totals.laborCost + totals.utilities + \n                        totals.promotion + totals.cleaning + totals.misc + \n                        totals.communication + totals.others\n  const grossProfit = totals.sales - totals.purchase\n  const operatingProfit = totals.sales - totalExpenses\n  const profitMargin = totals.sales > 0 ? (operatingProfit / totals.sales) * 100 : 0\n\n  // å‰æœˆæ¯”è¨ˆç®—\n  const salesGrowth = prevTotals.sales > 0 ? ((totals.sales - prevTotals.sales) / prevTotals.sales) * 100 : 0\n  const profitGrowth = prevTotals.profit > 0 ? ((operatingProfit - prevTotals.profit) / prevTotals.profit) * 100 : 0\n\n  // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿\n  const target = storeId === 'all' ? getAllStoresTarget() : getTargetForStore(storeId)\n  const targetAchievement = target ? (totals.sales / target.targetSales) * 100 : null\n\n  const monthLabel = new Date(month + '-01').toLocaleDateString('ja-JP', { \n    year: 'numeric', \n    month: 'long' \n  })\n\n  // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šè¨ˆç®—çµæœã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›\n  console.log('PLModal: æœ€çµ‚è¨ˆç®—çµæœ', {\n    month,\n    monthLabel,\n    totals,\n    totalExpenses,\n    grossProfit,\n    operatingProfit,\n    profitMargin,\n    salesGrowth,\n    profitGrowth\n  })\n\n  const PLRow = ({ label, amount, isSubtotal = false, isTotal = false, growth, note }: {\n    label: string\n    amount: number\n    isSubtotal?: boolean\n    isTotal?: boolean\n    growth?: number\n    note?: string\n  }) => (\n    <div className={`flex justify-between items-center py-2 ${\n      isTotal ? 'border-t-2 border-primary bg-blue-50 font-bold' : \n      isSubtotal ? 'border-t border-border bg-muted font-medium' : ''\n    } ${isTotal || isSubtotal ? 'px-3 -mx-3 rounded' : ''}`}>\n      <div className=\"flex items-center gap-2\">\n        <span className={isTotal ? 'text-lg' : isSubtotal ? 'text-base' : 'text-sm'}>\n          {label}\n        </span>\n        {note && <span className=\"text-xs text-muted-foreground\">({note})</span>}\n        {growth !== undefined && Math.abs(growth) > 0.1 && (\n          <div className=\"flex items-center gap-1\">\n            {growth >= 0 ? (\n              <TrendingUp className=\"w-3 h-3 text-green-500\" />\n            ) : (\n              <TrendingDown className=\"w-3 h-3 text-red-500\" />\n            )}\n            <span className={`text-xs ${growth >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n              {growth >= 0 ? '+' : ''}{growth.toFixed(1)}%\n            </span>\n          </div>\n        )}\n      </div>\n      <span className={`font-mono ${\n        isTotal ? 'text-lg font-bold' : \n        isSubtotal ? 'text-base font-medium' : 'text-sm'\n      } ${\n        amount < 0 ? 'text-red-600' : amount > 0 ? 'text-green-600' : 'text-muted-foreground'\n      }`}>\n        {formatCurrency(Math.abs(amount))}\n      </span>\n    </div>\n  )\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-background rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"px-6 py-4 border-b border-border flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-primary/10 rounded-lg\">\n              <Calendar className=\"w-6 h-6 text-primary\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold text-foreground\">\n              <p>æœˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: {month}</p>\n              <p>æœˆå½¢å¼æœ‰åŠ¹: {isValidMonth ? 'OK' : 'NG'}</p>\n                {monthLabel} æç›Šè¨ˆç®—æ›¸\n              </h2>\n              <p className=\"text-sm text-muted-foreground\">\n                {storeId === 'all' ? 'å…¨åº—èˆ—åˆè¨ˆ' : 'è±Šæ´²åº—'} â€¢ {totals.reportCount}ä»¶ã®å ±å‘Š\n              </p>\n            </div>\n          </div>\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n            <X className=\"w-5 h-5\" />\n          </Button>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          {/* ç›®æ¨™é”æˆçŠ¶æ³ */}\n          {target && targetAchievement && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg flex items-center gap-2\">\n                  <Target className=\"w-5 h-5 text-primary\" />\n                  ç›®æ¨™é”æˆçŠ¶æ³\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"flex justify-between items-center\">\n                  <span>å£²ä¸Šç›®æ¨™é”æˆç‡</span>\n                  <Badge variant={\n                    targetAchievement >= 100 ? 'default' : \n                    targetAchievement >= 80 ? 'secondary' : 'destructive'\n                  }>\n                    {targetAchievement.toFixed(1)}%\n                  </Badge>\n                </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">å®Ÿç¸¾</span>\n                  <span>{formatCurrency(totals.sales)}</span>\n                </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">ç›®æ¨™</span>\n                  <span>{formatCurrency(target.targetSales)}</span>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* æç›Šè¨ˆç®—æ›¸ */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">æç›Šè¨ˆç®—æ›¸ï¼ˆP&Lï¼‰</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-1\">\n              {/* å£²ä¸Š */}\n              <PLRow label=\"å£²ä¸Šé«˜\" amount={totals.sales} isTotal growth={salesGrowth} />\n              \n              {/* å£²ä¸Šå†…è¨³ */}\n              <div className=\"ml-4 space-y-1 pb-2\">\n                <PLRow label=\"ç¾é‡‘ãƒ»10%é£²é£Ÿ\" amount={adjustedSales.salesCash10} />\n                <PLRow label=\"ç¾é‡‘ãƒ»8%è»½æ¸›\" amount={adjustedSales.salesCash8} />\n                <PLRow label=\"ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»10%é£²é£Ÿ\" amount={adjustedSales.salesCredit10} />\n                <PLRow label=\"ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»8%è»½æ¸›\" amount={adjustedSales.salesCredit8} />\n              </div>\n\n              {/* å£²ä¸ŠåŸä¾¡ */}\n              <PLRow label=\"å£²ä¸ŠåŸä¾¡ï¼ˆä»•å…¥ï¼‰\" amount={totals.purchase} />\n              \n              {/* ç²—åˆ©ç›Š */}\n              <PLRow \n                label=\"å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰\" \n                amount={grossProfit} \n                isSubtotal \n                note={`ç²—åˆ©ç‡ ${totals.sales > 0 ? ((grossProfit / totals.sales) * 100).toFixed(1) : 0}%`}\n              />\n\n              {/* è²©ç®¡è²» */}\n              <div className=\"pt-2\">\n                <div className=\"text-sm font-medium text-muted-foreground mb-2\">è²©å£²è²»ãŠã‚ˆã³ä¸€èˆ¬ç®¡ç†è²»</div>\n                <div className=\"ml-4 space-y-1\">\n                  <PLRow label=\"äººä»¶è²»\" amount={totals.laborCost} />\n                  <PLRow label=\"å…‰ç†±è²»\" amount={totals.utilities} />\n                  <PLRow label=\"è²©ä¿ƒè²»\" amount={totals.promotion} />\n                  <PLRow label=\"æ¸…æƒè²»\" amount={totals.cleaning} />\n                  <PLRow label=\"é›‘è²»\" amount={totals.misc} />\n                  <PLRow label=\"é€šä¿¡è²»\" amount={totals.communication} />\n                  <PLRow label=\"ãã®ä»–\" amount={totals.others} />\n                </div>\n                <PLRow \n                  label=\"è²©ç®¡è²»åˆè¨ˆ\" \n                  amount={totalExpenses - totals.purchase} \n                  isSubtotal \n                />\n              </div>\n\n              {/* å–¶æ¥­åˆ©ç›Š */}\n              <PLRow \n                label=\"å–¶æ¥­åˆ©ç›Š\" \n                amount={operatingProfit} \n                isTotal \n                growth={profitGrowth}\n                note={`åˆ©ç›Šç‡ ${formatPercent(profitMargin)}`}\n              />\n            </CardContent>\n          </Card>\n\n          {/* æ¯”ç‡åˆ†æ */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">æ¯”ç‡åˆ†æ</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <h4 className=\"text-sm font-medium\">å£²ä¸Šæ§‹æˆæ¯”</h4>\n                  <div className=\"space-y-1 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span>ç¾é‡‘ãƒ»10%ç¨ç‡</span>\n                      <span>{formatPercent((adjustedSales.salesCash10 / totals.sales) * 100)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>ç¾é‡‘ãƒ»8%ç¨ç‡</span>\n                      <span>{formatPercent((adjustedSales.salesCash8 / totals.sales) * 100)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»10%ç¨ç‡</span>\n                      <span>{formatPercent((adjustedSales.salesCredit10 / totals.sales) * 100)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»8%ç¨ç‡</span>\n                      <span>{formatPercent((adjustedSales.salesCredit8 / totals.sales) * 100)}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <h4 className=\"text-sm font-medium\">è²»ç”¨æ¯”ç‡</h4>\n                  <div className=\"space-y-1 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span>åŸä¾¡ç‡</span>\n                      <span className={\n                        totals.sales > 0 && ((totals.purchase / totals.sales) * 100) <= 32 ? 'text-green-600' : 'text-red-600'\n                      }>\n                        {formatPercent(totals.sales > 0 ? (totals.purchase / totals.sales) * 100 : 0)}\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>äººä»¶è²»ç‡</span>\n                      <span className={\n                        totals.sales > 0 && ((totals.laborCost / totals.sales) * 100) <= 27 ? 'text-green-600' : 'text-red-600'\n                      }>\n                        {formatPercent(totals.sales > 0 ? (totals.laborCost / totals.sales) * 100 : 0)}\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>(è²©ç®¡è²»-äººä»¶è²»)ç‡</span>\n                      <span className={\n                        totals.sales > 0 && (((totalExpenses - totals.purchase - totals.laborCost) / totals.sales) * 100) <= 30 ? 'text-green-600' : 'text-red-600'\n                      }>\n                        {formatPercent(totals.sales > 0 ? ((totalExpenses - totals.purchase - totals.laborCost) / totals.sales) * 100 : 0)}\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between font-medium\">\n                      <span>å–¶æ¥­åˆ©ç›Šç‡</span>\n                      <span className={\n                        profitMargin >= 15 ? 'text-green-600' : \n                        profitMargin >= 10 ? 'text-yellow-600' : 'text-red-600'\n                      }>\n                        {formatPercent(profitMargin)}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */}\n          <div className=\"flex gap-3 pt-4 border-t border-border\">\n            <Button \n              variant=\"outline\" \n              className=\"flex-1\"\n              onClick={() => window.print()}\n            >\n              PDFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\n            </Button>\n            <Button \n              variant=\"outline\" \n              className=\"flex-1\"\n              onClick={() => {\n                const csv = [\n                  ['é …ç›®', 'é‡‘é¡'],\n                  ['å£²ä¸Šé«˜', totals.sales],\n                  ['ã€€ç¾é‡‘ãƒ»10%', totals.salesCash10],\n                  ['ã€€ç¾é‡‘ãƒ»8%', totals.salesCash8],\n                  ['ã€€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»10%', totals.salesCredit10],\n                  ['ã€€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»8%', totals.salesCredit8],\n                  ['å£²ä¸ŠåŸä¾¡', totals.purchase],\n                  ['å£²ä¸Šç·åˆ©ç›Š', grossProfit],\n                  ['äººä»¶è²»', totals.laborCost],\n                  ['å…‰ç†±è²»', totals.utilities],\n                  ['è²©ä¿ƒè²»', totals.promotion],\n                  ['æ¸…æƒè²»', totals.cleaning],\n                  ['é›‘è²»', totals.misc],\n                  ['é€šä¿¡è²»', totals.communication],\n                  ['ãã®ä»–', totals.others],\n                  ['å–¶æ¥­åˆ©ç›Š', operatingProfit],\n                  ['åˆ©ç›Šç‡(%)', profitMargin]\n                ].map(row => row.join(',')).join('\\n')\n                \n                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' })\n                const url = URL.createObjectURL(blob)\n                const a = document.createElement('a')\n                a.href = url\n                a.download = `PL_${month}_${storeId}.csv`\n                a.click()\n                URL.revokeObjectURL(url)\n              }}\n            >\n              CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\n            </Button>\n            <Button onClick={onClose}>\n              é–‰ã˜ã‚‹\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}",
  "src/components/Auth/AuthGate.tsx": "import { useState, useEffect } from 'react'\nimport { Navigate, Outlet, useLocation } from 'react-router-dom'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { TermsAcceptanceModal } from './TermsAcceptanceModal'\nimport { supabase } from '@/lib/supabase'\n\nexport default function AuthGate() {\n  const { isInitialized, isAuthenticated, user } = useAuth()\n  const location = useLocation()\n  const [termsAccepted, setTermsAccepted] = useState<boolean | null>(null)\n  const [checkingTerms, setCheckingTerms] = useState(true)\n\n  useEffect(() => {\n    if (user?.id) {\n      checkTermsAcceptance()\n    }\n  }, [user?.id])\n\n  const checkTermsAcceptance = async () => {\n    if (!user?.id) return\n\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('terms_accepted, privacy_accepted')\n        .eq('user_id', user.id)\n        .single()\n\n      if (error) {\n        console.error('Failed to check terms acceptance:', error)\n        setTermsAccepted(false)\n      } else {\n        setTermsAccepted(data?.terms_accepted && data?.privacy_accepted)\n      }\n    } catch (err) {\n      console.error('Error checking terms:', err)\n      setTermsAccepted(false)\n    } finally {\n      setCheckingTerms(false)\n    }\n  }\n\n  if (!isInitialized || checkingTerms) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n          <p className=\"text-slate-600\">èª­ã¿è¾¼ã¿ä¸­...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (!isAuthenticated) {\n    return <Navigate to=\"/login\" replace state={{ from: location }} />\n  }\n\n  if (termsAccepted === false && user?.id) {\n    return (\n      <TermsAcceptanceModal\n        userId={user.id}\n        onAccepted={() => {\n          setTermsAccepted(true)\n        }}\n      />\n    )\n  }\n\n  return <Outlet />\n}\n",
  "src/components/Auth/LoginForm.tsx": "import React, { useState } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Mail, Lock, User, CircleAlert as AlertCircle, Building } from 'lucide-react'\nimport { useAuth } from '@/contexts/AuthContext'\n\nexport const LoginForm: React.FC = () => {\n  const navigate = useNavigate()\n  const { signUp, signIn, loading: authLoading } = useAuth()\n\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    password: '',\n    organizationName: ''\n  })\n  const [isSignUp, setIsSignUp] = useState(false)\n  const [localSubmitting, setLocalSubmitting] = useState(false)\n  const [error, setError] = useState('')\n  const [success, setSuccess] = useState('')\n\n  const submitting = authLoading || localSubmitting\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData(prev => ({\n      ...prev,\n      [e.target.name]: e.target.value\n    }))\n    setError('')\n    setSuccess('')\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    console.log('ğŸŸ¦ LoginForm: ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡é–‹å§‹')\n    setError('')\n    setSuccess('')\n    setLocalSubmitting(true)\n\n    try {\n      if (isSignUp) {\n        // ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—\n        if (!formData.name || !formData.email || !formData.password || !formData.organizationName) {\n          setError('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')\n          setLocalSubmitting(false)\n          return\n        }\n\n        if (formData.password.length < 8) {\n          setError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„')\n          setLocalSubmitting(false)\n          return\n        }\n\n        console.log('ğŸŸ¦ LoginForm: ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—é–‹å§‹')\n        const { data, error } = await signUp(\n          formData.email,\n          formData.password,\n          formData.name,\n          'staff',\n          formData.organizationName\n        )\n\n        if (error) {\n          console.error('âŒ LoginForm: ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼', error)\n          setError(error.message)\n          setLocalSubmitting(false)\n          return\n        }\n\n        if (data) {\n          console.log('âœ… LoginForm: ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æˆåŠŸ')\n          setSuccess('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨çµ„ç¹”ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚')\n          setIsSignUp(false)\n          setFormData({ name: '', email: formData.email, password: '', organizationName: '' })\n          setLocalSubmitting(false)\n        }\n      } else {\n        // ã‚µã‚¤ãƒ³ã‚¤ãƒ³\n        if (!formData.email || !formData.password) {\n          setError('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')\n          setLocalSubmitting(false)\n          return\n        }\n\n        console.log('ğŸŸ¦ LoginForm: ã‚µã‚¤ãƒ³ã‚¤ãƒ³é–‹å§‹', formData.email)\n        const { data, error } = await signIn(formData.email, formData.password)\n        console.log('ğŸŸ¦ LoginForm: ã‚µã‚¤ãƒ³ã‚¤ãƒ³å®Œäº†', { data, error })\n\n        if (error) {\n          console.error('âŒ LoginForm: ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼', error)\n          setError(error.message || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ')\n          setLocalSubmitting(false)\n          return\n        }\n\n        if (data) {\n          console.log('âœ… LoginForm: ã‚µã‚¤ãƒ³ã‚¤ãƒ³æˆåŠŸã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸é·ç§»')\n          navigate('/dashboard/daily', { replace: true })\n        }\n      }\n    } catch (err) {\n      console.error('âŒ LoginForm: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼', err)\n      setError('äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ')\n      setLocalSubmitting(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 py-12 px-4\">\n      <Card className=\"w-full max-w-md shadow-xl\">\n        <CardHeader className=\"space-y-1 pb-6\">\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg\">\n              <Building className=\"w-10 h-10 text-white\" />\n            </div>\n          </div>\n          <CardTitle className=\"text-2xl font-bold text-center\">\n            æ ªå¼ä¼šç¤¾ã‚ã•ã²\n          </CardTitle>\n          <p className=\"text-center text-slate-600 text-sm\">\n            {isSignUp ? 'æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²' : 'æ¥­å‹™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ '}\n          </p>\n        </CardHeader>\n\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {isSignUp && (\n              <>\n                <div>\n                  <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                    <Building className=\"w-4 h-4 inline mr-2\" />\n                    çµ„ç¹”å\n                  </label>\n                  <input\n                    type=\"text\"\n                    name=\"organizationName\"\n                    value={formData.organizationName}\n                    onChange={handleInputChange}\n                    className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition\"\n                    placeholder=\"æ ªå¼ä¼šç¤¾ã€‡ã€‡\"\n                    disabled={submitting}\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                    <User className=\"w-4 h-4 inline mr-2\" />\n                    ãŠåå‰\n                  </label>\n                  <input\n                    type=\"text\"\n                    name=\"name\"\n                    value={formData.name}\n                    onChange={handleInputChange}\n                    className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition\"\n                    placeholder=\"å±±ç”°å¤ªéƒ\"\n                    disabled={submitting}\n                  />\n                </div>\n              </>\n            )}\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                <Mail className=\"w-4 h-4 inline mr-2\" />\n                ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹\n              </label>\n              <input\n                type=\"email\"\n                name=\"email\"\n                value={formData.email}\n                onChange={handleInputChange}\n                className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition\"\n                placeholder=\"your-email@example.com\"\n                disabled={submitting}\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                <Lock className=\"w-4 h-4 inline mr-2\" />\n                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰\n              </label>\n              <input\n                type=\"password\"\n                name=\"password\"\n                value={formData.password}\n                onChange={handleInputChange}\n                className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition\"\n                placeholder=\"8æ–‡å­—ä»¥ä¸Š\"\n                disabled={submitting}\n              />\n            </div>\n\n            {error && (\n              <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2\">\n                <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\n                <p className=\"text-sm text-red-800\">{error}</p>\n              </div>\n            )}\n\n            {success && (\n              <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg\">\n                <p className=\"text-sm text-green-800\">{success}</p>\n              </div>\n            )}\n\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-medium py-2.5 rounded-lg transition-all shadow-md hover:shadow-lg\"\n              disabled={submitting}\n            >\n              {submitting ? (\n                <span className=\"flex items-center justify-center gap-2\">\n                  <span className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent\"></span>\n                  å‡¦ç†ä¸­...\n                </span>\n              ) : isSignUp ? (\n                'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ'\n              ) : (\n                'ãƒ­ã‚°ã‚¤ãƒ³'\n              )}\n            </Button>\n\n            <div className=\"text-center mt-4\">\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setIsSignUp(!isSignUp)\n                  setError('')\n                  setSuccess('')\n                }}\n                className=\"text-sm text-blue-600 hover:text-blue-700 hover:underline transition\"\n                disabled={submitting}\n              >\n                {isSignUp\n                  ? 'ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹ã¯ã“ã¡ã‚‰'\n                  : 'æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã¯ã“ã¡ã‚‰'}\n              </button>\n            </div>\n          </form>\n\n          <div className=\"mt-6 pt-6 border-t border-slate-200\">\n            <p className=\"text-xs text-center text-slate-500\">\n              åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
  "src/components/Auth/PermissionGuard.tsx": "import React from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Shield, TriangleAlert as AlertTriangle, Lock, Users, ArrowLeft } from 'lucide-react'\nimport { useAuth } from '@/contexts/AuthContext'\n\ninterface PermissionGuardProps {\n  children: React.ReactNode\n  requiredRole?: 'staff' | 'manager' | 'admin'\n  requiredStoreAccess?: string\n  fallback?: React.ReactNode\n  showError?: boolean\n}\n\nexport const PermissionGuard: React.FC<PermissionGuardProps> = ({\n  children,\n  requiredRole,\n  requiredStoreAccess,\n  fallback,\n  showError = true\n}) => {\n  const { user, hasPermission, canAccessStore } = useAuth()\n\n  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å ´åˆ\n  if (!user) {\n    return fallback || null\n  }\n\n  // å¿…è¦ãªå½¹å‰²ãƒ¬ãƒ™ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯\n  if (requiredRole && !hasPermission(requiredRole)) {\n    if (!showError) return fallback || null\n\n    const roleNames = {\n      staff: 'ã‚¹ã‚¿ãƒƒãƒ•',\n      manager: 'åº—é•·ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',\n      admin: 'çµ±æ‹¬è²¬ä»»è€…'\n    }\n\n    return (\n      <div className=\"max-w-2xl mx-auto py-12\">\n        <Card className=\"border-2 border-red-200 bg-red-50\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\n              <Lock className=\"w-8 h-8 text-red-600\" />\n            </div>\n            <CardTitle className=\"text-xl font-bold text-red-800\">\n              ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã¾ã™\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"text-center space-y-4\">\n            <div className=\"space-y-2\">\n              <p className=\"text-sm text-red-700\">\n                ã“ã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯<strong>{roleNames[requiredRole]}</strong>ä»¥ä¸Šã®æ¨©é™ãŒå¿…è¦ã§ã™ã€‚\n              </p>\n              <div className=\"flex items-center justify-center gap-2\">\n                <Badge variant=\"outline\" className=\"border-red-300 text-red-700\">\n                  ç¾åœ¨ã®æ¨©é™: {roleNames[user.role]}\n                </Badge>\n                <Badge variant=\"destructive\">\n                  å¿…è¦æ¨©é™: {roleNames[requiredRole]}\n                </Badge>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-lg p-4 text-left\">\n              <h4 className=\"text-sm font-medium text-gray-700 mb-2\">åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½ï¼š</h4>\n              <ul className=\"text-xs text-gray-600 space-y-1\">\n                {user.role === 'staff' && (\n                  <>\n                    <li>âœ… æ—¥å ±å…¥åŠ›ãƒ»ç·¨é›†</li>\n                    <li>âœ… åŸºæœ¬çš„ãªãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰é–²è¦§</li>\n                    <li>âœ… AIåŸºæœ¬åˆ†æ</li>\n                    <li>âŒ åº—èˆ—ç®¡ç†æ©Ÿèƒ½</li>\n                    <li>âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</li>\n                    <li>âŒ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</li>\n                  </>\n                )}\n                {user.role === 'manager' && (\n                  <>\n                    <li>âœ… æ‹…å½“åº—èˆ—ç®¡ç†</li>\n                    <li>âœ… ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</li>\n                    <li>âœ… è©³ç´°åˆ†ææ©Ÿèƒ½</li>\n                    <li>âœ… AIé«˜åº¦åˆ†æ</li>\n                    <li>âŒ å…¨åº—èˆ—çµ±åˆç®¡ç†</li>\n                    <li>âŒ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</li>\n                  </>\n                )}\n              </ul>\n            </div>\n\n            <Button\n              onClick={() => window.history.back()}\n              variant=\"outline\"\n              className=\"mt-4\"\n            >\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              å‰ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  // ç‰¹å®šã®åº—èˆ—ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ãƒã‚§ãƒƒã‚¯\n  if (requiredStoreAccess && !canAccessStore(requiredStoreAccess)) {\n    if (!showError) return fallback || null\n\n    return (\n      <div className=\"max-w-2xl mx-auto py-12\">\n        <Card className=\"border-2 border-yellow-200 bg-yellow-50\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mb-4\">\n              <AlertTriangle className=\"w-8 h-8 text-yellow-600\" />\n            </div>\n            <CardTitle className=\"text-xl font-bold text-yellow-800\">\n              åº—èˆ—ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"text-center space-y-4\">\n            <p className=\"text-sm text-yellow-700\">\n              ã“ã®åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚\n            </p>\n            \n            <div className=\"bg-white rounded-lg p-4\">\n              <h4 className=\"text-sm font-medium text-gray-700 mb-2\">ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªåº—èˆ—ï¼š</h4>\n              <div className=\"space-y-1\">\n                {user.assignedStores?.map(store => (\n                  <div key={store.id} className=\"text-xs text-gray-600 flex items-center gap-2\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full\" />\n                    {store.name}\n                  </div>\n                )) || (\n                  <p className=\"text-xs text-gray-500\">ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªåº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“</p>\n                )}\n              </div>\n            </div>\n\n            <Button\n              onClick={() => window.history.back()}\n              variant=\"outline\"\n            >\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              æˆ»ã‚‹\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  // æ¨©é™ãƒã‚§ãƒƒã‚¯é€šéï¼šå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤º\n  return <>{children}</>\n}",
  "src/components/Auth/TermsAcceptanceModal.tsx": "import React, { useState } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { FileText, Shield, AlertCircle } from 'lucide-react'\nimport { useNavigate } from 'react-router-dom'\nimport { supabase } from '@/lib/supabase'\n\ninterface Props {\n  userId: string\n  onAccepted: () => void\n}\n\nconst TERMS_VERSION = '1.0'\nconst PRIVACY_VERSION = '1.0'\n\nexport const TermsAcceptanceModal: React.FC<Props> = ({ userId, onAccepted }) => {\n  const navigate = useNavigate()\n  const [termsChecked, setTermsChecked] = useState(false)\n  const [privacyChecked, setPrivacyChecked] = useState(false)\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const handleAccept = async () => {\n    if (!termsChecked || !privacyChecked) {\n      setError('åˆ©ç”¨è¦ç´„ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®ä¸¡æ–¹ã«åŒæ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™')\n      return\n    }\n\n    try {\n      setLoading(true)\n      setError(null)\n\n      const { error: rpcError } = await supabase.rpc('accept_terms_and_privacy', {\n        p_user_id: userId,\n        p_terms_version: TERMS_VERSION,\n        p_privacy_version: PRIVACY_VERSION\n      })\n\n      if (rpcError) {\n        console.error('Failed to record acceptance:', rpcError)\n        setError('åŒæ„ã®è¨˜éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚')\n        return\n      }\n\n      onAccepted()\n    } catch (err) {\n      console.error('Error accepting terms:', err)\n      setError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleLogout = async () => {\n    await supabase.auth.signOut()\n    navigate('/login')\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        <div className=\"sticky top-0 bg-white border-b border-slate-200 p-6\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center\">\n              <FileText className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-bold text-slate-900\">åˆ©ç”¨è¦ç´„ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã¸ã®åŒæ„</h2>\n              <p className=\"text-sm text-slate-600\">ã‚µãƒ¼ãƒ“ã‚¹ã®ã”åˆ©ç”¨ã«ã¯åŒæ„ãŒå¿…è¦ã§ã™</p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <div className=\"flex items-start gap-3\">\n              <AlertCircle className=\"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5\" />\n              <div className=\"text-sm text-blue-800\">\n                <p className=\"font-medium mb-1\">ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹å‰ã«</p>\n                <p>\n                  æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã”åˆ©ç”¨ã„ãŸã ãå‰ã«ã€åˆ©ç”¨è¦ç´„ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’å¿…ãšãŠèª­ã¿ã„ãŸã ãã€å†…å®¹ã‚’ã”ç†è§£ã®ä¸Šã§åŒæ„ã—ã¦ãã ã•ã„ã€‚\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"border border-slate-200 rounded-lg p-4 hover:border-blue-300 transition-colors\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"flex-shrink-0 mt-1\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"terms\"\n                    checked={termsChecked}\n                    onChange={(e) => setTermsChecked(e.target.checked)}\n                    className=\"w-5 h-5 text-blue-600 border-slate-300 rounded focus:ring-blue-500\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <label htmlFor=\"terms\" className=\"flex items-center gap-2 cursor-pointer\">\n                    <FileText className=\"w-5 h-5 text-slate-600\" />\n                    <span className=\"font-medium text-slate-900\">åˆ©ç”¨è¦ç´„</span>\n                  </label>\n                  <p className=\"text-sm text-slate-600 mt-1 mb-2\">\n                    æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨æ¡ä»¶ã€ç¦æ­¢äº‹é …ã€å…è²¬äº‹é …ãªã©ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚\n                  </p>\n                  <Button\n                    onClick={() => window.open('/terms', '_blank')}\n                    className=\"bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm\"\n                    size=\"sm\"\n                  >\n                    <FileText className=\"w-4 h-4 mr-2\" />\n                    åˆ©ç”¨è¦ç´„ã‚’èª­ã‚€\n                  </Button>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"border border-slate-200 rounded-lg p-4 hover:border-blue-300 transition-colors\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"flex-shrink-0 mt-1\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"privacy\"\n                    checked={privacyChecked}\n                    onChange={(e) => setPrivacyChecked(e.target.checked)}\n                    className=\"w-5 h-5 text-blue-600 border-slate-300 rounded focus:ring-blue-500\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <label htmlFor=\"privacy\" className=\"flex items-center gap-2 cursor-pointer\">\n                    <Shield className=\"w-5 h-5 text-slate-600\" />\n                    <span className=\"font-medium text-slate-900\">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</span>\n                  </label>\n                  <p className=\"text-sm text-slate-600 mt-1 mb-2\">\n                    å€‹äººæƒ…å ±ã®å–æ‰±ã„ã€åé›†ã™ã‚‹æƒ…å ±ã€åˆ©ç”¨ç›®çš„ãªã©ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚\n                  </p>\n                  <Button\n                    onClick={() => window.open('/privacy', '_blank')}\n                    className=\"bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm\"\n                    size=\"sm\"\n                  >\n                    <Shield className=\"w-4 h-4 mr-2\" />\n                    ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’èª­ã‚€\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n              <p className=\"text-sm text-red-800\">{error}</p>\n            </div>\n          )}\n\n          <div className=\"flex flex-col sm:flex-row gap-3\">\n            <Button\n              onClick={handleAccept}\n              disabled={!termsChecked || !privacyChecked || loading}\n              className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white disabled:bg-slate-300 disabled:text-slate-500\"\n            >\n              {loading ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                  å‡¦ç†ä¸­...\n                </>\n              ) : (\n                'åŒæ„ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹'\n              )}\n            </Button>\n            <Button\n              onClick={handleLogout}\n              disabled={loading}\n              className=\"sm:w-auto bg-slate-200 hover:bg-slate-300 text-slate-700\"\n            >\n              ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ\n            </Button>\n          </div>\n\n          <p className=\"text-xs text-slate-500 text-center\">\n            ãƒãƒ¼ã‚¸ãƒ§ãƒ³: åˆ©ç”¨è¦ç´„ {TERMS_VERSION} / ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ {PRIVACY_VERSION}\n          </p>\n        </div>\n      </div>\n    </div>\n  )\n}\n",
  "src/components/Charts/CalendarHeatmap.tsx": "import React, { useMemo } from 'react'\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'\nimport { DailyReportData } from '@/types'\nimport { formatCurrency } from '@/lib/format'\n\nexport const CalendarHeatmap: React.FC<{ reports: DailyReportData[] }> = ({ reports }) => {\n  const now = new Date()\n  const y = now.getFullYear()\n  const m = now.getMonth() // 0-11\n  const first = new Date(y, m, 1)\n  const last = new Date(y, m + 1, 0)\n  const daysInMonth = last.getDate()\n  const firstWeekDay = first.getDay() // 0 Sun\n\n  const salesByDay = useMemo(() => {\n    const map = new Map<number, number>()\n    reports.forEach(r => {\n      const d = new Date(r.date)\n      if (d.getFullYear() === y && d.getMonth() === m) {\n        const day = d.getDate()\n        map.set(day, (map.get(day) || 0) + r.sales)\n      }\n    })\n    return map\n  }, [reports, y, m])\n\n  const max = Math.max(1, ...Array.from(salesByDay.values()))\n\n  const cells: Array<{ day?: number; value?: number }> = []\n  for (let i = 0; i < firstWeekDay; i++) cells.push({})\n  for (let d = 1; d <= daysInMonth; d++) cells.push({ day: d, value: salesByDay.get(d) || 0 })\n\n  const color = (v: number) => {\n    const alpha = Math.min(1, (v / max) * 0.9 + 0.1)\n    return `rgba(59,130,246,${alpha})` // Tailwind blue-500 ã«è¿‘ã„\n  }\n\n  return (\n    <Card>\n      <CardHeader><CardTitle className=\"text-lg\">{now.toLocaleDateString('ja-JP',{year:'numeric',month:'long'})} å£²ä¸Šãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—</CardTitle></CardHeader>\n      <CardContent>\n        <div className=\"grid grid-cols-7 gap-1\">\n          {['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].map((w,i)=>(\n            <div key={i} className=\"text-xs text-muted-foreground text-center py-1\">{w}</div>\n          ))}\n          {cells.map((c, i) => (\n            <div\n              key={i}\n              className=\"h-16 rounded-md flex flex-col items-center justify-center text-xs p-1\"\n              style={{ backgroundColor: c.day ? color(c.value || 0) : 'transparent', color: c.day ? 'white' : 'inherit' }}\n              title={c.day ? `${c.day}æ—¥: ${formatCurrency(c.value || 0)}` : ''}\n            >\n              {c.day && (\n                <>\n                  <div className=\"font-medium\">{c.day}</div>\n                  <div className=\"text-xs font-mono leading-tight\">\n                    {c.value > 0 ? `Â¥${(c.value / 10000).toFixed(0)}ä¸‡` : '0'}\n                  </div>\n                </>\n              )}\n            </div>\n          ))}\n        </div>\n        <div className=\"flex items-center gap-2 mt-3 text-xs text-muted-foreground\">\n          <span>ä½</span>\n          <div className=\"h-3 flex-1 rounded\" style={{background:'linear-gradient(90deg, rgba(59,130,246,0.1), rgba(59,130,246,0.9))'}} />\n          <span>é«˜</span>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/Charts/ExpensePie.tsx": "import React from 'react'\nimport {\n  PieChart,\n  Pie,\n  Cell,\n  ResponsiveContainer,\n  Tooltip,\n  Legend\n} from 'recharts'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { formatCurrency } from '@/lib/format'\nimport { DailyReportData } from '@/types'\nimport { DailyExpenseReference } from '@/hooks/useExpenseBaseline'\n\ninterface ExpensePieProps {\n  reports: DailyReportData[]\n  period?: 'daily' | 'weekly' | 'monthly'\n  className?: string\n  title?: string\n  expenseBaseline?: DailyExpenseReference\n  daysCount?: number\n}\n\nconst COLORS = {\n  'ä»•å…¥': '#ef4444',        // red-500\n  'ãã®ä»–çµŒè²»': '#f59e0b',  // amber-500\n  'å–¶æ¥­åˆ©ç›Š': '#10b981'      // emerald-500 (green for profit)\n}\n\nexport const ExpensePie: React.FC<ExpensePieProps> = ({\n  reports,\n  period = 'daily',\n  className,\n  title,\n  expenseBaseline,\n  daysCount\n}) => {\n  const expenseData = React.useMemo(() => {\n    const totals = reports.reduce((acc, report) => ({\n      sales: acc.sales + report.sales,\n      purchase: acc.purchase + report.purchase,\n      laborCost: acc.laborCost + report.laborCost,\n      utilities: acc.utilities + report.utilities,\n      rent: acc.rent + (report.rent || 0),\n      consumables: acc.consumables + (report.consumables || 0),\n      promotion: acc.promotion + report.promotion,\n      cleaning: acc.cleaning + report.cleaning,\n      misc: acc.misc + report.misc,\n      communication: acc.communication + report.communication,\n      others: acc.others + report.others\n    }), {\n      sales: 0,\n      purchase: 0,\n      laborCost: 0,\n      utilities: 0,\n      rent: 0,\n      consumables: 0,\n      promotion: 0,\n      cleaning: 0,\n      misc: 0,\n      communication: 0,\n      others: 0\n    })\n\n    // å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹æ—¥æ•°ã‚’è¨ˆç®—ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ãªæ—¥ä»˜ã®æ•°ï¼‰\n    const uniqueDates = new Set(reports.map(r => r.date))\n    const actualDaysCount = uniqueDates.size\n\n    // ãã®ä»–çµŒè²»ã®åˆè¨ˆã‚’è¨ˆç®—\n    let otherExpenses = totals.laborCost + totals.utilities + totals.rent +\n                        totals.consumables + totals.promotion + totals.cleaning +\n                        totals.misc + totals.communication + totals.others\n\n    // å‚è€ƒçµŒè²»ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã‚Œã‚’ä½¿ç”¨ï¼ˆå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿æ—¥æ•°ã‚’å„ªå…ˆï¼‰\n    if (expenseBaseline && expenseBaseline.sumOther > 0) {\n      // å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹æ—¥æ•°åˆ†ã®å‚è€ƒçµŒè²»ã‚’è¨ˆç®—\n      const effectiveDays = actualDaysCount > 0 ? actualDaysCount : (daysCount || 0)\n      otherExpenses = expenseBaseline.sumOther * effectiveDays\n    }\n\n    // å–¶æ¥­åˆ©ç›Š = å£²ä¸Š - ä»•å…¥ - ãã®ä»–çµŒè²»\n    const operatingProfit = totals.sales - totals.purchase - otherExpenses\n\n    return [\n      { name: 'ä»•å…¥', value: totals.purchase },\n      { name: 'ãã®ä»–çµŒè²»', value: otherExpenses },\n      { name: 'å–¶æ¥­åˆ©ç›Š', value: operatingProfit > 0 ? operatingProfit : 0 }\n    ].filter(item => item.value > 0)\n  }, [reports, expenseBaseline, daysCount])\n\n  const total = expenseData.reduce((sum, item) => sum + item.value, 0)\n\n  const getTitle = () => {\n    if (title) return title\n    switch (period) {\n      case 'daily':\n        return 'çµŒè²»å†…è¨³ï¼ˆéå»7æ—¥é–“ï¼‰'\n      case 'weekly':\n        return 'çµŒè²»å†…è¨³ï¼ˆéå»30æ—¥é–“ï¼‰'\n      case 'monthly':\n        return 'çµŒè²»å†…è¨³ï¼ˆéå»3ãƒ¶æœˆï¼‰'\n      default:\n        return 'çµŒè²»å†…è¨³'\n    }\n  }\n\n  const totalSales = reports.reduce((sum, report) => sum + report.sales, 0)\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <CardTitle className=\"text-lg font-semibold\">\n          {getTitle()}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"mb-4 text-center\">\n          <div className=\"text-sm text-muted-foreground\">åˆè¨ˆå£²ä¸Š</div>\n          <div className=\"text-2xl font-bold text-blue-600\">{formatCurrency(totalSales)}</div>\n        </div>\n        <ResponsiveContainer width=\"100%\" height={300}>\n          <PieChart>\n            <Pie\n              data={expenseData}\n              dataKey=\"value\"\n              nameKey=\"name\"\n              cx=\"50%\"\n              cy=\"50%\"\n              outerRadius={80}\n              innerRadius={40}\n            >\n              {expenseData.map((entry, index) => (\n                <Cell key={`cell-${index}`} fill={COLORS[entry.name as keyof typeof COLORS] || '#6b7280'} />\n              ))}\n            </Pie>\n            <Tooltip\n              formatter={(value: number) => [\n                `${formatCurrency(value)} (${((value / total) * 100).toFixed(1)}%)`\n              ]}\n              contentStyle={{\n                backgroundColor: 'hsl(var(--card))',\n                border: '1px solid hsl(var(--border))',\n                borderRadius: '6px'\n              }}\n            />\n            <Legend\n              wrapperStyle={{ fontSize: '14px' }}\n              formatter={(value, entry) => {\n                const itemValue = entry.payload?.value || 0\n                const percentage = total > 0 ? ((itemValue / total) * 100).toFixed(1) : '0.0'\n                return `${value}: ${formatCurrency(itemValue)} (${percentage}%)`\n              }}\n            />\n          </PieChart>\n        </ResponsiveContainer>\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/Charts/KpiBullets.tsx": "import React from 'react'\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'\nimport { Progress } from '@/components/ui/progress'\nimport { formatCurrency, formatPercent } from '@/lib/format'\n\ntype Item = {\n  label: string\n  actual: number\n  target: number\n  format: 'currency' | 'percent'\n}\nexport const KpiBullets: React.FC<{ items: Item[] }> = ({ items }) => {\n  return (\n    <Card>\n      <CardHeader><CardTitle className=\"text-lg\">ç›®æ¨™é€²æ—ï¼ˆãƒãƒ¬ãƒƒãƒˆï¼‰</CardTitle></CardHeader>\n      <CardContent className=\"space-y-4\">\n        {items.map((it, i) => {\n          const ratio = it.target > 0 ? Math.min(100, (it.actual / it.target) * 100) : 0\n          const fmt = (n: number) => it.format === 'currency' ? formatCurrency(n) : formatPercent(n)\n          const tone =\n            ratio >= 100 ? 'text-green-600' :\n            ratio >= 80  ? 'text-yellow-600' : 'text-red-600'\n          return (\n            <div key={i} className=\"space-y-1\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">{it.label}</span>\n                <span className={`font-medium ${tone}`}>{fmt(it.actual)} / ç›®æ¨™ {fmt(it.target)}</span>\n              </div>\n              <Progress value={ratio} />\n            </div>\n          )\n        })}\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/Charts/ProfitWaterfall.tsx": "import React, { useMemo } from 'react'\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'\nimport { ResponsiveContainer, ComposedChart, XAxis, YAxis, Tooltip, Bar, CartesianGrid, LabelList } from 'recharts'\nimport { DailyReportData } from '@/types'\nimport { formatCurrency } from '@/lib/format'\nimport { DailyExpenseReference } from '@/hooks/useExpenseBaseline'\n\nexport const ProfitWaterfall: React.FC<{\n  reports: DailyReportData[]\n  expenseBaseline?: DailyExpenseReference\n  adjustedLaborCost?: number\n}> = ({ reports, expenseBaseline, adjustedLaborCost }) => {\n  const totals = useMemo(() => {\n    const actualTotals = reports.reduce((a, r) => {\n      a.sales += r.sales\n      a.purchase += r.purchase\n      a.labor += r.laborCost\n      a.utilities += r.utilities\n      a.rent += r.rent || 0\n      a.consumables += r.consumables || 0\n      a.promotion += r.promotion\n      a.cleaning += r.cleaning\n      a.misc += r.misc\n      a.communication += r.communication\n      a.others += r.others\n      return a\n    },{\n      sales:0, purchase:0, labor:0, utilities:0, rent:0, consumables:0, promotion:0, cleaning:0, misc:0, communication:0, others:0\n    })\n\n    // èª¿æ•´æ¸ˆã¿äººä»¶è²»ãŒã‚ã‚‹å ´åˆã¯ä½¿ç”¨\n    if (adjustedLaborCost !== undefined && adjustedLaborCost > 0) {\n      actualTotals.labor = adjustedLaborCost\n    }\n\n    // å‚è€ƒçµŒè²»ãŒã‚ã‚‹å ´åˆã€å®Ÿéš›ã®çµŒè²»ãŒã‚¼ãƒ­ã®é …ç›®ã¯å‚è€ƒçµŒè²»ã‚’ä½¿ç”¨\n    if (expenseBaseline) {\n      const daysCount = reports.length\n      if (actualTotals.utilities === 0) actualTotals.utilities = expenseBaseline.utilities * daysCount\n      if (actualTotals.rent === 0) actualTotals.rent = expenseBaseline.rent * daysCount\n      if (actualTotals.consumables === 0) actualTotals.consumables = expenseBaseline.consumables * daysCount\n      if (actualTotals.promotion === 0) actualTotals.promotion = expenseBaseline.promotion * daysCount\n      if (actualTotals.cleaning === 0) actualTotals.cleaning = expenseBaseline.cleaning * daysCount\n      if (actualTotals.misc === 0) actualTotals.misc = expenseBaseline.misc * daysCount\n      if (actualTotals.communication === 0) actualTotals.communication = expenseBaseline.communication * daysCount\n      if (actualTotals.others === 0) actualTotals.others = expenseBaseline.others * daysCount\n    }\n\n    return actualTotals\n  }, [reports, expenseBaseline, adjustedLaborCost])\n\n  // ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«ç”¨ãƒ‡ãƒ¼ã‚¿ä½œæˆ\n  const steps = [\n    { name: 'å£²ä¸Š', value: totals.sales },\n    { name: 'ä»•å…¥', value: -totals.purchase },\n    { name: 'äººä»¶è²»', value: -totals.labor },\n    { name: 'å…‰ç†±è²»', value: -totals.utilities },\n    { name: 'å®¶è³ƒ', value: -totals.rent },\n    { name: 'æ¶ˆè€—å“è²»', value: -totals.consumables },\n    { name: 'è²©ä¿ƒè²»', value: -totals.promotion },\n    { name: 'æ¸…æƒè²»', value: -totals.cleaning },\n    { name: 'é›‘è²»', value: -totals.misc },\n    { name: 'é€šä¿¡è²»', value: -totals.communication },\n    { name: 'ãã®ä»–', value: -totals.others },\n  ]\n  let running = 0\n  const data = steps.map(s => {\n    const base = Math.max(0, running) // è¦‹ãŸç›®ã‚’æ•´ãˆã‚‹ãŸã‚ç°¡æ˜“ã‚ªãƒ•ã‚»ãƒƒãƒˆ\n    running += s.value\n    return { name: s.name, base, delta: s.value }\n  })\n  const operatingProfit = running\n\n  // æœ€çµ‚ã€Œå–¶æ¥­åˆ©ç›Šã€\n  data.push({ name: 'å–¶æ¥­åˆ©ç›Š', base: Math.min(data[data.length-1].base + data[data.length-1].delta, 0), delta: operatingProfit })\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-lg\">æç›Šã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«</CardTitle>\n        <div className=\"text-sm text-muted-foreground\">\n          {new Date().toLocaleDateString('ja-JP', { \n            year: 'numeric', \n            month: 'long', \n            day: 'numeric',\n            weekday: 'short'\n          })} ç¾åœ¨\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"overflow-x-auto -mx-2 px-2\">\n          <div className=\"min-w-[600px]\">\n            <ResponsiveContainer width=\"100%\" height={320}>\n              <ComposedChart data={data}>\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                <XAxis\n                  dataKey=\"name\"\n                  className=\"text-xs\"\n                  angle={-45}\n                  textAnchor=\"end\"\n                  height={80}\n                  interval={0}\n                />\n                <YAxis tickFormatter={(v)=>`Â¥${(v/10000).toFixed(0)}ä¸‡`} className=\"text-xs\" />\n                <Tooltip\n                  formatter={(v: number, key) => [formatCurrency(key === 'delta' ? v as number : 0), key === 'delta' ? 'é‡‘é¡' : '']}\n                  labelFormatter={(l) => l}\n                  contentStyle={{ background:'hsl(var(--card))', border:'1px solid hsl(var(--border))', borderRadius:6 }}\n                />\n                {/* base: é€æ˜ã‚ªãƒ•ã‚»ãƒƒãƒˆ */}\n                <Bar dataKey=\"base\" stackId=\"a\" fill=\"transparent\" />\n                {/* delta: å®Ÿãƒãƒ¼ */}\n                <Bar dataKey=\"delta\" stackId=\"a\" fill=\"hsl(var(--primary))\">\n                  <LabelList dataKey=\"delta\" position=\"top\" formatter={(v: number)=> (v>=0?'+':'') + (v/10000).toFixed(0) + 'ä¸‡'} className=\"text-xs\" />\n                </Bar>\n              </ComposedChart>\n            </ResponsiveContainer>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/Charts/SalesChart.tsx": "import React from 'react'\nimport {\n  AreaChart,\n  Area,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  ReferenceLine\n} from 'recharts'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs'\nimport { formatCurrency, formatDate } from '@/lib/format'\nimport { DailyReportData } from '@/types'\nimport { DailyExpenseReference } from '@/hooks/useExpenseBaseline'\n\ninterface SalesChartProps {\n  reports: DailyReportData[]\n  period: 'daily' | 'weekly' | 'monthly'\n  onPeriodChange?: (period: 'daily' | 'weekly' | 'monthly') => void\n  targetSales?: number\n  className?: string\n  /** è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ç‚¹ã®æœ€å¤§æ•°ï¼ˆä¾‹ï¼šæœˆæ¬¡=12, é€±æ¬¡=26, æ—¥æ¬¡=30 ãªã©ï¼‰ */\n  maxPoints?: number\n  onDataPointClick?: (period: string) => void\n  expenseBaseline?: DailyExpenseReference\n}\n\nexport const SalesChart: React.FC<SalesChartProps> = ({\n  reports,\n  period,\n  onPeriodChange,\n  targetSales,\n  className,\n  maxPoints,\n  onDataPointClick,\n  expenseBaseline\n}) => {\n  // Process data for chart\n  const chartData = React.useMemo(() => {\n    const groupedData = new Map<string, {\n      date: string\n      sales: number\n      profit: number\n      purchase: number\n      count: number\n    }>()\n\n    reports.forEach(report => {\n      const date = new Date(report.date)\n      let key: string\n\n      switch (period) {\n        case 'daily':\n          key = report.date\n          break\n        case 'weekly':\n          const weekStart = new Date(date)\n          const dow = (date.getDay() + 6) % 7 // æœˆæ›œ=0\n          weekStart.setDate(date.getDate() - dow)\n          key = weekStart.toISOString().split('T')[0]\n          break\n        case 'monthly':\n          key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`\n          break\n      }\n\n      if (!groupedData.has(key)) {\n        groupedData.set(key, { date: key, sales: 0, profit: 0, purchase: 0, count: 0 })\n      }\n\n      const data = groupedData.get(key)!\n\n      data.sales += report.sales\n      data.purchase += report.purchase\n      data.count += 1\n    })\n\n    // å‚è€ƒçµŒè²»ã‚’ä½¿ç”¨ã—ã¦å–¶æ¥­åˆ©ç›Šã‚’è¨ˆç®—\n    const sorted = Array.from(groupedData.values()).map(data => {\n      let otherExpenses = 0\n\n      // å‚è€ƒçµŒè²»ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹å ´åˆ\n      if (expenseBaseline && expenseBaseline.sumOther > 0) {\n        // æ—¥æ¬¡ã®å ´åˆ: ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®æ—¥æ•°åˆ†ã®å‚è€ƒçµŒè²»\n        otherExpenses = expenseBaseline.sumOther * data.count\n      }\n\n      // å–¶æ¥­åˆ©ç›Š = å£²ä¸Š - ä»•å…¥ - ãã®ä»–çµŒè²»\n      const profit = data.sales - data.purchase - otherExpenses\n\n      return {\n        ...data,\n        profit\n      }\n    }).sort((a, b) => a.date.localeCompare(b.date))\n\n    const limit = maxPoints ?? (period === 'monthly' ? 12 : period === 'weekly' ? 26 : 30)\n    return sorted.slice(-limit)\n  }, [reports, period, expenseBaseline])\n\n  const formatXAxisLabel = (dateStr: string) => {\n    const date = new Date(dateStr)\n    switch (period) {\n      case 'daily':\n        return date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })\n      case 'weekly':\n        return `${date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })}é€±`\n      case 'monthly':\n        return date.toLocaleDateString('ja-JP', { year: '2-digit', month: 'short' })\n      default:\n        return dateStr\n    }\n  }\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg font-semibold\">\n            å£²ä¸Šæ¨ç§»\n          </CardTitle>\n          {onPeriodChange && (\n            <Tabs value={period} onValueChange={onPeriodChange as any}>\n              <TabsList>\n                <TabsTrigger value=\"daily\">æ—¥æ¬¡</TabsTrigger>\n                <TabsTrigger value=\"weekly\">é€±æ¬¡</TabsTrigger>\n                <TabsTrigger value=\"monthly\">æœˆæ¬¡</TabsTrigger>\n              </TabsList>\n            </Tabs>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"overflow-x-auto -mx-2 px-2\">\n          <div className=\"min-w-[500px]\">\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <AreaChart data={chartData}>\n                <defs>\n                  <linearGradient id=\"salesGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                    <stop offset=\"5%\" stopColor=\"#6366f1\" stopOpacity={0.3} />\n                    <stop offset=\"95%\" stopColor=\"#6366f1\" stopOpacity={0} />\n                  </linearGradient>\n                  <linearGradient id=\"profitGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                    <stop offset=\"5%\" stopColor=\"#10b981\" stopOpacity={0.3} />\n                    <stop offset=\"95%\" stopColor=\"#10b981\" stopOpacity={0} />\n                  </linearGradient>\n                </defs>\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                <XAxis\n                  dataKey=\"date\"\n                  tickFormatter={formatXAxisLabel}\n                  className=\"text-muted-foreground text-xs\"\n                  angle={-45}\n                  textAnchor=\"end\"\n                  height={60}\n                  interval={0}\n                />\n                <YAxis\n                  tickFormatter={(value) => `Â¥${(value / 10000).toFixed(0)}ä¸‡`}\n                  className=\"text-muted-foreground text-xs\"\n                />\n                <Tooltip\n                  formatter={(value: number, name: string) => [\n                    formatCurrency(value),\n                    name === 'sales' ? 'å£²ä¸Š' : 'å–¶æ¥­åˆ©ç›Š'\n                  ]}\n                  labelFormatter={formatXAxisLabel}\n                  contentStyle={{\n                    backgroundColor: 'hsl(var(--card))',\n                    border: '1px solid hsl(var(--border))',\n                    borderRadius: '6px'\n                  }}\n                />\n                {targetSales && (\n                  <ReferenceLine\n                    y={targetSales}\n                    stroke=\"hsl(var(--ring))\"\n                    strokeDasharray=\"4 4\"\n                    label=\"ç›®æ¨™\"\n                  />\n                )}\n                <Area\n                  type=\"monotone\"\n                  dataKey=\"sales\"\n                  stroke=\"#6366f1\"\n                  fill=\"url(#salesGradient)\"\n                  strokeWidth={2}\n                  onClick={(data: any) => {\n                    if (onDataPointClick && data?.payload) {\n                      onDataPointClick(data.payload.date)\n                    }\n                  }}\n                  style={{ cursor: onDataPointClick ? 'pointer' : 'default' }}\n                />\n                <Area\n                  type=\"monotone\"\n                  dataKey=\"profit\"\n                  stroke=\"#10b981\"\n                  fill=\"url(#profitGradient)\"\n                  strokeWidth={2}\n                  onClick={(data: any) => {\n                    if (onDataPointClick && data?.payload) {\n                      onDataPointClick(data.payload.date)\n                    }\n                  }}\n                  style={{ cursor: onDataPointClick ? 'pointer' : 'default' }}\n                />\n              </AreaChart>\n            </ResponsiveContainer>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/data/DataTable.tsx": "import React, { useMemo } from 'react'\nimport {\n  useReactTable,\n  getCoreRowModel,\n  getSortedRowModel,\n  getPaginationRowModel,\n  ColumnDef,\n  flexRender,\n  SortingState\n} from '@tanstack/react-table'\nimport { ArrowUpDown, ArrowUp, ArrowDown, ChevronLeft, ChevronRight, Trophy, Target } from 'lucide-react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { formatCurrency, formatPercent, formatDate } from '@/lib/format'\nimport { DailyReportData } from '@/types'\nimport { ExpenseBaselineDb } from '@/services/supabase'\n\ninterface DataTableProps {\n  reports: DailyReportData[]\n  period: 'daily' | 'weekly' | 'monthly'\n  groupByStore?: boolean\n  className?: string\n  onPeriodClick?: (period: string) => void\n  dailyTargets?: Record<string, number>\n  baselineMap?: Map<string, ExpenseBaselineDb>\n}\n\ninterface ProcessedRow {\n  period: string\n  rawPeriodKey: string\n  storeName: string\n  sales: number\n  purchase: number\n  laborCost: number\n  otherExpenses: number\n  expenses: number\n  grossProfit: number\n  operatingProfit: number\n  profitMargin: number\n  reportCount: number\n  targetSales?: number\n  achievementRate?: number\n  isAchieved?: boolean\n}\n\n// âœ… React.memo ã§ãƒ©ãƒƒãƒ—ã—ã¦ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ã‚’é˜²ã\nconst DataTableImpl: React.FC<DataTableProps> = ({\n  reports,\n  period,\n  groupByStore = true,\n  className,\n  onPeriodClick,\n  dailyTargets = {},\n  baselineMap = new Map()\n}) => {\n  const [sorting, setSorting] = React.useState<SortingState>([])\n\n  const handleExportCsv = () => {\n    const headers = ['æœŸé–“','åº—èˆ—å','å£²ä¸Š','ç›®æ¨™é”æˆ','é”æˆç‡','å·®é¡','ä»•å…¥','äººä»¶è²»','ãã®ä»–çµŒè²»','ç²—åˆ©ç›Š','å–¶æ¥­åˆ©ç›Š','åˆ©ç›Šç‡','å ±å‘Šæ•°']\n    const rows = processedData.map(r => [\n      r.period,\n      r.storeName,\n      r.sales,\n      r.isAchieved !== undefined ? (r.isAchieved ? 'é”æˆ' : 'æœªé”æˆ') : 'ç›®æ¨™æœªè¨­å®š',\n      r.achievementRate !== undefined ? r.achievementRate.toFixed(1) + '%' : '-',\n      r.targetSales !== undefined ? (r.sales - r.targetSales) : '-',\n      r.purchase,\n      r.laborCost,\n      r.otherExpenses,\n      r.grossProfit,\n      r.operatingProfit,\n      r.profitMargin.toFixed(1),\n      r.reportCount\n    ])\n    const csv = [headers, ...rows].map(cols => \n      cols.map(String).map(s => `\"${s.replace(/\"/g, '\"\"')}\"`).join(',')\n    ).join('\\n')\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' })\n    const url = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = `reports_${period}_${new Date().toISOString().split('T')[0]}.csv`\n    a.click()\n    URL.revokeObjectURL(url)\n  }\n\n  // Process data for table\n  const processedData = React.useMemo((): ProcessedRow[] => {\n    const groupedData = new Map<string, {\n      period: string\n      storeName: string\n      sales: number\n      purchase: number\n      laborCost: number\n      otherExpenses: number\n      count: number\n    }>()\n\n    // âœ… ãƒ­ã‚°ã‚’æœ€å°é™ã«\n    // console.log('ğŸ“Š DataTable: Processing data', {\n    //   totalReports: reports.length,\n    //   period,\n    //   groupByStore\n    // })\n\n    reports.forEach(report => {\n      const date = new Date(report.date)\n      let key: string\n      let rawKey: string\n      let displayPeriod: string\n\n      switch (period) {\n        case 'daily':\n          key = groupByStore ? `${report.date}-${report.storeId}` : report.date\n          rawKey = report.date\n          displayPeriod = formatDate(date)\n          break\n        case 'weekly':\n          const weekStart = new Date(date)\n          const dow = (date.getDay() + 6) % 7\n          weekStart.setDate(date.getDate() - dow)\n          key = groupByStore ? `${weekStart.toISOString().split('T')[0]}-${report.storeId}` : weekStart.toISOString().split('T')[0]\n          rawKey = weekStart.toISOString().split('T')[0]\n          displayPeriod = `${formatDate(weekStart)}é€±`\n          break\n        case 'monthly':\n          key = groupByStore ? `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${report.storeId}` : `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`\n          rawKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`\n          displayPeriod = date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' })\n          break\n      }\n\n      if (!groupedData.has(key)) {\n        groupedData.set(key, {\n          period: displayPeriod,\n          rawPeriodKey: rawKey,\n          storeName: reports.length > 0 && reports.every(r => r.storeId === reports[0].storeId)\n            ? reports[0].storeName\n            : (groupByStore ? report.storeName : 'å…¨åº—èˆ—åˆè¨ˆ'),\n          sales: 0,\n          purchase: 0,\n          laborCost: 0,\n          otherExpenses: 0,\n          count: 0\n        })\n      }\n\n      const data = groupedData.get(key)!\n\n      // äººä»¶è²»ã¨ãã®ä»–çµŒè²»ã‚’å€‹åˆ¥ã«é›†è¨ˆ\n      let laborCost = report.laborCost || 0\n      let otherExpenses = (report.utilities || 0) + (report.rent || 0) + (report.consumables || 0) +\n                           (report.promotion || 0) + (report.cleaning || 0) + (report.misc || 0) +\n                           (report.communication || 0) + (report.others || 0)\n\n      // ãã®ä»–çµŒè²»ãŒ0ã®å ´åˆã¯å‚è€ƒçµŒè²»ã‚’ä½¿ç”¨ï¼ˆæœˆæ¬¡ç®¡ç†ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œï¼‰\n      if (laborCost === 0 && otherExpenses === 0) {\n        const yyyymm = report.date.slice(0, 7)\n        const baselineKey = `${report.storeId}-${yyyymm}`\n        const baseline = baselineMap.get(baselineKey)\n\n        if (baseline) {\n          const [year, month] = yyyymm.split('-').map(Number)\n          const daysInMonth = new Date(year, month, 0).getDate()\n          const openDays = baseline.open_days || daysInMonth\n          const perDay = (value: number) => Math.round(value / Math.max(openDays, 1))\n\n          laborCost = perDay((baseline.labor_cost_employee || 0) + (baseline.labor_cost_part_time || 0))\n          otherExpenses = perDay((baseline.utilities || 0) + (baseline.rent || 0) +\n            (baseline.consumables || 0) + (baseline.promotion || 0) + (baseline.cleaning || 0) +\n            (baseline.misc || 0) + (baseline.communication || 0) + (baseline.others || 0))\n        }\n      }\n\n      data.sales += report.sales\n      data.purchase += Number(report.purchase) || 0\n      data.laborCost += Number(laborCost) || 0\n      data.otherExpenses += Number(otherExpenses) || 0\n      data.count += 1\n    })\n\n    return Array.from(groupedData.values()).map(item => {\n      const sales = Number(item.sales) || 0\n      const purchase = Number(item.purchase) || 0\n      const laborCost = Number(item.laborCost) || 0\n      const otherExpenses = Number(item.otherExpenses) || 0\n      const expenses = purchase + laborCost + otherExpenses\n      const grossProfit = sales - purchase\n      const operatingProfit = sales - expenses\n      const profitMargin = sales > 0 ? (operatingProfit / sales) * 100 : 0\n\n      const targetSales = dailyTargets[item.rawPeriodKey]\n      const achievementRate = targetSales ? (sales / targetSales) * 100 : undefined\n      const isAchieved = targetSales ? sales >= targetSales : undefined\n\n      return {\n        period: item.period,\n        rawPeriodKey: item.rawPeriodKey,\n        storeName: item.storeName,\n        sales,\n        purchase,\n        laborCost,\n        otherExpenses,\n        expenses,\n        grossProfit,\n        operatingProfit,\n        profitMargin,\n        reportCount: item.count,\n        targetSales,\n        achievementRate,\n        isAchieved\n      }\n    })\n  }, [reports, period, groupByStore, baselineMap, dailyTargets])\n\n  // âœ… columns ã‚’ãƒ¡ãƒ¢åŒ–ï¼ˆå†ãƒ¬ãƒ³ãƒ€ã‚’é˜²ãï¼‰\n  const columns = useMemo((): ColumnDef<ProcessedRow>[] => [\n    {\n      accessorKey: 'period',\n      header: ({ column }) => {\n        return (\n          <Button\n            variant=\"ghost\"\n            onClick={() => column.toggleSorting(column.getIsSorted() === \"asc\")}\n            className=\"h-auto p-0 font-medium\"\n          >\n            æœŸé–“\n            {column.getIsSorted() === \"asc\" ? (\n              <ArrowUp className=\"ml-2 h-4 w-4\" />\n            ) : column.getIsSorted() === \"desc\" ? (\n              <ArrowDown className=\"ml-2 h-4 w-4\" />\n            ) : (\n              <ArrowUpDown className=\"ml-2 h-4 w-4\" />\n            )}\n          </Button>\n        )\n      },\n      cell: ({ row }) => (\n        <div\n          className={`font-medium ${\n            onPeriodClick ? 'text-primary cursor-pointer hover:underline' : ''\n          }`}\n          onClick={() => {\n            if (onPeriodClick) {\n              onPeriodClick(row.original.rawPeriodKey)\n            }\n          }}\n        >\n          {row.getValue('period')}\n        </div>\n      )\n    },\n    {\n      accessorKey: 'storeName',\n      header: 'åº—èˆ—å',\n      cell: ({ row }) => (\n        <div className=\"font-medium\">\n          {row.getValue('storeName')}\n        </div>\n      )\n    },\n    {\n      accessorKey: 'sales',\n      header: ({ column }) => {\n        return (\n          <Button\n            variant=\"ghost\"\n            onClick={() => column.toggleSorting(column.getIsSorted() === \"asc\")}\n            className=\"h-auto p-0 font-medium\"\n          >\n            å£²ä¸Š\n            {column.getIsSorted() === \"asc\" ? (\n              <ArrowUp className=\"ml-2 h-4 w-4\" />\n            ) : column.getIsSorted() === \"desc\" ? (\n              <ArrowDown className=\"ml-2 h-4 w-4\" />\n            ) : (\n              <ArrowUpDown className=\"ml-2 h-4 w-4\" />\n            )}\n          </Button>\n        )\n      },\n      cell: ({ row }) => (\n        <div className=\"text-right font-medium text-blue-600\">\n          {formatCurrency(row.getValue('sales'))}\n        </div>\n      )\n    },\n    {\n      accessorKey: 'isAchieved',\n      header: ({ column }) => {\n        return (\n          <Button\n            variant=\"ghost\"\n            onClick={() => column.toggleSorting(column.getIsSorted() === \"asc\")}\n            className=\"h-auto p-0 font-medium\"\n          >\n            ç›®æ¨™é”æˆ\n            {column.getIsSorted() === \"asc\" ? (\n              <ArrowUp className=\"ml-2 h-4 w-4\" />\n            ) : column.getIsSorted() === \"desc\" ? (\n              <ArrowDown className=\"ml-2 h-4 w-4\" />\n            ) : (\n              <ArrowUpDown className=\"ml-2 h-4 w-4\" />\n            )}\n          </Button>\n        )\n      },\n      cell: ({ row }) => {\n        const isAchieved = row.original.isAchieved\n        const achievementRate = row.original.achievementRate\n        const targetSales = row.original.targetSales\n        const sales = row.original.sales\n\n        if (targetSales === undefined) {\n          return (\n            <div className=\"text-center text-xs text-muted-foreground\">\n              ç›®æ¨™æœªè¨­å®š\n            </div>\n          )\n        }\n\n        const difference = sales - targetSales\n\n        return (\n          <div className=\"space-y-1\">\n            <div className=\"flex items-center justify-center gap-2\">\n              <Badge\n                variant={isAchieved ? \"default\" : \"destructive\"}\n                className={`text-xs font-bold ${isAchieved ? 'bg-green-600 hover:bg-green-700' : ''}`}\n              >\n                {isAchieved ? (\n                  <>\n                    <Trophy className=\"h-3 w-3 mr-1\" />\n                    é”æˆ\n                  </>\n                ) : (\n                  <>\n                    <Target className=\"h-3 w-3 mr-1\" />\n                    æœªé”æˆ\n                  </>\n                )}\n              </Badge>\n            </div>\n            <div className=\"text-xs text-center text-muted-foreground\">\n              {formatPercent(achievementRate || 0)}\n            </div>\n            <div className={`text-xs text-center font-medium ${\n              isAchieved ? 'text-green-600' : 'text-red-600'\n            }`}>\n              {isAchieved ? '+' : ''}{formatCurrency(difference)}\n            </div>\n          </div>\n        )\n      }\n    },\n    {\n      accessorKey: 'purchase',\n      header: 'ä»•å…¥',\n      cell: ({ row }) => (\n        <div className=\"text-right font-medium text-red-600\">\n          {formatCurrency(Number(row.getValue('purchase')) || 0)}\n        </div>\n      )\n    },\n    {\n      accessorKey: 'laborCost',\n      header: 'äººä»¶è²»',\n      cell: ({ row }) => (\n        <div className=\"text-right font-medium text-orange-600\">\n          {formatCurrency(Number(row.getValue('laborCost')) || 0)}\n        </div>\n      )\n    },\n    {\n      accessorKey: 'otherExpenses',\n      header: 'ãã®ä»–çµŒè²»',\n      cell: ({ row }) => (\n        <div className=\"text-right font-medium text-gray-600\">\n          {formatCurrency(Number(row.getValue('otherExpenses')) || 0)}\n        </div>\n      )\n    },\n    {\n      accessorKey: 'grossProfit',\n      header: 'ç²—åˆ©ç›Š',\n      cell: ({ row }) => {\n        const value = row.getValue('grossProfit') as number\n        return (\n          <div className={`text-right font-medium ${\n            value >= 0 ? 'text-green-600' : 'text-red-600'\n          }`}>\n            {formatCurrency(value)}\n          </div>\n        )\n      }\n    },\n    {\n      accessorKey: 'operatingProfit',\n      header: ({ column }) => {\n        return (\n          <Button\n            variant=\"ghost\"\n            onClick={() => column.toggleSorting(column.getIsSorted() === \"asc\")}\n            className=\"h-auto p-0 font-medium\"\n          >\n            å–¶æ¥­åˆ©ç›Š\n            {column.getIsSorted() === \"asc\" ? (\n              <ArrowUp className=\"ml-2 h-4 w-4\" />\n            ) : column.getIsSorted() === \"desc\" ? (\n              <ArrowDown className=\"ml-2 h-4 w-4\" />\n            ) : (\n              <ArrowUpDown className=\"ml-2 h-4 w-4\" />\n            )}\n          </Button>\n        )\n      },\n      cell: ({ row }) => {\n        const value = row.getValue('operatingProfit') as number\n        return (\n          <div className={`text-right font-medium ${\n            value >= 0 ? 'text-green-600' : 'text-red-600'\n          }`}>\n            {formatCurrency(value)}\n          </div>\n        )\n      }\n    },\n    {\n      accessorKey: 'profitMargin',\n      header: 'åˆ©ç›Šç‡',\n      cell: ({ row }) => {\n        const value = row.getValue('profitMargin') as number\n        return (\n          <div className=\"text-right\">\n            <Badge \n              variant={value >= 15 ? 'default' : value >= 10 ? 'secondary' : 'destructive'}\n              className=\"text-xs\"\n            >\n              {formatPercent(value)}\n            </Badge>\n          </div>\n        )\n      }\n    },\n    {\n      accessorKey: 'reportCount',\n      header: 'å ±å‘Šæ•°',\n      cell: ({ row }) => (\n        <div className=\"text-right text-muted-foreground\">\n          {row.getValue('reportCount')}ä»¶\n        </div>\n      )\n    }\n  ], [onPeriodClick]) // âœ… onPeriodClick ãŒå¤‰ã‚ã£ãŸã¨ãã®ã¿å†ç”Ÿæˆ\n\n  const table = useReactTable({\n    data: processedData,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    getPaginationRowModel: getPaginationRowModel(),\n    onSortingChange: setSorting,\n    state: {\n      sorting,\n    },\n    initialState: {\n      pagination: {\n        pageSize: 7,\n      },\n    },\n  })\n\n  return (\n    <Card className={className}>\n      <CardHeader className=\"px-3 sm:px-6 py-3 sm:py-6\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <CardTitle className=\"text-base sm:text-lg font-semibold truncate\">\n            è©³ç´°ãƒ‡ãƒ¼ã‚¿\n          </CardTitle>\n          <Button variant=\"outline\" size=\"sm\" onClick={handleExportCsv} className=\"flex-shrink-0 text-xs sm:text-sm\">\n            <span className=\"hidden sm:inline\">CSV</span>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"px-2 sm:px-6 pb-3 sm:pb-6\">\n        <div className=\"rounded-md border\">\n          <div className=\"overflow-x-auto -mx-2 sm:mx-0\">\n            <table className=\"w-full min-w-[800px]\">\n              <thead>\n                {table.getHeaderGroups().map((headerGroup) => (\n                  <tr key={headerGroup.id} className=\"border-b border-border\">\n                    {headerGroup.headers.map((header) => (\n                      <th key={header.id} className=\"h-10 sm:h-12 px-2 sm:px-4 text-left align-middle font-medium text-muted-foreground text-xs sm:text-sm\">\n                        {header.isPlaceholder\n                          ? null\n                          : flexRender(\n                              header.column.columnDef.header,\n                              header.getContext()\n                            )}\n                      </th>\n                    ))}\n                  </tr>\n                ))}\n              </thead>\n              <tbody>\n                {table.getRowModel().rows?.length ? (\n                  table.getRowModel().rows.map((row) => (\n                    <tr\n                      key={row.id}\n                      className=\"border-b border-border hover:bg-muted/50 transition-colors\"\n                    >\n                      {row.getVisibleCells().map((cell) => (\n                        <td key={cell.id} className=\"p-2 sm:p-4 align-middle text-xs sm:text-sm\">\n                          {flexRender(cell.column.columnDef.cell, cell.getContext())}\n                        </td>\n                      ))}\n                    </tr>\n                  ))\n                ) : (\n                  <tr>\n                    <td colSpan={columns.length} className=\"h-24 text-center\">\n                      ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </div>\n        \n        {/* Pagination */}\n        <div className=\"flex flex-col sm:flex-row items-center justify-between pt-4 gap-2\">\n          <div className=\"text-xs sm:text-sm text-muted-foreground\">\n            {table.getFilteredRowModel().rows.length} ä»¶ä¸­{' '}\n            {table.getState().pagination.pageIndex * table.getState().pagination.pageSize + 1}-\n            {Math.min(\n              (table.getState().pagination.pageIndex + 1) * table.getState().pagination.pageSize,\n              table.getFilteredRowModel().rows.length\n            )} ä»¶ã‚’è¡¨ç¤º\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => table.previousPage()}\n              disabled={!table.getCanPreviousPage()}\n              className=\"text-xs sm:text-sm\"\n            >\n              <ChevronLeft className=\"h-3 w-3 sm:h-4 sm:w-4\" />\n              <span className=\"hidden sm:inline\">å‰ã¸</span>\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => table.nextPage()}\n              disabled={!table.getCanNextPage()}\n              className=\"text-xs sm:text-sm\"\n            >\n              <span className=\"hidden sm:inline\">æ¬¡ã¸</span>\n              <ChevronRight className=\"h-3 w-3 sm:h-4 sm:w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n\n// âœ… React.memo ã§ãƒ©ãƒƒãƒ—ã—ã¦ props ãŒå®‰å®šã—ã¦ã„ã‚‹é™ã‚Šå†ãƒ¬ãƒ³ãƒ€ã‚’é˜²ã\nexport const DataTable = React.memo(DataTableImpl)",
  "src/components/Layout/Footer.tsx": "import React from 'react'\nimport { Link } from 'react-router-dom'\nimport { FileText, Shield, Mail } from 'lucide-react'\n\nexport const Footer: React.FC = () => {\n  const currentYear = new Date().getFullYear()\n\n  return (\n    <footer className=\"bg-slate-900 text-slate-300 mt-auto\">\n      <div className=\"max-w-7xl mx-auto px-4 py-8\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n          <div>\n            <h3 className=\"text-white font-bold text-lg mb-4\">AIçµŒå–¶ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h3>\n            <p className=\"text-sm text-slate-400\">\n              é£²é£Ÿåº—ã®çµŒå–¶ã‚’æ”¯æ´ã™ã‚‹ç·åˆçš„ãªåˆ†æãƒ„ãƒ¼ãƒ«\n            </p>\n          </div>\n\n          <div>\n            <h4 className=\"text-white font-semibold mb-4\">æ³•çš„æƒ…å ±</h4>\n            <ul className=\"space-y-2\">\n              <li>\n                <Link\n                  to=\"/terms\"\n                  className=\"flex items-center gap-2 text-sm hover:text-white transition-colors\"\n                >\n                  <FileText className=\"w-4 h-4\" />\n                  åˆ©ç”¨è¦ç´„\n                </Link>\n              </li>\n              <li>\n                <Link\n                  to=\"/privacy\"\n                  className=\"flex items-center gap-2 text-sm hover:text-white transition-colors\"\n                >\n                  <Shield className=\"w-4 h-4\" />\n                  ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼\n                </Link>\n              </li>\n            </ul>\n          </div>\n\n          <div>\n            <h4 className=\"text-white font-semibold mb-4\">ãŠå•ã„åˆã‚ã›</h4>\n            <ul className=\"space-y-2\">\n              <li className=\"flex items-center gap-2 text-sm\">\n                <Mail className=\"w-4 h-4\" />\n                <a\n                  href=\"mailto:support@izakaya-ikki.example.com\"\n                  className=\"hover:text-white transition-colors\"\n                >\n                  support@izakaya-ikki.example.com\n                </a>\n              </li>\n            </ul>\n          </div>\n        </div>\n\n        <div className=\"border-t border-slate-800 mt-8 pt-6 text-center\">\n          <p className=\"text-sm text-slate-400\">\n            &copy; {currentYear} AIçµŒå–¶ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ . All rights reserved.\n          </p>\n        </div>\n      </div>\n    </footer>\n  )\n}\n",
  "src/components/system/HelpGuide.tsx": "import React from 'react';\nimport { X, BookOpen, FileText, Target, PieChart, MessageSquare, Users, Calendar, TrendingUp } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface HelpGuideProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport const HelpGuide: React.FC<HelpGuideProps> = ({ isOpen, onClose }) => {\n  const { user } = useAuth();\n\n  if (!isOpen) return null;\n\n  const sections = [\n    {\n      icon: FileText,\n      title: 'æ—¥å ±ã®å…¥åŠ›',\n      role: ['admin', 'manager', 'staff'],\n      steps: [\n        'å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œæ—¥å ±ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯',\n        'åº—èˆ—ã€æ—¥ä»˜ã‚’é¸æŠ',\n        'å£²ä¸Šã€ä»•å…¥ã‚Œã€å„ç¨®çµŒè²»ã‚’å…¥åŠ›',\n        'ä»•å…¥å†…è¨³ï¼ˆæ¥­è€…åˆ¥ï¼‰ãŒã‚ã‚‹å ´åˆã¯è¿½åŠ ',\n        'ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã§ç™»éŒ²å®Œäº†'\n      ],\n      tips: [\n        'é‡‘é¡ã¯åŠè§’æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„',\n        'ä»•å…¥å†…è¨³ã¯è¤‡æ•°ã®æ¥­è€…ã‚’è¿½åŠ ã§ãã¾ã™',\n        'ä¿å­˜å¾Œã‚‚ç·¨é›†å¯èƒ½ã§ã™'\n      ]\n    },\n    {\n      icon: PieChart,\n      title: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è¦‹æ–¹',\n      role: ['admin', 'manager', 'staff'],\n      steps: [\n        'å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰è¡¨ç¤ºæœŸé–“ã‚’é¸æŠï¼ˆæ—¥æ¬¡ãƒ»é€±æ¬¡ãƒ»æœˆæ¬¡ï¼‰',\n        'ãƒ˜ãƒƒãƒ€ãƒ¼ã®åº—èˆ—é¸æŠã§è¡¨ç¤ºåº—èˆ—ã‚’åˆ‡ã‚Šæ›¿ãˆ',\n        'KPIã‚«ãƒ¼ãƒ‰ã§ä¸»è¦æŒ‡æ¨™ã‚’ç¢ºèª',\n        'ã‚°ãƒ©ãƒ•ã§æ¨ç§»ã‚’è¦–è¦šçš„ã«æŠŠæ¡',\n        'ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã§è©³ç´°ã‚’ç¢ºèª'\n      ],\n      tips: [\n        'ç®¡ç†è€…ã¯å…¨åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§å¯èƒ½',\n        'ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°åˆ†æãŒè¡¨ç¤ºã•ã‚Œã¾ã™',\n        'ã‚°ãƒ©ãƒ•ã¯æœŸé–“ã«å¿œã˜ã¦è‡ªå‹•èª¿æ•´ã•ã‚Œã¾ã™'\n      ]\n    },\n    {\n      icon: Target,\n      title: 'ç›®æ¨™è¨­å®š',\n      role: ['admin', 'manager'],\n      steps: [\n        'å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œç›®æ¨™è¨­å®šã€ã‚’ã‚¯ãƒªãƒƒã‚¯',\n        'åº—èˆ—ã¨å¯¾è±¡æœˆã‚’é¸æŠ',\n        'å£²ä¸Šç›®æ¨™ã€åŸä¾¡ç‡ã€äººä»¶è²»ç‡ãªã©ã‚’å…¥åŠ›',\n        'ã€Œä¿å­˜ã€ã§è¨­å®šå®Œäº†',\n        'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§é”æˆç‡ãŒè‡ªå‹•è¡¨ç¤ºã•ã‚Œã¾ã™'\n      ],\n      tips: [\n        'ç›®æ¨™ã¯æœˆã”ã¨ã«è¨­å®šã§ãã¾ã™',\n        'é”æˆç‡ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¨ˆç®—ã•ã‚Œã¾ã™',\n        'éå»ã®å®Ÿç¸¾ã‚’å‚è€ƒã«è¨­å®šã—ã¾ã—ã‚‡ã†'\n      ]\n    },\n    {\n      icon: Calendar,\n      title: 'æœˆæ¬¡çµŒè²»ã®å…¥åŠ›',\n      role: ['admin', 'manager'],\n      steps: [\n        'å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œæœˆæ¬¡çµŒè²»å…¥åŠ›ã€ã‚’ã‚¯ãƒªãƒƒã‚¯',\n        'åº—èˆ—ã¨å¯¾è±¡æœˆã‚’é¸æŠ',\n        'å®¶è³ƒã€å…‰ç†±è²»ã€é€šä¿¡è²»ãªã©ã®å›ºå®šè²»ã‚’å…¥åŠ›',\n        'ã€Œä¿å­˜ã€ã§ç™»éŒ²å®Œäº†',\n        'åˆ©ç›Šè¨ˆç®—ã«è‡ªå‹•åæ˜ ã•ã‚Œã¾ã™'\n      ],\n      tips: [\n        'æœˆã«1å›å…¥åŠ›ã™ã‚Œã°è‡ªå‹•ã§è¨ˆç®—ã«åæ˜ ',\n        'æ¶ˆè€—å“ã‚„å®¶è³ƒã¯å¿˜ã‚Œãšã«å…¥åŠ›',\n        'éå»ã®æœˆæ¬¡çµŒè²»ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ç·¨é›†å¯èƒ½'\n      ]\n    },\n    {\n      icon: MessageSquare,\n      title: 'AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½',\n      role: ['admin', 'manager', 'staff'],\n      steps: [\n        'å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒAIãƒãƒ£ãƒƒãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯',\n        'è³ªå•ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šã€Œä»Šæœˆã®å£²ä¸Šã¯ï¼Ÿã€ï¼‰',\n        'AIãŒæ¥­ç¸¾ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦å›ç­”',\n        'ä¼šè©±å±¥æ­´ã¯è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™',\n        'æ¤œç´¢æ©Ÿèƒ½ã§éå»ã®ä¼šè©±ã‚’æ¤œç´¢å¯èƒ½'\n      ],\n      tips: [\n        'å…·ä½“çš„ãªè³ªå•ã»ã©çš„ç¢ºãªå›ç­”ãŒå¾—ã‚‰ã‚Œã¾ã™',\n        'ã€ŒåŸä¾¡ç‡ã‚’æ”¹å–„ã™ã‚‹ã«ã¯ï¼Ÿã€ãªã©ææ¡ˆã‚‚ä¾é ¼å¯',\n        'ä¼šè©±ã¯åº—èˆ—ã”ã¨ã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™'\n      ]\n    },\n    {\n      icon: TrendingUp,\n      title: 'AIåˆ†æãƒ¬ãƒãƒ¼ãƒˆ',\n      role: ['admin', 'manager'],\n      steps: [\n        'å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒAIåˆ†æãƒ¬ãƒãƒ¼ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯',\n        'ã€Œæ–°è¦ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯',\n        'æœŸé–“ã¨åº—èˆ—ã‚’é¸æŠ',\n        'AIãŒè‡ªå‹•ã§è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆ',\n        'ãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèªãƒ»å…±æœ‰ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½'\n      ],\n      tips: [\n        'æœˆæœ«ã‚„é€±æœ«ã«ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã¨ä¾¿åˆ©',\n        'å…±æœ‰ãƒªãƒ³ã‚¯ã§ä»–ã®ã‚¹ã‚¿ãƒƒãƒ•ã«å…±æœ‰å¯èƒ½',\n        'ãƒ¬ãƒãƒ¼ãƒˆã¯PDFå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™'\n      ]\n    },\n    {\n      icon: Users,\n      title: 'ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†',\n      role: ['admin'],\n      steps: [\n        'å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œè¨­å®šã€â†’ã€Œã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ã€',\n        'ã€Œæ–°è¦ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯',\n        'åå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€å½¹å‰²ã‚’å…¥åŠ›',\n        'æ‹…å½“åº—èˆ—ã‚’å‰²ã‚Šå½“ã¦',\n        'ã€Œä¿å­˜ã€ã§ç™»éŒ²å®Œäº†'\n      ],\n      tips: [\n        'å½¹å‰²ï¼šçµ±æ‹¬ï¼ˆå…¨æ¨©é™ï¼‰ã€åº—é•·ã€ã‚¹ã‚¿ãƒƒãƒ•',\n        'ã‚¹ã‚¿ãƒƒãƒ•ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸåº—èˆ—ã®ã¿é–²è¦§å¯',\n        'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«è¨­å®š'\n      ]\n    }\n  ];\n\n  const userSections = sections.filter(section =>\n    section.role.includes(user?.role || 'staff')\n  );\n\n  return (\n    <div\n      className=\"fixed top-0 left-0 right-0 bottom-0 z-[99999] flex items-start justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200 overflow-hidden\"\n      onClick={onClose}\n      style={{ position: 'fixed', inset: 0 }}\n    >\n      <div\n        className=\"relative w-full max-w-5xl h-full max-h-screen bg-white shadow-2xl overflow-hidden flex flex-col m-0 sm:m-4 sm:rounded-xl sm:h-[96vh] sm:max-h-[96vh]\"\n        onClick={(e) => e.stopPropagation()}\n        style={{ zIndex: 99999 }}\n      >\n        {/* Header - Fixed */}\n        <div className=\"flex-shrink-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-4 sm:px-6 sm:py-5 flex items-center justify-between shadow-lg z-20\">\n          <div className=\"flex items-center gap-2 sm:gap-3 min-w-0\">\n            <BookOpen className=\"h-5 w-5 sm:h-6 sm:w-6 flex-shrink-0\" />\n            <div className=\"min-w-0\">\n              <h2 className=\"text-lg sm:text-2xl font-bold truncate\">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2>\n              <p className=\"text-xs sm:text-sm text-blue-50 opacity-90 hidden sm:block\">æ¥­å‹™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®åŸºæœ¬æ“ä½œ</p>\n            </div>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onClose}\n            className=\"text-white hover:bg-white/20 transition-colors flex-shrink-0\"\n            title=\"é–‰ã˜ã‚‹\"\n          >\n            <X className=\"h-5 w-5 sm:h-6 sm:w-6\" />\n          </Button>\n        </div>\n\n        {/* Content - Scrollable */}\n        <div className=\"flex-1 overflow-y-auto bg-gray-50\">\n          <div className=\"p-4 sm:p-6 md:p-8 space-y-6\">\n          {/* Quick Start */}\n          <div className=\"bg-gradient-to-br from-blue-50 via-blue-50 to-green-50 border-2 border-blue-300 rounded-xl p-6 md:p-8 shadow-sm\">\n            <h3 className=\"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2\">\n              <span className=\"text-2xl\">ğŸš€</span>\n              ã¯ã˜ã‚ã«\n            </h3>\n            <div className=\"space-y-4 text-gray-700\">\n              <p className=\"text-base leading-relaxed\">ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€æ—¥ã€…ã®å£²ä¸Šãƒ»çµŒè²»ã‚’è¨˜éŒ²ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ¥­ç¸¾ã‚’åˆ†æã§ãã‚‹ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-5\">\n                <div className=\"bg-white rounded-xl p-4 shadow-md hover:shadow-lg transition-shadow border border-blue-100\">\n                  <div className=\"font-bold text-blue-600 mb-2 text-lg\">ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—1</div>\n                  <div className=\"text-sm text-gray-600\">æ—¥å ±ã‚’å…¥åŠ›ã—ã¦æ—¥ã€…ã®æ¥­ç¸¾ã‚’è¨˜éŒ²</div>\n                </div>\n                <div className=\"bg-white rounded-xl p-4 shadow-md hover:shadow-lg transition-shadow border border-purple-100\">\n                  <div className=\"font-bold text-purple-600 mb-2 text-lg\">ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—2</div>\n                  <div className=\"text-sm text-gray-600\">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§æ¨ç§»ã‚’ç¢ºèª</div>\n                </div>\n                <div className=\"bg-white rounded-xl p-4 shadow-md hover:shadow-lg transition-shadow border border-green-100\">\n                  <div className=\"font-bold text-green-600 mb-2 text-lg\">ğŸ¤– ã‚¹ãƒ†ãƒƒãƒ—3</div>\n                  <div className=\"text-sm text-gray-600\">AIã§åˆ†æãƒ»æ”¹å–„ææ¡ˆã‚’å–å¾—</div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Sections */}\n          {userSections.map((section, index) => {\n            const Icon = section.icon;\n            return (\n              <div key={index} className=\"bg-white border-2 border-gray-200 rounded-xl p-6 md:p-8 hover:shadow-lg hover:border-blue-300 transition-all\">\n                <div className=\"flex items-center gap-4 mb-6\">\n                  <div className=\"p-3 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl shadow-sm\">\n                    <Icon className=\"h-6 w-6 text-blue-700\" />\n                  </div>\n                  <h3 className=\"text-xl font-bold text-gray-900\">{section.title}</h3>\n                </div>\n\n                <div className=\"space-y-5\">\n                  {/* Steps */}\n                  <div>\n                    <h4 className=\"text-base font-bold text-gray-800 mb-3 flex items-center gap-2\">\n                      <span className=\"text-blue-600\">â–¶</span>\n                      æ‰‹é †\n                    </h4>\n                    <ol className=\"space-y-3\">\n                      {section.steps.map((step, stepIndex) => (\n                        <li key={stepIndex} className=\"flex gap-3 text-sm text-gray-700 leading-relaxed\">\n                          <span className=\"flex-shrink-0 w-7 h-7 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold shadow-sm\">\n                            {stepIndex + 1}\n                          </span>\n                          <span className=\"pt-1\">{step}</span>\n                        </li>\n                      ))}\n                    </ol>\n                  </div>\n\n                  {/* Tips */}\n                  <div className=\"bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-300 rounded-xl p-5 shadow-sm\">\n                    <h4 className=\"text-base font-bold text-amber-900 mb-3 flex items-center gap-2\">\n                      <span className=\"text-lg\">ğŸ’¡</span>\n                      ãƒã‚¤ãƒ³ãƒˆ\n                    </h4>\n                    <ul className=\"space-y-2\">\n                      {section.tips.map((tip, tipIndex) => (\n                        <li key={tipIndex} className=\"text-sm text-amber-900 flex gap-2 leading-relaxed\">\n                          <span className=\"text-amber-600 font-bold\">âœ“</span>\n                          <span>{tip}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n\n          {/* FAQ */}\n          <div className=\"bg-white border-2 border-gray-300 rounded-xl p-6 md:p-8 shadow-sm\">\n            <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\n              <span className=\"text-2xl\">â“</span>\n              ã‚ˆãã‚ã‚‹è³ªå•\n            </h3>\n            <div className=\"space-y-5\">\n              <div className=\"pb-4 border-b border-gray-200 last:border-0 last:pb-0\">\n                <div className=\"font-bold text-gray-900 mb-2 text-base\">Q. ãƒ‡ãƒ¼ã‚¿ã¯ã„ã¤æ›´æ–°ã•ã‚Œã¾ã™ã‹ï¼Ÿ</div>\n                <div className=\"text-sm text-gray-600 leading-relaxed pl-4\">A. æ—¥å ±ã‚’ä¿å­˜ã™ã‚‹ã¨å³åº§ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«åæ˜ ã•ã‚Œã¾ã™ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãŒç¢ºèªã§ãã¾ã™ã€‚</div>\n              </div>\n              <div className=\"pb-4 border-b border-gray-200 last:border-0 last:pb-0\">\n                <div className=\"font-bold text-gray-900 mb-2 text-base\">Q. éå»ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿®æ­£ã§ãã¾ã™ã‹ï¼Ÿ</div>\n                <div className=\"text-sm text-gray-600 leading-relaxed pl-4\">A. ã¯ã„ã€æ—¥å ±ä¸€è¦§ã‹ã‚‰è©²å½“ã®æ—¥å ±ã‚’é¸æŠã—ã¦ç·¨é›†ã§ãã¾ã™ã€‚</div>\n              </div>\n              <div className=\"pb-4 border-b border-gray-200 last:border-0 last:pb-0\">\n                <div className=\"font-bold text-gray-900 mb-2 text-base\">Q. ä»–ã®åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ã¯è¦‹ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ</div>\n                <div className=\"text-sm text-gray-600 leading-relaxed pl-4\">A. æ¨©é™ã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™ã€‚çµ±æ‹¬ã¯å…¨åº—èˆ—ã€åº—é•·ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸåº—èˆ—ã®ã¿é–²è¦§å¯èƒ½ã§ã™ã€‚</div>\n              </div>\n              <div className=\"pb-4 border-b border-gray-200 last:border-0 last:pb-0\">\n                <div className=\"font-bold text-gray-900 mb-2 text-base\">Q. AIãƒãƒ£ãƒƒãƒˆã®ä½¿ç”¨æ–™é‡‘ã¯ï¼Ÿ</div>\n                <div className=\"text-sm text-gray-600 leading-relaxed pl-4\">A. ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨æ–™é‡‘ã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ãŸã ã—ã€éåº¦ãªä½¿ç”¨ã¯æ§ãˆã¦ãã ã•ã„ã€‚</div>\n              </div>\n            </div>\n          </div>\n\n          {/* Support */}\n          <div className=\"bg-gradient-to-r from-blue-50 to-green-50 border-2 border-blue-300 rounded-xl p-6 md:p-8 text-center shadow-sm\">\n            <h3 className=\"text-xl font-bold text-gray-900 mb-3 flex items-center justify-center gap-2\">\n              <span className=\"text-2xl\">ğŸ“</span>\n              ãŠå•ã„åˆã‚ã›\n            </h3>\n            <p className=\"text-base text-gray-700 mb-4 leading-relaxed\">\n              ã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã¾ã§ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\n            </p>\n            <div className=\"text-sm text-gray-500 font-medium\">\n              ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0.0\n            </div>\n          </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n",
  "src/components/system/QuickActions.tsx": "import React from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Clock, TrendingUp, Zap } from 'lucide-react'\nimport { formatCurrency } from '@/lib/format'\n\ntype Priority = 'é«˜' | 'ä¸­' | 'ä½'\n\ninterface QuickActionItem {\n  category: string\n  description: string\n  priority: Priority\n  timeframe: string\n  actions: string[]\n  expectedSavings: number\n}\n\n// å„ªå…ˆåº¦åˆ¥ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ï¼ˆå‹å®‰å…¨ãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ãï¼‰\nconst priorityStyle = (p: Priority | undefined) => {\n  switch (p) {\n    case 'é«˜':\n      return {\n        card: 'bg-red-600 text-white border-red-600',\n        title: 'text-white',\n        desc: 'text-white/90',\n        chipVariant: 'destructive' as const,\n        action: 'bg-white/20 text-white border-white/30',\n        effect: 'text-white/80',\n      }\n    case 'ä¸­':\n      return {\n        card: 'bg-yellow-50 text-yellow-800 border-yellow-200',\n        title: 'text-yellow-900',\n        desc: 'text-yellow-700',\n        chipVariant: 'secondary' as const,\n        action: 'bg-white/50 text-yellow-800 border-yellow-200',\n        effect: 'text-yellow-700',\n      }\n    case 'ä½':\n      return {\n        card: 'bg-green-50 text-green-800 border-green-200',\n        title: 'text-green-900',\n        desc: 'text-green-700',\n        chipVariant: 'secondary' as const,\n        action: 'bg-white/50 text-green-800 border-green-200',\n        effect: 'text-green-700',\n      }\n    default:\n      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆå‹å®‰å…¨ï¼‰\n      return {\n        card: 'bg-muted text-foreground border-border',\n        title: 'text-foreground',\n        desc: 'text-muted-foreground',\n        chipVariant: 'secondary' as const,\n        action: 'bg-white text-foreground border-border',\n        effect: 'text-muted-foreground',\n      }\n  }\n}\n\nexport const QuickActions: React.FC = () => {\n  const quickActionItems: QuickActionItem[] = [\n    {\n      category: 'åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ',\n      description: 'é£Ÿæãƒ­ã‚¹å‰Šæ¸›ã¨ã‚³ã‚¹ãƒˆæœ€é©åŒ–',\n      priority: 'é«˜',\n      timeframe: '2-3ãƒ¶æœˆ',\n      actions: [\n        'ç™ºæ³¨ç‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ',\n        'å»ƒæ£„ç‡è‡ªå‹•è¨ˆç®—',\n        'æ¥­è€…åˆ¥ä¾¡æ ¼æ¯”è¼ƒ',\n        'ABCåˆ†æå°å…¥'\n      ],\n      expectedSavings: 600000\n    },\n    {\n      category: 'POSé€£æºæ©Ÿèƒ½',\n      description: 'ãƒ¬ã‚¸ãƒ‡ãƒ¼ã‚¿è‡ªå‹•å–è¾¼ã§ãƒ‡ãƒ¼ã‚¿ç²¾åº¦å‘ä¸Š',\n      priority: 'é«˜',\n      timeframe: '1-2ãƒ¶æœˆ',\n      actions: [\n        'ãƒ¬ã‚¸APIé€£æº',\n        'å®¢æ•°ãƒ»å®¢å˜ä¾¡è‡ªå‹•è¨ˆç®—',\n        'å•†å“åˆ¥å£²ä¸Šåˆ†æ',\n        'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å£²ä¸Šæ›´æ–°'\n      ],\n      expectedSavings: 360000\n    },\n    {\n      category: 'ç¨å‹™ãƒ¬ãƒãƒ¼ãƒˆ',\n      description: 'ç¨ç†å£«è²»ç”¨å‰Šæ¸›ã¨æ³•å‹™å¯¾å¿œ',\n      priority: 'ä¸­',\n      timeframe: '1ãƒ¶æœˆ',\n      actions: [\n        'æ¶ˆè²»ç¨è¨ˆç®—ç²¾åº¦å‘ä¸Š',\n        'æœˆæ¬¡ç¨å‹™ãƒ¬ãƒãƒ¼ãƒˆ',\n        'å¹´æ¬¡æ±ºç®—è³‡æ–™ç”Ÿæˆ',\n        'ç›£æŸ»ãƒ­ã‚°æ©Ÿèƒ½'\n      ],\n      expectedSavings: 360000\n    },\n    {\n      category: 'ã‚·ãƒ•ãƒˆç®¡ç†',\n      description: 'äººä»¶è²»æœ€é©åŒ–ã¨åŠ´å‹™ç®¡ç†',\n      priority: 'ä¸­',\n      timeframe: '2ãƒ¶æœˆ',\n      actions: [\n        'æ™‚çµ¦è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ ',\n        'åŠ´åƒæ™‚é–“ç®¡ç†',\n        'ã‚·ãƒ•ãƒˆæœ€é©åŒ–AI',\n        'äººä»¶è²»äºˆç®—ç®¡ç†'\n      ],\n      expectedSavings: 480000\n    },\n    {\n      category: 'é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ',\n      description: 'ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½ã§è¿…é€Ÿãªå¯¾å¿œ',\n      priority: 'ä½',\n      timeframe: '2é€±é–“',\n      actions: [\n        'åˆ©ç›Šç‡æ‚ªåŒ–ã‚¢ãƒ©ãƒ¼ãƒˆ',\n        'LINE/Slacké€šçŸ¥',\n        'å£²ä¸Šç›®æ¨™æœªé”é€šçŸ¥',\n        'ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š'\n      ],\n      expectedSavings: 120000\n    },\n    {\n      category: 'ç«¶åˆåˆ†æ',\n      description: 'å¸‚å ´ãƒã‚¸ã‚·ãƒ§ãƒ³æŠŠæ¡ã¨æˆ¦ç•¥ç«‹æ¡ˆ',\n      priority: 'ä½',\n      timeframe: '3ãƒ¶æœˆ',\n      actions: [\n        'å•†åœåˆ†æãƒ„ãƒ¼ãƒ«',\n        'ç«¶åˆä¾¡æ ¼èª¿æŸ»',\n        'ãƒãƒ¼ã‚±ãƒƒãƒˆã‚·ã‚§ã‚¢åˆ†æ',\n        'é¡§å®¢æº€è¶³åº¦èª¿æŸ»'\n      ],\n      expectedSavings: 240000\n    }\n  ]\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Zap className=\"w-5 h-5 text-orange-500\" />\n          è¿½åŠ å®Ÿè£…æ¨å¥¨æ©Ÿèƒ½\n        </CardTitle>\n        <div className=\"text-sm text-muted-foreground\">\n          å®Ÿå‹™ãƒ¬ãƒ™ãƒ«å‘ä¸Šã®ãŸã‚ã®å„ªå…ˆæ©Ÿèƒ½ãƒªã‚¹ãƒˆ\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n          {quickActionItems.map((item, index) => {\n            const style = priorityStyle(item.priority)\n            \n            return (\n              <div key={`${item.category}-${index}`} className={`p-4 rounded-lg border-2 ${style.card}`}>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className={`text-sm font-bold ${style.title}`}>\n                    {item.category}\n                  </span>\n                  <Badge variant={style.chipVariant} className=\"text-xs\">\n                    {item.priority}\n                  </Badge>\n                </div>\n                \n                <p className={`text-xs mb-3 ${style.desc}`}>\n                  {item.description}\n                </p>\n                \n                <div className=\"space-y-2\">\n                  {item.actions.map((action) => (\n                    <div \n                      key={action}\n                      className={`text-xs p-2 rounded border ${style.action}`}\n                    >\n                      â€¢ {action}\n                    </div>\n                  ))}\n                </div>\n                \n                <div className=\"flex items-center justify-between mt-3\">\n                  <div className={`text-xs ${style.effect}`}>\n                    æœŸå¾…åŠ¹æœ: æœˆé–“{formatCurrency(item.expectedSavings)}å‰Šæ¸›\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <Clock className={`w-3 h-3 ${style.effect.replace('text-', 'text-')}`} />\n                    <span className={`text-xs ${style.effect}`}>\n                      {item.timeframe}\n                    </span>\n                  </div>\n                </div>\n              </div>\n            )\n          })}\n        </div>\n        \n        <div className=\"mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <TrendingUp className=\"w-5 h-5 text-blue-600\" />\n            <h4 className=\"font-medium text-blue-900\">å®Ÿè£…æ™‚ã®ç·åˆåŠ¹æœ</h4>\n          </div>\n          <div className=\"grid grid-cols-2 gap-4 text-sm\">\n            <div>\n              <span className=\"text-blue-700\">å¹´é–“å‰Šæ¸›åŠ¹æœ:</span>\n              <span className=\"font-bold text-blue-900 ml-2\">\n                {formatCurrency(quickActionItems.reduce((sum, item) => sum + item.expectedSavings * 12, 0))}\n              </span>\n            </div>\n            <div>\n              <span className=\"text-blue-700\">æŠ•è³‡å›åæœŸé–“:</span>\n              <span className=\"font-bold text-blue-900 ml-2\">3-6ãƒ¶æœˆ</span>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/ui/MetricCard.tsx": "import React from 'react'\nimport { type LucideIcon } from 'lucide-react'\nimport { Card, CardContent } from './card'\nimport { Badge } from './badge'\nimport { cn } from '@/lib/utils'\n\nexport interface MetricCardProps {\n  label: string\n  value: string\n  delta?: {\n    value: number\n    isPositive: boolean\n    label?: string\n  }\n  icon: LucideIcon\n  tone?: 'success' | 'warning' | 'danger' | 'info' | 'neutral'\n  hint?: string\n  details?: Array<{ label: string; value: string }>\n  loading?: boolean\n  className?: string\n}\n\nconst toneClasses = {\n  success: 'bg-success/10 text-success border-success/20',\n  warning: 'bg-warning/10 text-warning border-warning/20',\n  danger: 'bg-danger/10 text-danger border-danger/20',\n  info: 'bg-info/10 text-info border-info/20',\n  neutral: 'bg-muted text-muted-foreground border-border'\n}\n\nconst iconToneClasses = {\n  success: 'text-success',\n  warning: 'text-warning',\n  danger: 'text-danger',\n  info: 'text-info',\n  neutral: 'text-muted-foreground'\n}\n\nexport const MetricCard: React.FC<MetricCardProps> = ({\n  label,\n  value,\n  delta,\n  icon: Icon,\n  tone = 'neutral',\n  hint,\n  details,\n  loading = false,\n  className\n}) => {\n  if (loading) {\n    return (\n      <Card className={cn('animate-pulse', className)}>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"h-4 bg-muted rounded w-20\"></div>\n            <div className=\"h-8 w-8 bg-muted rounded-lg\"></div>\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"h-8 bg-muted rounded w-24\"></div>\n            <div className=\"h-4 bg-muted rounded w-16\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    )\n  }\n\n  return (\n    <Card className={cn('transition-all duration-200 hover:shadow-md', className)}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"text-sm font-medium text-muted-foreground\">\n            {label}\n          </div>\n          <div className={cn('p-2 rounded-lg', toneClasses[tone])}>\n            <Icon className={cn('h-4 w-4', iconToneClasses[tone])} />\n          </div>\n        </div>\n        \n        <div className=\"space-y-2\">\n          <div className=\"text-2xl font-bold text-foreground\">\n            {value}\n          </div>\n          \n          {delta && (\n            <div className=\"flex items-center gap-2\">\n              <Badge \n                variant={delta.isPositive ? 'default' : 'destructive'}\n                className=\"text-xs\"\n              >\n                {delta.isPositive ? '+' : ''}{delta.value.toFixed(1)}%\n              </Badge>\n              {delta.label && (\n                <span className=\"text-xs text-muted-foreground\">\n                  {delta.label}\n                </span>\n              )}\n            </div>\n          )}\n          \n          {hint && (\n            <p className=\"text-xs text-muted-foreground\">\n              {hint}\n            </p>\n          )}\n\n          {details && details.length > 0 && (\n            <div className=\"mt-3 pt-3 border-t border-border/50 space-y-1\">\n              {details.map((detail, idx) => (\n                <div key={idx} className=\"flex items-center justify-between text-xs\">\n                  <span className=\"text-muted-foreground\">{detail.label}</span>\n                  <span className=\"font-medium text-foreground\">{detail.value}</span>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/ui/badge.tsx": "import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }",
  "src/components/ui/button.tsx": "import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground shadow hover:bg-primary/90\",\n        destructive: \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90\",\n        outline: \"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground\",\n        secondary: \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 text-xs\",\n        lg: \"h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }",
  "src/components/ui/card.tsx": "import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }",
  "src/components/ui/dropdown-menu.tsx": "import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName = DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName = DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName = DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}",
  "src/components/ui/empty-state.tsx": "import React from 'react'\nimport { type LucideIcon } from 'lucide-react'\nimport { Card, CardContent } from './card'\nimport { Button } from './button'\n\ninterface EmptyStateProps {\n  icon: LucideIcon\n  title: string\n  description: string\n  action?: {\n    label: string\n    onClick: () => void\n  }\n  className?: string\n}\n\nexport const EmptyState: React.FC<EmptyStateProps> = ({\n  icon: Icon,\n  title,\n  description,\n  action,\n  className\n}) => {\n  return (\n    <Card className={className}>\n      <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n        <div className=\"mb-4 p-3 rounded-full bg-muted\">\n          <Icon className=\"h-8 w-8 text-muted-foreground\" />\n        </div>\n        <h3 className=\"text-lg font-semibold text-foreground mb-2\">\n          {title}\n        </h3>\n        <p className=\"text-sm text-muted-foreground mb-6 max-w-sm\">\n          {description}\n        </p>\n        {action && (\n          <Button onClick={action.onClick}>\n            {action.label}\n          </Button>\n        )}\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/ui/error-state.tsx": "import React from 'react'\nimport { AlertCircle, RefreshCw } from 'lucide-react'\nimport { Card, CardContent } from './card'\nimport { Button } from './button'\n\ninterface ErrorStateProps {\n  title?: string\n  message: string\n  onRetry?: () => void\n  className?: string\n}\n\nexport const ErrorState: React.FC<ErrorStateProps> = ({\n  title = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',\n  message,\n  onRetry,\n  className\n}) => {\n  return (\n    <Card className={className}>\n      <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n        <div className=\"mb-4 p-3 rounded-full bg-destructive/10\">\n          <AlertCircle className=\"h-8 w-8 text-destructive\" />\n        </div>\n        <h3 className=\"text-lg font-semibold text-foreground mb-2\">\n          {title}\n        </h3>\n        <p className=\"text-sm text-muted-foreground mb-6 max-w-sm\">\n          {message}\n        </p>\n        {onRetry && (\n          <Button onClick={onRetry} variant=\"outline\">\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            å†è©¦è¡Œ\n          </Button>\n        )}\n      </CardContent>\n    </Card>\n  )\n}",
  "src/components/ui/progress.tsx": "import * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }",
  "src/components/ui/skeleton.tsx": "import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }",
  "src/components/ui/tabs.tsx": "import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }",
  "src/contexts/AdminDataContext.tsx": "import React, { createContext, useContext, useEffect, useMemo, useState, useCallback } from 'react'\nimport { type Store, type TargetData } from '@/types'\nimport { type Vendor, type StoreVendorAssignment } from '@/types'\nimport { useAuth } from './AuthContext'\nimport {\n  getStores,\n  createStore as createStoreDb,\n  updateStore as updateStoreDb,\n  deleteStore as deleteStoreDb,\n  getVendors,\n  createVendor as createVendorDb,\n  updateVendor as updateVendorDb,\n  deleteVendor as deleteVendorDb,\n  getAllStoreVendorAssignments,\n  getStoreVendors as getStoreVendorsDb,\n  assignVendorToStore as assignVendorToStoreDb,\n  removeVendorFromStore as removeVendorFromStoreDb,\n  getTargets,\n  upsertTarget as upsertTargetDb,\n  deleteTarget as deleteTargetDb\n} from '../services/supabase'\n\n// UUID validation utility\nconst isValidUUID = (str: string): boolean => {\n  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i\n  return uuidRegex.test(str)\n}\n\ntype StoreInput = {\n  name: string\n  address: string\n  managerId?: string | null\n  managerName?: string | null\n  manager?: string | null\n  isActive?: boolean\n}\n\ntype AdminCtx = {\n  stores: Store[]\n  targets: TargetData[]\n  vendors: Vendor[]\n  storeVendorAssignments: StoreVendorAssignment[]\n  addStore: (input: StoreInput) => Promise<{ ok: boolean; error?: string }>\n  updateStore: (id: string, patch: Partial<Store>) => void\n  deleteStore: (id: string) => void\n  upsertTarget: (t: TargetData) => void\n  deleteTarget: (storeId: string, period: string) => void\n  addVendor: (vendor: Omit<Vendor, 'id'>) => void\n  updateVendor: (id: string, patch: Partial<Vendor>) => void\n  deleteVendor: (id: string) => void\n  getStoreVendors: (storeId: string) => Vendor[]\n  assignVendorToStore: (storeId: string, vendorId: string) => void\n  unassignVendorFromStore: (storeId: string, vendorId: string) => void\n}\n\nconst AdminDataContext = createContext<AdminCtx | null>(null)\n\nexport const AdminDataProvider: React.FC<{children: React.ReactNode}> = ({ children }) => {\n  const [stores, setStores] = useState<Store[]>([])\n  const [targets, setTargets] = useState<TargetData[]>([])\n  const [vendors, setVendors] = useState<Vendor[]>([])\n  const [storeVendorAssignments, setStoreVendorAssignments] = useState<StoreVendorAssignment[]>([])\n  const [loading, setLoading] = useState(true)\n  const { user } = useAuth()\n\n  // Supabaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n  useEffect(() => {\n    const fetchData = async () => {\n      if (!user) return\n\n      try {\n        setLoading(true)\n\n        // ä¸¦è¡Œã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n        const [storesResult, vendorsResult, targetsResult, assignmentsResult] = await Promise.all([\n          getStores(),\n          getVendors(),\n          getTargets(),\n          getAllStoreVendorAssignments()\n        ])\n\n        // Stores\n        if (!storesResult.error && storesResult.data) {\n          const transformedStores: Store[] = storesResult.data.map(store => ({\n            id: store.id,\n            name: store.name,\n            address: store.address,\n            manager: store.manager_id || '',\n            isActive: store.is_active ?? true\n          }))\n          setStores(transformedStores)\n        }\n\n        // Vendors\n        if (!vendorsResult.error && vendorsResult.data) {\n          const transformedVendors: Vendor[] = vendorsResult.data.map(vendor => ({\n            id: vendor.id,\n            name: vendor.name,\n            category: vendor.category,\n            contactInfo: vendor.contact_info,\n            isActive: vendor.is_active,\n            createdAt: vendor.created_at,\n            updatedAt: vendor.updated_at\n          }))\n          setVendors(transformedVendors)\n        }\n\n        // Targets\n        if (!targetsResult.error && targetsResult.data) {\n          const transformedTargets: TargetData[] = targetsResult.data.map(target => ({\n            storeId: target.store_id,\n            period: target.period,\n            targetSales: target.target_sales,\n            targetProfit: target.target_profit,\n            targetProfitMargin: target.target_profit_margin,\n            targetCostRate: target.target_cost_rate || 0,\n            targetLaborRate: target.target_labor_rate || 0\n          }))\n          setTargets(transformedTargets)\n        }\n\n        // Store Vendor Assignments\n        if (!assignmentsResult.error && assignmentsResult.data) {\n          const transformedAssignments: StoreVendorAssignment[] = assignmentsResult.data.map((a: any) => ({\n            storeId: a.store_id,\n            vendorId: a.vendor_id,\n            displayOrder: a.display_order || 0\n          }))\n          console.log('ğŸ“¦ AdminDataContext: å‰²ã‚Šå½“ã¦ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', transformedAssignments)\n          setStoreVendorAssignments(transformedAssignments)\n        } else {\n          console.log('âš ï¸ AdminDataContext: å‰²ã‚Šå½“ã¦ãƒ‡ãƒ¼ã‚¿ãªã— or ã‚¨ãƒ©ãƒ¼', assignmentsResult)\n        }\n\n      } catch (err) {\n        console.error('âŒ AdminDataProvider: ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', err)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchData()\n  }, [user])\n\n  const addStore: AdminCtx['addStore'] = async (input) => {\n    try {\n      if (!input.name?.trim()) {\n        return { ok: false, error: 'åº—èˆ—åã¯å¿…é ˆã§ã™' }\n      }\n      if (!input.address?.trim()) {\n        return { ok: false, error: 'ä½æ‰€ã¯å¿…é ˆã§ã™' }\n      }\n\n      const manager_id = input.managerId && isValidUUID(input.managerId)\n        ? input.managerId\n        : input.manager && isValidUUID(input.manager)\n        ? input.manager\n        : undefined\n\n      const payload = {\n        name: input.name.trim(),\n        address: input.address.trim(),\n        manager_id,\n        is_active: input.isActive ?? true\n      }\n\n      const { data, error } = await createStoreDb(payload)\n\n      if (error) {\n        return { ok: false, error: error.message }\n      }\n\n      if (data) {\n        const newStore: Store = {\n          id: data.id,\n          name: data.name,\n          address: data.address,\n          manager: data.manager_id || '',\n          isActive: data.is_active ?? true\n        }\n        setStores(prev => [...prev, newStore])\n      }\n\n      return { ok: true }\n    } catch (e: any) {\n      console.error('âŒ åº—èˆ—ä½œæˆã‚¨ãƒ©ãƒ¼:', e)\n      return { ok: false, error: e?.message ?? 'åº—èˆ—ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ' }\n    }\n  }\n\n  const updateStore: AdminCtx['updateStore'] = async (id, patch) => {\n    try {\n      // Validate manager_id - only set if it's a valid UUID, otherwise undefined  \n      const managerId = patch.manager && isValidUUID(patch.manager) ? patch.manager : undefined\n      \n      const updateData = {\n        name: patch.name,\n        address: patch.address,\n        manager_id: managerId,\n        is_active: patch.isActive\n      }\n      \n      const { data, error } = await updateStoreDb(id, updateData)\n      \n      if (error) {\n        throw new Error(error.message)\n      }\n      \n      setStores(prev => prev.map(s => s.id === id ? { ...s, ...patch } : s))\n    } catch (err) {\n      console.error('âŒ åº—èˆ—æ›´æ–°ã‚¨ãƒ©ãƒ¼:', err)\n      throw err\n    }\n  }\n\n  const deleteStore: AdminCtx['deleteStore'] = async (id) => {\n    try {\n      const { error } = await deleteStoreDb(id)\n      \n      if (error) {\n        throw new Error(error.message)\n      }\n      \n      setStores(prev => prev.map(s => s.id === id ? { ...s, isActive: false } : s))\n    } catch (err) {\n      console.error('âŒ åº—èˆ—å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', err)\n      throw err\n    }\n  }\n\n  const upsertTarget: AdminCtx['upsertTarget'] = async (t) => {\n    try {\n      const targetData = {\n        store_id: t.storeId,\n        period: t.period,\n        target_sales: t.targetSales,\n        target_profit: t.targetProfit,\n        target_profit_margin: t.targetProfitMargin,\n        target_cost_rate: t.targetCostRate || 0,\n        target_labor_rate: t.targetLaborRate || 0\n      }\n\n      console.log('ğŸ“Š AdminDataContext: ç›®æ¨™ä¿å­˜é–‹å§‹', targetData)\n\n      const { data, error } = await upsertTargetDb(targetData)\n\n      console.log('ğŸ“Š AdminDataContext: ä¿å­˜çµæœ', { data, error })\n\n      if (error) {\n        console.error('âŒ AdminDataContext: Supabaseã‚¨ãƒ©ãƒ¼:', error)\n        throw new Error(error.message)\n      }\n\n      setTargets(prev => {\n        const idx = prev.findIndex(x => x.storeId === t.storeId && x.period === t.period)\n        if (idx >= 0) {\n          const copy = [...prev]\n          copy[idx] = t\n          return copy\n        }\n        return [...prev, t]\n      })\n\n      console.log('âœ… AdminDataContext: ç›®æ¨™ä¿å­˜æˆåŠŸ')\n    } catch (err) {\n      console.error('âŒ ç›®æ¨™ä¿å­˜ã‚¨ãƒ©ãƒ¼:', err)\n      throw err\n    }\n  }\n\n  const deleteTarget: AdminCtx['deleteTarget'] = async (storeId, period) => {\n    try {\n      const { error } = await deleteTargetDb(storeId, period)\n      \n      if (error) {\n        throw new Error(error.message)\n      }\n      \n      setTargets(prev => prev.filter(t => !(t.storeId === storeId && t.period === period)))\n    } catch (err) {\n      console.error('âŒ ç›®æ¨™å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', err)\n      throw err\n    }\n  }\n\n  const addVendor: AdminCtx['addVendor'] = async (vendor) => {\n    try {\n      console.log('ğŸ” addVendor: æ¥­è€…ä½œæˆé–‹å§‹:', vendor)\n\n      if (!user?.id) {\n        throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“')\n      }\n\n      // Convert camelCase to snake_case for database\n      const vendorData = {\n        name: vendor.name,\n        category: vendor.category,\n        contact_info: vendor.contactInfo || '',\n        is_active: vendor.isActive,\n        user_id: user.id\n      }\n\n      console.log('ğŸ” addVendor: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç”¨ã«å¤‰æ›:', vendorData)\n\n      const result = await createVendorDb(vendorData)\n\n      if (result.data) {\n        console.log('âœ… addVendor: æ¥­è€…ä½œæˆæˆåŠŸ:', result.data)\n        const newVendor: Vendor = {\n          id: result.data.id,\n          name: result.data.name,\n          category: result.data.category,\n          contactInfo: result.data.contact_info,\n          isActive: result.data.is_active,\n          createdAt: result.data.created_at,\n          updatedAt: result.data.updated_at\n        }\n        setVendors(prev => [...prev, newVendor])\n      } else if (result.error) {\n        console.error('âŒ addVendor: ã‚¨ãƒ©ãƒ¼:', result.error)\n        throw new Error(result.error.message || 'æ¥­è€…ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ')\n      }\n    } catch (err) {\n      console.error('âŒ æ¥­è€…ä½œæˆã‚¨ãƒ©ãƒ¼:', err)\n      throw err\n    }\n  }\n\n  const updateVendor: AdminCtx['updateVendor'] = async (id, patch) => {\n    try {\n      console.log('ğŸ” updateVendor: æ¥­è€…æ›´æ–°é–‹å§‹:', { id, patch })\n      \n      const updateData = {\n        name: patch.name,\n        category: patch.category,\n        contact_info: patch.contactInfo,\n        is_active: patch.isActive\n      }\n      \n      const result = await updateVendorDb(id, updateData)\n      \n      if (result.error) {\n        console.error('âŒ updateVendor: ã‚¨ãƒ©ãƒ¼:', result.error)\n        throw new Error(result.error.message || 'æ¥­è€…ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ')\n      } else {\n        console.log('âœ… updateVendor: æ¥­è€…æ›´æ–°æˆåŠŸ')\n      }\n      \n      setVendors(prev => prev.map(v => v.id === id ? { \n        ...v, \n        ...patch, \n        updatedAt: new Date().toISOString() \n      } : v))\n    } catch (err) {\n      console.error('âŒ æ¥­è€…æ›´æ–°ã‚¨ãƒ©ãƒ¼:', err)\n      throw err\n    }\n  }\n\n  const deleteVendor: AdminCtx['deleteVendor'] = async (id) => {\n    try {\n      console.log('ğŸ” deleteVendor: æ¥­è€…å‰Šé™¤é–‹å§‹:', id)\n      \n      const result = await deleteVendorDb(id)\n      \n      if (result.error) {\n        console.error('âŒ deleteVendor: ã‚¨ãƒ©ãƒ¼:', result.error)\n        throw new Error(result.error.message || 'æ¥­è€…ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ')\n      } else {\n        console.log('âœ… deleteVendor: æ¥­è€…å‰Šé™¤æˆåŠŸ')\n      }\n      \n      setVendors(prev => prev.map(v => v.id === id ? { ...v, isActive: false } : v))\n    } catch (err) {\n      console.error('âŒ æ¥­è€…å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', err)\n      throw err\n    }\n  }\n\n  const getStoreVendors = useCallback<AdminCtx['getStoreVendors']>((storeId) => {\n    // 'all'ã‚„ç©ºã®å ´åˆã¯ç©ºé…åˆ—ã‚’è¿”ã™\n    if (!storeId || storeId === 'all') {\n      console.log('ğŸ” getStoreVendors: storeId ãŒ \"all\" ã¾ãŸã¯ç©ºã®ãŸã‚ç©ºé…åˆ—ã‚’è¿”ã—ã¾ã™')\n      return []\n    }\n\n    // æ–‡å­—åˆ—åŒ–ã—ã¦æ¯”è¼ƒï¼ˆUUID / 'store-toyosu' ãªã©ã®å½¢å¼ã®é•ã„ã«å¯¾å¿œï¼‰\n    const sid = String(storeId)\n\n    console.log('ğŸ” getStoreVendors called:', {\n      requestedStoreId: sid,\n      totalAssignments: storeVendorAssignments.length,\n      totalVendors: vendors.length,\n      allStoreIds: [...new Set(storeVendorAssignments.map(a => a.storeId))]\n    })\n\n    const assignedVendorIds = storeVendorAssignments\n      .filter(a => {\n        const matches = String(a.storeId) === sid\n        if (!matches && storeVendorAssignments.length > 0) {\n          console.log('ğŸ” No match:', { assignmentStoreId: a.storeId, requestedStoreId: sid })\n        }\n        return matches\n      })\n      .sort((a, b) => (a.displayOrder ?? 0) - (b.displayOrder ?? 0))\n      .map(a => a.vendorId)\n\n    console.log('ğŸ” Assigned vendor IDs for store:', assignedVendorIds)\n\n    const result = assignedVendorIds\n      .map(vendorId => vendors.find(v => v.id === vendorId))\n      .filter((v): v is Vendor => !!v && v.isActive)\n\n    console.log('ğŸ” Final vendors:', result)\n    return result\n  }, [storeVendorAssignments, vendors])\n\n  const assignVendorToStore: AdminCtx['assignVendorToStore'] = async (storeId, vendorId) => {\n    try {\n      console.log('ğŸ”§ assignVendorToStore:', { storeId, vendorId })\n\n      const maxOrder = Math.max(\n        0,\n        ...storeVendorAssignments.filter(a => a.storeId === storeId).map(a => a.displayOrder)\n      )\n\n      const { data, error } = await assignVendorToStoreDb(storeId, vendorId, maxOrder + 1)\n\n      if (error) {\n        console.error('âŒ assignVendorToStoreDb error:', error)\n        throw new Error(error.message)\n      }\n\n      console.log('âœ… assignVendorToStoreDb success, updating state')\n\n      const newAssignment = {\n        storeId,\n        vendorId,\n        displayOrder: maxOrder + 1\n      }\n\n      setStoreVendorAssignments(prev => {\n        const updated = [...prev, newAssignment]\n        console.log('ğŸ“¦ Updated storeVendorAssignments:', updated)\n        return updated\n      })\n    } catch (err) {\n      console.error('âŒ æ¥­è€…å‰²ã‚Šå½“ã¦ã‚¨ãƒ©ãƒ¼:', err)\n      throw err\n    }\n  }\n\n  const unassignVendorFromStore: AdminCtx['unassignVendorFromStore'] = async (storeId, vendorId) => {\n    try {\n      const { error } = await removeVendorFromStoreDb(storeId, vendorId)\n      \n      if (error) {\n        throw new Error(error.message)\n      }\n      \n      setStoreVendorAssignments(prev => prev.filter(a => !(a.storeId === storeId && a.vendorId === vendorId)))\n    } catch (err) {\n      console.error('âŒ æ¥­è€…å‰²ã‚Šå½“ã¦è§£é™¤ã‚¨ãƒ©ãƒ¼:', err)\n      throw err\n    }\n  }\n\n  const value = useMemo<AdminCtx>(() => ({\n    stores, targets, vendors, storeVendorAssignments,\n    addStore, updateStore, deleteStore, upsertTarget, deleteTarget,\n    addVendor, updateVendor, deleteVendor, getStoreVendors,\n    assignVendorToStore, unassignVendorFromStore\n  }), [stores, targets, vendors, storeVendorAssignments])\n\n  return <AdminDataContext.Provider value={value}>{children}</AdminDataContext.Provider>\n}\n\nexport const useAdminData = () => {\n  const ctx = useContext(AdminDataContext)\n  if (!ctx) throw new Error('useAdminData must be used within AdminDataProvider')\n  return ctx\n}",
  "src/contexts/AuthContext.tsx": "import React, { createContext, useContext, useEffect, useMemo, useRef, useState, useCallback } from 'react'\nimport { supabase, isSupabaseReady } from '@/lib/supabase'\nimport type { User as SbUser } from '@supabase/supabase-js'\n\ntype Role = 'staff' | 'manager' | 'admin'\ninterface User {\n  id: string;\n  name: string;\n  email: string;\n  role: Role;\n  storeIds?: string[];\n  assignedStores?: {id:string;name:string}[];\n  organizationId?: string;\n}\n\ntype Ctx = {\n  user: User | null\n  loading: boolean\n  isInitialized: boolean\n  isAuthenticated: boolean\n  isSupabaseMode: boolean\n  signIn: (email: string, password: string) => Promise<{ data: any; error: null | { message: string } }>\n  signUp: (email: string, password: string, name: string, role: Role, organizationName?: string) => Promise<{ data: any; error: null | { message: string } }>\n  signOut: () => Promise<{ error: unknown | null }>\n  hasPermission: (role: Role) => boolean\n  canAccessStore: (storeId: string) => boolean\n  getAccessibleStores: () => Array<{ id: string; name: string }>\n  allStores: Array<{ id: string; name: string }>\n}\n\nconst AuthContext = createContext<Ctx | null>(null)\n\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null)\n  const [loading, setLoading] = useState(false)\n  const [isInitialized, setIsInitialized] = useState(false)\n  const [allStores, setAllStores] = useState<Array<{ id: string; name: string }>>([])\n\n  const initOnceRef = useRef(false)\n  const subscribedRef = useRef(false)\n\n  const composeUser = useCallback(async (sbUser: SbUser): Promise<User> => {\n    let name = sbUser.email?.split('@')[0] ?? 'user'\n    let role: Role = 'staff'\n    let assigned: { id: string; name: string }[] = []\n    let organizationId: string | undefined = undefined\n\n    console.log('ğŸ” Fetching profile for user:', sbUser.id)\n\n    // âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—\n    try {\n      const profilePromise = supabase.from('profiles').select('*').eq('id', sbUser.id).maybeSingle()\n      const timeoutPromise = new Promise<{ data: null; error: any }>((resolve) =>\n        setTimeout(() => resolve({ data: null, error: { message: 'Profile fetch timeout' } }), 5000)\n      )\n\n      const { data: profile, error } = await Promise.race([profilePromise, timeoutPromise])\n\n      if (error) {\n        console.error('âŒ Profile fetch error:', error)\n      } else if (profile) {\n        console.log('âœ… Profile found:', { name: profile.name, role: profile.role })\n        if (profile?.name) name = profile.name\n        if (profile?.role) role = profile.role as Role\n        if (profile?.organization_id) organizationId = profile.organization_id\n      } else {\n        console.warn('âš ï¸ No profile found, using defaults')\n      }\n    } catch (e) {\n      console.error('ğŸ’¥ Profile fetch exception:', e)\n    }\n\n    // âœ… çµ„ç¹”IDãŒå–å¾—ã§ãã¦ã„ãªã„å ´åˆã®ã¿ãƒ•ã‚§ãƒƒãƒ\n    if (!organizationId) {\n      try {\n        const orgPromise = supabase\n          .from('organization_members')\n          .select('organization_id')\n          .eq('user_id', sbUser.id)\n          .maybeSingle()\n        const orgTimeout = new Promise<{ data: null }>((resolve) =>\n          setTimeout(() => resolve({ data: null }), 3000)\n        )\n        const { data: memberData } = await Promise.race([orgPromise, orgTimeout])\n        if (memberData?.organization_id) {\n          organizationId = memberData.organization_id\n        }\n      } catch (e) {\n        console.error('Failed to fetch organization membership:', e)\n      }\n    }\n\n    // âœ… ã‚¹ãƒˆã‚¢å‰²ã‚Šå½“ã¦å–å¾—ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãï¼‰\n    try {\n      const assignPromise = supabase\n        .from('store_assignments')\n        .select('store_id, stores!inner(id, name)')\n        .eq('user_id', sbUser.id)\n      const assignTimeout = new Promise<{ data: null }>((resolve) =>\n        setTimeout(() => resolve({ data: null }), 3000)\n      )\n      const { data: assigns } = await Promise.race([assignPromise, assignTimeout])\n      assigned = (assigns ?? []).map((a: any) => ({ id: a.stores.id, name: a.stores.name }))\n    } catch (e) {\n      console.error('Failed to fetch store assignments:', e)\n    }\n\n    console.log('Composed user:', { id: sbUser.id, email: sbUser.email, role, name, organizationId })\n\n    return {\n      id: sbUser.id,\n      name,\n      email: sbUser.email ?? '',\n      role,\n      storeIds: assigned.map(s => s.id),\n      assignedStores: assigned,\n      organizationId,\n    }\n  }, [])\n\n  useEffect(() => {\n    if (initOnceRef.current) return\n    initOnceRef.current = true\n\n    const init = async () => {\n      if (!isSupabaseReady()) {\n        setIsInitialized(true)\n        return\n      }\n      try {\n        const sessionPromise = supabase.auth.getSession()\n        const timeout = new Promise<{data:{session:null}}>(res => setTimeout(() => res({data:{session:null}}), 3000))\n        const { data: { session } } = await Promise.race([sessionPromise, timeout]) as any\n        if (session?.user) {\n          setUser(await composeUser(session.user))\n        }\n\n        const { data: stores } = await supabase.from('stores').select('id, name').eq('is_active', true).order('name')\n        if (stores) {\n          setAllStores(stores)\n        }\n      } finally {\n        setIsInitialized(true)\n      }\n    }\n    init()\n  }, [composeUser])\n\n  useEffect(() => {\n    if (subscribedRef.current) return\n    subscribedRef.current = true\n\n    // âœ… CRITICAL: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯asyncã«ã›ãšã€å†…éƒ¨ã§asyncãƒ–ãƒ­ãƒƒã‚¯ã‚’å®Ÿè¡Œ\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\n      console.log('ğŸ” onAuthStateChange:', event)\n\n      if ((event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') && session?.user) {\n        // âœ… éåŒæœŸå‡¦ç†ã¯å³åº§å®Ÿè¡Œé–¢æ•°ã§å›²ã‚€ï¼ˆãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯é˜²æ­¢ï¼‰\n        (async () => {\n          try {\n            const composedUser = await composeUser(session.user)\n            setUser(composedUser)\n          } catch (err) {\n            console.error('âŒ Failed to compose user:', err)\n            setUser(null)\n          }\n        })()\n      } else if (event === 'SIGNED_OUT') {\n        setUser(null)\n      }\n    })\n    return () => subscription.unsubscribe()\n  }, [composeUser])\n\n  const signIn = useCallback(async (email: string, password: string) => {\n    if (!isSupabaseReady()) return { data: null, error: { message: 'Supabase not configured' } }\n    setLoading(true)\n    try {\n      const { data, error } = await supabase.auth.signInWithPassword({ email, password })\n      if (error) return { data: null, error: { message: error.message } }\n      const u = await composeUser(data.user)\n      setUser(u)\n      return { data: u, error: null }\n    } finally {\n      setLoading(false)\n    }\n  }, [composeUser])\n\n  const signUp = useCallback(async (email: string, password: string, name: string, role: Role = 'staff', organizationName?: string) => {\n    if (!isSupabaseReady()) return { data: null, error: { message: 'Supabase not configured' } }\n    setLoading(true)\n    try {\n      const { data, error } = await supabase.auth.signUp({\n        email,\n        password,\n        options: {\n          data: {\n            name,\n            role,\n            organizationName: organizationName || `${name}ã®çµ„ç¹”`\n          }\n        }\n      })\n      if (error) return { data: null, error: { message: error.message } }\n      return { data, error: null }\n    } finally {\n      setLoading(false)\n    }\n  }, [])\n\n  const signOut = useCallback(async () => {\n    const { error } = await supabase.auth.signOut()\n    setUser(null)\n    return { error }\n  }, [])\n\n  const hasPermission = useCallback((req: Role) => {\n    if (!user) return false\n    const levels = { staff: 1, manager: 2, admin: 3 }\n    return levels[user.role] >= levels[req]\n  }, [user])\n\n  const canAccessStore = useCallback((storeId: string) => {\n    if (!user) return false\n    return user.role === 'admin' || user.storeIds?.includes(storeId) === true\n  }, [user])\n\n  const getAccessibleStores = useCallback(() => {\n    return user?.role === 'admin' ? allStores : (user?.assignedStores ?? [])\n  }, [user, allStores])\n\n  const value = useMemo<Ctx>(() => ({\n    user,\n    loading,\n    isInitialized,\n    isAuthenticated: !!user,\n    isSupabaseMode: isSupabaseReady(),\n    signIn, signUp, signOut,\n    hasPermission,\n    canAccessStore,\n    getAccessibleStores,\n    allStores,\n  }), [user, loading, isInitialized, allStores, signIn, signUp, signOut, hasPermission, canAccessStore, getAccessibleStores])\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>\n}\n\nexport const useAuth = () => {\n  const c = useContext(AuthContext)\n  if (!c) throw new Error('useAuth must be used within AuthProvider')\n  return c\n}\n",
  "src/contexts/OrganizationContext.tsx": "import React, { createContext, useContext, useEffect, useState, useMemo, useCallback } from 'react'\nimport { supabase, isSupabaseReady } from '@/lib/supabase'\nimport type { Organization, OrganizationMember } from '@/types'\n\ninterface OrganizationContextType {\n  organization: Organization | null\n  organizationRole: 'owner' | 'admin' | 'member' | null\n  loading: boolean\n  isInitialized: boolean\n  refreshOrganization: () => Promise<void>\n  isOwner: boolean\n  isAdmin: boolean\n  canManageOrganization: boolean\n  withinLimits: {\n    stores: boolean\n    users: boolean\n    aiRequests: boolean\n  }\n  currentUsage: {\n    stores: number\n    users: number\n    aiRequestsThisMonth: number\n  }\n}\n\nconst OrganizationContext = createContext<OrganizationContextType | null>(null)\n\nexport const OrganizationProvider: React.FC<{ children: React.ReactNode; userId: string | null }> = ({\n  children,\n  userId\n}) => {\n  const [organization, setOrganization] = useState<Organization | null>(null)\n  const [organizationRole, setOrganizationRole] = useState<'owner' | 'admin' | 'member' | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [isInitialized, setIsInitialized] = useState(false)\n  const [currentUsage, setCurrentUsage] = useState({\n    stores: 0,\n    users: 0,\n    aiRequestsThisMonth: 0\n  })\n\n  const fetchOrganization = useCallback(async () => {\n    if (!userId || !isSupabaseReady()) {\n      setLoading(false)\n      setIsInitialized(true)\n      return\n    }\n\n    try {\n      setLoading(true)\n\n      const { data: memberData, error: memberError } = await supabase\n        .from('organization_members')\n        .select('organization_id, role')\n        .eq('user_id', userId)\n        .maybeSingle()\n\n      if (memberError) {\n        console.error('Failed to fetch organization membership:', memberError)\n        return\n      }\n\n      if (!memberData) {\n        console.log('User is not a member of any organization')\n        setOrganization(null)\n        setOrganizationRole(null)\n        return\n      }\n\n      setOrganizationRole(memberData.role)\n\n      const { data: orgData, error: orgError } = await supabase\n        .from('organizations')\n        .select('*')\n        .eq('id', memberData.organization_id)\n        .single()\n\n      if (orgError) {\n        console.error('Failed to fetch organization:', orgError)\n        return\n      }\n\n      setOrganization({\n        id: orgData.id,\n        name: orgData.name,\n        slug: orgData.slug,\n        email: orgData.email,\n        phone: orgData.phone,\n        subscriptionStatus: orgData.subscription_status,\n        subscriptionPlan: orgData.subscription_plan,\n        trialEndsAt: orgData.trial_ends_at,\n        maxStores: orgData.max_stores,\n        maxUsers: orgData.max_users,\n        maxAiRequestsPerMonth: orgData.max_ai_requests_per_month,\n        settings: orgData.settings,\n        createdAt: orgData.created_at,\n        updatedAt: orgData.updated_at\n      })\n\n      const { count: storesCount } = await supabase\n        .from('stores')\n        .select('*', { count: 'exact', head: true })\n        .eq('organization_id', memberData.organization_id)\n\n      const { count: usersCount } = await supabase\n        .from('organization_members')\n        .select('*', { count: 'exact', head: true })\n        .eq('organization_id', memberData.organization_id)\n\n      const startOfMonth = new Date()\n      startOfMonth.setDate(1)\n      startOfMonth.setHours(0, 0, 0, 0)\n\n      const { count: aiRequestsCount } = await supabase\n        .from('ai_usage_tracking')\n        .select('*', { count: 'exact', head: true })\n        .eq('organization_id', memberData.organization_id)\n        .gte('created_at', startOfMonth.toISOString())\n\n      setCurrentUsage({\n        stores: storesCount || 0,\n        users: usersCount || 0,\n        aiRequestsThisMonth: aiRequestsCount || 0\n      })\n\n    } catch (error) {\n      console.error('Error fetching organization:', error)\n    } finally {\n      setLoading(false)\n      setIsInitialized(true)\n    }\n  }, [userId])\n\n  useEffect(() => {\n    fetchOrganization()\n  }, [fetchOrganization])\n\n  const isOwner = organizationRole === 'owner'\n  const isAdmin = organizationRole === 'admin' || organizationRole === 'owner'\n  const canManageOrganization = isAdmin\n\n  const withinLimits = useMemo(() => ({\n    stores: !organization || currentUsage.stores < organization.maxStores,\n    users: !organization || currentUsage.users < organization.maxUsers,\n    aiRequests: !organization || currentUsage.aiRequestsThisMonth < organization.maxAiRequestsPerMonth\n  }), [organization, currentUsage])\n\n  const value = useMemo<OrganizationContextType>(() => ({\n    organization,\n    organizationRole,\n    loading,\n    isInitialized,\n    refreshOrganization: fetchOrganization,\n    isOwner,\n    isAdmin,\n    canManageOrganization,\n    withinLimits,\n    currentUsage\n  }), [\n    organization,\n    organizationRole,\n    loading,\n    isInitialized,\n    fetchOrganization,\n    isOwner,\n    isAdmin,\n    canManageOrganization,\n    withinLimits,\n    currentUsage\n  ])\n\n  return (\n    <OrganizationContext.Provider value={value}>\n      {children}\n    </OrganizationContext.Provider>\n  )\n}\n\nexport const useOrganization = () => {\n  const context = useContext(OrganizationContext)\n  if (!context) {\n    throw new Error('useOrganization must be used within OrganizationProvider')\n  }\n  return context\n}\n",
  "src/contexts/StoreContext.tsx": "import React, { createContext, useContext, useState } from 'react'\n\ntype StoreContextType = { \n  storeId: string\n  setStoreId: (storeId: string) => void \n}\n\nconst StoreContext = createContext<StoreContextType | null>(null)\n\nexport const StoreProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [storeId, setStoreId] = useState<string>('all')\n  \n  return (\n    <StoreContext.Provider value={{ storeId, setStoreId }}>\n      {children}\n    </StoreContext.Provider>\n  )\n}\n\nexport const useStore = () => {\n  const ctx = useContext(StoreContext)\n  if (!ctx) {\n    throw new Error('useStore must be used within StoreProvider')\n  }\n  return ctx\n}",
  "src/hooks/useAIReports.ts": "import { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\n\nexport interface AIReport {\n  id: string;\n  store_id: string | null;\n  report_type: 'weekly' | 'monthly';\n  period_start: string;\n  period_end: string;\n  title: string;\n  summary: string;\n  analysis_content: {\n    salesTrend?: string;\n    profitability?: string;\n    costStructure?: string;\n    storeComparison?: string;\n  };\n  key_insights: string[];\n  recommendations: string[];\n  metrics: {\n    totalSales: number;\n    totalExpenses: number;\n    grossProfit: number;\n    operatingProfit: number;\n    profitMargin: number;\n    costRate: number;\n    laborRate: number;\n    storeBreakdown?: Array<{\n      storeId: string;\n      storeName: string;\n      sales: number;\n      expenses: number;\n      profit: number;\n      profitMargin: number;\n      costRate: number;\n      laborRate: number;\n    }>;\n  };\n  generated_by: string;\n  generated_at: string;\n  created_at: string;\n}\n\nexport interface ReportSchedule {\n  id: string;\n  report_type: 'weekly' | 'monthly';\n  store_id: string | null;\n  is_enabled: boolean;\n  cron_expression: string;\n  last_run_at: string | null;\n  next_run_at: string | null;\n  notification_emails: string[];\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface ReportGenerationLog {\n  id: string;\n  schedule_id: string | null;\n  report_id: string | null;\n  report_type: 'weekly' | 'monthly';\n  store_id: string | null;\n  status: 'success' | 'failed' | 'in_progress';\n  started_at: string;\n  completed_at: string | null;\n  error_message: string | null;\n  data_summary: {\n    reportCount?: number;\n    storeCount?: number;\n  };\n  created_at: string;\n}\n\nexport function useAIReports(storeId?: string) {\n  const [reports, setReports] = useState<AIReport[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchReports = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      let query = supabase\n        .from('ai_generated_reports')\n        .select('*')\n        .order('generated_at', { ascending: false });\n\n      if (storeId) {\n        query = query.eq('store_id', storeId);\n      }\n\n      const { data, error: fetchError } = await query;\n\n      if (fetchError) throw fetchError;\n\n      setReports(data || []);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch reports');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const deleteReport = async (reportId: string) => {\n    try {\n      const { error: deleteError } = await supabase\n        .from('ai_generated_reports')\n        .delete()\n        .eq('id', reportId);\n\n      if (deleteError) throw deleteError;\n\n      await fetchReports();\n      return { error: null };\n    } catch (err) {\n      return { error: err instanceof Error ? err.message : 'Failed to delete report' };\n    }\n  };\n\n  useEffect(() => {\n    fetchReports();\n  }, [storeId]);\n\n  return { reports, loading, error, refetch: fetchReports, deleteReport };\n}\n\nexport function useReportSchedules() {\n  const [schedules, setSchedules] = useState<ReportSchedule[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchSchedules = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const { data, error: fetchError } = await supabase\n        .from('report_schedules')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (fetchError) throw fetchError;\n\n      setSchedules(data || []);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch schedules');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const createSchedule = async (schedule: Omit<ReportSchedule, 'id' | 'created_at' | 'updated_at' | 'last_run_at' | 'next_run_at'>) => {\n    try {\n      const { data, error: insertError } = await supabase\n        .from('report_schedules')\n        .insert(schedule)\n        .select()\n        .single();\n\n      if (insertError) throw insertError;\n\n      await fetchSchedules();\n      return { data, error: null };\n    } catch (err) {\n      return { data: null, error: err instanceof Error ? err.message : 'Failed to create schedule' };\n    }\n  };\n\n  const updateSchedule = async (id: string, updates: Partial<ReportSchedule>) => {\n    try {\n      const { data, error: updateError } = await supabase\n        .from('report_schedules')\n        .update({ ...updates, updated_at: new Date().toISOString() })\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (updateError) throw updateError;\n\n      await fetchSchedules();\n      return { data, error: null };\n    } catch (err) {\n      return { data: null, error: err instanceof Error ? err.message : 'Failed to update schedule' };\n    }\n  };\n\n  const deleteSchedule = async (id: string) => {\n    try {\n      const { error: deleteError } = await supabase\n        .from('report_schedules')\n        .delete()\n        .eq('id', id);\n\n      if (deleteError) throw deleteError;\n\n      await fetchSchedules();\n      return { error: null };\n    } catch (err) {\n      return { error: err instanceof Error ? err.message : 'Failed to delete schedule' };\n    }\n  };\n\n  useEffect(() => {\n    fetchSchedules();\n  }, []);\n\n  return {\n    schedules,\n    loading,\n    error,\n    refetch: fetchSchedules,\n    createSchedule,\n    updateSchedule,\n    deleteSchedule,\n  };\n}\n\nexport function useReportGenerationLogs() {\n  const [logs, setLogs] = useState<ReportGenerationLog[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchLogs = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const { data, error: fetchError } = await supabase\n        .from('report_generation_logs')\n        .select('*')\n        .order('started_at', { ascending: false })\n        .limit(50);\n\n      if (fetchError) throw fetchError;\n\n      setLogs(data || []);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch logs');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchLogs();\n  }, []);\n\n  return { logs, loading, error, refetch: fetchLogs };\n}\n\nexport async function generateReport(\n  reportType: 'weekly' | 'monthly',\n  storeId?: string,\n  periodStart?: string,\n  periodEnd?: string\n) {\n  try {\n    const { data: { session } } = await supabase.auth.getSession();\n\n    if (!session) {\n      throw new Error('Not authenticated');\n    }\n\n    const url = `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/generate-ai-report`;\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${session.access_token}`,\n      },\n      body: JSON.stringify({\n        reportType,\n        storeId: storeId || null,\n        periodStart: periodStart || null,\n        periodEnd: periodEnd || null,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.error || 'Failed to generate report');\n    }\n\n    const result = await response.json();\n    return { data: result.report, error: null };\n  } catch (err) {\n    return { data: null, error: err instanceof Error ? err.message : 'Failed to generate report' };\n  }\n}\n",
  "src/hooks/useAIUsageLimit.ts": "import { useState, useEffect, useCallback } from 'react'\nimport { supabase } from '@/lib/supabase'\n\nexport interface AIUsageStatus {\n  currentCount: number\n  dailyLimit: number\n  remaining: number\n  resetAt: string\n  isLimited: boolean\n}\n\nexport interface AIUsageLimitResult {\n  status: AIUsageStatus | null\n  loading: boolean\n  error: string | null\n  refresh: () => Promise<void>\n}\n\nexport function useAIUsageLimit(userId: string | undefined): AIUsageLimitResult {\n  const [status, setStatus] = useState<AIUsageStatus | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  const fetchUsageStatus = useCallback(async () => {\n    if (!userId || !supabase) {\n      setStatus(null)\n      setLoading(false)\n      return\n    }\n\n    try {\n      setLoading(true)\n      setError(null)\n\n      const { data, error: rpcError } = await supabase.rpc('get_user_usage_status', {\n        p_user_id: userId\n      })\n\n      if (rpcError) {\n        console.error('Failed to fetch usage status:', rpcError)\n        setError(rpcError.message)\n        setStatus(null)\n      } else if (data) {\n        setStatus({\n          currentCount: data.current_count ?? 0,\n          dailyLimit: data.daily_limit ?? 5,\n          remaining: data.remaining ?? 0,\n          resetAt: data.reset_at ?? new Date().toISOString(),\n          isLimited: data.is_limited ?? false\n        })\n      }\n    } catch (err) {\n      console.error('Error fetching usage status:', err)\n      setError(err instanceof Error ? err.message : 'Unknown error')\n      setStatus(null)\n    } finally {\n      setLoading(false)\n    }\n  }, [userId])\n\n  const refresh = useCallback(async () => {\n    await fetchUsageStatus()\n  }, [fetchUsageStatus])\n\n  useEffect(() => {\n    fetchUsageStatus()\n\n    if (!userId || !supabase) return\n\n    const channel = supabase\n      .channel('ai-usage-changes')\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'ai_usage_tracking',\n          filter: `user_id=eq.${userId}`\n        },\n        () => {\n          fetchUsageStatus()\n        }\n      )\n      .subscribe()\n\n    return () => {\n      supabase.removeChannel(channel)\n    }\n  }, [userId, fetchUsageStatus])\n\n  return {\n    status,\n    loading,\n    error,\n    refresh\n  }\n}\n",
  "src/hooks/useChatArchive.ts": "import { useEffect, useState, useCallback } from 'react'\nimport {\n  createConversation,\n  listConversations,\n  fetchMessages,\n  addMessage,\n  updateConversation,\n  searchConversations,\n  deleteConversation,\n  type Message,\n  type Conversation\n} from '../services/chatArchive'\n\nexport function useChatArchive(\n  userId: string,\n  initialStoreId: string = 'all',\n  initialConversationId?: string\n) {\n  const [conversationId, setConversationId] = useState<string | null>(\n    initialConversationId ?? null\n  )\n  const [messages, setMessages] = useState<Message[]>([])\n  const [conversations, setConversations] = useState<Conversation[]>([])\n  const [loading, setLoading] = useState(false)\n\n  const loadConversations = useCallback(async () => {\n    const { data } = await listConversations()\n    setConversations(data ?? [])\n  }, [])\n\n  const startNewConversation = useCallback(\n    async (storeId: string = initialStoreId, title?: string) => {\n      const { data, error } = await createConversation(userId, storeId, title)\n      if (!error && data) {\n        setConversationId(data.id)\n        localStorage.setItem('last_conv', data.id)\n        await loadConversations()\n        setMessages([])\n      }\n      return { data, error }\n    },\n    [userId, initialStoreId, loadConversations]\n  )\n\n  const loadMessages = useCallback(async (convId: string) => {\n    setLoading(true)\n    setConversationId(convId)\n    localStorage.setItem('last_conv', convId)\n    const { data } = await fetchMessages(convId)\n    setMessages(data ?? [])\n    setLoading(false)\n  }, [])\n\n  const sendUserMessage = useCallback(\n    async (content: string) => {\n      let conv = conversationId\n      if (!conv) {\n        const { data, error: convError } = await startNewConversation(initialStoreId, 'æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ')\n        conv = data?.id ?? null\n        if (!conv || convError) {\n          return { data: null, error: convError || { message: 'ä¼šè©±ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ' } }\n        }\n      }\n\n      const { data, error } = await addMessage(conv, 'user', content)\n      if (data) {\n        setMessages(prev => [...prev, data])\n      }\n      return { data, error, conversationId: conv }\n    },\n    [conversationId, initialStoreId, startNewConversation]\n  )\n\n  const appendAssistantMessage = useCallback(\n    async (content: string, meta?: any, explicitConvId?: string) => {\n      const convId = explicitConvId || conversationId\n      if (!convId) return { data: null, error: { message: 'ä¼šè©±ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“' } }\n      const { data, error } = await addMessage(convId, 'assistant', content, meta)\n      if (data) {\n        setMessages(prev => [...prev, data])\n      }\n      return { data, error }\n    },\n    [conversationId]\n  )\n\n  const renameConversation = useCallback(\n    async (title: string) => {\n      if (!conversationId) return\n      await updateConversation(conversationId, { title })\n      await loadConversations()\n    },\n    [conversationId, loadConversations]\n  )\n\n  const archiveConversation = useCallback(\n    async (convId: string) => {\n      await updateConversation(convId, { archived: true })\n      await loadConversations()\n      if (conversationId === convId) {\n        setConversationId(null)\n        setMessages([])\n        localStorage.removeItem('last_conv')\n      }\n    },\n    [conversationId, loadConversations]\n  )\n\n  const removeConversation = useCallback(\n    async (convId: string) => {\n      await deleteConversation(convId)\n      await loadConversations()\n      if (conversationId === convId) {\n        setConversationId(null)\n        setMessages([])\n        localStorage.removeItem('last_conv')\n      }\n    },\n    [conversationId, loadConversations]\n  )\n\n  const search = useCallback(async (q: string) => {\n    if (!q.trim()) return []\n    const { data } = await searchConversations(q.trim())\n    return data ?? []\n  }, [])\n\n  useEffect(() => {\n    (async () => {\n      await loadConversations()\n      const last = initialConversationId || localStorage.getItem('last_conv')\n      if (last) {\n        await loadMessages(last)\n      } else {\n        await startNewConversation(initialStoreId, 'æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ')\n      }\n    })()\n  }, [])\n\n  return {\n    conversationId,\n    messages,\n    conversations,\n    loading,\n    startNewConversation,\n    loadMessages,\n    sendUserMessage,\n    appendAssistantMessage,\n    renameConversation,\n    archiveConversation,\n    removeConversation,\n    search\n  }\n}\n",
  "src/hooks/useDailyTarget.ts": "import { useState, useEffect, useCallback } from 'react'\nimport { getDailyTarget, upsertDailyTarget, deleteDailyTarget } from '@/services/supabase'\nimport { DailyTargetData } from '@/types'\n\nexport const useDailyTarget = (storeId: string | null, date: string) => {\n  const [target, setTarget] = useState<DailyTargetData | null>(null)\n  const [isLoading, setIsLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const fetchTarget = useCallback(async () => {\n    if (!storeId || storeId === 'all') {\n      setTarget(null)\n      return\n    }\n\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const { data, error: fetchError } = await getDailyTarget(storeId, date)\n\n      if (fetchError) {\n        console.error('æ—¥åˆ¥ç›®æ¨™ã®å–å¾—ã‚¨ãƒ©ãƒ¼:', fetchError)\n        setError('ç›®æ¨™ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        setTarget(null)\n      } else if (data) {\n        setTarget({\n          id: data.id,\n          storeId: data.store_id,\n          date: data.date,\n          targetSales: data.target_sales,\n          createdAt: data.created_at,\n          updatedAt: data.updated_at\n        })\n      } else {\n        setTarget(null)\n      }\n    } catch (e) {\n      console.error('æ—¥åˆ¥ç›®æ¨™ã®å–å¾—ã‚¨ãƒ©ãƒ¼:', e)\n      setError('ç›®æ¨™ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n      setTarget(null)\n    } finally {\n      setIsLoading(false)\n    }\n  }, [storeId, date])\n\n  useEffect(() => {\n    fetchTarget()\n  }, [fetchTarget])\n\n  const saveTarget = useCallback(async (targetSales: number) => {\n    if (!storeId || storeId === 'all') {\n      setError('åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„')\n      return { success: false, error: 'åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„' }\n    }\n\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const { data, error: saveError } = await upsertDailyTarget({\n        storeId,\n        date,\n        targetSales\n      })\n\n      if (saveError) {\n        console.error('æ—¥åˆ¥ç›®æ¨™ã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:', saveError)\n        setError('ç›®æ¨™ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return { success: false, error: 'ç›®æ¨™ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ' }\n      }\n\n      if (data) {\n        setTarget({\n          id: data.id,\n          storeId: data.store_id,\n          date: data.date,\n          targetSales: data.target_sales,\n          createdAt: data.created_at,\n          updatedAt: data.updated_at\n        })\n      }\n\n      return { success: true, error: null }\n    } catch (e) {\n      console.error('æ—¥åˆ¥ç›®æ¨™ã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:', e)\n      setError('ç›®æ¨™ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ')\n      return { success: false, error: 'ç›®æ¨™ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ' }\n    } finally {\n      setIsLoading(false)\n    }\n  }, [storeId, date])\n\n  const removeTarget = useCallback(async () => {\n    if (!storeId || storeId === 'all') {\n      setError('åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„')\n      return { success: false, error: 'åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„' }\n    }\n\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const { error: deleteError } = await deleteDailyTarget(storeId, date)\n\n      if (deleteError) {\n        console.error('æ—¥åˆ¥ç›®æ¨™ã®å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', deleteError)\n        setError('ç›®æ¨™ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return { success: false, error: 'ç›®æ¨™ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ' }\n      }\n\n      setTarget(null)\n      return { success: true, error: null }\n    } catch (e) {\n      console.error('æ—¥åˆ¥ç›®æ¨™ã®å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', e)\n      setError('ç›®æ¨™ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ')\n      return { success: false, error: 'ç›®æ¨™ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ' }\n    } finally {\n      setIsLoading(false)\n    }\n  }, [storeId, date])\n\n  return {\n    target,\n    isLoading,\n    error,\n    saveTarget,\n    removeTarget,\n    refetch: fetchTarget\n  }\n}\n",
  "src/hooks/useExpenseBaseline.ts": "import { useEffect, useState, useMemo } from 'react'\nimport { getExpenseBaseline, ExpenseBaselineDb } from '@/services/supabase'\n\n// âœ… \"storeId-YYYY-MM\" å˜ä½ã§ã€Œå­˜åœ¨ã—ãªã„ã€ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ404å†è©¦è¡Œé˜²æ­¢ï¼‰\nconst NO_BASELINE_CACHE = new Set<string>()\n\nexport interface DailyExpenseReference {\n  laborCost: number\n  utilities: number\n  rent: number\n  consumables: number\n  promotion: number\n  cleaning: number\n  misc: number\n  communication: number\n  others: number\n  sumOther: number\n  totalExpense: number\n}\n\nexport interface MonthlyExpenseReference {\n  laborCost: number\n  utilities: number\n  rent: number\n  consumables: number\n  promotion: number\n  cleaning: number\n  misc: number\n  communication: number\n  others: number\n  sumOther: number\n  totalExpense: number\n}\n\nexport const useExpenseBaseline = (storeId?: string, yyyymm?: string) => {\n  // âœ… å®‰å®šã‚­ãƒ¼ç”Ÿæˆ\n  const cacheKey = useMemo(() => (storeId && yyyymm) ? `${storeId}-${yyyymm}` : '', [storeId, yyyymm])\n\n  const [daily, setDaily] = useState<DailyExpenseReference>({\n    laborCost: 0,\n    utilities: 0,\n    rent: 0,\n    consumables: 0,\n    promotion: 0,\n    cleaning: 0,\n    misc: 0,\n    communication: 0,\n    others: 0,\n    sumOther: 0,\n    totalExpense: 0\n  })\n  const [monthlyTotal, setMonthlyTotal] = useState<MonthlyExpenseReference>({\n    laborCost: 0,\n    utilities: 0,\n    rent: 0,\n    consumables: 0,\n    promotion: 0,\n    cleaning: 0,\n    misc: 0,\n    communication: 0,\n    others: 0,\n    sumOther: 0,\n    totalExpense: 0\n  })\n  const [monthly, setMonthly] = useState<ExpenseBaselineDb | null>(null)\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    const loadBaseline = async () => {\n      if (!cacheKey || storeId === 'all') {\n        const emptyExpense = {\n          laborCost: 0,\n          utilities: 0,\n          rent: 0,\n          consumables: 0,\n          promotion: 0,\n          cleaning: 0,\n          misc: 0,\n          communication: 0,\n          others: 0,\n          sumOther: 0,\n          totalExpense: 0\n        }\n        setDaily(emptyExpense)\n        setMonthlyTotal(emptyExpense)\n        setMonthly(null)\n        return\n      }\n\n      // âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã€Œå­˜åœ¨ã—ãªã„ã€è¨˜éŒ²ãŒã‚ã‚Œã°å†è©¦è¡Œã—ãªã„\n      if (NO_BASELINE_CACHE.has(cacheKey)) {\n        console.log(`ğŸ“‹ useExpenseBaseline: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ (å­˜åœ¨ã—ãªã„): ${cacheKey}`)\n        const emptyExpense = {\n          laborCost: 0,\n          utilities: 0,\n          rent: 0,\n          consumables: 0,\n          promotion: 0,\n          cleaning: 0,\n          misc: 0,\n          communication: 0,\n          others: 0,\n          sumOther: 0,\n          totalExpense: 0\n        }\n        setDaily(emptyExpense)\n        setMonthlyTotal(emptyExpense)\n        setMonthly(null)\n        setLoading(false)\n        return\n      }\n\n      setLoading(true)\n      setError(null)\n\n      try {\n        const { data, error: fetchError } = await getExpenseBaseline(storeId!, yyyymm!)\n\n        if (fetchError) {\n          // âœ… 404ç³»ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã—ãªã„ or ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰ã¯ã€Œå­˜åœ¨ã—ãªã„ã€ã¨ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥\n          const errorCode = (fetchError as any)?.code\n          const errorMessage = fetchError.message || ''\n\n          if (errorCode === 'PGRST116' || // Postgrest: relation does not exist\n              errorCode === 'PGRST205' || // Could not find the table\n              errorMessage.includes('Could not find the table') ||\n              errorMessage.includes('relation') && errorMessage.includes('does not exist')) {\n            console.log(`âš ï¸ useExpenseBaseline: ãƒ†ãƒ¼ãƒ–ãƒ«/ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¾ã›ã‚“ (404) - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¾ã™: ${cacheKey}`)\n            NO_BASELINE_CACHE.add(cacheKey)\n\n            const emptyExpense = {\n              laborCost: 0,\n              utilities: 0,\n              rent: 0,\n              consumables: 0,\n              promotion: 0,\n              cleaning: 0,\n              misc: 0,\n              communication: 0,\n              others: 0,\n              sumOther: 0,\n              totalExpense: 0\n            }\n            setDaily(emptyExpense)\n            setMonthlyTotal(emptyExpense)\n            setMonthly(null)\n            setLoading(false)\n            return\n          }\n\n          // âœ… ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ã¯é€šå¸¸å‡¦ç†\n          console.error('useExpenseBaseline: ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼', fetchError)\n          setError(fetchError.message || 'ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n          setLoading(false)\n          return\n        }\n\n        // æœˆã®æ—¥æ•°ã‚’è¨ˆç®—\n        const [year, month] = yyyymm.split('-').map(Number)\n        const daysInMonth = new Date(year, month, 0).getDate()\n        const openDays = data?.open_days || daysInMonth\n\n        // æ—¥å‰²ã‚Šè¨ˆç®—é–¢æ•°\n        const perDay = (value?: number) => Math.round((value || 0) / Math.max(openDays, 1))\n\n        // æ—¥å‰²ã‚ŠçµŒè²»ã‚’è¨ˆç®—\n        const laborCost = perDay((data?.labor_cost_employee || 0) + (data?.labor_cost_part_time || 0))\n        const utilities = perDay(data?.utilities)\n        const rent = perDay(data?.rent)\n        const consumables = perDay(data?.consumables)\n        const promotion = perDay(data?.promotion)\n        const cleaning = perDay(data?.cleaning)\n        const misc = perDay(data?.misc)\n        const communication = perDay(data?.communication)\n        const others = perDay(data?.others)\n\n        const sumOther = utilities + rent + consumables + promotion + cleaning + misc + communication + others\n        const totalExpense = laborCost + sumOther\n\n        setDaily({\n          laborCost,\n          utilities,\n          rent,\n          consumables,\n          promotion,\n          cleaning,\n          misc,\n          communication,\n          others,\n          sumOther,\n          totalExpense\n        })\n\n        // æœˆæ¬¡åˆè¨ˆã‚’è¨ˆç®—\n        const monthlyLaborCost = (data?.labor_cost_employee || 0) + (data?.labor_cost_part_time || 0)\n        const monthlyUtilities = data?.utilities || 0\n        const monthlyRent = data?.rent || 0\n        const monthlyConsumables = data?.consumables || 0\n        const monthlyPromotion = data?.promotion || 0\n        const monthlyCleaning = data?.cleaning || 0\n        const monthlyMisc = data?.misc || 0\n        const monthlyCommunication = data?.communication || 0\n        const monthlyOthers = data?.others || 0\n\n        const monthlySumOther = monthlyUtilities + monthlyRent + monthlyConsumables +\n                                monthlyPromotion + monthlyCleaning + monthlyMisc + monthlyCommunication + monthlyOthers\n\n        setMonthlyTotal({\n          laborCost: monthlyLaborCost,\n          utilities: monthlyUtilities,\n          rent: monthlyRent,\n          consumables: monthlyConsumables,\n          promotion: monthlyPromotion,\n          cleaning: monthlyCleaning,\n          misc: monthlyMisc,\n          communication: monthlyCommunication,\n          others: monthlyOthers,\n          sumOther: monthlySumOther,\n          totalExpense: monthlyLaborCost + monthlySumOther\n        })\n        setMonthly(data)\n      } catch (err) {\n        console.error('useExpenseBaseline: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼', err)\n        setError(err instanceof Error ? err.message : 'äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ')\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    loadBaseline()\n  }, [cacheKey, storeId, yyyymm])\n\n  return {\n    expenseBaseline: daily,\n    monthlyExpenseBaseline: monthlyTotal,\n    monthly,\n    loading,\n    error\n  }\n}\n",
  "src/hooks/useKpis.ts": "import { useMemo } from 'react'\nimport { DailyReportData } from '@/types'\n\nexport interface KPIData {\n  totalSales: number\n  totalExpenses: number\n  grossProfit: number\n  operatingProfit: number\n  profitMargin: number\n  reportCount: number\n  averageDailySales: number\n  salesGrowth?: number\n  profitGrowth?: number\n  // â–¼ è¿½åŠ \n  purchaseTotal: number\n  laborTotal: number\n  purchaseRate: number\n  laborRate: number\n  primeCost: number\n  primeCostRate: number\n  estimatedCustomers: number\n  averageTicket: number\n  totalCustomers: number\n}\n\nexport const useKpis = (reports: DailyReportData[], previousReports?: DailyReportData[]) => {\n  return useMemo(() => {\n    if (reports.length === 0) {\n      return {\n        totalSales: 0,\n        totalExpenses: 0,\n        grossProfit: 0,\n        operatingProfit: 0,\n        profitMargin: 0,\n        reportCount: 0,\n        averageDailySales: 0,\n        salesGrowth: 0,\n        profitGrowth: 0,\n        // è¿½åŠ åˆ†\n        purchaseTotal: 0,\n        laborTotal: 0,\n        purchaseRate: 0,\n        laborRate: 0,\n        primeCost: 0,\n        primeCostRate: 0,\n        estimatedCustomers: 0,\n        averageTicket: 0,\n        totalCustomers: 0,\n      }\n    }\n\n    const totals = reports.reduce((acc, r) => {\n      const totalExpenses = r.purchase + r.laborCost + r.utilities + (r.rent || 0) + (r.consumables || 0) + r.promotion + r.cleaning + r.misc + r.communication + r.others\n      acc.sales += r.sales\n      acc.expenses += totalExpenses\n      acc.purchase += r.purchase\n      acc.labor += r.laborCost\n      acc.customers += r.customers || 0\n      acc.count += 1\n      return acc\n    }, { sales: 0, expenses: 0, purchase: 0, labor: 0, customers: 0, count: 0 })\n\n    const grossProfit = totals.sales - totals.purchase\n    const operatingProfit = totals.sales - totals.expenses\n    const profitMargin = totals.sales > 0 ? (operatingProfit / totals.sales) * 100 : 0\n    const averageDailySales = totals.count > 0 ? totals.sales / totals.count : 0\n\n    // è¿½åŠ KPI\n    const purchaseRate = totals.sales > 0 ? (totals.purchase / totals.sales) * 100 : 0\n    const laborRate = totals.sales > 0 ? (totals.labor / totals.sales) * 100 : 0\n    const primeCost = totals.purchase + totals.labor\n    const primeCostRate = totals.sales > 0 ? (primeCost / totals.sales) * 100 : 0\n\n    // å®Ÿéš›ã®å®¢æ•°ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å®¢å˜ä¾¡ã‚’è¨ˆç®—\n    const totalCustomers = totals.customers\n    const averageTicket = totalCustomers > 0 ? Math.round(totals.sales / totalCustomers) : 0\n    const estimatedCustomers = totalCustomers\n\n    // å‰æœŸé–“æ¯”è¼ƒ\n    let salesGrowth = 0\n    let profitGrowth = 0\n    if (previousReports && previousReports.length > 0) {\n      const prevTotals = previousReports.reduce((acc, r) => {\n        const totalExpenses = r.purchase + r.laborCost + r.utilities + (r.rent || 0) + (r.consumables || 0) + r.promotion + r.cleaning + r.misc + r.communication + r.others\n        acc.sales += r.sales\n        acc.profit += (r.sales - totalExpenses)\n        return acc\n      }, { sales: 0, profit: 0 })\n      salesGrowth = prevTotals.sales > 0 ? ((totals.sales - prevTotals.sales) / prevTotals.sales) * 100 : 0\n      profitGrowth = prevTotals.profit > 0 ? ((operatingProfit - prevTotals.profit) / prevTotals.profit) * 100 : 0\n    }\n\n    return {\n      totalSales: totals.sales,\n      totalExpenses: totals.expenses,\n      grossProfit,\n      operatingProfit,\n      profitMargin,\n      reportCount: totals.count,\n      averageDailySales,\n      salesGrowth,\n      profitGrowth,\n      // è¿½åŠ åˆ†\n      purchaseTotal: totals.purchase,\n      laborTotal: totals.labor,\n      purchaseRate,\n      laborRate,\n      primeCost,\n      primeCostRate,\n      estimatedCustomers,\n      averageTicket,\n      totalCustomers\n    }\n  }, [reports, previousReports])\n}",
  "src/hooks/useReports.ts": "import { useState, useEffect, useMemo, useCallback, useRef } from 'react'\nimport { type DailyReportData } from '@/types'\nimport { getDailyReports, getMonthlyExpenses } from '@/services/supabase'\nimport { useAuth } from '@/contexts/AuthContext'\n\nexport interface ReportFilters {\n  storeId?: string\n  dateFrom?: string\n  dateTo?: string\n  period?: 'daily' | 'weekly' | 'monthly'\n}\n\nexport const useReports = (filters: ReportFilters = {}) => {\n  const [data, setData] = useState<DailyReportData[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [isError, setIsError] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const { user } = useAuth()\n\n  // âœ… å®‰å®šã‚­ãƒ¼ï¼šä¾å­˜ã®å¤‰åŒ–ã ã‘æ¤œçŸ¥ï¼ˆå‚ç…§å®‰å®šï¼‰\n  const stableKey = useMemo(\n    () => JSON.stringify({\n      s: filters.storeId ?? '',\n      f: filters.dateFrom ?? '',\n      t: filters.dateTo ?? '',\n      p: filters.period ?? '',\n      u: user?.id ?? ''\n    }),\n    [filters.storeId, filters.dateFrom, filters.dateTo, filters.period, user?.id]\n  )\n\n  // âœ… å¤ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä¸­æ–­ã™ã‚‹ãŸã‚ã®AbortController\n  const abortRef = useRef<AbortController | null>(null)\n\n  const fetchReports = useCallback(async (signal: AbortSignal, key: string) => {\n    // âœ… keyã‹ã‚‰å€¤ã‚’å¾©å…ƒï¼ˆã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã§å¤ã„å€¤ã‚’æ´ã¾ãªã„ï¼‰\n    const params = JSON.parse(key) as { s: string; f: string; t: string; p: string; u: string }\n\n    // âœ… ãƒ­ã‚°ã‚’æœ€å°é™ã«\n    // console.log('ğŸ”„ useReports: fetchReports called', { key, params })\n\n    if (!params.u) {\n      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ãªã„å ´åˆã¯ç©ºãƒ‡ãƒ¼ã‚¿\n      setData([])\n      setIsLoading(false)\n      return\n    }\n\n    try {\n      setIsLoading(true)\n      setIsError(false)\n      setError(null)\n\n      // Supabaseã‹ã‚‰æ—¥æ¬¡å ±å‘Šã‚’å–å¾—\n      const { data: reportsData, error: reportsError } = await getDailyReports({\n        storeId: params.s || undefined,\n        dateFrom: params.f || undefined,\n        dateTo: params.t || undefined,\n        userId: params.u\n      })\n\n      // âœ… ä¸­æ–­ã•ã‚Œã¦ã„ãŸã‚‰setStateã—ãªã„ï¼ˆå¤ã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®åæ˜ é˜²æ­¢ï¼‰\n      if (signal.aborted) {\n        // console.log('âš ï¸ useReports: Request aborted')\n        return\n      }\n\n      if (reportsError) {\n        throw new Error(reportsError.message)\n      }\n\n      let filteredData = reportsData || []\n      let uniqueLocalCount = 0\n\n      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚‚å–å¾—ï¼ˆç§»è¡ŒæœŸé–“ç”¨ï¼‰\n      const localReports: DailyReportData[] = JSON.parse(localStorage.getItem('userReports') || '[]')\n      if (localReports.length > 0) {\n        // console.log('ğŸ“¦ useReports: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚‚å«ã‚ã¾ã™:', localReports.length, 'ä»¶')\n        // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹éš›ã€storeIdã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\n        const filteredLocal = localReports.filter(r => {\n          if (params.s && params.s !== 'all' && r.storeId !== params.s) return false\n          if (params.f && r.date < params.f) return false\n          if (params.t && r.date > params.t) return false\n          return true\n        })\n\n        // console.log('ğŸ“¦ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çµæœ', {\n        //   totalLocal: localReports.length,\n        //   filteredLocal: filteredLocal.length,\n        //   filters: params,\n        //   sampleDates: filteredLocal.slice(0, 5).map(r => r.date)\n        // })\n\n        // é‡è¤‡ã‚’é˜²ãï¼šåŒã˜date+storeIdã®çµ„ã¿åˆã‚ã›ãŒSupabaseã«ã‚ã‚‹å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚’é™¤å¤–\n        const uniqueLocal = filteredLocal.filter(localReport => {\n          return !filteredData.some(supabaseReport =>\n            supabaseReport.date === localReport.date &&\n            supabaseReport.storeId === localReport.storeId\n          )\n        })\n\n        if (uniqueLocal.length > 0) {\n          uniqueLocalCount = uniqueLocal.length\n          // console.log('ğŸ“¦ é‡è¤‡ã‚’é™¤å¤–å¾Œ:', uniqueLocalCount, 'ä»¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ')\n          filteredData = [...filteredData, ...uniqueLocal]\n        }\n      }\n\n      // æœˆæ¬¡çµŒè²»ãƒ‡ãƒ¼ã‚¿ã¯æ—¥å ±ãƒªã‚¹ãƒˆã«æ··ãœãªã„\n      // æœˆæ¬¡çµŒè²»ã¯åˆ¥é€”MonthlyExpenseFormç­‰ã§ç®¡ç†\n\n      // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ\n      filteredData.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\n\n      // console.log('ğŸ“Š useReports: æœ€çµ‚ãƒ‡ãƒ¼ã‚¿', {\n      //   total: filteredData.length,\n      //   supabase: (reportsData || []).length,\n      //   local: uniqueLocalCount,\n      //   sample: filteredData[0] // æœ€æ–°ã®1ä»¶ã‚’ã‚µãƒ³ãƒ—ãƒ«è¡¨ç¤º\n      // })\n\n      // âœ… ä¸­æ–­ãƒã‚§ãƒƒã‚¯\n      if (signal.aborted) return\n      setData(filteredData)\n    } catch (err) {\n      // âœ… ä¸­æ–­ãƒã‚§ãƒƒã‚¯\n      if (signal.aborted) return\n      setIsError(true)\n      setError(err instanceof Error ? err.message : 'ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      // âœ… ä¸­æ–­ãƒã‚§ãƒƒã‚¯\n      if (!signal.aborted) setIsLoading(false)\n    }\n  }, [])\n\n  useEffect(() => {\n    console.log('ğŸ¯ useReports: useEffect triggered', { stableKey })\n\n    // âœ… æ—§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å¿…ãšä¸­æ–­\n    abortRef.current?.abort()\n    const controller = new AbortController()\n    abortRef.current = controller\n\n    fetchReports(controller.signal, stableKey)\n\n    return () => {\n      console.log('ğŸ§¹ useReports: Cleanup - aborting')\n      controller.abort()\n    }\n  }, [stableKey])\n\n  return {\n    data,\n    isLoading,\n    isError,\n    error,\n    refetch: fetchReports\n  }\n}",
  "src/hooks/useStores.ts": "import { useState, useEffect } from 'react'\nimport { mockStores } from '../lib/mock'\n\ninterface Store {\n  id: string\n  name: string\n  address: string\n  manager_id?: string\n  is_active?: boolean\n  created_at?: string\n  updated_at?: string\n}\n\ninterface StoreWithDetails extends Store { \n  manager_name?: string\n  reportCount?: number\n  lastReportDate?: string\n  isAssigned?: boolean\n}\n\nexport const useStores = (userId: string | null) => {\n  const [stores, setStores] = useState<StoreWithDetails[]>([])\n  const [selectedStoreId, setSelectedStoreId] = useState<string | null>(null)\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰åº—èˆ—ã‚’å–å¾—\n  const fetchStores = async () => {\n    if (!userId) return\n\n    try {\n      setLoading(true)\n      setError(null)\n      \n      console.log('ğŸ” fetchStores: ãƒ¢ãƒƒã‚¯åº—èˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹')\n      \n      // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã«è©³ç´°æƒ…å ±ã‚’è¿½åŠ \n      const storesWithDetails = mockStores.map((store, index) => ({\n        ...store,\n        manager_name: index === 0 ? 'ç”°ä¸­å¥å¤ª' : index === 1 ? 'é«˜å±±å¿ ç´”' : 'ä½è—¤é™½ä»‹',\n        reportCount: Math.floor(Math.random() * 30) + 5, // 5-35ä»¶\n        lastReportDate: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(), // éå»1é€±é–“ä»¥å†…\n        isAssigned: true\n      }))\n      \n      console.log('âœ… fetchStores: ãƒ¢ãƒƒã‚¯åº—èˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†:', storesWithDetails.length, 'ä»¶')\n      setStores(storesWithDetails)\n      \n      // æœ€åˆã®æœ‰åŠ¹åº—èˆ—ã‚’è‡ªå‹•é¸æŠ\n      const firstActiveStore = storesWithDetails.find(s => s.is_active)\n      if (!selectedStoreId && firstActiveStore) {\n        console.log('ğŸ¯ fetchStores: æœ€åˆã®åº—èˆ—ã‚’è‡ªå‹•é¸æŠ:', firstActiveStore.name)\n        setSelectedStoreId(firstActiveStore.id)\n      }\n    } catch (err) {\n      console.error('âŒ fetchStores: ã‚¨ãƒ©ãƒ¼:', err)\n      setError('åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // åº—èˆ—ä½œæˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰\n  const createStore = async (storeData: {\n    name: string\n    address: string\n    managerName?: string\n    isActive?: boolean\n  }) => {\n    try {\n      setLoading(true)\n      setError(null)\n      \n      console.log('ğŸª createStore: æ–°è¦åº—èˆ—ä½œæˆé–‹å§‹:', storeData)\n      \n      // é‡è¤‡ãƒã‚§ãƒƒã‚¯\n      const existingStore = stores.find(store => \n        store.name.toLowerCase() === storeData.name.toLowerCase() && store.is_active\n      )\n      \n      if (existingStore) {\n        const errorMsg = `åº—èˆ—åã€Œ${storeData.name}ã€ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™`\n        console.log('âš ï¸ createStore: é‡è¤‡åº—èˆ—æ¤œå‡º:', errorMsg)\n        return { error: errorMsg }\n      }\n      \n      // æ–°åº—èˆ—ä½œæˆ\n      const newStore: StoreWithDetails = {\n        id: `store-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        name: storeData.name,\n        address: storeData.address,\n        manager_name: storeData.managerName || 'æ–°åº—é•·',\n        is_active: storeData.isActive !== false,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString(),\n        reportCount: 0,\n        lastReportDate: new Date().toISOString(),\n        isAssigned: true\n      }\n      \n      // åº—èˆ—ãƒªã‚¹ãƒˆã«è¿½åŠ \n      const updatedStores = [...stores, newStore]\n      setStores(updatedStores)\n      \n      console.log('âœ… createStore: åº—èˆ—ä½œæˆæˆåŠŸ:', newStore.name)\n      return { data: newStore, error: null }\n    } catch (err) {\n      console.error('âŒ createStore: ã‚¨ãƒ©ãƒ¼:', err)\n      const errorMessage = 'åº—èˆ—ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ'\n      setError(errorMessage)\n      return { error: errorMessage }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // åº—èˆ—æ›´æ–°ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰\n  const updateStore = async (storeId: string, updateData: {\n    name?: string\n    address?: string\n    manager_name?: string\n    isActive?: boolean\n  }) => {\n    try {\n      setLoading(true)\n      setError(null)\n      \n      const storeIndex = stores.findIndex(store => store.id === storeId)\n      if (storeIndex === -1) {\n        return { error: 'æŒ‡å®šã•ã‚ŒãŸåº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' }\n      }\n      \n      // æ›´æ–°\n      const updatedStores = [...stores]\n      updatedStores[storeIndex] = {\n        ...updatedStores[storeIndex],\n        ...updateData,\n        updated_at: new Date().toISOString()\n      }\n      \n      setStores(updatedStores)\n      console.log('âœ… updateStore: åº—èˆ—æ›´æ–°æˆåŠŸ:', updatedStores[storeIndex].name)\n      \n      return { data: updatedStores[storeIndex], error: null }\n    } catch (err) {\n      console.error('âŒ updateStore: ã‚¨ãƒ©ãƒ¼:', err)\n      return { error: 'åº—èˆ—ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ' }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // åº—èˆ—å‰Šé™¤ï¼ˆè«–ç†å‰Šé™¤ï¼‰\n  const deleteStore = async (storeId: string) => {\n    try {\n      setLoading(true)\n      setError(null)\n      \n      const storeIndex = stores.findIndex(store => store.id === storeId)\n      if (storeIndex === -1) {\n        return { error: 'æŒ‡å®šã•ã‚ŒãŸåº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' }\n      }\n      \n      // è«–ç†å‰Šé™¤\n      const updatedStores = [...stores]\n      updatedStores[storeIndex] = {\n        ...updatedStores[storeIndex],\n        is_active: false,\n        updated_at: new Date().toISOString()\n      }\n      \n      setStores(updatedStores)\n      \n      // é¸æŠä¸­ã®åº—èˆ—ã ã£ãŸå ´åˆã¯ã‚¯ãƒªã‚¢\n      if (selectedStoreId === storeId) {\n        setSelectedStoreId(null)\n      }\n      \n      console.log('âœ… deleteStore: åº—èˆ—å‰Šé™¤æˆåŠŸ')\n      return { error: null }\n    } catch (err) {\n      console.error('âŒ deleteStore: ã‚¨ãƒ©ãƒ¼:', err)\n      return { error: 'åº—èˆ—ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ' }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // åº—èˆ—é¸æŠ\n  const selectStore = (storeId: string | null) => {\n    console.log('ğŸ¯ selectStore: åº—èˆ—é¸æŠ:', storeId)\n    setSelectedStoreId(storeId)\n  }\n\n  // é¸æŠä¸­ã®åº—èˆ—å–å¾—\n  const getSelectedStore = () => {\n    return stores.find(store => store.id === selectedStoreId) || null\n  }\n\n  // åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—\n  useEffect(() => {\n    if (userId) {\n      fetchStores()\n    }\n  }, [userId])\n\n  return {\n    stores: stores.filter(s => s.is_active), // æœ‰åŠ¹ãªåº—èˆ—ã®ã¿è¿”ã™\n    selectedStoreId,\n    selectedStore: getSelectedStore(),\n    loading,\n    error,\n    fetchStores,\n    createStore,\n    updateStore,\n    deleteStore,\n    selectStore\n  }\n}",
  "src/hooks/useTargets.ts": "import { useState, useEffect } from 'react'\nimport { getTargets } from '@/services/supabase'\nimport { useAuth } from '@/contexts/AuthContext'\n\nexport interface TargetMetrics {\n  salesAchievement: number\n  profitAchievement: number\n  remainingSales: number\n  requiredDailySales: number\n  requiredCustomers: number\n  averageCustomerSpend: number\n  daysRemaining: number\n}\n\nexport type TargetData = {\n  storeId: string\n  period: string\n  targetSales: number\n  targetProfit: number\n  targetProfitMargin: number\n  targetCostRate: number\n  targetLaborRate: number\n}\n\nexport const useTargets = (storeId: string = 'all', period: string) => {\n  const [targets, setTargets] = useState<TargetData[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const { user } = useAuth()\n\n  useEffect(() => {\n    const fetchTargets = async () => {\n      if (!user) return\n\n      try {\n        setIsLoading(true)\n        const { data, error } = await getTargets({\n          storeId: storeId !== 'all' ? storeId : undefined\n        })\n\n        if (error) {\n          console.error('useTargets getTargets error:', error)\n          setTargets([])\n          return\n        }\n\n        const mapped: TargetData[] = (data ?? []).map(t => ({\n          storeId: t.store_id,\n          period: t.period,\n          targetSales: t.target_sales,\n          targetProfit: t.target_profit,\n          targetProfitMargin: t.target_profit_margin,\n          targetCostRate: t.target_cost_rate || 0,\n          targetLaborRate: t.target_labor_rate || 0\n        }))\n        setTargets(mapped)\n      } catch (e) {\n        console.error('âŒ useTargets: ã‚¨ãƒ©ãƒ¼:', e)\n        setTargets([])\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    fetchTargets()\n  }, [storeId, user])\n\n  const calculateTargetMetrics = (\n    currentSales: number,\n    currentProfit: number,\n    targetSales: number,\n    targetProfit: number\n  ): TargetMetrics => {\n    const safe = (n: number, d: number) => (d > 0 ? n / d : 0)\n    const salesAchievement = safe(currentSales, targetSales) * 100\n    const profitAchievement = safe(currentProfit, targetProfit) * 100\n    const remainingSales = Math.max(0, targetSales - currentSales)\n    \n    // Remaining days in current month\n    const now = new Date()\n    const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate()\n    const daysRemaining = lastDay - now.getDate()\n    \n    const requiredDailySales = daysRemaining > 0 ? remainingSales / daysRemaining : 0\n    const averageCustomerSpend = 3500 // Average spend per customer\n    const requiredCustomers = requiredDailySales / averageCustomerSpend\n\n    return {\n      salesAchievement,\n      profitAchievement,\n      remainingSales,\n      requiredDailySales,\n      requiredCustomers,\n      averageCustomerSpend,\n      daysRemaining\n    }\n  }\n\n  const getTargetForStore = (storeId: string) => {\n    return targets.find(t => t.storeId === storeId && t.period === period)\n  }\n\n  const getAllStoresTarget = () => {\n    const storeTargets = targets.filter(t => t.period === period)\n    const agg = storeTargets.reduce((acc, t) => ({\n      targetSales: acc.targetSales + t.targetSales,\n      targetProfit: acc.targetProfit + t.targetProfit,\n      totalCostRate: acc.totalCostRate + t.targetCostRate,\n      totalLaborRate: acc.totalLaborRate + t.targetLaborRate\n    }), { targetSales: 0, targetProfit: 0, totalCostRate: 0, totalLaborRate: 0 })\n    const targetProfitMargin = agg.targetSales > 0 ? (agg.targetProfit / agg.targetSales) * 100 : 0\n    const avgCostRate = storeTargets.length > 0 ? agg.totalCostRate / storeTargets.length : 0\n    const avgLaborRate = storeTargets.length > 0 ? agg.totalLaborRate / storeTargets.length : 0\n    return {\n      targetSales: agg.targetSales,\n      targetProfit: agg.targetProfit,\n      targetProfitMargin,\n      targetCostRate: avgCostRate,\n      targetLaborRate: avgLaborRate\n    }\n  }\n\n  return {\n    targets,\n    isLoading,\n    getTargetForStore,\n    getAllStoresTarget,\n    calculateTargetMetrics\n  }\n}",
  "src/hooks/useUsageLimits.ts": "import { useState, useEffect } from 'react'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { getUsageStatus, UsageStatus } from '@/services/usageLimits'\n\nexport function useUsageLimits() {\n  const { user } = useAuth()\n  const [status, setStatus] = useState<UsageStatus | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    if (user?.id) {\n      loadUsageStatus()\n    }\n  }, [user?.id])\n\n  const loadUsageStatus = async () => {\n    if (!user?.id) return\n\n    try {\n      setLoading(true)\n      setError(null)\n\n      const usageStatus = await getUsageStatus(user.id)\n      setStatus(usageStatus)\n    } catch (err) {\n      setError('ä½¿ç”¨çŠ¶æ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n      console.error('Failed to load usage status:', err)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const refresh = () => {\n    loadUsageStatus()\n  }\n\n  return {\n    status,\n    loading,\n    error,\n    refresh\n  }\n}\n",
  "src/index.css": "@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  :root {\n    --background: 0 0% 100%;\n    --foreground: 222.2 84% 4.9%;\n    --card: 0 0% 100%;\n    --card-foreground: 222.2 84% 4.9%;\n    --popover: 0 0% 100%;\n    --popover-foreground: 222.2 84% 4.9%;\n    --primary: 221.2 83.2% 53.3%;\n    --primary-foreground: 210 40% 98%;\n    --secondary: 210 40% 96%;\n    --secondary-foreground: 222.2 84% 4.9%;\n    --muted: 210 40% 96%;\n    --muted-foreground: 215.4 16.3% 46.9%;\n    --accent: 210 40% 96%;\n    --accent-foreground: 222.2 84% 4.9%;\n    --destructive: 0 84.2% 60.2%;\n    --destructive-foreground: 210 40% 98%;\n    --border: 214.3 31.8% 91.4%;\n    --input: 214.3 31.8% 91.4%;\n    --ring: 221.2 83.2% 53.3%;\n    --radius: 0.75rem;\n    \n    /* Semantic colors */\n    --success: 142 72% 40%;\n    --warning: 38 92% 50%;\n    --info: 217 91% 60%;\n    --danger: 0 84% 60%;\n    \n    /* Chart color palette */\n    --chart-1: 221 83% 53%;\n    --chart-2: 142 72% 40%;\n    --chart-3: 271 91% 65%;\n    --chart-4: 14 90% 57%;\n    --chart-5: 199 89% 48%;\n    --chart-6: 50 97% 63%;\n    --chart-7: 339 90% 55%;\n    --chart-8: 192 19% 40%;\n    /* Semantic colors */\n    --success: 142 72% 40%;\n    --warning: 38 92% 50%;\n    --info: 217 91% 60%;\n    --danger: 0 84% 60%;\n    \n    /* Chart color palette */\n    --chart-1: 221 83% 53%;\n    --chart-2: 142 72% 40%;\n    --chart-3: 271 91% 65%;\n    --chart-4: 14 90% 57%;\n    --chart-5: 199 89% 48%;\n    --chart-6: 50 97% 63%;\n    --chart-7: 339 90% 55%;\n    --chart-8: 192 19% 40%;\n  }\n \n  .dark {\n    --background: 222.2 84% 4.9%;\n    --foreground: 210 40% 98%;\n    --card: 222.2 84% 4.9%;\n    --card-foreground: 210 40% 98%;\n    --popover: 222.2 84% 4.9%;\n    --popover-foreground: 210 40% 98%;\n    --primary: 217.2 91.2% 59.8%;\n    --primary-foreground: 222.2 84% 4.9%;\n    --secondary: 217.2 32.6% 17.5%;\n    --secondary-foreground: 210 40% 98%;\n    --muted: 217.2 32.6% 17.5%;\n    --muted-foreground: 215 20.2% 65.1%;\n    --accent: 217.2 32.6% 17.5%;\n    --accent-foreground: 210 40% 98%;\n    --destructive: 0 62.8% 30.6%;\n    --destructive-foreground: 210 40% 98%;\n    --border: 217.2 32.6% 17.5%;\n    --input: 217.2 32.6% 17.5%;\n    --ring: 224.3 76.3% 94.1%;\n    \n    /* Semantic colors */\n    --success: 142 70% 45%;\n    --warning: 38 92% 60%;\n    --info: 217 91% 70%;\n    --danger: 0 84% 66%;\n    \n    /* Chart color palette */\n    --chart-1: 221 83% 60%;\n    --chart-2: 142 72% 46%;\n    --chart-3: 271 91% 70%;\n    --chart-4: 14 90% 64%;\n    --chart-5: 199 89% 56%;\n    --chart-6: 50 97% 70%;\n    --chart-7: 339 90% 62%;\n    --chart-8: 192 19% 50%;\n    /* Semantic colors */\n    --success: 142 70% 45%;\n    --warning: 38 92% 60%;\n    --info: 217 91% 70%;\n    --danger: 0 84% 66%;\n    \n    /* Chart color palette */\n    --chart-1: 221 83% 60%;\n    --chart-2: 142 72% 46%;\n    --chart-3: 271 91% 70%;\n    --chart-4: 14 90% 64%;\n    --chart-5: 199 89% 56%;\n    --chart-6: 50 97% 70%;\n    --chart-7: 339 90% 62%;\n    --chart-8: 192 19% 50%;\n  }\n}\n \n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply bg-background text-foreground;\n  }\n}",
  "src/layout/Header.tsx": "import React, { useTransition } from 'react'\nimport { useNavigate, useLocation } from 'react-router-dom'\nimport { Menu, User, LogOut, Settings, ChevronDown, Store, Shield, HelpCircle, Loader2 } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport { useAdminData } from '@/contexts/AdminDataContext'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { HelpGuide } from '@/components/system/HelpGuide'\n\ninterface HeaderProps {\n  onMenuClick: () => void\n}\n\nexport const Header: React.FC<HeaderProps> = ({ onMenuClick }) => {\n  const navigate = useNavigate()\n  const location = useLocation()\n  const params = new URLSearchParams(location.search)\n  const initialStore = params.get('store') || 'all'\n  const [selectedStoreId, setSelectedStoreId] = React.useState<string>(initialStore)\n  const [isHelpOpen, setIsHelpOpen] = React.useState(false)\n  const { stores } = useAdminData()\n  const { user, signOut } = useAuth()\n\n  // âœ… startTransition: é‡ã„é›†è¨ˆã¨ç«¶åˆã—ãªã„ã‚ˆã†ã«UIæ›´æ–°ã‚’ç·©å’Œ\n  const [isPending, startTransition] = useTransition()\n\n  const currentPeriod = new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' })\n\n  // ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªåº—èˆ—ã‚’è¨ˆç®—\n  const accessibleStores = React.useMemo(() => {\n    if (!user) return []\n    if (user.role === 'admin') {\n      return stores.map(s => ({ id: s.id, name: s.name }))\n    }\n    return user.assignedStores || []\n  }, [user, stores])\n  const selectedStore = accessibleStores.find(s => s.id === selectedStoreId)\n\n  // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¦stateã‚’åŒæœŸ\n  React.useEffect(() => {\n    const urlStoreId = params.get('store') || 'all'\n    if (urlStoreId !== selectedStoreId) {\n      setSelectedStoreId(urlStoreId)\n    }\n  }, [location.search, selectedStoreId, params])\n\n  const onChangeStore = (id: string) => {\n    // âœ… çŠ¶æ…‹æ›´æ–°ã‚’ä¸¦è¡Œãƒ¬ãƒ³ãƒ€ã«é€ƒãŒã™ï¼ˆä½“æ„Ÿãƒ•ãƒªãƒ¼ã‚ºè§£æ¶ˆï¼‰\n    startTransition(() => {\n      setSelectedStoreId(id)\n      const p = new URLSearchParams(location.search)\n      if (id === 'all') p.delete('store'); else p.set('store', id)\n      navigate(`${location.pathname}?${p.toString()}`, { replace: true })\n    })\n  }\n\n  const handleSignOut = async () => {\n    await signOut()\n    navigate('/')\n  }\n\n  const getRoleIcon = (role: string) => {\n    switch (role) {\n      case 'admin': return <Shield className=\"h-3 w-3 text-red-600\" />\n      case 'manager': return <User className=\"h-3 w-3 text-blue-600\" />\n      case 'staff': return <User className=\"h-3 w-3 text-green-600\" />\n      default: return <User className=\"h-3 w-3\" />\n    }\n  }\n\n  const getRoleName = (role: string) => {\n    switch (role) {\n      case 'admin': return 'çµ±æ‹¬'\n      case 'manager': return 'åº—é•·'\n      case 'staff': return 'ã‚¹ã‚¿ãƒƒãƒ•'\n      default: return role\n    }\n  }\n\n  // åº—èˆ—é¸æŠã‚’éè¡¨ç¤ºã«ã™ã‚‹ãƒšãƒ¼ã‚¸ï¼ˆãƒšãƒ¼ã‚¸å†…ã§åº—èˆ—é¸æŠãŒã‚ã‚‹å ´åˆï¼‰\n  const hideStoreSelector = [\n    '/report',\n    '/report/new',\n    '/expenses/monthly',\n    '/admin',\n    '/chat',\n    '/ai-reports'\n  ].includes(location.pathname)\n\n  return (\n    <>\n    <header className=\"h-16 border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n      <div className=\"flex h-full items-center justify-between px-4\">\n        {/* Left section */}\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"lg:hidden\"\n            onClick={onMenuClick}\n          >\n            <Menu className=\"h-5 w-5\" />\n          </Button>\n          \n          <div className=\"min-w-0\">\n            <h1 className=\"text-sm sm:text-lg font-semibold text-foreground truncate leading-tight\">\n              <span className=\"sm:hidden\">AIçµŒå–¶ç®¡ç†</span>\n              <span className=\"hidden sm:inline\">AIçµŒå–¶ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </span>\n            </h1>\n            <p className=\"text-xs sm:text-sm text-muted-foreground truncate leading-tight\">\n              <span className=\"hidden sm:inline\">{currentPeriod}ã®åˆ†æ</span>\n              <span className=\"sm:hidden\">åˆ†æ</span>\n              {selectedStoreId === 'all' ? <span className=\"hidden sm:inline\">ï¼ˆå…¨åº—èˆ—åˆè¨ˆï¼‰</span> : ''}\n            </p>\n          </div>\n        </div>\n\n        {/* Store selector - Hidden on pages with their own store selector */}\n        {!hideStoreSelector && (\n          <div className=\"flex items-center gap-1 sm:gap-3 flex-1 sm:flex-initial justify-center sm:justify-start min-w-0 max-w-xs sm:max-w-none\">\n            {/* âœ… ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */}\n            {isPending ? (\n              <Loader2 className=\"h-4 w-4 text-muted-foreground animate-spin\" />\n            ) : (\n              <Store className=\"h-4 w-4 text-muted-foreground\" />\n            )}\n            <select\n              value={selectedStoreId}\n              onChange={(e) => onChangeStore(e.target.value)}\n              disabled={isPending}\n              className=\"px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm border border-input rounded-md bg-background focus:outline-none focus:ring-2 focus:ring-ring min-w-0 w-full sm:w-auto max-w-full sm:min-w-64 truncate disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {user?.role === 'admin' && (\n                <option value=\"all\">ğŸ¢ å…¨åº—èˆ—ï¼ˆåˆè¨ˆï¼‰</option>\n              )}\n              {accessibleStores.map(store => (\n                <option key={store.id} value={store.id}>\n                  {store.name}\n                </option>\n              ))}\n            </select>\n            {(selectedStoreId === 'all' || selectedStore) && (\n              <Badge variant=\"secondary\" className=\"text-xs hidden md:inline-flex\">\n                {selectedStoreId === 'all' ? 'å…¨åº—èˆ—' : (user?.role === 'admin' ? 'å…¨æ¨©é™' : 'é™å®šæ¨©é™')}\n              </Badge>\n            )}\n          </div>\n        )}\n\n        {/* Right section - Help & User menu */}\n        <div className=\"min-w-0 flex-shrink-0 flex items-center gap-2\">\n          {/* Help Button */}\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setIsHelpOpen(true)}\n            className=\"h-8 w-8 sm:h-10 sm:w-10\"\n            title=\"ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰\"\n          >\n            <HelpCircle className=\"h-4 w-4 sm:h-5 sm:w-5 text-blue-600\" />\n          </Button>\n\n          {/* User Menu */}\n          <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" className=\"flex items-center gap-1 sm:gap-2 px-1 sm:px-2 h-8 sm:h-10\">\n              <User className=\"h-4 w-4\" />\n              <span className=\"hidden md:inline text-sm\">\n                {user?.name}\n              </span>\n              <Badge variant=\"outline\" className=\"text-xs hidden lg:inline-flex\">\n                <div className=\"flex items-center gap-1\">\n                  {getRoleIcon(user?.role || '')}\n                  {getRoleName(user?.role || '')}\n                </div>\n              </Badge>\n              <ChevronDown className=\"h-3 w-3 hidden sm:inline\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\n            <div className=\"px-2 py-1.5 text-sm font-medium\">\n              {user?.name}\n            </div>\n            <div className=\"px-2 py-1.5 text-xs text-muted-foreground\">\n              <div className=\"flex items-center gap-2\">\n                {getRoleIcon(user?.role || '')}\n                {getRoleName(user?.role || '')}\n                {user?.role === 'admin' && <Badge variant=\"destructive\" className=\"text-xs\">å…¨æ¨©é™</Badge>}\n              </div>\n            </div>\n            {user?.assignedStores && user.assignedStores.length > 0 && (\n              <>\n                <DropdownMenuSeparator />\n                <div className=\"px-2 py-1.5\">\n                  <p className=\"text-xs text-muted-foreground mb-1\">æ‹…å½“åº—èˆ—:</p>\n                  {user.assignedStores.slice(0, 3).map(store => (\n                    <div key={store.id} className=\"text-xs text-foreground\">\n                      ğŸª {store.name.replace('å±…é…’å±‹ã„ã£ã', '').replace('ãƒãƒ¼ãƒ«ã‚¢ãƒ•ãƒ­ãƒãƒ¼ã‚¸ãƒ¥ã‚¹ãƒ¼ãƒ´ã‚©ãƒ¯ãƒ«', 'ã‚¢ãƒ•ãƒ­')}\n                    </div>\n                  ))}\n                  {user.assignedStores.length > 3 && (\n                    <div className=\"text-xs text-muted-foreground\">\n                      ä»–{user.assignedStores.length - 3}åº—èˆ—...\n                    </div>\n                  )}\n                </div>\n              </>\n            )}\n            <DropdownMenuSeparator />\n            <DropdownMenuItem onClick={() => navigate('/admin')}>\n              <Settings className=\"h-4 w-4 mr-2\" />\n              è¨­å®š\n            </DropdownMenuItem>\n            <DropdownMenuItem onClick={handleSignOut}>\n              <LogOut className=\"h-4 w-4 mr-2\" />\n              ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      </div>\n    </header>\n\n    {/* Help Guide Modal - Rendered outside header for proper z-index */}\n    <HelpGuide isOpen={isHelpOpen} onClose={() => setIsHelpOpen(false)} />\n    </>\n  )\n}",
  "src/layout/MainLayout.tsx": "import React, { useState } from 'react'\nimport { Outlet, useLocation } from 'react-router-dom'\nimport { Header } from './Header'\nimport { Sidebar } from './Sidebar'\nimport { StoreProvider } from '@/contexts/StoreContext'\nimport { AdminDataProvider } from '@/contexts/AdminDataContext'\nimport { AIReportNotification } from '@/components/Dashboard/AIReportNotification'\nimport { Footer } from '@/components/Layout/Footer'\n\nexport const MainLayout: React.FC = () => {\n  const [sidebarOpen, setSidebarOpen] = useState(false)\n  const location = useLocation()\n\n  // ãƒ•ãƒƒã‚¿ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸\n  const showFooter = ['/admin', '/organization'].includes(location.pathname)\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {sidebarOpen && (\n        <div\n          className=\"lg:hidden fixed inset-0 bg-background/80 backdrop-blur-sm z-40\"\n          onClick={() => setSidebarOpen(false)}\n        />\n      )}\n\n      <AdminDataProvider>\n        <StoreProvider>\n          <div className=\"flex h-screen\">\n            <Sidebar\n              isOpen={sidebarOpen}\n              onClose={() => setSidebarOpen(false)}\n            />\n            <div className=\"flex-1 flex flex-col min-w-0\">\n              <Header onMenuClick={() => setSidebarOpen(true)} />\n              <main className=\"flex-1 overflow-auto flex flex-col\">\n                <div className=\"flex-1 container mx-auto px-2 sm:px-4 py-3 sm:py-6\">\n                  <Outlet />\n                </div>\n                {showFooter && <Footer />}\n              </main>\n            </div>\n          </div>\n          <AIReportNotification />\n        </StoreProvider>\n      </AdminDataProvider>\n    </div>\n  )\n}",
  "src/layout/Sidebar.tsx": "import React from 'react'\nimport { useLocation, useNavigate } from 'react-router-dom'\nimport { ChartBar as BarChart3, Calendar, Target, MessageSquare, X, TrendingUp, Settings, Users, FileText, Building } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { cn } from '@/lib/utils'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { PermissionGuard } from '@/components/Auth/PermissionGuard'\n\ninterface SidebarProps {\n  isOpen: boolean\n  onClose: () => void\n}\n\nconst menuItems = [\n  {\n    id: 'dashboard',\n    label: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',\n    icon: BarChart3,\n    children: [\n      { id: 'daily', label: 'æ—¥æ¬¡åˆ†æ', path: '/dashboard/daily' },\n      { id: 'weekly', label: 'é€±æ¬¡åˆ†æ', path: '/dashboard/weekly' },\n      { id: 'monthly', label: 'æœˆæ¬¡åˆ†æ', path: '/dashboard/monthly' }\n    ]\n  },\n  {\n    id: 'targets',\n    label: 'ç›®æ¨™é”æˆåº¦',\n    icon: Target,\n    path: '/targets'\n  },\n  {\n    id: 'chat',\n    label: 'AIãƒãƒ£ãƒƒãƒˆ',\n    icon: MessageSquare,\n    path: '/chat',\n    badge: 'Beta'\n  },\n  {\n    id: 'ai-reports',\n    label: 'AIåˆ†æãƒ¬ãƒãƒ¼ãƒˆ',\n    icon: FileText,\n    path: '/ai-reports'\n  },\n  {\n    id: 'report',\n    label: 'æ—¥å ±å…¥åŠ›',\n    icon: Calendar,\n    path: '/report/new'\n  },\n  {\n    id: 'monthly-expense',\n    label: 'æœˆæ¬¡çµŒè²»å…¥åŠ›',\n    icon: Calendar,\n    path: '/expenses/monthly'\n  },\n  {\n    id: 'staff',\n    label: 'ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†',\n    icon: Users,\n    path: '/staff'\n  },\n  {\n    id: 'organization',\n    label: 'çµ„ç¹”è¨­å®š',\n    icon: Building,\n    path: '/organization'\n  },\n  {\n    id: 'admin',\n    label: 'ã‚·ã‚¹ãƒ†ãƒ è¨­å®š',\n    icon: Settings,\n    path: '/admin'\n  }\n]\n\nexport const Sidebar: React.FC<SidebarProps> = ({ isOpen, onClose }) => {\n  const location = useLocation()\n  const navigate = useNavigate()\n  const { user } = useAuth()\n\n  const handleNavigation = (path: string) => {\n    // ç¾åœ¨ã®URLã‹ã‚‰åº—èˆ—IDã‚’å–å¾—\n    const currentParams = new URLSearchParams(location.search)\n    const currentStoreId = currentParams.get('store')\n\n    // åº—èˆ—IDãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€æ–°ã—ã„ãƒ‘ã‚¹ã«ã‚‚å¼•ãç¶™ã\n    if (currentStoreId) {\n      const newUrl = `${path}?store=${currentStoreId}`\n      navigate(newUrl)\n    } else {\n      navigate(path)\n    }\n    onClose()\n  }\n\n  const isActivePath = (path: string) => {\n    return location.pathname === path || location.pathname.startsWith(path)\n  }\n\n  // æ¨©é™ã«å¿œã˜ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\n  const getVisibleMenuItems = () => {\n    if (!user) return []\n    \n    const allItems = menuItems\n    \n    // ã‚¹ã‚¿ãƒƒãƒ•ã®å ´åˆã¯åŸºæœ¬æ©Ÿèƒ½ã®ã¿\n    if (user.role === 'staff') {\n      return allItems.filter(item => \n        ['dashboard', 'report', 'chat'].includes(item.id)\n      )\n    }\n    \n    // åº—é•·ã®å ´åˆã¯ä¸€éƒ¨ç®¡ç†æ©Ÿèƒ½ã®ã¿è¡¨ç¤º\n    if (user.role === 'manager') {\n      return allItems\n    }\n    \n    // çµ±æ‹¬ã¯å…¨æ©Ÿèƒ½ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½\n    return allItems\n  }\n\n  const visibleMenuItems = getVisibleMenuItems()\n  return (\n    <>\n      <aside className={cn(\n        \"fixed lg:static inset-y-0 left-0 z-50 w-64 bg-card border-r border-border transform transition-transform duration-200 ease-in-out\",\n        isOpen ? \"translate-x-0\" : \"-translate-x-full lg:translate-x-0\"\n      )}>\n        <div className=\"flex flex-col h-full\">\n          {/* Header */}\n          <div className=\"flex h-16 items-center justify-between px-4 border-b border-border\">\n            <div className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-6 w-6 text-primary\" />\n              <span className=\"font-semibold text-foreground\">\n                Analytics\n              </span>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"lg:hidden\"\n              onClick={onClose}\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n\n          {/* Navigation */}\n          <nav className=\"flex-1 px-3 py-4 space-y-2\">\n            {visibleMenuItems.map((item) => {\n              const Icon = item.icon\n              const hasChildren = !!item.children\n              const isParentActive = hasChildren \n                ? item.children.some(child => isActivePath(child.path))\n                : isActivePath(item.path || '')\n\n              return (\n                <div key={item.id}>\n                  {/* Parent item */}\n                  {item.id === 'admin' || item.id === 'staff' ? (\n                    <PermissionGuard requiredRole={item.id === 'admin' ? 'admin' : 'manager'} showError={false}>\n                      <Button\n                        variant=\"ghost\"\n                        className={cn(\n                          \"w-full justify-start h-auto py-3 px-3\",\n                          isParentActive && \"bg-accent text-accent-foreground\"\n                        )}\n                        onClick={() => !hasChildren && handleNavigation(item.path!)}\n                      >\n                        <Icon className=\"h-4 w-4 mr-3\" />\n                        <span className=\"flex-1 text-left\">{item.label}</span>\n                        {item.badge && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {item.badge}\n                          </Badge>\n                        )}\n                      </Button>\n                    </PermissionGuard>\n                  ) : (\n                    <Button\n                      variant=\"ghost\"\n                      className={cn(\n                        \"w-full justify-start h-auto py-3 px-3\",\n                        isParentActive && \"bg-accent text-accent-foreground\"\n                      )}\n                      onClick={() => !hasChildren && handleNavigation(item.path!)}\n                    >\n                      <Icon className=\"h-4 w-4 mr-3\" />\n                      <span className=\"flex-1 text-left\">{item.label}</span>\n                      {item.badge && (\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {item.badge}\n                        </Badge>\n                      )}\n                    </Button>\n                  )}\n\n                  {/* Children items */}\n                  {hasChildren && (\n                    <div className=\"ml-4 mt-1 space-y-1\">\n                      {item.children.map((child) => (\n                        <Button\n                          key={child.id}\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className={cn(\n                            \"w-full justify-start text-sm py-2\",\n                            isActivePath(child.path) && \"bg-primary text-primary-foreground\"\n                          )}\n                          onClick={() => handleNavigation(child.path)}\n                        >\n                          {child.label}\n                        </Button>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )\n            })}\n          </nav>\n\n          {/* Footer */}\n          <div className=\"p-4 border-t border-border\">\n            {user && (\n              <div className=\"mb-3 p-2 bg-muted rounded-lg\">\n                <div className=\"text-xs text-muted-foreground mb-1\">ãƒ­ã‚°ã‚¤ãƒ³ä¸­</div>\n                <div className=\"flex items-center gap-2\">\n                  <div className={`w-2 h-2 rounded-full ${\n                    user.role === 'admin' ? 'bg-red-500' :\n                    user.role === 'manager' ? 'bg-blue-500' :\n                    'bg-green-500'\n                  }`} />\n                  <div className=\"text-xs font-medium truncate\">{user.name}</div>\n                </div>\n                <div className=\"text-xs text-muted-foreground\">\n                  {user.role === 'admin' ? 'çµ±æ‹¬æ¨©é™' :\n                   user.role === 'manager' ? 'åº—é•·æ¨©é™' :\n                   'ã‚¹ã‚¿ãƒƒãƒ•æ¨©é™'}\n                </div>\n              </div>\n            )}\n            <div className=\"text-xs text-muted-foreground\">\n              Version 1.0.0\n            </div>\n          </div>\n        </div>\n      </aside>\n    </>\n  )\n}",
  "src/lib/errorMessages.ts": "/**\n * Supabaseã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ—¥æœ¬èªåŒ–\n */\n\nexport function translateSupabaseError(error: any): string {\n  if (!error) return 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'\n\n  const message = error.message || error.toString()\n\n  // Authã‚¨ãƒ©ãƒ¼\n  if (message.includes('Invalid login credentials')) {\n    return 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'\n  }\n  if (message.includes('Email not confirmed')) {\n    return 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„'\n  }\n  if (message.includes('User already registered')) {\n    return 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™'\n  }\n  if (message.includes('Password should be at least')) {\n    return 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§è¨­å®šã—ã¦ãã ã•ã„'\n  }\n  if (message.includes('Unable to validate email address')) {\n    return 'æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'\n  }\n\n  // RLSã‚¨ãƒ©ãƒ¼\n  if (message.includes('row-level security') || message.includes('RLS') || message.includes('policy')) {\n    return 'ã“ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«åº—èˆ—å‰²å½“ã‚’ã”ç¢ºèªãã ã•ã„'\n  }\n\n  // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼\n  if (message.includes('Failed to fetch') || message.includes('Network')) {\n    return 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„'\n  }\n\n  // å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„\n  if (message.includes('foreign key constraint') || message.includes('violates foreign key')) {\n    return 'é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€ã“ã®æ“ä½œã‚’å®Ÿè¡Œã§ãã¾ã›ã‚“'\n  }\n\n  // ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„\n  if (message.includes('duplicate key') || message.includes('unique constraint')) {\n    return 'ã“ã®å€¤ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™'\n  }\n\n  // NOT NULLåˆ¶ç´„\n  if (message.includes('null value') || message.includes('violates not-null')) {\n    return 'å¿…é ˆé …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“'\n  }\n\n  // ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼\n  if (message.includes('syntax error') || message.includes('invalid input')) {\n    return 'å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™'\n  }\n\n  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\n  return message\n}\n\n/**\n * OpenAI APIã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ—¥æœ¬èªåŒ–\n */\nexport function translateOpenAIError(status: number, message?: string): string {\n  switch (status) {\n    case 401:\n      return 'OpenAI APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„'\n    case 429:\n      return 'APIåˆ©ç”¨åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„'\n    case 500:\n    case 502:\n    case 503:\n      return 'OpenAI APIã‚µãƒ¼ãƒãƒ¼ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„'\n    default:\n      return message || 'ChatGPT APIã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'\n  }\n}\n\n/**\n * æ±ç”¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—\n */\nexport function getErrorMessage(error: unknown): string {\n  if (typeof error === 'string') {\n    return error\n  }\n\n  if (error && typeof error === 'object') {\n    // Supabaseã‚¨ãƒ©ãƒ¼\n    if ('message' in error) {\n      return translateSupabaseError(error)\n    }\n\n    // PostgrestError\n    if ('code' in error && 'details' in error) {\n      return translateSupabaseError(error)\n    }\n  }\n\n  return 'äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'\n}\n",
  "src/lib/format.ts": "export const formatCurrency = (value: number): string => {\n  return new Intl.NumberFormat('ja-JP', {\n    style: 'currency',\n    currency: 'JPY',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0\n  }).format(value)\n}\n\nexport const formatPercent = (value: number): string => {\n  return `${value.toFixed(1)}%`\n}\n\nexport const formatNumber = (value: number): string => {\n  return value.toLocaleString('ja-JP')\n}\n\nexport const formatDate = (date: Date | string): string => {\n  const d = typeof date === 'string' ? new Date(date) : date\n  return d.toLocaleDateString('ja-JP', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  })\n}\n\nexport const formatDateRange = (start: Date, end: Date): string => {\n  return `${formatDate(start)} - ${formatDate(end)}`\n}\n\nexport const truncateText = (text: string, maxLength: number): string => {\n  return text.length > maxLength ? `${text.slice(0, maxLength)}...` : text\n}",
  "src/lib/mock.ts": "// ãƒ¢ãƒƒã‚¯ã‚¹ãƒˆã‚¢ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰\n// å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã¯Supabaseã¾ãŸã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å–å¾—ã—ã¾ã™\n\nimport type { DailyReportData } from '@/types'\n\nexport const mockStores = [\n  {\n    id: 'store-toyosu',\n    name: 'å±…é…’å±‹ã„ã£ãè±Šæ´²åº—',\n    address: 'æ±äº¬éƒ½æ±Ÿæ±åŒºè±Šæ´²4-1-1',\n    is_active: true\n  },\n  {\n    id: 'store-ariake',\n    name: 'å±…é…’å±‹ã„ã£ãæœ‰æ˜åº—',\n    address: 'æ±äº¬éƒ½æ±Ÿæ±åŒºæœ‰æ˜4-3-2',\n    is_active: true\n  },\n  {\n    id: 'store-honten',\n    name: 'å±…é…’å±‹ã„ã£ãæœ¬åº—',\n    address: 'æ±äº¬éƒ½æ±Ÿæ±åŒºå¤çŸ³å ´2-14-1',\n    is_active: true\n  },\n  {\n    id: 'store-afro',\n    name: 'ãƒãƒ¼ãƒ«ã‚¢ãƒ•ãƒ­ãƒãƒ¼ã‚¸ãƒ¥ã‚¹ãƒ¼ãƒ´ã‚©ãƒ¯ãƒ«',\n    address: 'æ±äº¬éƒ½ä¸–ç”°è°·åŒºç‰å·4-5-6å°¾å³¶ãƒ“ãƒ«ï¼‘F',\n    is_active: true\n  }\n]\n\n/**\n * æŒ‡å®šæ—¥æ•°åˆ†ã®ãƒ¢ãƒƒã‚¯æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆï¼ˆãƒ‡ãƒ¢ï¼ãƒ‡ãƒ¼ã‚¿æ¬ ææ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰\n * @param days ç”Ÿæˆã™ã‚‹æ—¥æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30æ—¥ï¼‰\n * @param storeId åº—èˆ—IDï¼ˆæŒ‡å®šã—ãªã„å ´åˆã¯å…¨åº—èˆ—ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ï¼‰\n * @returns ãƒ¢ãƒƒã‚¯æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—\n */\nexport function generateMockReports(days: number = 30, storeId?: string): DailyReportData[] {\n  const today = new Date()\n  const reports: DailyReportData[] = []\n\n  const stores = storeId\n    ? mockStores.filter(s => s.id === storeId)\n    : mockStores\n\n  if (stores.length === 0) {\n    console.warn('generateMockReports: æœ‰åŠ¹ãªåº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“')\n    return []\n  }\n\n  for (let i = 0; i < days; i++) {\n    const date = new Date(today)\n    date.setDate(date.getDate() - i)\n    const dateStr = date.toISOString().slice(0, 10)\n\n    // å„åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\n    stores.forEach(store => {\n      // åŸºæœ¬å£²ä¸Šï¼ˆåº—èˆ—ã”ã¨ã«å¤‰å‹•ï¼‰\n      const baseSales = store.id === 'store-toyosu' ? 280000 :\n                       store.id === 'store-ariake' ? 250000 :\n                       store.id === 'store-honten' ? 320000 : 200000\n\n      // æ—¥æ¬¡å¤‰å‹•ï¼ˆÂ±30%ï¼‰\n      const variation = 0.7 + Math.random() * 0.6\n      const sales = Math.round(baseSales * variation)\n\n      // åŸä¾¡ç‡32%\n      const purchase = Math.round(sales * 0.32)\n\n      // äººä»¶è²»ç‡25%\n      const laborCost = Math.round(sales * 0.25)\n\n      // ãã®ä»–çµŒè²»\n      const utilities = Math.round(sales * 0.03)\n      const promotion = Math.round(sales * 0.02)\n      const cleaning = Math.round(sales * 0.01)\n      const misc = Math.round(sales * 0.02)\n      const communication = Math.round(sales * 0.005)\n      const others = Math.round(sales * 0.015)\n\n      // å£²ä¸Šå†…è¨³ï¼ˆç¨ç‡ãƒ»æ±ºæ¸ˆæ–¹æ³•ï¼‰\n      const salesCash10 = Math.round(sales * 0.50)    // ç¾é‡‘10%ç¨ç‡: 50%\n      const salesCash8 = Math.round(sales * 0.15)     // ç¾é‡‘8%ç¨ç‡: 15%\n      const salesCredit10 = Math.round(sales * 0.25)  // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ10%ç¨ç‡: 25%\n      const salesCredit8 = Math.round(sales * 0.10)   // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ8%ç¨ç‡: 10%\n\n      // å®¢æ•°ï¼ˆå®¢å˜ä¾¡3,500å††å‰å¾Œï¼‰\n      const customers = Math.round(sales / 3500)\n\n      reports.push({\n        id: `mock-${store.id}-${dateStr}`,\n        date: dateStr,\n        storeId: store.id,\n        storeName: store.name,\n        sales,\n        purchase,\n        laborCost,\n        utilities,\n        promotion,\n        cleaning,\n        misc,\n        communication,\n        others,\n        salesCash10,\n        salesCash8,\n        salesCredit10,\n        salesCredit8,\n        customers,\n        reportText: 'ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿',\n        createdAt: new Date().toISOString()\n      })\n    })\n  }\n\n  return reports\n}\n\n/**\n * æŒ‡å®šæœŸé–“ã®ãƒ¢ãƒƒã‚¯æ—¥å ±ã‚’ç”Ÿæˆ\n * @param params.storeId åº—èˆ—ID\n * @param params.start é–‹å§‹æ—¥ï¼ˆYYYY-MM-DDï¼‰\n * @param params.end çµ‚äº†æ—¥ï¼ˆYYYY-MM-DDï¼‰\n * @returns ãƒ¢ãƒƒã‚¯æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—\n */\nexport function generateMockReportsForPeriod(params: {\n  storeId: string\n  start: string\n  end: string\n}): DailyReportData[] {\n  const { storeId, start, end } = params\n  const startDate = new Date(start)\n  const endDate = new Date(end)\n\n  if (startDate > endDate) {\n    console.warn('generateMockReportsForPeriod: é–‹å§‹æ—¥ãŒçµ‚äº†æ—¥ã‚ˆã‚Šå¾Œã§ã™')\n    return []\n  }\n\n  const reports: DailyReportData[] = []\n  const store = mockStores.find(s => s.id === storeId)\n\n  if (!store) {\n    console.warn('generateMockReportsForPeriod: åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', storeId)\n    return []\n  }\n\n  const currentDate = new Date(startDate)\n\n  while (currentDate <= endDate) {\n    const dateStr = currentDate.toISOString().slice(0, 10)\n\n    // åŸºæœ¬å£²ä¸Š\n    const baseSales = store.id === 'store-toyosu' ? 280000 :\n                     store.id === 'store-ariake' ? 250000 :\n                     store.id === 'store-honten' ? 320000 : 200000\n\n    const variation = 0.7 + Math.random() * 0.6\n    const sales = Math.round(baseSales * variation)\n    const purchase = Math.round(sales * 0.32)\n    const laborCost = Math.round(sales * 0.25)\n    const utilities = Math.round(sales * 0.03)\n    const promotion = Math.round(sales * 0.02)\n    const cleaning = Math.round(sales * 0.01)\n    const misc = Math.round(sales * 0.02)\n    const communication = Math.round(sales * 0.005)\n    const others = Math.round(sales * 0.015)\n\n    const salesCash10 = Math.round(sales * 0.50)\n    const salesCash8 = Math.round(sales * 0.15)\n    const salesCredit10 = Math.round(sales * 0.25)\n    const salesCredit8 = Math.round(sales * 0.10)\n    const customers = Math.round(sales / 3500)\n\n    reports.push({\n      id: `mock-${store.id}-${dateStr}`,\n      date: dateStr,\n      storeId: store.id,\n      storeName: store.name,\n      sales,\n      purchase,\n      laborCost,\n      utilities,\n      promotion,\n      cleaning,\n      misc,\n      communication,\n      others,\n      salesCash10,\n      salesCash8,\n      salesCredit10,\n      salesCredit8,\n      customers,\n      reportText: 'ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿',\n      createdAt: new Date().toISOString()\n    })\n\n    currentDate.setDate(currentDate.getDate() + 1)\n  }\n\n  return reports\n}\n\n// å‹å®šç¾©ã¯ @/types ã‹ã‚‰importã—ã¦ãã ã•ã„\nexport type { DailyReportData, TargetData, Store } from '@/types'\n",
  "src/lib/organizationHelper.ts": "import { supabase } from './supabase'\n\nexport async function getCurrentOrganizationId(userId: string): Promise<string | null> {\n  if (!userId) return null\n\n  try {\n    const { data: memberData, error } = await supabase\n      .from('organization_members')\n      .select('organization_id')\n      .eq('user_id', userId)\n      .maybeSingle()\n\n    if (error) {\n      console.error('Failed to get organization ID:', error)\n      return null\n    }\n\n    return memberData?.organization_id || null\n  } catch (error) {\n    console.error('Error getting organization ID:', error)\n    return null\n  }\n}\n\nexport function addOrganizationFilter<T>(\n  query: any,\n  organizationId: string | undefined | null\n): any {\n  if (!organizationId) {\n    return query\n  }\n  return query.eq('organization_id', organizationId)\n}\n\nexport async function validateOrganizationAccess(\n  userId: string,\n  organizationId: string\n): Promise<boolean> {\n  if (!userId || !organizationId) return false\n\n  try {\n    const { data, error } = await supabase\n      .from('organization_members')\n      .select('organization_id')\n      .eq('user_id', userId)\n      .eq('organization_id', organizationId)\n      .maybeSingle()\n\n    if (error) {\n      console.error('Failed to validate organization access:', error)\n      return false\n    }\n\n    return !!data\n  } catch (error) {\n    console.error('Error validating organization access:', error)\n    return false\n  }\n}\n\nexport async function getUserOrganizationRole(\n  userId: string,\n  organizationId: string\n): Promise<'owner' | 'admin' | 'member' | null> {\n  if (!userId || !organizationId) return null\n\n  try {\n    const { data, error } = await supabase\n      .from('organization_members')\n      .select('role')\n      .eq('user_id', userId)\n      .eq('organization_id', organizationId)\n      .maybeSingle()\n\n    if (error) {\n      console.error('Failed to get organization role:', error)\n      return null\n    }\n\n    return data?.role || null\n  } catch (error) {\n    console.error('Error getting organization role:', error)\n    return null\n  }\n}\n\nexport async function checkOrganizationLimits(organizationId: string): Promise<{\n  withinStoreLimit: boolean\n  withinUserLimit: boolean\n  withinAiRequestLimit: boolean\n  currentStores: number\n  currentUsers: number\n  currentAiRequests: number\n  maxStores: number\n  maxUsers: number\n  maxAiRequests: number\n}> {\n  if (!organizationId) {\n    return {\n      withinStoreLimit: false,\n      withinUserLimit: false,\n      withinAiRequestLimit: false,\n      currentStores: 0,\n      currentUsers: 0,\n      currentAiRequests: 0,\n      maxStores: 0,\n      maxUsers: 0,\n      maxAiRequests: 0\n    }\n  }\n\n  try {\n    const { data: org, error: orgError } = await supabase\n      .from('organizations')\n      .select('max_stores, max_users, max_ai_requests_per_month')\n      .eq('id', organizationId)\n      .single()\n\n    if (orgError || !org) {\n      throw new Error('Failed to fetch organization limits')\n    }\n\n    const { count: storesCount } = await supabase\n      .from('stores')\n      .select('*', { count: 'exact', head: true })\n      .eq('organization_id', organizationId)\n\n    const { count: usersCount } = await supabase\n      .from('organization_members')\n      .select('*', { count: 'exact', head: true })\n      .eq('organization_id', organizationId)\n\n    const startOfMonth = new Date()\n    startOfMonth.setDate(1)\n    startOfMonth.setHours(0, 0, 0, 0)\n\n    const { count: aiRequestsCount } = await supabase\n      .from('ai_usage_tracking')\n      .select('*', { count: 'exact', head: true })\n      .eq('organization_id', organizationId)\n      .gte('created_at', startOfMonth.toISOString())\n\n    const currentStores = storesCount || 0\n    const currentUsers = usersCount || 0\n    const currentAiRequests = aiRequestsCount || 0\n\n    return {\n      withinStoreLimit: currentStores < org.max_stores,\n      withinUserLimit: currentUsers < org.max_users,\n      withinAiRequestLimit: currentAiRequests < org.max_ai_requests_per_month,\n      currentStores,\n      currentUsers,\n      currentAiRequests,\n      maxStores: org.max_stores,\n      maxUsers: org.max_users,\n      maxAiRequests: org.max_ai_requests_per_month\n    }\n  } catch (error) {\n    console.error('Error checking organization limits:', error)\n    return {\n      withinStoreLimit: false,\n      withinUserLimit: false,\n      withinAiRequestLimit: false,\n      currentStores: 0,\n      currentUsers: 0,\n      currentAiRequests: 0,\n      maxStores: 0,\n      maxUsers: 0,\n      maxAiRequests: 0\n    }\n  }\n}\n",
  "src/lib/supabase.ts": "import { createClient } from '@supabase/supabase-js'\n\nconst url = import.meta.env.VITE_SUPABASE_URL!\nconst key = import.meta.env.VITE_SUPABASE_ANON_KEY!\n\nexport const supabase = createClient(url, key, {\n  auth: {\n    flowType: 'pkce',\n    persistSession: true,\n    autoRefreshToken: true,\n    detectSessionInUrl: true,\n    storageKey: 'rms-auth',\n  },\n})\n\nexport const isSupabaseReady = () => Boolean(url && key)\n\nconsole.log(isSupabaseReady() ? 'âœ… Supabase configured' : 'âš ï¸ Supabase not configured', {\n  hasUrl: !!url,\n  hasKey: !!key,\n})\n\nif (import.meta.env.DEV && supabase) {\n  (window as any).__supabase = supabase\n}\n\nexport interface Profile {\n  id: string\n  name: string\n  email: string\n  role: 'staff' | 'manager' | 'admin'\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface Store {\n  id: string\n  name: string\n  address: string\n  manager_id?: string\n  is_active?: boolean\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface DailyReportDb {\n  id: string\n  date: string\n  store_id: string\n  user_id: string\n  sales: number\n  purchase: number\n  labor_cost: number\n  utilities: number\n  promotion: number\n  cleaning: number\n  misc: number\n  communication: number\n  others: number\n  customers?: number\n  report_text?: string\n  created_at?: string\n  updated_at?: string\n}\n",
  "src/lib/utils.ts": "import { type ClassValue, clsx } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function formatCurrency(value: number): string {\n  return new Intl.NumberFormat('ja-JP', {\n    style: 'currency',\n    currency: 'JPY'\n  }).format(value)\n}\n\nexport function formatPercent(value: number): string {\n  return `${value.toFixed(1)}%`\n}\n\nexport function formatNumber(value: number): string {\n  return value.toLocaleString('ja-JP')\n}\n\n// UUID validation utility\nexport function isUUID(value?: string): boolean {\n  if (!value || typeof value !== 'string') return false\n  return /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(value)\n}",
  "src/main.tsx": "// import { StrictMode } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport { BrowserRouter } from 'react-router-dom';\nimport { AuthProvider } from './contexts/AuthContext';\nimport App from './App.tsx';\nimport './index.css';\n\ncreateRoot(document.getElementById('root')!).render(\n  // StrictMode temporarily disabled for debugging infinite loops\n  // <StrictMode>\n    <AuthProvider>\n      <BrowserRouter>\n        <App />\n      </BrowserRouter>\n    </AuthProvider>\n  // </StrictMode>\n);\n",
  "src/pages/AIChatPage.tsx": "import React, { useState, useRef, useEffect } from 'react'\nimport { useLocation, useNavigate } from 'react-router-dom'\nimport { Send, Bot, User, Brain, Sparkles, Lightbulb, Trash2, Store, MessageSquare, Archive, Search, Plus } from 'lucide-react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { useReports } from '@/hooks/useReports'\nimport { useKpis } from '@/hooks/useKpis'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { formatCurrency, formatPercent } from '@/lib/format'\nimport { useChatArchive } from '@/hooks/useChatArchive'\nimport { supabase } from '@/lib/supabase'\nimport { useAIUsageLimit } from '@/hooks/useAIUsageLimit'\nimport { AIUsageIndicator } from '@/components/Chat/AIUsageIndicator'\n\ninterface Message {\n  id: string\n  type: 'user' | 'ai'\n  content: string\n  timestamp: Date\n  suggestions?: string[]\n}\n\ninterface DisplayMessage extends Message {\n  role: 'user' | 'assistant'\n}\n\nexport const AIChatPage: React.FC = () => {\n  const location = useLocation()\n  const navigate = useNavigate()\n  const sp = new URLSearchParams(location.search)\n  const { user, getAccessibleStores } = useAuth()\n  \n  // Get accessible stores for current user\n  const accessibleStores = getAccessibleStores()\n  \n  // Set initial store based on user permissions\n  const getInitialStoreId = () => {\n    const urlStore = sp.get('store')\n    if (urlStore && accessibleStores.some(store => store.id === urlStore)) {\n      return urlStore\n    }\n    return accessibleStores.length > 0 ? accessibleStores[0].id : 'all'\n  }\n\n  const [currentStoreId, setCurrentStoreId] = useState(getInitialStoreId())\n  const initialConvId = sp.get('conv') || undefined\n\n  const {\n    conversationId,\n    messages: archivedMessages,\n    conversations,\n    loading: archiveLoading,\n    startNewConversation,\n    loadMessages,\n    sendUserMessage,\n    appendAssistantMessage,\n    renameConversation,\n    archiveConversation,\n    removeConversation,\n    search\n  } = useChatArchive(user?.id || 'guest', currentStoreId, initialConvId)\n\n  const [displayMessages, setDisplayMessages] = useState<Message[]>([\n    {\n      id: '1',\n      type: 'ai',\n      content: `ã“ã‚“ã«ã¡ã¯ï¼ğŸ¤– AIçµŒå–¶ã‚¢ãƒŠãƒªã‚¹ãƒˆã§ã™ã€‚\\n\\n${user?.name}ã•ã‚“ï¼ˆ${user?.role === 'admin' ? 'çµ±æ‹¬' : user?.role === 'manager' ? 'åº—é•·' : 'ã‚¹ã‚¿ãƒƒãƒ•'}æ¨©é™ï¼‰ã¨ã—ã¦ã€${user?.role === 'admin' ? 'å…¨åº—èˆ—ã®' : user?.role === 'manager' ? 'æ‹…å½“åº—èˆ—ã®' : 'å‹¤å‹™åº—èˆ—ã®'}æ¥­å‹™ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦å…·ä½“çš„ãªæ´å¯Ÿã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚\\n\\nä½•ã«ã¤ã„ã¦ãŠèãã«ãªã‚ŠãŸã„ã§ã™ã‹ï¼Ÿ`,\n      suggestions: [\n        user?.role === 'admin' ? 'å…¨åº—èˆ—ã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º' : 'ä»Šæœˆã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º',\n        user?.role === 'admin' ? 'åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ' : user?.role === 'manager' ? 'æ‹…å½“åº—èˆ—æ¯”è¼ƒåˆ†æ' : 'åº—èˆ—æ¥­ç¸¾åˆ†æ',\n        'æ¥æœˆã®å£²ä¸Šäºˆæ¸¬',\n        'çµŒè²»æœ€é©åŒ–ææ¡ˆ',\n        'ç›®æ¨™é”æˆãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—'\n      ],\n      timestamp: new Date()\n    }\n  ])\n  const [inputMessage, setInputMessage] = useState('')\n  const [isLoading, setIsLoading] = useState(false)\n  const [showSidebar, setShowSidebar] = useState(false)\n  const [searchQuery, setSearchQuery] = useState('')\n  const [searchResults, setSearchResults] = useState<any[]>([])\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  const { status: usageStatus, loading: usageLoading, refresh: refreshUsage } = useAIUsageLimit(user?.id)\n\n  useEffect(() => {\n    const convertedMessages: Message[] = archivedMessages.map(m => ({\n      id: m.id,\n      type: m.role === 'user' ? 'user' : 'ai',\n      content: m.content,\n      timestamp: new Date(m.created_at),\n      suggestions: undefined\n    }))\n\n    if (convertedMessages.length === 0) {\n      setDisplayMessages([{\n        id: '1',\n        type: 'ai',\n        content: `ã“ã‚“ã«ã¡ã¯ï¼ğŸ¤– AIçµŒå–¶ã‚¢ãƒŠãƒªã‚¹ãƒˆã§ã™ã€‚\\n\\n${user?.name}ã•ã‚“ï¼ˆ${user?.role === 'admin' ? 'çµ±æ‹¬' : user?.role === 'manager' ? 'åº—é•·' : 'ã‚¹ã‚¿ãƒƒãƒ•'}æ¨©é™ï¼‰ã¨ã—ã¦ã€${user?.role === 'admin' ? 'å…¨åº—èˆ—ã®' : user?.role === 'manager' ? 'æ‹…å½“åº—èˆ—ã®' : 'å‹¤å‹™åº—èˆ—ã®'}æ¥­å‹™ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦å…·ä½“çš„ãªæ´å¯Ÿã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚\\n\\nä½•ã«ã¤ã„ã¦ãŠèãã«ãªã‚ŠãŸã„ã§ã™ã‹ï¼Ÿ`,\n        suggestions: [\n          user?.role === 'admin' ? 'å…¨åº—èˆ—ã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º' : 'ä»Šæœˆã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º',\n          user?.role === 'admin' ? 'åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ' : user?.role === 'manager' ? 'æ‹…å½“åº—èˆ—æ¯”è¼ƒåˆ†æ' : 'åº—èˆ—æ¥­ç¸¾åˆ†æ',\n          'æ¥æœˆã®å£²ä¸Šäºˆæ¸¬',\n          'çµŒè²»æœ€é©åŒ–ææ¡ˆ',\n          'ç›®æ¨™é”æˆãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—'\n        ],\n        timestamp: new Date()\n      }])\n    } else {\n      setDisplayMessages(convertedMessages)\n    }\n  }, [archivedMessages, user])\n\n  const { data: reports } = useReports({ storeId: currentStoreId })\n  const kpis = useKpis(reports)\n  const mKey = new Date().toISOString().slice(0,7)\n  const thisMonthReports = reports.filter(r => r.date.startsWith(mKey))\n  const thisMonthKpis = useKpis(thisMonthReports)\n  \n  // Pre-calculate store-filtered KPIs for current selection\n  const currentStoreFilteredReports = currentStoreId === 'all' \n    ? reports \n    : reports.filter(r => r.storeId === currentStoreId)\n  const currentStoreKpis = useKpis(currentStoreFilteredReports)\n\n  const getStoreDisplayName = (storeId: string) => {\n    const store = accessibleStores.find(s => s.id === storeId)\n    return store ? store.label : 'é¸æŠåº—èˆ—'\n  }\n\n  const handleStoreChange = (newStoreId: string) => {\n    // Check if user has access to the selected store\n    if (!accessibleStores.some(store => store.id === newStoreId)) {\n      console.warn('Access denied to store:', newStoreId)\n      return\n    }\n    \n    setCurrentStoreId(newStoreId)\n    // Update URL\n    const newSearchParams = new URLSearchParams(location.search)\n    newSearchParams.set('store', newStoreId)\n    navigate(`${location.pathname}?${newSearchParams.toString()}`, { replace: true })\n  }\n\n  // Permission-based analysis context\n  const getAnalysisContext = () => {\n    if (!user) return 'æ¨©é™ãªã—'\n    \n    switch (user.role) {\n      case 'admin':\n        return 'çµ±æ‹¬æ¨©é™ï¼šå…¨åº—èˆ—ã®çµŒå–¶ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»æˆ¦ç•¥ç«‹æ¡ˆãŒå¯èƒ½'\n      case 'manager':\n        return `åº—é•·æ¨©é™ï¼šæ‹…å½“åº—èˆ—ï¼ˆ${user.assignedStores?.length || 0}åº—èˆ—ï¼‰ã®è©³ç´°åˆ†æãƒ»ç®¡ç†ãŒå¯èƒ½`\n      case 'staff':\n        return `ã‚¹ã‚¿ãƒƒãƒ•æ¨©é™ï¼šå‹¤å‹™åº—èˆ—ã®åŸºæœ¬åˆ†æãƒ»æ¥­ç¸¾ç¢ºèªãŒå¯èƒ½`\n      default:\n        return 'åŸºæœ¬æ¨©é™'\n    }\n  }\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }\n\n  useEffect(() => {\n    scrollToBottom()\n  }, [displayMessages])\n\n  const generateAIResponse = (\n    question: string,\n    context: { kpisAll: typeof kpis; kpisThisMonth: typeof thisMonthKpis; reports: typeof reports; storeId: string }\n  ): { content: string; suggestions?: string[] } => {\n    const q = question.toLowerCase()\n    \n    // Filter reports to selected store only (unless 'all' is explicitly selected by admin)\n    const filteredReports = context.storeId === 'all' \n      ? context.reports \n      : context.reports.filter(r => r.storeId === context.storeId)\n    \n    if (filteredReports.length === 0) {\n      return {\n        content: `ğŸ“Š ${context.storeId === 'all' ? 'å…¨åº—èˆ—ã®' : 'é¸æŠåº—èˆ—ã®'}åˆ†æå¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚\\n\\nã€Œæ–°è¦å ±å‘Šã€ã‹ã‚‰æ—¥æ¬¡å ±å‘Šã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚`,\n        suggestions: ['ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ', 'ã‚µãƒ³ãƒ—ãƒ«åˆ†æã‚’è¡¨ç¤º']\n      }\n    }\n\n    // Get selected store name for personalized responses\n    const selectedStore = accessibleStores.find(s => s.id === context.storeId)\n    const storeDisplayName = selectedStore ? selectedStore.name.replace('ğŸª ', '').replace('ğŸ¢ ', '') : 'é¸æŠåº—èˆ—'\n\n    const thisMonthKpis = context.kpisThisMonth\n\n    // ç‰¹åˆ¥ãªå£²ä¸Šå®Ÿç¸¾ã®åˆ†æï¼ˆ9æœˆ18æ—¥ã®è±Šæ´²åº—ï¼‰\n    const specialEvent = filteredReports.find(r => \n      r.date === '2024-09-18' && r.storeId === 'store-toyosu'\n    )\n    \n    if (q.includes('9æœˆ18æ—¥') || q.includes('918') || q.includes('ç‰¹åˆ¥') || q.includes('ã‚¤ãƒ™ãƒ³ãƒˆ') || q.includes('è±Šæ´²') && q.includes('æœ€é«˜')) {\n      if (specialEvent) {\n        const eventExpenses = specialEvent.purchase + specialEvent.laborCost + specialEvent.utilities + \n                             specialEvent.promotion + specialEvent.cleaning + specialEvent.misc + \n                             specialEvent.communication + specialEvent.others\n        const eventProfit = specialEvent.sales - eventExpenses\n        const eventMargin = (eventProfit / specialEvent.sales) * 100\n        \n        return {\n          content: `ğŸ‰ **2024å¹´9æœˆ18æ—¥ è±Šæ´²åº— ç‰¹åˆ¥å®Ÿç¸¾åˆ†æ**\\n\\nğŸ’° **å£²ä¸Šå®Ÿç¸¾:** ${formatCurrency(specialEvent.sales)}\\nğŸ“Š **å–¶æ¥­åˆ©ç›Š:** ${formatCurrency(eventProfit)}\\nğŸ“ˆ **åˆ©ç›Šç‡:** ${formatPercent(eventMargin)}\\n\\nğŸ† **ç‰¹åˆ¥è¦å› :**\\nâ€¢ è±Šæ´²å¸‚å ´è¦‹å­¦ãƒ„ã‚¢ãƒ¼ã¨ã®ã‚¿ã‚¤ã‚¢ãƒƒãƒ—åŠ¹æœ\\nâ€¢ ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬ã«ã‚ˆã‚‹å¤§å¹…å£²ä¸Šå‘ä¸Š\\nâ€¢ é€šå¸¸æ—¥å•†ã®ç´„5.5å€ã®å®Ÿç¸¾\\n\\nğŸ’¡ **æˆåŠŸè¦å› åˆ†æ:**\\nâ€¢ åœ°åŸŸç‰¹æ€§ã‚’æ´»ã‹ã—ãŸã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³\\nâ€¢ è¦³å…‰å®¢ã®å–ã‚Šè¾¼ã¿æˆåŠŸ\\nâ€¢ åŠ¹æœçš„ãªãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ–½ç­–`,\n          suggestions: ['ä»–åº—èˆ—ã§ã‚‚åŒæ§˜ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬å¯èƒ½ï¼Ÿ', 'ã‚¤ãƒ™ãƒ³ãƒˆæ™‚ã®çµŒè²»åŠ¹ç‡åˆ†æ', 'ä»Šå¾Œã®ç‰¹åˆ¥ä¼ç”»ææ¡ˆ']\n        }\n      }\n    }\n\n    // æœ€é«˜å£²ä¸Šæ—¥ã®åˆ†æ\n    if (q.includes('æœ€é«˜') && (q.includes('å£²ä¸Š') || q.includes('æ—¥å•†'))) {\n      const maxSalesReport = filteredReports.reduce((max, r) => \n        r.sales > max.sales ? r : max, context.reports[0] || { sales: 0 }\n      )\n      \n      if (maxSalesReport && maxSalesReport.sales > 0) {\n        const isSpecialDay = maxSalesReport.date === '2024-09-18' && maxSalesReport.storeId === 'store-toyosu'\n        return {\n          content: `ğŸ† **æœ€é«˜å£²ä¸Šæ—¥åˆ†æ**\\n\\nğŸ“… **æ—¥ä»˜:** ${maxSalesReport.date}\\nğŸª **åº—èˆ—:** ${maxSalesReport.storeName}\\nğŸ’° **å£²ä¸Š:** ${formatCurrency(maxSalesReport.sales)}\\n\\n${isSpecialDay ? 'ğŸŠ **è±Šæ´²å¸‚å ´è¦‹å­¦ãƒ„ã‚¢ãƒ¼ã¨ã®ã‚¿ã‚¤ã‚¢ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆ**\\nâ€¢ ç‰¹åˆ¥ä¼ç”»ã«ã‚ˆã‚‹è¨˜éŒ²çš„å£²ä¸Š\\nâ€¢ åœ°åŸŸé€£æºã®æˆåŠŸäº‹ä¾‹\\nâ€¢ è¦³å…‰å®¢æµå…¥ã®åŠ¹æœã‚’å®Ÿè¨¼' : 'ğŸ“ˆ **å„ªç§€ãªå–¶æ¥­å®Ÿç¸¾**\\né€šå¸¸å–¶æ¥­ã§ã®é«˜ã„å£²ä¸Šã‚’è¨˜éŒ²'}`,\n          suggestions: ['ã“ã®æˆåŠŸã‚’ä»–åº—èˆ—ã«å±•é–‹', 'æˆåŠŸè¦å› ã®è©³ç´°åˆ†æ', 'ä»Šå¾Œã®ä¼ç”»ææ¡ˆ']\n        }\n      }\n    }\n    if (q.includes('æ¥­ç¸¾') || q.includes('ã‚µãƒãƒªãƒ¼') || q.includes('ä»Šæœˆ')) {\n      const scopeLabel = context.storeId === 'all' ? 'å…¨åº—èˆ—' : storeDisplayName\n      \n      return {\n        content: `ğŸ“Š **${scopeLabel}ã®ä»Šæœˆæ¥­ç¸¾ã‚µãƒãƒªãƒ¼**\\n\\nğŸ¢ **å®Ÿç¸¾:**\\nâ€¢ å£²ä¸Š: ${formatCurrency(context.kpisAll.totalSales)}\\nâ€¢ å–¶æ¥­åˆ©ç›Š: ${formatCurrency(context.kpisAll.operatingProfit)}\\nâ€¢ åˆ©ç›Šç‡: ${formatPercent(context.kpisAll.profitMargin)}\\nâ€¢ å ±å‘Šæ•°: ${context.kpisAll.reportCount}ä»¶\\n\\n${context.storeId === 'all' ? 'ğŸ“Š å…¨åº—èˆ—çµ±åˆåˆ†æ' : `ğŸª ${storeDisplayName}å°‚ç”¨åˆ†æ`}\\n\\n${context.kpisAll.profitMargin >= 20 ? 'ğŸ‰ å„ªç§€ãªæ¥­ç¸¾ã§ã™ï¼' : context.kpisAll.profitMargin >= 15 ? 'ğŸ‘ è‰¯å¥½ãªæ¥­ç¸¾ã§ã™' : 'âš ï¸ æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™'}`,\n        suggestions: ['è©³ç´°ãªåº—èˆ—åˆ¥åˆ†æ', 'æ¥æœˆã®å£²ä¸Šäºˆæ¸¬', 'çµŒå–¶æ”¹å–„ææ¡ˆ']\n      }\n    }\n\n    // åº—èˆ—æ¯”è¼ƒ\n    if (q.includes('åº—èˆ—') && (q.includes('æ¯”è¼ƒ') || q.includes('åˆ†æ'))) {\n      // Permission check for store comparison\n      if (user?.role === 'staff') {\n        const staffStore = user.assignedStores?.[0]?.name || 'å‹¤å‹™åº—èˆ—'\n        return {\n          content: `ğŸ“Š **${staffStore}ã®æ¥­ç¸¾åˆ†æ**\\n\\nğŸ’° **å£²ä¸Šå®Ÿç¸¾:** ${formatCurrency(context.kpisAll.totalSales)}\\nğŸ“ˆ **åˆ©ç›Šç‡:** ${formatPercent(context.kpisAll.profitMargin)}\\nğŸ“Š **å ±å‘Šæ•°:** ${context.kpisAll.reportCount}ä»¶\\n\\nğŸ’¡ **ã‚¹ã‚¿ãƒƒãƒ•æ¨©é™ã§ã¯å˜ä¸€åº—èˆ—ã®åˆ†æã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚**`,\n          suggestions: ['ä»Šæœˆã®å£²ä¸Šå‚¾å‘', 'çµŒè²»æ§‹é€ åˆ†æ', 'ç›®æ¨™é”æˆåº¦ç¢ºèª']\n        }\n      }\n      \n      // If specific store is selected, show only that store's analysis\n      if (context.storeId !== 'all') {\n        return {\n          content: `ğŸ“Š **${storeDisplayName}ã®æ¥­ç¸¾åˆ†æ**\\n\\nğŸ’° **å£²ä¸Šå®Ÿç¸¾:** ${formatCurrency(context.kpisAll.totalSales)}\\nğŸ“ˆ **åˆ©ç›Šç‡:** ${formatPercent(context.kpisAll.profitMargin)}\\nğŸ“Š **å ±å‘Šæ•°:** ${context.kpisAll.reportCount}ä»¶\\n\\nğŸª **é¸æŠåº—èˆ—å°‚ç”¨åˆ†æã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚**`,\n          suggestions: ['ã“ã®åº—èˆ—ã®å£²ä¸Šå‚¾å‘', 'çµŒè²»æ§‹é€ è©³ç´°åˆ†æ', 'æ”¹å–„ææ¡ˆ']\n        }\n      }\n      \n      // Only admin can see multi-store comparison when 'all' is selected\n      if (user?.role !== 'admin') {\n        return {\n          content: `ğŸ“Š **æ¨©é™åˆ¶é™ã«ã‚ˆã‚Šæ¯”è¼ƒåˆ†æã¯åˆ©ç”¨ã§ãã¾ã›ã‚“**\\n\\nğŸ’¡ **${user?.role === 'manager' ? 'åº—é•·' : 'ã‚¹ã‚¿ãƒƒãƒ•'}æ¨©é™ã§ã¯å€‹åˆ¥åº—èˆ—ã®åˆ†æã®ã¿å¯èƒ½ã§ã™ã€‚**\\n\\nğŸª **ç¾åœ¨ã®åˆ†æå¯¾è±¡:** ${storeDisplayName}`,\n          suggestions: ['å€‹åˆ¥åº—èˆ—ã®è©³ç´°åˆ†æ', 'å£²ä¸Šå‘ä¸Šæ–½ç­–', 'çµŒè²»æœ€é©åŒ–']\n        }\n      }\n      \n      const storeAnalysis = filteredReports.reduce((acc, report) => {\n        if (!acc[report.storeName]) {\n          acc[report.storeName] = { sales: 0, profit: 0, count: 0 }\n        }\n        const expenses = report.purchase + report.laborCost + report.utilities + \n                        report.promotion + report.cleaning + report.misc + \n                        report.communication + report.others\n        acc[report.storeName].sales += report.sales\n        acc[report.storeName].profit += (report.sales - expenses)\n        acc[report.storeName].count += 1\n        return acc\n      }, {} as Record<string, { sales: number; profit: number; count: number }>)\n\n      const ranking = Object.entries(storeAnalysis)\n        .map(([name, data]) => ({\n          name: name.replace('å±…é…’å±‹ã„ã£ã', ''),\n          sales: data.sales,\n          profit: data.profit,\n          profitMargin: data.sales > 0 ? (data.profit / data.sales) * 100 : 0\n        }))\n        .sort((a, b) => b.sales - a.sales)\n\n      // è±Šæ´²åº—ã®ç‰¹åˆ¥å®Ÿç¸¾ã‚’å¼·èª¿\n      const toyosuRanking = ranking.find(r => r.name.includes('è±Šæ´²'))\n      const hasSpecialEvent = filteredReports.some(r => \n        r.date === '2024-09-18' && r.storeId === 'store-toyosu'\n      )\n      return {\n        content: `ğŸ† **${context.storeId === 'all' ? 'å…¨åº—èˆ—' : storeDisplayName}ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ**\\n\\n${ranking.map((store, i) => {\n          const isTop = i === 0\n          const isToyosu = store.name.includes('è±Šæ´²')\n          return `${isTop ? 'ğŸ‘‘' : `${i + 1}ä½.`} ${store.name}åº—\\nâ€¢ å£²ä¸Š: ${formatCurrency(store.sales)}\\nâ€¢ åˆ©ç›Šç‡: ${formatPercent(store.profitMargin)}${isToyosu && hasSpecialEvent ? '\\nâ­ ç‰¹åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿç¸¾å«ã‚€' : ''}`\n        }).join('\\n\\n')}${hasSpecialEvent ? '\\n\\nğŸ’¡ **æ³¨ç›®ãƒã‚¤ãƒ³ãƒˆ:**\\nè±Šæ´²åº—ã¯9/18ã«å¸‚å ´è¦‹å­¦ãƒ„ã‚¢ãƒ¼ã‚³ãƒ©ãƒœã§è¨˜éŒ²çš„å£²ä¸Šã‚’é”æˆ' : ''}`,\n        suggestions: ['ãƒˆãƒƒãƒ—åº—èˆ—ã®æˆåŠŸè¦å› ', 'æ”¹å–„ãŒå¿…è¦ãªåº—èˆ—ã®å¯¾ç­–', 'å…¨åº—èˆ—å…±é€šã®èª²é¡Œ']\n      }\n    }\n\n    // çµŒè²»åˆ†æ\n    if (q.includes('çµŒè²»') || q.includes('ã‚³ã‚¹ãƒˆ')) {\n      const expenseTotal = filteredReports.reduce((sum, r) => \n        sum + r.purchase + r.laborCost + r.utilities + r.promotion + \n        r.cleaning + r.misc + r.communication + r.others, 0)\n      const purchaseTotal = filteredReports.reduce((sum, r) => sum + r.purchase, 0)\n      const purchaseRatio = (purchaseTotal / expenseTotal) * 100\n\n      return {\n        content: `ğŸ’¸ **${storeDisplayName}ã®çµŒè²»æ§‹é€ åˆ†æ**\\n\\nğŸ’° **ç·çµŒè²»:** ${formatCurrency(expenseTotal)}\\nğŸ¥‡ **æœ€å¤§é …ç›®:** ä»•å…¥ (${purchaseRatio.toFixed(1)}%)\\n\\nğŸ“Š é¸æŠåº—èˆ—ã®çµŒè²»æ¯”ç‡åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸã€‚`,\n        suggestions: ['çµŒè²»å‰Šæ¸›æˆ¦ç•¥', 'æœ€é©ãªçµŒè²»æ¯”ç‡', 'ã‚³ã‚¹ãƒˆç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹']\n      }\n    }\n\n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¿œç­”\n    return {\n      content: `ğŸ¤– **AIåˆ†æã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­**\\n\\nğŸª **åˆ†æå¯¾è±¡:** ${storeDisplayName}\\nğŸ“Š **ãƒ‡ãƒ¼ã‚¿ä»¶æ•°:** ${filteredReports.length}ä»¶\\n\\nåˆ©ç”¨å¯èƒ½ãªåˆ†æ:\\nğŸ“Š æ¥­ç¸¾åˆ†æ\\nğŸ† ${context.storeId === 'all' && user?.role === 'admin' ? 'åº—èˆ—æ¯”è¼ƒ' : 'åº—èˆ—åˆ†æ'}\\nğŸ’¸ çµŒè²»åˆ†æ\\nğŸ¯ ç›®æ¨™é€²æ—\\n\\nå…·ä½“çš„ãªè³ªå•ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚`,\n      suggestions: [\n        'ä»Šæœˆã®æ¥­ç¸¾ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º',\n        context.storeId === 'all' && user?.role === 'admin' ? 'åº—èˆ—åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ' : 'åº—èˆ—è©³ç´°åˆ†æ', \n        'çµŒè²»æ§‹é€ ã‚’åˆ†æ',\n        'ç›®æ¨™é”æˆçŠ¶æ³ã‚’ç¢ºèª'\n      ]\n    }\n  }\n\n  const handleSendMessage = async () => {\n    if (!inputMessage.trim() || isLoading) return\n\n    if (usageStatus?.isLimited) {\n      alert(`æœ¬æ—¥ã®åˆ©ç”¨ä¸Šé™ï¼ˆ${usageStatus.dailyLimit}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚\\næ˜æ—¥åˆå‰0æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚`)\n      return\n    }\n\n    const userText = inputMessage\n    setInputMessage('')\n    setIsLoading(true)\n\n    const { error: userMsgError, conversationId: msgConvId } = await sendUserMessage(userText)\n\n    if (userMsgError) {\n      console.error('Failed to send user message:', userMsgError)\n      setIsLoading(false)\n      return\n    }\n\n    try {\n      // Prepare business data for ChatGPT context\n      // Filter data to selected store only for security\n      const selectedStoreName = accessibleStores.find(s => s.id === currentStoreId)?.name || 'é¸æŠåº—èˆ—'\n      \n      const businessData = {\n        totalSales: currentStoreKpis.totalSales,\n        totalExpenses: currentStoreKpis.totalExpenses,\n        profitMargin: currentStoreKpis.profitMargin,\n        reportCount: currentStoreKpis.reportCount,\n        analysisScope: currentStoreId === 'all' ? 'å…¨åº—èˆ—' : selectedStoreName.replace('ğŸª ', '').replace('ğŸ¢ ', ''),\n        stores: currentStoreId === 'all' \n          ? accessibleStores.map(s => s.name.replace('ğŸª ', '').replace('ğŸ¢ ', ''))\n          : [selectedStoreName.replace('ğŸª ', '').replace('ğŸ¢ ', '')],\n        recentEvents: currentStoreFilteredReports.some(r => r.date === '2024-09-18' && r.storeId === 'store-toyosu') \n          ? ['è±Šæ´²åº—2024å¹´9æœˆ18æ—¥: å£²ä¸Š1,534,220å††ã®è¨˜éŒ²çš„å®Ÿç¸¾ï¼ˆè±Šæ´²å¸‚å ´è¦‹å­¦ãƒ„ã‚¢ãƒ¼ã‚³ãƒ©ãƒœï¼‰'] \n          : [],\n        currentMonth: {\n          sales: currentStoreKpis.totalSales,\n          profit: currentStoreKpis.operatingProfit,\n          margin: currentStoreKpis.profitMargin\n        }\n      }\n\n      // Get user session for Edge Function authentication\n      const { data: { session } } = await supabase!.auth.getSession()\n\n      // Call ChatGPT via Supabase Edge Function\n      const response = await fetch(`${import.meta.env.VITE_SUPABASE_URL}/functions/v1/chat-gpt`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session?.access_token ?? import.meta.env.VITE_SUPABASE_ANON_KEY}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messages: [\n            ...displayMessages.slice(-6).map(m => ({\n              role: m.type === 'user' ? 'user' : 'assistant',\n              content: m.content\n            })),\n            { role: 'user', content: userText }\n          ],\n          businessData,\n          storeId: currentStoreId\n        })\n      })\n\n      const result = await response.json()\n\n      let assistantContent: string\n\n      if (response.status === 429) {\n        assistantContent = result.message || result.error || 'æœ¬æ—¥ã®åˆ©ç”¨ä¸Šé™ã«é”ã—ã¾ã—ãŸã€‚'\n        await appendAssistantMessage(assistantContent, undefined, msgConvId)\n        await refreshUsage()\n        setIsLoading(false)\n        return\n      }\n\n      if (result.success && result.response) {\n        assistantContent = result.response\n\n        if (result.usageInfo) {\n          await refreshUsage()\n        }\n      } else {\n        console.warn('ChatGPT API failed, using local fallback:', result.error)\n        const fallbackResponse = generateAIResponse(userText, {\n          kpisAll: currentStoreKpis,\n          kpisThisMonth: thisMonthKpis,\n          reports: currentStoreFilteredReports,\n          storeId: currentStoreId\n        })\n        assistantContent = `${fallbackResponse.content}\\n\\nğŸ’¡ ãƒ­ãƒ¼ã‚«ãƒ«åˆ†æã§å¯¾å¿œä¸­`\n      }\n\n      await appendAssistantMessage(assistantContent, { usage: result?.usage }, msgConvId)\n\n      if (archivedMessages.length < 2 && (conversationId || msgConvId)) {\n        await renameConversation(userText.slice(0, 30))\n      }\n    } catch (error) {\n      console.error('ChatGPT API error:', error)\n      await appendAssistantMessage('âš ï¸ AIå¿œç­”ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚', undefined, msgConvId)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleSuggestionClick = (suggestion: string) => {\n    setInputMessage(suggestion)\n  }\n\n  const clearChat = async () => {\n    await startNewConversation(currentStoreId, 'æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ')\n  }\n\n  const handleSearch = async () => {\n    if (!searchQuery.trim()) {\n      setSearchResults([])\n      return\n    }\n    const results = await search(searchQuery)\n    setSearchResults(results)\n  }\n\n  const handleLoadConversation = async (convId: string) => {\n    await loadMessages(convId)\n    setShowSidebar(false)\n    const newSearchParams = new URLSearchParams(location.search)\n    newSearchParams.set('conv', convId)\n    navigate(`${location.pathname}?${newSearchParams.toString()}`, { replace: true })\n  }\n\n  return (\n    <div className=\"w-full max-w-6xl mx-auto space-y-3 sm:space-y-6 px-2 sm:px-4 lg:px-0\">\n      <div className=\"flex gap-4\">\n        {showSidebar && (\n          <Card className=\"w-80 flex-shrink-0 h-[85vh] overflow-hidden\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <MessageSquare className=\"w-4 h-4\" />\n                ä¼šè©±å±¥æ­´\n              </CardTitle>\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"æ¤œç´¢...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n                  className=\"flex-1 px-2 py-1 text-xs border rounded\"\n                />\n                <Button size=\"sm\" variant=\"outline\" onClick={handleSearch}>\n                  <Search className=\"w-3 h-3\" />\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"overflow-y-auto h-[calc(100%-100px)] space-y-2\">\n              {searchResults.length > 0 ? (\n                <div className=\"space-y-2\">\n                  <p className=\"text-xs text-muted-foreground\">æ¤œç´¢çµæœ: {searchResults.length}ä»¶</p>\n                  {searchResults.map((result: any) => (\n                    <button\n                      key={result.conversation_id}\n                      onClick={() => handleLoadConversation(result.conversation_id)}\n                      className=\"w-full text-left p-2 rounded hover:bg-accent text-xs border\"\n                    >\n                      <div className=\"font-medium truncate\">{result.title}</div>\n                      <div className=\"text-muted-foreground line-clamp-2\">{result.snippet}</div>\n                    </button>\n                  ))}\n                </div>\n              ) : (\n                conversations.slice(0, 20).map((conv: any) => (\n                  <div key={conv.id} className=\"relative group\">\n                    <button\n                      onClick={() => handleLoadConversation(conv.id)}\n                      className={`w-full text-left p-2 rounded hover:bg-accent text-xs transition-colors ${\n                        conversationId === conv.id ? 'bg-accent' : ''\n                      }`}\n                    >\n                      <div className=\"font-medium truncate\">{conv.title || 'æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ'}</div>\n                      <div className=\"text-muted-foreground\">\n                        {new Date(conv.updated_at).toLocaleDateString('ja-JP')}\n                      </div>\n                    </button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => archiveConversation(conv.id)}\n                      className=\"absolute right-1 top-1 opacity-0 group-hover:opacity-100 h-6 w-6 p-0\"\n                    >\n                      <Archive className=\"w-3 h-3\" />\n                    </Button>\n                  </div>\n                ))\n              )}\n            </CardContent>\n          </Card>\n        )}\n        <div className=\"flex-1 space-y-3 sm:space-y-6\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-4 sm:p-6\">\n        <div className=\"flex flex-col gap-3\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-white/20 rounded-lg\">\n              <Brain className=\"w-6 h-6\" />\n            </div>\n            <div className=\"flex-1\">\n              <h1 className=\"text-base sm:text-xl font-bold\">AIçµŒå–¶ã‚¢ãƒŠãƒªã‚¹ãƒˆ</h1>\n              <p className=\"text-xs text-blue-100\">\n                <span className=\"hidden sm:inline\">OpenAI GPT-4o-minié€£æº - </span>\n                {user?.role === 'admin' ? 'çµ±æ‹¬å°‚ç”¨' : user?.role === 'manager' ? 'åº—é•·å°‚ç”¨' : 'ã‚¹ã‚¿ãƒƒãƒ•å°‚ç”¨'}åˆ†æAI\n              </p>\n            </div>\n            <div className=\"hidden sm:block\">\n              <AIUsageIndicator status={usageStatus} loading={usageLoading} compact />\n            </div>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <div className=\"flex items-center gap-2 text-blue-100 text-xs\">\n              <Sparkles className=\"w-3 h-3\" />\n              <span>\n                {getAnalysisContext().split('ï¼š')[0]}ãƒ‡ãƒ¼ã‚¿: {reports.length}ä»¶\n              </span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"sm:hidden\">\n                <AIUsageIndicator status={usageStatus} loading={usageLoading} compact />\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <div className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\"></div>\n                <Badge className=\"bg-green-500/20 text-green-100 border-green-300/30 text-xs px-2 py-0\">\n                  <span className=\"hidden sm:inline\">ChatGPT</span>é€£æºä¸­\n                </Badge>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Mobile Store Selector */}\n      <div className=\"md:hidden mb-4\">\n        <Card>\n          <CardHeader className=\"pb-2 px-4 py-3\">\n            <CardTitle className=\"text-sm flex items-center gap-2 truncate\">\n              <Store className=\"w-4 h-4 text-blue-600\" />\n              åˆ†æå¯¾è±¡åº—èˆ— ({user?.role === 'admin' ? 'å…¨æ¨©é™' : user?.role === 'manager' ? 'æ‹…å½“åº—èˆ—' : 'å‹¤å‹™åº—èˆ—'})\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-0 px-4 pb-3\">\n            <select\n              value={currentStoreId}\n              onChange={(e) => handleStoreChange(e.target.value)}\n              className=\"w-full px-3 py-3 text-sm border border-input rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring min-h-[44px] truncate\"\n            >\n              {accessibleStores.map(store => (\n                <option key={store.id} value={store.id}>\n                  {store.name}\n                </option>\n              ))}\n            </select>\n            <p className=\"text-xs text-muted-foreground mt-2 leading-relaxed\">\n              ğŸ’¡ {getAnalysisContext()}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Desktop Store Tabs */}\n      <div className=\"hidden md:block mb-6\">\n        <div className=\"flex flex-wrap gap-2 mb-4\">\n          {accessibleStores.map(option => (\n            <Button\n              key={option.id}\n              onClick={() => handleStoreChange(option.id)}\n              className={`px-3 py-2 text-sm rounded-lg transition-colors ${\n                currentStoreId === option.id \n                  ? 'bg-primary text-primary-foreground' \n                  : 'bg-muted text-muted-foreground hover:bg-accent'\n              }`}\n            >\n              {option.name}\n            </Button>\n          ))}\n        </div>\n        <div className=\"text-xs text-muted-foreground p-2 bg-muted rounded\">\n          ğŸ”’ **{user?.role === 'admin' ? 'çµ±æ‹¬æ¨©é™' : user?.role === 'manager' ? 'åº—é•·æ¨©é™' : 'ã‚¹ã‚¿ãƒƒãƒ•æ¨©é™'}**: {getAnalysisContext()}\n        </div>\n      </div>\n\n      {/* API Status Indicator */}\n\n      {/* Chat Interface */}\n      <Card className=\"h-[75vh] md:h-[600px] flex flex-col\">\n        <CardHeader className=\"pb-2 px-3 sm:px-6 py-3 sm:py-4 border-b border-border\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2 text-sm sm:text-base truncate flex-1\">\n              <Bot className=\"w-5 h-5 text-blue-600\" />\n              <span className=\"hidden sm:inline\">AIã‚¢ãƒŠãƒªã‚¹ãƒˆä¼šè©±</span>\n              <span className=\"sm:hidden\">AIä¼šè©±</span>\n              <Badge variant=\"outline\" className=\"text-xs hidden sm:inline-flex\">\n                {getStoreDisplayName(currentStoreId)}\n              </Badge>\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {user?.role === 'admin' ? 'çµ±æ‹¬' : user?.role === 'manager' ? 'åº—é•·' : 'ã‚¹ã‚¿ãƒƒãƒ•'}æ¨©é™\n              </Badge>\n            </CardTitle>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setShowSidebar(!showSidebar)}\n                className=\"text-muted-foreground px-2 sm:px-3\"\n              >\n                <MessageSquare className=\"w-4 h-4 md:mr-2\" />\n                <span className=\"hidden md:inline\">å±¥æ­´</span>\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={clearChat}\n                className=\"text-muted-foreground px-2 sm:px-3\"\n              >\n                <Plus className=\"w-4 h-4 md:mr-2\" />\n                <span className=\"hidden md:inline\">æ–°è¦</span>\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        \n        <CardContent className=\"flex-1 overflow-y-auto p-2 sm:p-4 space-y-4 sm:space-y-6\">\n          {displayMessages.map((message) => (\n            <div key={message.id} className=\"space-y-4\">\n              <div className={`flex gap-2 sm:gap-4 ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}>\n                {message.type === 'ai' && (\n                  <div className=\"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center flex-shrink-0\">\n                    <Bot className=\"w-3 h-3 sm:w-4 sm:h-4 text-white\" />\n                  </div>\n                )}\n                <div className={`max-w-[85%] sm:max-w-[80%] ${message.type === 'user' ? 'order-1' : ''}`}>\n                  <div className={`px-3 sm:px-4 py-2 sm:py-3 rounded-xl sm:rounded-2xl text-xs sm:text-sm leading-relaxed ${\n                    message.type === 'user'\n                      ? 'bg-primary text-primary-foreground rounded-br-md'\n                      : 'bg-muted text-foreground rounded-bl-md'\n                  }`}>\n                    <div className=\"whitespace-pre-line break-words\">{message.content}</div>\n                    <p className={`text-xs mt-2 ${\n                      message.type === 'user' ? 'text-primary-foreground/70' : 'text-muted-foreground'\n                    }`}>\n                      {message.timestamp.toLocaleTimeString('ja-JP', { \n                        hour: '2-digit', \n                        minute: '2-digit' \n                      })}\n                    </p>\n                  </div>\n                  \n                  {/* Suggestion buttons */}\n                  {message.type === 'ai' && message.suggestions && (\n                    <div className=\"mt-2 sm:mt-3 space-y-2\">\n                      <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                        <Lightbulb className=\"w-3 h-3\" />\n                        <span className=\"hidden sm:inline\">ãŠã™ã™ã‚ã®åˆ†æ:</span>\n                        <span className=\"sm:hidden\">ãŠã™ã™ã‚:</span>\n                      </p>\n                      <div className=\"flex flex-wrap gap-2\">\n                        {message.suggestions.map((suggestion, index) => (\n                          <Button\n                            key={index}\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleSuggestionClick(suggestion)}\n                            className=\"text-xs h-auto py-1.5 px-2 sm:px-3 hover:bg-accent transition-colors break-words text-left\"\n                          >\n                            {suggestion.length > 15 ? `${suggestion.substring(0, 15)}...` : suggestion}\n                          </Button>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n                {message.type === 'user' && (\n                  <div className=\"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-muted flex items-center justify-center flex-shrink-0\">\n                    <User className=\"w-3 h-3 sm:w-4 sm:h-4 text-muted-foreground\" />\n                  </div>\n                )}\n              </div>\n            </div>\n          ))}\n          \n          {isLoading && (\n            <div className=\"flex gap-2 sm:gap-4 justify-start\">\n              <div className=\"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center flex-shrink-0\">\n                <Bot className=\"w-3 h-3 sm:w-4 sm:h-4 text-white\" />\n              </div>\n              <div className=\"bg-muted px-3 sm:px-4 py-2 sm:py-3 rounded-xl sm:rounded-2xl rounded-bl-md max-w-[85%] sm:max-w-[80%]\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"flex gap-1\">\n                    <div className=\"w-2 h-2 bg-primary rounded-full animate-bounce\"></div>\n                    <div className=\"w-2 h-2 bg-primary rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                    <div className=\"w-2 h-2 bg-primary rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                  </div>\n                  <span className=\"text-xs sm:text-sm text-muted-foreground\">\n                    <span className=\"hidden sm:inline\">é«˜åº¦åˆ†æå‡¦ç†ä¸­...</span>\n                    <span className=\"sm:hidden\">åˆ†æä¸­...</span>\n                  </span>\n                  <Sparkles className=\"w-4 h-4 text-purple-500 animate-pulse\" />\n                </div>\n              </div>\n            </div>\n          )}\n          <div ref={messagesEndRef} />\n        </CardContent>\n        \n        {/* Input Area */}\n        <div className=\"p-3 sm:p-4 border-t border-border\">\n          <div className=\"flex gap-2 sm:gap-3\">\n            <div className=\"flex-1 relative\">\n              <input\n                type=\"text\"\n                value={inputMessage}\n                onChange={(e) => setInputMessage(e.target.value)}\n                onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && handleSendMessage()}\n                placeholder=\"ä¾‹: ä»Šæœˆã®å£²ä¸Šã¯ï¼Ÿ\"\n                className=\"w-full px-3 sm:px-4 py-3 text-sm border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring bg-background min-h-[44px]\"\n                disabled={isLoading}\n              />\n            </div>\n            <Button\n              onClick={handleSendMessage}\n              disabled={isLoading || !inputMessage.trim() || usageStatus?.isLimited}\n              className=\"px-3 sm:px-6 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 min-h-[44px] min-w-[44px]\"\n              title={usageStatus?.isLimited ? 'æœ¬æ—¥ã®åˆ©ç”¨ä¸Šé™ã«é”ã—ã¾ã—ãŸ' : ''}\n            >\n              {isLoading ? (\n                <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n              ) : (\n                <Send className=\"w-4 h-4\" />\n              )}\n            </Button>\n          </div>\n          <p className=\"text-xs text-muted-foreground mt-2 flex items-center justify-between\">\n            <Sparkles className=\"w-3 h-3\" />\n            <span>\n              <span className=\"hidden sm:inline\">Enteré€ä¿¡ | </span>\n              {user?.role === 'admin' ? 'çµ±æ‹¬å°‚ç”¨' : user?.role === 'manager' ? 'åº—é•·å°‚ç”¨' : 'ã‚¹ã‚¿ãƒƒãƒ•å°‚ç”¨'}AI\n            </span>\n          </p>\n        </div>\n      </Card>\n      \n      {/* Side Panel */}\n      <div className=\"mt-4 md:mt-6\">\n        <div className=\"md:hidden\">\n          <Card>\n            <CardHeader className=\"pb-2 px-4 py-3\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <Bot className=\"w-4 h-4 text-blue-600\" />\n                åˆ†æçŠ¶æ³ ({user?.role === 'admin' ? 'çµ±æ‹¬' : user?.role === 'manager' ? 'åº—é•·' : 'ã‚¹ã‚¿ãƒƒãƒ•'}æ¨©é™)\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"px-4 pb-3\">\n              <div className=\"space-y-3\">\n                <AIUsageIndicator status={usageStatus} loading={usageLoading} />\n                <div className=\"grid grid-cols-2 gap-3 text-xs pt-3 border-t\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãƒ‡ãƒ¼ã‚¿</span>\n                    <span className=\"font-medium text-blue-600\">{reports.length}ä»¶</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">å¯¾è±¡åº—èˆ—æ•°</span>\n                    <span className=\"font-medium text-green-600\">{accessibleStores.length}åº—èˆ—</span>\n                  </div>\n                </div>\n                <div className=\"text-xs text-muted-foreground\">\n                  ğŸ”’ æ¨©é™ç¯„å›²: {user?.role === 'admin' ? 'å…¨åº—èˆ—ç®¡ç†' : user?.role === 'manager' ? 'æ‹…å½“åº—èˆ—ç®¡ç†' : 'å‹¤å‹™åº—èˆ—ã®ã¿'}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n        \n        <div className=\"hidden lg:block\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <Bot className=\"w-5 h-5 text-blue-600\" />\n                åˆ†ææ¨©é™ãƒ»çŠ¶æ³\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-sm\">\n              <div className=\"p-3 bg-blue-50 rounded-lg border border-blue-200\">\n                <div className=\"text-xs text-blue-800 font-medium mb-1\">\n                  {user?.name}ã•ã‚“ ({user?.role === 'admin' ? 'çµ±æ‹¬è²¬ä»»è€…' : user?.role === 'manager' ? 'åº—é•·' : 'ã‚¹ã‚¿ãƒƒãƒ•'})\n                </div>\n                <div className=\"text-xs text-blue-700\">\n                  {getAnalysisContext()}\n                </div>\n              </div>\n\n              <div className=\"pt-2 border-t\">\n                <AIUsageIndicator status={usageStatus} loading={usageLoading} />\n              </div>\n\n              <div className=\"flex justify-between pt-2 border-t\">\n                <span className=\"text-muted-foreground\">ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãƒ‡ãƒ¼ã‚¿</span>\n                <span className=\"font-medium text-blue-600\">{reports.length}ä»¶</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">å¯¾è±¡åº—èˆ—æ•°</span>\n                <span className=\"font-medium text-green-600\">{accessibleStores.length}åº—èˆ—</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">æœ€çµ‚åˆ†æ</span>\n                <span className=\"font-medium text-muted-foreground\">\n                  {new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })}\n                </span>\n              </div>\n              {user?.assignedStores && user.assignedStores.length > 0 && (\n                <div className=\"pt-2 border-t border-border\">\n                  <div className=\"text-xs text-muted-foreground mb-1\">æ‹…å½“åº—èˆ—:</div>\n                  {user.assignedStores.slice(0, 3).map(store => (\n                    <div key={store.id} className=\"text-xs\">\n                      ğŸª {store.name.replace('å±…é…’å±‹ã„ã£ã', '').replace('ãƒãƒ¼ãƒ«ã‚¢ãƒ•ãƒ­ãƒãƒ¼ã‚¸ãƒ¥ã‚¹ãƒ¼ãƒ´ã‚©ãƒ¯ãƒ«', 'ã‚¢ãƒ•ãƒ­')}\n                    </div>\n                  ))}\n                  {user.assignedStores.length > 3 && (\n                    <div className=\"text-xs text-muted-foreground\">\n                      ä»–{user.assignedStores.length - 3}åº—èˆ—...\n                    </div>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n        </div>\n      </div>\n      </div>\n    </div>\n  )\n}",
  "src/pages/AIReportsPage.tsx": "import { useState, useEffect } from 'react';\nimport { FileText, Plus, Filter } from 'lucide-react';\nimport { useSearchParams } from 'react-router-dom';\nimport { AIReportsList } from '../components/Reports/AIReportsList';\nimport { AIReportDetail } from '../components/Reports/AIReportDetail';\nimport { GenerateReportDialog } from '../components/Reports/GenerateReportDialog';\nimport { Button } from '../components/ui/button';\nimport { useAIReports } from '../hooks/useAIReports';\n\nexport function AIReportsPage() {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const reportIdFromUrl = searchParams.get('report');\n  const [selectedReportId, setSelectedReportId] = useState<string | null>(reportIdFromUrl);\n  const [showGenerateDialog, setShowGenerateDialog] = useState(false);\n  const [filterType, setFilterType] = useState<'all' | 'weekly' | 'monthly'>('all');\n  const { reports, refetch, deleteReport } = useAIReports();\n\n  useEffect(() => {\n    if (reportIdFromUrl) {\n      setSelectedReportId(reportIdFromUrl);\n    }\n  }, [reportIdFromUrl]);\n\n  const selectedReport = selectedReportId\n    ? reports.find((r) => r.id === selectedReportId)\n    : null;\n\n  const filteredReports = filterType === 'all'\n    ? reports\n    : reports.filter((r) => r.report_type === filterType);\n\n  return (\n    <div className=\"p-6 max-w-7xl mx-auto\">\n      {selectedReport ? (\n        <AIReportDetail\n          report={selectedReport}\n          onBack={() => setSelectedReportId(null)}\n          onDelete={deleteReport}\n        />\n      ) : (\n        <>\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div>\n                <h1 className=\"text-3xl font-bold text-gray-900 flex items-center\">\n                  <FileText className=\"w-8 h-8 mr-3\" />\n                  AIåˆ†æãƒ¬ãƒãƒ¼ãƒˆ\n                </h1>\n                <p className=\"text-gray-600 mt-2\">\n                  AIãŒè‡ªå‹•ç”Ÿæˆã—ãŸè©³ç´°ãªæ¥­ç¸¾åˆ†æãƒ¬ãƒãƒ¼ãƒˆ\n                </p>\n              </div>\n\n              <Button onClick={() => setShowGenerateDialog(true)}>\n                <Plus className=\"w-4 h-4 mr-2\" />\n                ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ\n              </Button>\n            </div>\n\n            <div className=\"flex items-center gap-3\">\n              <Filter className=\"w-5 h-5 text-gray-400\" />\n              <div className=\"flex gap-2\">\n                <Button\n                  variant={filterType === 'all' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => setFilterType('all')}\n                >\n                  ã™ã¹ã¦\n                </Button>\n                <Button\n                  variant={filterType === 'weekly' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => setFilterType('weekly')}\n                >\n                  æœŸé–“æŒ‡å®š\n                </Button>\n                <Button\n                  variant={filterType === 'monthly' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => setFilterType('monthly')}\n                >\n                  æœˆæ¬¡\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          <AIReportsList\n            onReportSelect={setSelectedReportId}\n          />\n        </>\n      )}\n\n      {showGenerateDialog && (\n        <GenerateReportDialog\n          onClose={() => setShowGenerateDialog(false)}\n          onSuccess={async (reportId) => {\n            setShowGenerateDialog(false);\n            await refetch();\n            setSelectedReportId(reportId);\n            setSearchParams({ report: reportId });\n          }}\n        />\n      )}\n    </div>\n  );\n}\n",
  "src/pages/AdminSettings.tsx": "import React, { useMemo, useState } from 'react'\nimport { Card, CardHeader, CardContent, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs'\nimport { Badge } from '@/components/ui/badge'\nimport { useAdminData } from '@/contexts/AdminDataContext'\nimport { formatCurrency } from '@/lib/format'\nimport { PermissionGuard } from '@/components/Auth/PermissionGuard'\nimport { type VendorDb } from '@/services/supabase'\nimport { insertSampleData } from '@/services/sampleData'\nimport { Database, DollarSign, Brain, Shield } from 'lucide-react'\nimport { ExpenseBaselineSettings } from '@/components/Dashboard/ExpenseBaselineSettings'\nimport { AIUsageLimitManagement } from '@/components/Admin/AIUsageLimitManagement'\nimport { AuditLogViewer } from '@/components/Admin/AuditLogViewer'\n\ntype VendorForm = {\n  name: string\n  category: VendorDb['category']\n  contact_info: string\n  is_active: boolean\n}\n\nexport const AdminSettings: React.FC = () => {\n  const { \n    stores, targets, vendors, storeVendorAssignments,\n    addStore, updateStore, deleteStore, upsertTarget, deleteTarget,\n    addVendor, updateVendor, deleteVendor, getStoreVendors,\n    assignVendorToStore, unassignVendorFromStore\n  } = useAdminData()\n\n  const [storeForm, setStoreForm] = useState({\n    id: '', name: '', address: '', manager: '', isActive: true, editing: false\n  })\n  \n  const [vendorForm, setVendorForm] = useState<VendorForm & { id: string; editing: boolean }>({\n    id: '',\n    name: '',\n    category: 'others',\n    contact_info: '',\n    is_active: true,\n    editing: false\n  })\n  \n  const [error, setError] = useState<string>('')\n  const [sampleDataLoading, setSampleDataLoading] = useState(false)\n  const [sampleDataMessage, setSampleDataMessage] = useState<string>('')\n\n  const [assignmentForm, setAssignmentForm] = useState({\n    selectedStoreId: '',\n    unassignedVendors: [] as string[]\n  })\n\n  const [showExpenseBaselineModal, setShowExpenseBaselineModal] = useState(false)\n\n  const handleInsertSampleData = async () => {\n    if (!confirm('ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã¾ã™ã€‚æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {\n      return\n    }\n\n    setSampleDataLoading(true)\n    setSampleDataMessage('')\n\n    const result = await insertSampleData()\n\n    setSampleDataLoading(false)\n    setSampleDataMessage(result.message)\n\n    if (result.success) {\n      alert(`${result.message}\\n\\nãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`)\n      window.location.reload()\n    } else {\n      alert(result.message)\n    }\n  }\n\n  const resetStoreForm = () => setStoreForm({ id:'', name:'', address:'', manager:'', isActive:true, editing:false })\n  const resetVendorForm = () => setVendorForm({ \n    id: '', \n    name: '', \n    category: 'others', \n    contact_info: '', \n    is_active: true, \n    editing: false \n  })\n\n  // å®‰å…¨ãª onChange ãƒãƒ³ãƒ‰ãƒ©\n  const handleVendorFormChange = <K extends keyof VendorForm>(key: K) => \n    (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\n      const value = e?.target?.value ?? ''\n      setVendorForm(prev => ({ ...prev, [key]: value }))\n    }\n  \n  const onSubmitStore = () => {\n    if (!(storeForm.name ?? '').trim()) return\n    if (storeForm.editing && storeForm.id) {\n      updateStore(storeForm.id, { name: storeForm.name, address: storeForm.address, manager: storeForm.manager, isActive: storeForm.isActive })\n    } else {\n      addStore({ id: storeForm.id || undefined, name: storeForm.name, address: storeForm.address, manager: storeForm.manager, isActive: storeForm.isActive })\n    }\n    resetStoreForm()\n  }\n\n  const onSubmitVendor = async () => {\n    setError('')\n    const name = (vendorForm.name ?? '').trim()\n    \n    if (!name) {\n      setError('æ¥­è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')\n      return\n    }\n    \n    console.log('ğŸ“ onSubmitVendor: é–‹å§‹', { editing: vendorForm.editing, id: vendorForm.id, name })\n    \n    if (vendorForm.editing && vendorForm.id) {\n      // ç·¨é›†æ™‚ã¯å·®åˆ†ã®ã¿é€ä¿¡\n      const updates: Partial<VendorDb> = {}\n      if (name !== vendors.find(v => v.id === vendorForm.id)?.name) {\n        updates.name = name\n      }\n      if (vendorForm.category !== vendors.find(v => v.id === vendorForm.id)?.category) {\n        updates.category = vendorForm.category\n      }\n      const trimmedContact = vendorForm.contact_info.trim()\n      if (trimmedContact !== (vendors.find(v => v.id === vendorForm.id)?.contact_info ?? '')) {\n        updates.contact_info = trimmedContact\n      }\n      if (vendorForm.is_active !== vendors.find(v => v.id === vendorForm.id)?.is_active) {\n        updates.is_active = vendorForm.is_active\n      }\n      \n      try {\n        await updateVendor(vendorForm.id, updates)\n        console.log('âœ… onSubmitVendor: æ›´æ–°å®Œäº†')\n      } catch (err) {\n        console.error('âŒ onSubmitVendor: æ›´æ–°ã‚¨ãƒ©ãƒ¼:', err)\n        setError('æ¥­è€…ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n    } else {\n      try {\n        await addVendor({\n          name,\n          category: vendorForm.category,\n          contactInfo: vendorForm.contact_info.trim(),\n          isActive: vendorForm.is_active\n        })\n        console.log('âœ… onSubmitVendor: æ–°è¦ä½œæˆå®Œäº†')\n      } catch (err) {\n        console.error('âŒ onSubmitVendor: ä½œæˆã‚¨ãƒ©ãƒ¼:', err)\n        setError('æ¥­è€…ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n    }\n    resetVendorForm()\n  }\n\n  const [targetForm, setTargetForm] = useState({\n    storeId: '',\n    period: new Date().toISOString().substring(0,7),\n    targetSales: 0,\n    targetProfitMargin: 20,\n    targetCostRate: 30,\n    targetLaborRate: 25\n  })\n  const [targetStatus, setTargetStatus] = useState<{ success: boolean; message: string } | null>(null)\n  const selectedStoreName = useMemo(() => stores.find(s => s.id === targetForm.storeId)?.name ?? '', [stores, targetForm.storeId])\n  const onSubmitTarget = async () => {\n    if (!targetForm.storeId || !targetForm.period) {\n      setTargetStatus({ success: false, message: 'åº—èˆ—ã¨å¯¾è±¡æœˆã‚’é¸æŠã—ã¦ãã ã•ã„' })\n      setTimeout(() => setTargetStatus(null), 3000)\n      return\n    }\n\n    if (targetForm.targetSales === 0) {\n      setTargetStatus({ success: false, message: 'ç›®æ¨™å£²ä¸Šã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' })\n      setTimeout(() => setTargetStatus(null), 3000)\n      return\n    }\n\n    try {\n      const targetProfit = Math.round(targetForm.targetSales * (targetForm.targetProfitMargin / 100))\n      console.log('ğŸ“Š ç›®æ¨™ä¿å­˜:', {\n        storeId: targetForm.storeId,\n        period: targetForm.period,\n        targetSales: targetForm.targetSales,\n        targetProfit,\n        targetProfitMargin: targetForm.targetProfitMargin\n      })\n\n      await upsertTarget({\n        storeId: targetForm.storeId,\n        period: targetForm.period,\n        targetSales: targetForm.targetSales,\n        targetProfit,\n        targetProfitMargin: targetForm.targetProfitMargin,\n        targetCostRate: targetForm.targetCostRate,\n        targetLaborRate: targetForm.targetLaborRate\n      })\n\n      setTargetStatus({ success: true, message: `${selectedStoreName}ã®${targetForm.period}ç›®æ¨™ã‚’ä¿å­˜ã—ã¾ã—ãŸ` })\n      setTargetForm({ storeId: '', period: new Date().toISOString().substring(0,7), targetSales: 0, targetProfitMargin: 20, targetCostRate: 30, targetLaborRate: 25 })\n      setTimeout(() => setTargetStatus(null), 3000)\n    } catch (err) {\n      console.error('âŒ ç›®æ¨™ä¿å­˜ã‚¨ãƒ©ãƒ¼:', err)\n      const errorMessage = err instanceof Error ? err.message : 'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ'\n      setTargetStatus({ success: false, message: `ä¿å­˜ã«å¤±æ•—: ${errorMessage}` })\n      setTimeout(() => setTargetStatus(null), 5000)\n    }\n  }\n\n  const categoryLabels = {\n    vegetable_meat: 'é‡èœãƒ»è‚‰é¡',\n    seafood: 'é­šä»‹é¡',\n    alcohol: 'é…’é¡',\n    rice: 'ç±³ç©€',\n    seasoning: 'èª¿å‘³æ–™',\n    frozen: 'å†·å‡é£Ÿå“',\n    dessert: 'è£½è“ãƒ»ãƒ‡ã‚¶ãƒ¼ãƒˆ',\n    others: 'ãã®ä»–'\n  }\n\n  return (\n    <PermissionGuard requiredRole=\"manager\">\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground\">è¨­å®šï¼ˆç®¡ç†ï¼‰</h1>\n        <p className=\"text-sm text-muted-foreground\">åº—èˆ—æƒ…å ±ã€æ¥­è€…ç®¡ç†ã€æœˆæ¬¡ç›®æ¨™ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</p>\n      </div>\n\n      <Tabs defaultValue=\"stores\">\n        <TabsList>\n          <TabsTrigger value=\"stores\">åº—èˆ—</TabsTrigger>\n          <TabsTrigger value=\"vendors\">æ¥­è€…</TabsTrigger>\n          <TabsTrigger value=\"targets\">æœˆæ¬¡ç›®æ¨™</TabsTrigger>\n          <TabsTrigger value=\"audit-logs\">\n            <Shield className=\"w-4 h-4 mr-2\" />\n            ç›£æŸ»ãƒ­ã‚°\n          </TabsTrigger>\n          <TabsTrigger value=\"expense-baseline\">å‚è€ƒçµŒè²»</TabsTrigger>\n          <TabsTrigger value=\"ai-limits\">AIä½¿ç”¨åˆ¶é™</TabsTrigger>\n        </TabsList>\n\n        {/* ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ */}\n        {stores.length === 0 && (\n          <Card className=\"mt-4 bg-blue-50 border-blue-200\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-start gap-4\">\n                <Database className=\"h-8 w-8 text-blue-600 flex-shrink-0 mt-1\" />\n                <div className=\"flex-1\">\n                  <h3 className=\"font-semibold text-blue-900 mb-2\">åˆã‚ã¦ã”åˆ©ç”¨ã®æ–¹ã¸</h3>\n                  <p className=\"text-sm text-blue-800 mb-4\">\n                    åº—èˆ—ãƒ»æ¥­è€…ãƒ»ç›®æ¨™å€¤ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ã§æŠ•å…¥ã§ãã¾ã™ã€‚\n                    ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œç¢ºèªã‚„ãƒ†ã‚¹ãƒˆã«ã”åˆ©ç”¨ãã ã•ã„ã€‚\n                  </p>\n                  <Button\n                    onClick={handleInsertSampleData}\n                    disabled={sampleDataLoading}\n                    className=\"bg-blue-600 hover:bg-blue-700\"\n                  >\n                    <Database className=\"h-4 w-4 mr-2\" />\n                    {sampleDataLoading ? 'ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¸­...' : 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥'}\n                  </Button>\n                  {sampleDataMessage && (\n                    <p className=\"text-sm text-blue-700 mt-3\">{sampleDataMessage}</p>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        <TabsContent value=\"stores\" className=\"mt-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader><CardTitle>åº—èˆ—ã®ç™»éŒ²/ç·¨é›†</CardTitle></CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">åº—èˆ—å</label>\n                  <input className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={storeForm.name} onChange={(e)=>setStoreForm(s=>({...s,name:e.target.value}))}/>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">ä½æ‰€</label>\n                  <input className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={storeForm.address} onChange={(e)=>setStoreForm(s=>({...s,address:e.target.value}))}/>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">åº—é•·/è²¬ä»»è€…</label>\n                  <input className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={storeForm.manager} onChange={(e)=>setStoreForm(s=>({...s,manager:e.target.value}))}/>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <input id=\"active\" type=\"checkbox\" checked={storeForm.isActive}\n                    onChange={(e)=>setStoreForm(s=>({...s,isActive:e.target.checked}))}/>\n                  <label htmlFor=\"active\" className=\"text-sm\">ç¨¼åƒä¸­</label>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button onClick={onSubmitStore}>{storeForm.editing ? 'æ›´æ–°' : 'ç™»éŒ²'}</Button>\n                  <Button variant=\"outline\" onClick={resetStoreForm}>ã‚¯ãƒªã‚¢</Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader><CardTitle>ç™»éŒ²æ¸ˆã¿åº—èˆ—</CardTitle></CardHeader>\n              <CardContent className=\"space-y-3\">\n                {stores.map(s=>(\n                  <div key={s.id} className=\"flex items-center justify-between border border-border rounded-md px-3 py-2\">\n                    <div className=\"text-sm\">\n                      <div className=\"font-medium\">{s.name}</div>\n                      <div className=\"text-muted-foreground\">{s.address} / {s.manager}</div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant={s.isActive ? 'default' : 'secondary'}>{s.isActive ? 'ç¨¼åƒ' : 'åœæ­¢'}</Badge>\n                      <Button variant=\"outline\" size=\"sm\"\n                        onClick={()=>setStoreForm({ id:s.id, name:s.name, address:s.address, manager:s.manager, isActive:s.isActive, editing:true })}>\n                        ç·¨é›†\n                      </Button>\n                      <Button variant=\"destructive\" size=\"sm\" onClick={()=>deleteStore(s.id)}>å‰Šé™¤</Button>\n                    </div>\n                  </div>\n                ))}\n                {stores.length===0 && <div className=\"text-sm text-muted-foreground\">åº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"vendors\" className=\"mt-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader><CardTitle>æ¥­è€…ã®ç™»éŒ²/ç·¨é›†</CardTitle></CardHeader>\n              <CardContent className=\"space-y-4\">\n                {error && (\n                  <div className=\"p-3 bg-red-50 border border-red-200 rounded text-sm text-red-700\">\n                    {error}\n                  </div>\n                )}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">æ¥­è€…å</label>\n                  <input className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={vendorForm.name} \n                    onChange={handleVendorFormChange('name')}\n                    placeholder=\"ä¾‹ï¼šç¯‰åœ°é’æœå¸\"/>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">ã‚«ãƒ†ã‚´ãƒª</label>\n                  <select className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={vendorForm.category} \n                    onChange={handleVendorFormChange('category')}>\n                    {Object.entries(categoryLabels).map(([value, label]) => (\n                      <option key={value} value={value}>{label}</option>\n                    ))}\n                  </select>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">é€£çµ¡å…ˆï¼ˆä»»æ„ï¼‰</label>\n                  <input className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={vendorForm.contact_info} \n                    onChange={handleVendorFormChange('contact_info')}\n                    placeholder=\"ä¾‹ï¼š03-1234-5678\"/>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <input id=\"vendorActive\" type=\"checkbox\" checked={vendorForm.is_active}\n                    onChange={(e)=>setVendorForm(v=>({...v, is_active: e.target.checked}))}/>\n                  <label htmlFor=\"vendorActive\" className=\"text-sm\">ä½¿ç”¨ä¸­</label>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button \n                    onClick={onSubmitVendor}\n                    disabled={!(vendorForm.name ?? '').trim()}\n                  >\n                    {vendorForm.editing ? 'æ›´æ–°' : 'ç™»éŒ²'}\n                  </Button>\n                  <Button variant=\"outline\" onClick={resetVendorForm}>ã‚¯ãƒªã‚¢</Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader><CardTitle>ç™»éŒ²æ¸ˆã¿æ¥­è€…</CardTitle></CardHeader>\n              <CardContent className=\"space-y-4 max-h-96 overflow-y-auto\">\n                {/* æœ‰åŠ¹ãªæ¥­è€… */}\n                <div>\n                  <h4 className=\"text-sm font-medium text-green-700 mb-2 flex items-center gap-1\">\n                    âœ… ä½¿ç”¨ä¸­ã®æ¥­è€… ({vendors.filter(v => v.isActive).length}ä»¶)\n                  </h4>\n                  <div className=\"space-y-2\">\n                    {vendors.filter(v => v.isActive).map(v => (\n                      <div key={v.id} className=\"flex items-center justify-between border border-border rounded-md px-3 py-2 bg-green-50\">\n                        <div className=\"text-sm\">\n                          <div className=\"font-medium\">\n                            ğŸ“¦ {(v.name ?? '').trim() !== '' ? v.name : 'ï¼ˆåç§°æœªè¨­å®šï¼‰'}\n                          </div>\n                          <div className=\"text-muted-foreground\">{categoryLabels[v.category]}</div>\n                          {(v.contact_info ?? '').trim() && (\n                            <div className=\"text-xs text-muted-foreground\">ğŸ“ {v.contact_info}</div>\n                          )}\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Badge variant=\"default\">ä½¿ç”¨ä¸­</Badge>\n                          <Button variant=\"outline\" size=\"sm\"\n                            onClick={() => setVendorForm({ \n                              id: v.id, \n                              name: (v.name ?? '').toString(), \n                              category: v.category ?? 'others', \n                              contact_info: (v.contact_info ?? '').toString(), \n                              is_active: v.is_active ?? true, \n                              editing: true \n                            })}>\n                            ç·¨é›†\n                          </Button>\n                          <Button variant=\"destructive\" size=\"sm\" \n                            onClick={() => {\n                              if (confirm(`æ¥­è€…ã€Œ${(v.name ?? '').trim() || 'ï¼ˆåç§°æœªè¨­å®šï¼‰'}ã€ã‚’åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ`)) {\n                                deleteVendor(v.id)\n                              }\n                            }}>\n                            åœæ­¢\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                    {vendors.filter(v => v.isActive).length === 0 && (\n                      <div className=\"text-center py-4 text-muted-foreground\">\n                        ä½¿ç”¨ä¸­ã®æ¥­è€…ãŒã‚ã‚Šã¾ã›ã‚“\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* åœæ­¢ä¸­ã®æ¥­è€… */}\n                {vendors.filter(v => !v.isActive).length > 0 && (\n                  <div>\n                    <h4 className=\"text-sm font-medium text-red-700 mb-2 flex items-center gap-1\">\n                      â›” åœæ­¢ä¸­ã®æ¥­è€… ({vendors.filter(v => !v.isActive).length}ä»¶)\n                    </h4>\n                    <div className=\"space-y-2\">\n                      {vendors.filter(v => !v.isActive).map(v => (\n                        <div key={v.id} className=\"flex items-center justify-between border border-border rounded-md px-3 py-2 bg-red-50\">\n                          <div className=\"text-sm\">\n                            <div className=\"font-medium text-red-700\">\n                              ğŸ“¦ {(v.name ?? '').trim() !== '' ? v.name : 'ï¼ˆåç§°æœªè¨­å®šï¼‰'}\n                            </div>\n                            <div className=\"text-red-600\">\n                              {categoryLabels[v.category]}\n                              {(v.contact_info ?? '').trim() && ` / ${v.contact_info}`}\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <Badge variant=\"destructive\">åœæ­¢ä¸­</Badge>\n                            <Button variant=\"default\" size=\"sm\"\n                              onClick={() => {\n                                if (confirm(`æ¥­è€…ã€Œ${(v.name ?? '').trim() || 'ï¼ˆåç§°æœªè¨­å®šï¼‰'}ã€ã‚’å†é–‹ã—ã¾ã™ã‹ï¼Ÿ`)) {\n                                  updateVendor(v.id, { isActive: true })\n                                }\n                              }}>\n                              å†é–‹\n                            </Button>\n                            <Button variant=\"destructive\" size=\"sm\"\n                              onClick={() => {\n                                if (confirm(`æ¥­è€…ã€Œ${(v.name ?? '').trim() || 'ï¼ˆåç§°æœªè¨­å®šï¼‰'}ã€ã‚’å®Œå…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {\n                                 deleteVendor(v.id)\n                                }\n                              }}>\n                              å‰Šé™¤\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* å…¨æ¥­è€…ãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}\n                {vendors.length === 0 && (\n                  <div className=\"text-center py-6 text-muted-foreground\">\n                    <p className=\"text-sm\">æ¥­è€…ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>\n                    <p className=\"text-xs mt-1\">ğŸ‘† å·¦å´ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æ¥­è€…ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* åº—èˆ—åˆ¥æ¥­è€…å‰²ã‚Šå½“ã¦ */}\n          <Card className=\"mt-6\">\n            <CardHeader>\n              <CardTitle>åº—èˆ—åˆ¥æ¥­è€…å‰²ã‚Šå½“ã¦</CardTitle>\n              <div className=\"text-sm text-muted-foreground mt-2\">\n                ğŸ“‹ <strong>æ‰‹é †ï¼š</strong>\n                <ol className=\"list-decimal list-inside mt-1 space-y-1\">\n                  <li>ä¸‹ã‹ã‚‰åº—èˆ—ã‚’é¸æŠ</li>\n                  <li>å³å´ã®ã€Œæœªå‰²ã‚Šå½“ã¦æ¥­è€…ã€ã‹ã‚‰ã€Œè¿½åŠ ã€ã§å‰²ã‚Šå½“ã¦</li>\n                  <li>å·¦å´ã®ã€Œå‰²ã‚Šå½“ã¦æ¸ˆã¿ã€ã‹ã‚‰ã€Œå‰Šé™¤ã€ã§è§£é™¤</li>\n                </ol>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm\">åº—èˆ—é¸æŠ</label>\n                <select \n                  value={assignmentForm.selectedStoreId}\n                  onChange={(e)=>setAssignmentForm(f=>({...f, selectedStoreId:e.target.value}))}\n                  className=\"w-full border border-input rounded-md px-3 py-2 bg-background text-base min-h-[44px]\">\n                  <option value=\"\">é¸æŠã—ã¦ãã ã•ã„</option>\n                  {stores.map(s=>(\n                    <option key={s.id} value={s.id}>ğŸª {s.name}</option>\n                  ))}\n                </select>\n                {!assignmentForm.selectedStoreId && (\n                  <p className=\"text-xs text-blue-600\">ğŸ‘† ã¾ãšåº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</p>\n                )}\n              </div>\n\n              {assignmentForm.selectedStoreId && (\n                <>\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4\">\n                  <p className=\"text-sm text-blue-800\">\n                    ğŸ“ <strong>{stores.find(s => s.id === assignmentForm.selectedStoreId)?.name}</strong> ã®æ¥­è€…ç®¡ç†\n                  </p>\n                  <p className=\"text-xs text-blue-600 mt-1\">\n                    ç¾åœ¨ {getStoreVendors(assignmentForm.selectedStoreId).length}æ¥­è€… / å…¨{vendors.filter(v=>v.isActive).length}æ¥­è€…ä¸­\n                  </p>\n                </div>\n\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                  <div>\n                    <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n                      âœ… å‰²ã‚Šå½“ã¦æ¸ˆã¿æ¥­è€… ({getStoreVendors(assignmentForm.selectedStoreId).length}ä»¶)\n                    </h4>\n                    <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n                      {getStoreVendors(assignmentForm.selectedStoreId).length === 0 ? (\n                        <div className=\"text-center py-6 text-muted-foreground border border-dashed border-border rounded\">\n                          <p className=\"text-sm\">ã¾ã æ¥­è€…ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“</p>\n                          <p className=\"text-xs mt-1\">å³å´ã‹ã‚‰æ¥­è€…ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ â†’</p>\n                        </div>\n                      ) : getStoreVendors(assignmentForm.selectedStoreId).map(vendor => (\n                        <div key={vendor.id} className=\"flex items-center justify-between p-2 border border-border rounded text-sm\">\n                          <div>\n                            <div className=\"font-medium\">\n                              ğŸ“¦ {(vendor.name ?? '').trim() !== '' ? vendor.name : 'ï¼ˆåç§°æœªè¨­å®šï¼‰'}\n                            </div>\n                            <div className=\"text-muted-foreground\">{categoryLabels[vendor.category]}</div>\n                            {(vendor.contact_info ?? '').trim() && (\n                              <div className=\"text-xs text-muted-foreground\">ğŸ“ {vendor.contact_info}</div>\n                            )}\n                          </div>\n                          <Button size=\"sm\" variant=\"destructive\" \n                            onClick={()=>unassignVendorFromStore(assignmentForm.selectedStoreId, vendor.id)}>\n                            å‰Šé™¤\n                          </Button>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n                      â• æœªå‰²ã‚Šå½“ã¦æ¥­è€… ({vendors.filter(v => v.isActive && !getStoreVendors(assignmentForm.selectedStoreId).some(av => av.id === v.id)).length}ä»¶)\n                    </h4>\n                    <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n                      {vendors\n                        .filter(v => v.isActive && !getStoreVendors(assignmentForm.selectedStoreId).some(av => av.id === v.id))\n                        .length === 0 ? (\n                        <div className=\"text-center py-6 text-muted-foreground border border-dashed border-border rounded\">\n                          <p className=\"text-sm\">ã™ã¹ã¦ã®æ¥­è€…ãŒå‰²ã‚Šå½“ã¦æ¸ˆã¿ã§ã™</p>\n                          <p className=\"text-xs mt-1\">âœ… å®Œäº†</p>\n                        </div>\n                      ) : vendors\n                        .filter(v => v.isActive && !getStoreVendors(assignmentForm.selectedStoreId).some(av => av.id === v.id))\n                        .map(vendor => (\n                        <div key={vendor.id} className=\"flex items-center justify-between p-2 border border-border rounded text-sm\">\n                          <div>\n                            <div className=\"font-medium\">\n                              ğŸ“¦ {(vendor.name ?? '').trim() !== '' ? vendor.name : 'ï¼ˆåç§°æœªè¨­å®šï¼‰'}\n                            </div>\n                            <div className=\"text-muted-foreground\">{categoryLabels[vendor.category]}</div>\n                            {(vendor.contact_info ?? '').trim() && (\n                              <div className=\"text-xs text-muted-foreground\">ğŸ“ {vendor.contact_info}</div>\n                            )}\n                          </div>\n                          <Button size=\"sm\" variant=\"default\"\n                            onClick={()=>assignVendorToStore(assignmentForm.selectedStoreId, vendor.id)}>\n                            è¿½åŠ \n                          </Button>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n\n                {/* ä¸€æ‹¬å‰²ã‚Šå½“ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ */}\n                <div className=\"pt-4 border-t border-border\">\n                  <p className=\"text-sm font-medium mb-2\">ã‚¯ã‚¤ãƒƒã‚¯æ“ä½œ</p>\n                  <div className=\"flex gap-2 flex-wrap\">\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => {\n                        vendors.filter(v => v.isActive).forEach(vendor => {\n                          assignVendorToStore(assignmentForm.selectedStoreId, vendor.id)\n                        })\n                      }}\n                      disabled={!assignmentForm.selectedStoreId}\n                    >\n                      å…¨æ¥­è€…ã‚’å‰²ã‚Šå½“ã¦\n                    </Button>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => {\n                        getStoreVendors(assignmentForm.selectedStoreId).forEach(vendor => {\n                          unassignVendorFromStore(assignmentForm.selectedStoreId, vendor.id)\n                        })\n                      }}\n                      disabled={!assignmentForm.selectedStoreId || getStoreVendors(assignmentForm.selectedStoreId).length === 0}\n                    >\n                      å…¨æ¥­è€…ã®å‰²ã‚Šå½“ã¦è§£é™¤\n                    </Button>\n                  </div>\n                </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"targets\" className=\"mt-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader><CardTitle>æœˆæ¬¡ç›®æ¨™ã®è¨­å®š</CardTitle></CardHeader>\n              <CardContent className=\"space-y-4\">\n                {targetStatus && (\n                  <div className={`p-3 rounded-lg border ${\n                    targetStatus.success ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'\n                  }`}>\n                    {targetStatus.message}\n                  </div>\n                )}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">åº—èˆ—</label>\n                  <select className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={targetForm.storeId}\n                    onChange={(e)=>setTargetForm(f=>({...f, storeId:e.target.value}))}>\n                    <option value=\"\">é¸æŠã—ã¦ãã ã•ã„</option>\n                    {stores.map(s=>(\n                      <option key={s.id} value={s.id}>{s.name}</option>\n                    ))}\n                  </select>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">å¯¾è±¡æœˆ</label>\n                  <input type=\"month\" className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={targetForm.period}\n                    onChange={(e)=>setTargetForm(f=>({...f, period:e.target.value}))}/>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">æœˆæ¬¡ç›®æ¨™å£²ä¸Šï¼ˆå††ï¼‰</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    placeholder=\"8000000\"\n                    className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={targetForm.targetSales === 0 ? '' : targetForm.targetSales}\n                    onChange={(e)=>{\n                      const numValue = e.target.value.replace(/[^0-9]/g,'')\n                      setTargetForm(f=>({...f, targetSales: numValue === '' ? 0 : Number(numValue)}))\n                    }}\n                  />\n                  <div className=\"text-xs text-muted-foreground\">ä¾‹: 8,000,000å††ï¼ˆ800ä¸‡å††ï¼‰</div>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">ç›®æ¨™å–¶æ¥­åˆ©ç›Šç‡ï¼ˆ%ï¼‰</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    placeholder=\"20\"\n                    className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={targetForm.targetProfitMargin === 0 ? '' : targetForm.targetProfitMargin}\n                    onChange={(e)=>{\n                      const numValue = e.target.value.replace(/[^0-9.]/g,'')\n                      setTargetForm(f=>({...f, targetProfitMargin: numValue === '' ? 0 : Number(numValue)}))\n                    }}\n                  />\n                  <div className=\"text-xs text-muted-foreground\">ä¾‹: 20%ï¼ˆæ¥­ç•Œæ¨™æº–15-25%ï¼‰</div>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">ç›®æ¨™åŸä¾¡ç‡ï¼ˆ%ï¼‰</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    placeholder=\"30\"\n                    className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={targetForm.targetCostRate === 0 ? '' : targetForm.targetCostRate}\n                    onChange={(e)=>{\n                      const numValue = e.target.value.replace(/[^0-9.]/g,'')\n                      setTargetForm(f=>({...f, targetCostRate: numValue === '' ? 0 : Number(numValue)}))\n                    }}\n                  />\n                  <div className=\"text-xs text-muted-foreground\">ä¾‹: 30%ï¼ˆé£²é£Ÿåº—ã®æ¨™æº–åŸä¾¡ç‡ï¼‰</div>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm\">ç›®æ¨™äººä»¶è²»ç‡ï¼ˆ%ï¼‰</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    placeholder=\"25\"\n                    className=\"w-full border border-input rounded-md px-3 py-2 bg-background\"\n                    value={targetForm.targetLaborRate === 0 ? '' : targetForm.targetLaborRate}\n                    onChange={(e)=>{\n                      const numValue = e.target.value.replace(/[^0-9.]/g,'')\n                      setTargetForm(f=>({...f, targetLaborRate: numValue === '' ? 0 : Number(numValue)}))\n                    }}\n                  />\n                  <div className=\"text-xs text-muted-foreground\">ä¾‹: 25%ï¼ˆé£²é£Ÿåº—ã®æ¨™æº–äººä»¶è²»ç‡ï¼‰</div>\n                </div>\n                <div className=\"text-sm text-muted-foreground\">\n                  è‡ªå‹•è¨ˆç®— ç›®æ¨™å–¶æ¥­åˆ©ç›Šï¼š{formatCurrency(Math.round(targetForm.targetSales * (targetForm.targetProfitMargin/100)))}\n                  {targetForm.storeId && selectedStoreName && (\n                    <div className=\"mt-1 text-primary\">\n                      ğŸ“Š {selectedStoreName} / {targetForm.period}\n                    </div>\n                  )}\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button\n                    onClick={onSubmitTarget}\n                    disabled={!targetForm.storeId || !targetForm.period || targetForm.targetSales === 0}\n                  >\n                    ä¿å­˜/æ›´æ–°\n                  </Button>\n                  <Button variant=\"outline\" onClick={()=>setTargetForm({ storeId:'', period:new Date().toISOString().substring(0,7), targetSales:0, targetProfitMargin:20, targetCostRate:30, targetLaborRate:25 })}>\n                    ã‚¯ãƒªã‚¢\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader><CardTitle>è¨­å®šæ¸ˆã¿ç›®æ¨™</CardTitle></CardHeader>\n              <CardContent className=\"space-y-3\">\n                {targets.length === 0 && <div className=\"text-sm text-muted-foreground\">ç›®æ¨™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>}\n                {targets\n                  .sort((a,b)=> (a.storeId+a.period).localeCompare(b.storeId+b.period))\n                  .map(t=>(\n                  <div key={`${t.storeId}-${t.period}`} className=\"flex items-center justify-between border border-border rounded-md px-3 py-2 text-sm\">\n                    <div>\n                      <div className=\"font-medium\">\n                        {stores.find(s=>s.id===t.storeId)?.name ?? t.storeId} / {t.period}\n                      </div>\n                      <div className=\"text-muted-foreground\">\n                        å£²ä¸Š {formatCurrency(t.targetSales)}ãƒ»åˆ©ç›Š {formatCurrency(t.targetProfit)}ãƒ»åˆ©ç›Šç‡ {t.targetProfitMargin}%\n                        {(t.targetCostRate > 0 || t.targetLaborRate > 0) && (\n                          <span className=\"ml-2\">\n                            {t.targetCostRate > 0 && `ãƒ»åŸä¾¡ç‡ ${t.targetCostRate}%`}\n                            {t.targetLaborRate > 0 && `ãƒ»äººä»¶è²»ç‡ ${t.targetLaborRate}%`}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Button variant=\"outline\" size=\"sm\"\n                        onClick={()=>setTargetForm({ storeId: t.storeId, period: t.period, targetSales: t.targetSales, targetProfitMargin: t.targetProfitMargin, targetCostRate: t.targetCostRate || 30, targetLaborRate: t.targetLaborRate || 25 })}>\n                        ç·¨é›†\n                      </Button>\n                      <Button variant=\"destructive\" size=\"sm\" onClick={()=>deleteTarget(t.storeId, t.period)}>å‰Šé™¤</Button>\n                    </div>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"expense-baseline\" className=\"mt-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <DollarSign className=\"w-5 h-5\" />\n                å‚è€ƒçµŒè²»ï¼ˆæœˆæ¬¡å¹³å‡ï¼‰è¨­å®š\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                  <h3 className=\"font-semibold text-blue-900 mb-2\">å‚è€ƒçµŒè²»ã¨ã¯ï¼Ÿ</h3>\n                  <ul className=\"text-sm text-blue-800 space-y-1 list-disc list-inside\">\n                    <li>æ—¥å ±å…¥åŠ›æ™‚ã«ã€é£Ÿæè²»ä»¥å¤–ã®çµŒè²»ã‚’å‚è€ƒå€¤ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã§ã™</li>\n                    <li>å…‰ç†±è²»ãƒ»è²©ä¿ƒè²»ãƒ»é€šä¿¡è²»ãªã©ã€è«‹æ±‚æ›¸ãŒæœˆæœ«ã«æ¥ã‚‹çµŒè²»ã®æœˆæ¬¡å¹³å‡ã‚’è¨­å®šã—ã¾ã™</li>\n                    <li>æ—¥å ±ã§ã¯è‡ªå‹•çš„ã«æ—¥å‰²ã‚Šè¨ˆç®—ã•ã‚Œã€ã€Œå‚è€ƒKPIã€ã¨ã—ã¦å–¶æ¥­åˆ©ç›Šãƒ»åˆ©ç›Šç‡ã‚’è¡¨ç¤ºã—ã¾ã™</li>\n                    <li>ç¿Œæœˆã«ç¢ºå®šå€¤ã‚’æœˆæ¬¡çµŒè²»ã¨ã—ã¦å…¥åŠ›ã™ã‚Œã°ã€æ­£ç¢ºãªPLã«æ›´æ–°ã•ã‚Œã¾ã™</li>\n                  </ul>\n                </div>\n\n                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n                  <h4 className=\"font-medium text-amber-900 mb-2\">ğŸ’¡ ä½¿ã„æ–¹</h4>\n                  <ol className=\"text-sm text-amber-800 space-y-1 list-decimal list-inside\">\n                    <li>ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰åº—èˆ—ãƒ»æœˆã‚’é¸ã‚“ã§å‚è€ƒçµŒè²»ã‚’è¨­å®š</li>\n                    <li>æ—¥å ±å…¥åŠ›æ™‚ã«ã€Œå‚è€ƒKPIã€ã¨ã—ã¦å–¶æ¥­åˆ©ç›Šãƒ»åˆ©ç›Šç‡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>\n                    <li>ç¿Œæœˆã€ç¢ºå®šã—ãŸçµŒè²»ã‚’ã€Œæœˆæ¬¡çµŒè²»å…¥åŠ›ã€ã§ç™»éŒ²ã—ã¦PLã‚’ç¢ºå®š</li>\n                  </ol>\n                </div>\n\n                <Button\n                  onClick={() => setShowExpenseBaselineModal(true)}\n                  className=\"w-full sm:w-auto\"\n                >\n                  <DollarSign className=\"w-4 h-4 mr-2\" />\n                  å‚è€ƒçµŒè²»ã‚’è¨­å®š\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"ai-limits\" className=\"mt-4\">\n          <AIUsageLimitManagement />\n        </TabsContent>\n\n        <TabsContent value=\"audit-logs\" className=\"mt-4\">\n          <AuditLogViewer />\n        </TabsContent>\n      </Tabs>\n\n    </div>\n      {showExpenseBaselineModal && (\n        <ExpenseBaselineSettings\n          stores={stores}\n          onClose={() => setShowExpenseBaselineModal(false)}\n          onSaved={() => {\n            setShowExpenseBaselineModal(false)\n          }}\n        />\n      )}\n    </PermissionGuard>\n  )\n}",
  "src/pages/DashboardDaily.tsx": "import React, { useState, useMemo, useEffect, useCallback } from 'react'\nimport { useLocation, useNavigate } from 'react-router-dom'\nimport { TrendingUp, Wallet, PiggyBank, Percent, FileText, CreditCard as Edit, Trash2, ChevronLeft, ChevronRight } from 'lucide-react'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { MetricCard } from '@/components/ui/MetricCard'\nimport { SalesChart } from '@/components/Charts/SalesChart'\nimport { ExpensePie } from '@/components/Charts/ExpensePie'\nimport { DataTable } from '@/components/data/DataTable'\nimport { KpiBullets } from '@/components/Charts/KpiBullets'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { EmptyState } from '@/components/ui/empty-state'\nimport { ErrorState } from '@/components/ui/error-state'\nimport { DailyTargetInput } from '@/components/Dashboard/DailyTargetInput'\nimport { useReports } from '@/hooks/useReports'\nimport { useKpis } from '@/hooks/useKpis'\nimport { useExpenseBaseline } from '@/hooks/useExpenseBaseline'\nimport { useTargets } from '@/hooks/useTargets'\nimport { useDailyTarget } from '@/hooks/useDailyTarget'\nimport { formatCurrency, formatPercent } from '@/lib/format'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { deleteDailyReport, getDailyTargets } from '@/services/supabase'\n\nexport const DashboardDaily: React.FC = () => {\n  const location = useLocation()\n  const navigate = useNavigate()\n  const sp = new URLSearchParams(location.search)\n  const storeId = sp.get('store') || 'all'\n  const { user, canAccessStore } = useAuth()\n  const [deleting, setDeleting] = useState<string | null>(null)\n  const [selectedDate, setSelectedDate] = useState<string | null>(null)\n  const [reportListPage, setReportListPage] = useState(0)\n  const reportsPerPage = 7\n\n  // âœ… onPeriodClick ã‚’ãƒ¡ãƒ¢åŒ–\n  const handlePeriodClick = useCallback((date: string) => {\n    setSelectedDate(date)\n  }, [])\n\n  // æ—¥å ±å‰Šé™¤å‡¦ç†\n  const handleDelete = async (reportId: string, reportDate: string) => {\n    if (!confirm(`${reportDate}ã®æ—¥å ±ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {\n      return\n    }\n\n    setDeleting(reportId)\n    try {\n      const { error } = await deleteDailyReport(reportId)\n      if (error) {\n        console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error)\n        alert('æ—¥å ±ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ')\n      } else {\n        console.log('âœ… æ—¥å ±ã‚’å‰Šé™¤ã—ã¾ã—ãŸ:', reportId)\n        // ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿\n        refetch()\n      }\n    } catch (e) {\n      console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', e)\n      alert('æ—¥å ±ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setDeleting(null)\n    }\n  }\n\n  // æ¨©é™ãƒã‚§ãƒƒã‚¯\n  useEffect(() => {\n    if (!user) return\n\n    // å…¨åº—èˆ—è¡¨ç¤ºã¯adminã®ã¿è¨±å¯\n    if (storeId === 'all' && user.role !== 'admin') {\n      const accessibleStores = user.storeIds || []\n      if (accessibleStores.length > 0) {\n        navigate(`/dashboard/daily?store=${accessibleStores[0]}`, { replace: true })\n      }\n      return\n    }\n\n    // ç‰¹å®šåº—èˆ—é¸æŠæ™‚ã®æ¨©é™ãƒã‚§ãƒƒã‚¯\n    if (storeId !== 'all' && !canAccessStore(storeId)) {\n      const accessibleStores = user.storeIds || []\n      if (accessibleStores.length > 0) {\n        navigate(`/dashboard/daily?store=${accessibleStores[0]}`, { replace: true })\n      } else if (user.role !== 'admin') {\n        navigate('/dashboard/daily', { replace: true })\n      }\n    }\n  }, [storeId, user?.id, user?.role, canAccessStore, navigate])\n\n  // Get today's data\n  const today = new Date().toISOString().split('T')[0]\n  const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n\n  // ä»Šæœˆã®ãƒ‡ãƒ¼ã‚¿ï¼ˆæœˆåˆã‹ã‚‰ä»Šæ—¥ã¾ã§ï¼‰\n  const now = new Date()\n  const monthStart = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0]\n  const currentYYYYMM = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`\n  const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n  const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n\n  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¡ãƒ¢åŒ–\n  const todayFilters = useMemo(() => ({\n    storeId,\n    dateFrom: today,\n    dateTo: today\n  }), [storeId, today])\n\n  const yesterdayFilters = useMemo(() => ({\n    storeId,\n    dateFrom: yesterday,\n    dateTo: yesterday\n  }), [storeId, yesterday])\n\n  const weekFilters = useMemo(() => ({\n    storeId,\n    dateFrom: sevenDaysAgo,\n    dateTo: today\n  }), [storeId, sevenDaysAgo, today])\n\n  const allReportsFilters = useMemo(() => ({\n    storeId,\n    dateFrom: thirtyDaysAgo,\n    dateTo: today\n  }), [storeId, thirtyDaysAgo, today])\n\n  const { data: todayReports, isLoading, isError, error, refetch } = useReports(todayFilters)\n  const { data: yesterdayReports } = useReports(yesterdayFilters)\n  const { data: weekReports } = useReports(weekFilters)\n  const { data: allReports } = useReports(allReportsFilters)\n\n  // éå»30æ—¥é–“ã®æ—¥åˆ¥ç›®æ¨™ã‚’å–å¾—\n  const [dailyTargets, setDailyTargets] = React.useState<Record<string, number>>({})\n\n  // ãƒ‡ãƒãƒƒã‚°: dailyTargetsã®çŠ¶æ…‹ã‚’ç›£è¦–\n  React.useEffect(() => {\n    console.log('ğŸ“Š dailyTargetsçŠ¶æ…‹æ›´æ–°:', dailyTargets)\n  }, [dailyTargets])\n\n  React.useEffect(() => {\n    const fetchDailyTargets = async () => {\n      if (storeId === 'all') {\n        console.log('ğŸ¯ æ—¥åˆ¥ç›®æ¨™å–å¾—ã‚¹ã‚­ãƒƒãƒ—: å…¨åº—èˆ—è¡¨ç¤º')\n        return\n      }\n\n      console.log('ğŸ¯ æ—¥åˆ¥ç›®æ¨™ã‚’å–å¾—ä¸­...', { storeId, dateFrom: thirtyDaysAgo, dateTo: today })\n      const { data, error } = await getDailyTargets({\n        storeId,\n        dateFrom: thirtyDaysAgo,\n        dateTo: today\n      })\n\n      console.log('ğŸ¯ æ—¥åˆ¥ç›®æ¨™å–å¾—çµæœ:', { data, error })\n\n      if (data && !error) {\n        const targetsMap: Record<string, number> = {}\n        data.forEach((target: any) => {\n          targetsMap[target.date] = target.target_sales\n        })\n        console.log('ğŸ¯ æ—¥åˆ¥ç›®æ¨™ãƒãƒƒãƒ—:', targetsMap)\n        setDailyTargets(targetsMap)\n      }\n    }\n\n    fetchDailyTargets()\n  }, [storeId, thirtyDaysAgo, today])\n\n  const { data: monthReports } = useReports({\n    storeId,\n    dateFrom: monthStart,\n    dateTo: today\n  })\n\n  // å‚è€ƒçµŒè²»ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n  const { expenseBaseline } = useExpenseBaseline(storeId !== 'all' ? storeId : undefined, currentYYYYMM)\n\n  // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n  const { getTargetForStore, getAllStoresTarget } = useTargets(storeId, currentYYYYMM)\n\n  // æ—¥åˆ¥ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆæœ¬æ—¥ã®ã¿ã€é¸æŠæ—¥ã¯å¯¾è±¡å¤–ï¼‰\n  const displayDate = selectedDate || today\n  const { target: dailyTarget, saveTarget: saveDailyTarget, isLoading: dailyTargetLoading } = useDailyTarget(\n    storeId !== 'all' ? storeId : null,\n    displayDate\n  )\n\n  // æœˆã®çµŒéæ—¥æ•°ã‚’è¨ˆç®—ï¼ˆä»Šæ—¥ãŒä½•æ—¥ç›®ã‹ï¼‰\n  const daysIntoMonth = now.getDate()\n\n  const todayKpis = useKpis(todayReports, yesterdayReports)\n  const weekKpis = useKpis(weekReports)\n  const monthKpis = useKpis(monthReports)\n\n  // åº—èˆ—ã¾ãŸã¯allåº—èˆ—ã®ç›®æ¨™ã‚’å–å¾—\n  const currentTarget = useMemo(() => {\n    if (storeId === 'all') {\n      return getAllStoresTarget()\n    } else {\n      const target = getTargetForStore(storeId)\n      return target ? {\n        targetSales: target.targetSales,\n        targetProfit: target.targetProfit,\n        targetProfitMargin: target.targetProfitMargin,\n        targetCostRate: target.targetCostRate,\n        targetLaborRate: target.targetLaborRate\n      } : null\n    }\n  }, [storeId, getTargetForStore, getAllStoresTarget])\n\n  // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n  const selectedDateReports = React.useMemo(() => {\n    return selectedDate\n      ? weekReports.filter(r => r.date === selectedDate)\n      : todayReports\n  }, [selectedDate, weekReports, todayReports])\n\n  const selectedDateYesterday = React.useMemo(() => {\n    return selectedDate\n      ? new Date(new Date(selectedDate).getTime() - 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n      : yesterday\n  }, [selectedDate, yesterday])\n\n  const selectedDateYesterdayReports = React.useMemo(() => {\n    return weekReports.filter(r => r.date === selectedDateYesterday)\n  }, [weekReports, selectedDateYesterday])\n\n  // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã®KPIã‚’å¸¸ã«è¨ˆç®—ï¼ˆHooksã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã†ï¼‰\n  const selectedDateKpis = useKpis(selectedDateReports, selectedDateYesterdayReports)\n\n  // è¡¨ç¤ºç”¨ã®KPIã‚’é¸æŠæ—¥ä»˜ã¾ãŸã¯æœ¬æ—¥ã§åˆ‡ã‚Šæ›¿ãˆ\n  const displayKpis = selectedDate ? selectedDateKpis : todayKpis\n\n  // ãã®ä»–çµŒè²»ã‚’è¨ˆç®—ï¼ˆå‚è€ƒçµŒè²»ã‚’ä½¿ç”¨ï¼‰\n  const otherExpenses = React.useMemo(() => {\n    // å®Ÿéš›ã®ãã®ä»–çµŒè²»ã‚’è¨ˆç®—\n    const actualOtherExpenses = selectedDateReports.reduce((sum, report) => {\n      return sum + report.utilities + report.promotion + report.cleaning +\n             report.misc + report.communication + report.others +\n             (report.rent || 0) + (report.consumables || 0)\n    }, 0)\n\n    // å®Ÿéš›ã®çµŒè²»ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°å‚è€ƒçµŒè²»ã‚’ä½¿ç”¨\n    if (actualOtherExpenses > 0) {\n      return actualOtherExpenses\n    }\n\n    // å‚è€ƒçµŒè²»ã‹ã‚‰1æ—¥ã‚ãŸã‚Šã®çµŒè²»ã‚’è¨ˆç®—\n    if (expenseBaseline && expenseBaseline.sumOther > 0) {\n      return expenseBaseline.sumOther\n    }\n\n    return 0\n  }, [selectedDateReports, expenseBaseline])\n\n  // å–¶æ¥­åˆ©ç›Šã‚’è¨ˆç®—ï¼ˆç²—åˆ©ç›Š - ãã®ä»–çµŒè²»ï¼‰\n  const operatingProfit = React.useMemo(() => {\n    return displayKpis.grossProfit - otherExpenses\n  }, [displayKpis.grossProfit, otherExpenses])\n\n  // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã®æœ¬æ—¥ã®çµŒè²»ã‚’è¨ˆç®—ï¼ˆä»•å…¥+ãã®ä»–çµŒè²»ï¼‰\n  const selectedDateExpenses = React.useMemo(() => {\n    return displayKpis.purchaseTotal + otherExpenses\n  }, [displayKpis.purchaseTotal, otherExpenses])\n\n  // ç›®æ¨™é”æˆçŠ¶æ³ã‚’è¨ˆç®—ï¼ˆå°†æ¥ã®æ©Ÿèƒ½æ‹¡å¼µç”¨ã«ä¿æŒï¼‰\n  const targetAchievement = React.useMemo((): {\n    targetSales: number\n    actualSales: number\n    achievementRate: number\n    isAchieved: boolean\n    difference: number\n  } | null => {\n    if (!dailyTarget || dailyTarget.targetSales === 0) {\n      return null\n    }\n\n    const actualSales = displayKpis.totalSales\n    const targetSales = dailyTarget.targetSales\n    const achievementRate = (actualSales / targetSales) * 100\n    const isAchieved = actualSales >= targetSales\n    const difference = actualSales - targetSales\n\n    return {\n      targetSales,\n      actualSales,\n      achievementRate,\n      isAchieved,\n      difference\n    }\n  }, [dailyTarget, displayKpis.totalSales])\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <Skeleton key={i} className=\"h-32\" />\n          ))}\n        </div>\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Skeleton className=\"h-96\" />\n          <Skeleton className=\"h-96\" />\n        </div>\n        <Skeleton className=\"h-64\" />\n      </div>\n    )\n  }\n\n  if (isError && error) {\n    return (\n      <ErrorState\n        title=\"ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ\"\n        message={error}\n        onRetry={refetch}\n      />\n    )\n  }\n\n  if (weekReports.length === 0) {\n    return (\n      <EmptyState\n        icon={FileText}\n        title=\"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“\"\n        description=\"æ—¥æ¬¡å ±å‘Šã‚’ä½œæˆã™ã‚‹ã¨ã€ã“ã“ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\"\n        action={{\n          label: \"ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\",\n          onClick: () => window.location.reload()\n        }}\n      />\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <div className=\"flex items-center justify-between\">\n          <h1 className=\"text-2xl font-bold text-foreground mb-2\">\n            æ—¥æ¬¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰\n            {storeId === 'all' ? (\n              <Badge variant=\"default\" className=\"ml-2 bg-blue-600\">\n                å…¨åº—èˆ—é›†è¨ˆ\n              </Badge>\n            ) : (\n              user?.role !== 'admin' && (\n                <Badge variant=\"outline\" className=\"ml-2 text-xs\">\n                  {user?.role === 'manager' ? 'åº—é•·æ¨©é™' : 'ã‚¹ã‚¿ãƒƒãƒ•æ¨©é™'}\n                </Badge>\n              )\n            )}\n            {selectedDate && (\n              <Badge variant=\"default\" className=\"ml-2 bg-purple-600\">\n                {selectedDate} ã®ãƒ‡ãƒ¼ã‚¿\n              </Badge>\n            )}\n          </h1>\n          {selectedDate && (\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setSelectedDate(null)}\n            >\n              æœ¬æ—¥ã«æˆ»ã‚‹\n            </Button>\n          )}\n        </div>\n        <p className=\"text-muted-foreground\">\n          åˆ†ææœŸé–“: {new Date(displayDate).toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}\n        </p>\n        <p className=\"text-muted-foreground text-sm\">\n          {storeId === 'all'\n            ? 'å…¨ç™»éŒ²åº—èˆ—ã®æœ¬æ—¥ã®æ¥­ç¸¾ã¨éå»7æ—¥é–“ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆåˆè¨ˆå€¤ï¼‰'\n            : 'æœ¬æ—¥ã®æ¥­ç¸¾ã¨éå»7æ—¥é–“ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ'\n          }\n          {storeId !== 'all' && user?.role !== 'admin' && (\n            <span className=\"text-blue-600 ml-2\">ï¼ˆæ‹…å½“åº—èˆ—ãƒ‡ãƒ¼ã‚¿ï¼‰</span>\n          )}\n        </p>\n      </div>\n\n      {/* æ—¥åˆ¥å£²ä¸Šç›®æ¨™å…¥åŠ› */}\n      {storeId !== 'all' && (\n        <Card className=\"border-blue-200 bg-blue-50/50\">\n          <CardContent className=\"pt-6\">\n            {!selectedDate ? (\n              <DailyTargetInput\n                date={today}\n                storeId={storeId}\n                currentTarget={dailyTarget?.targetSales || null}\n                onSave={saveDailyTarget}\n                isLoading={dailyTargetLoading}\n              />\n            ) : (\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2\">\n                  <TrendingUp className=\"h-4 w-4 text-blue-600\" />\n                  <span className=\"text-sm font-medium text-muted-foreground\">\n                    {selectedDate}ã®å£²ä¸Šç›®æ¨™\n                  </span>\n                </div>\n                {dailyTargets[selectedDate] ? (\n                  <div className=\"text-lg font-bold text-blue-600\">\n                    {formatCurrency(dailyTargets[selectedDate])}\n                  </div>\n                ) : (\n                  <div className=\"text-sm text-muted-foreground italic\">\n                    ç›®æ¨™æœªè¨­å®š\n                  </div>\n                )}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      )}\n\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <MetricCard\n          label={selectedDate ? `${selectedDate}ã®å£²ä¸Š` : \"æœ¬æ—¥ã®å£²ä¸Š\"}\n          value={formatCurrency(displayKpis.totalSales)}\n          delta={displayKpis.salesGrowth !== undefined ? {\n            value: displayKpis.salesGrowth,\n            isPositive: displayKpis.salesGrowth >= 0,\n            label: \"å‰æ—¥æ¯”\"\n          } : undefined}\n          icon={TrendingUp}\n          tone=\"info\"\n          hint={`${displayKpis.reportCount}ä»¶ã®å ±å‘Š`}\n          details={displayKpis.totalCustomers > 0 ? [\n            { label: 'å¹³å‡å®¢å˜ä¾¡', value: formatCurrency(displayKpis.averageTicket) },\n            { label: 'å®¢æ•°', value: `${displayKpis.totalCustomers.toLocaleString()}äºº` }\n          ] : [\n            { label: 'å®¢æ•°ãƒ‡ãƒ¼ã‚¿', value: 'æœªå…¥åŠ›' }\n          ]}\n        />\n\n        <MetricCard\n          label={selectedDate ? `${selectedDate}ã®çµŒè²»` : \"æœ¬æ—¥ã®çµŒè²»\"}\n          value={formatCurrency(selectedDateExpenses)}\n          icon={Wallet}\n          tone=\"danger\"\n          hint=\"ä»•å…¥+ãã®ä»–çµŒè²»\"\n          details={[\n            { label: 'ä»•å…¥', value: `${formatCurrency(displayKpis.purchaseTotal)} (${formatPercent(displayKpis.purchaseRate)})` },\n            { label: 'ãã®ä»–çµŒè²»', value: formatCurrency(otherExpenses) }\n          ]}\n        />\n\n        <MetricCard\n          label={selectedDate ? `${selectedDate}ã®ç²—åˆ©ç›Š` : \"æœ¬æ—¥ã®ç²—åˆ©ç›Š\"}\n          value={formatCurrency(displayKpis.grossProfit)}\n          icon={PiggyBank}\n          tone={displayKpis.grossProfit >= 0 ? \"success\" : \"danger\"}\n          hint=\"å£²ä¸Š - ä»•å…¥\"\n          details={[\n            { label: 'åŸä¾¡ç‡', value: formatPercent(displayKpis.purchaseRate) },\n            { label: 'ç²—åˆ©ç‡', value: formatPercent(100 - displayKpis.purchaseRate) }\n          ]}\n        />\n\n        <MetricCard\n          label={selectedDate ? `${selectedDate}ã®å–¶æ¥­åˆ©ç›Š` : \"æœ¬æ—¥ã®å–¶æ¥­åˆ©ç›Š\"}\n          value={formatCurrency(operatingProfit)}\n          delta={displayKpis.profitGrowth !== undefined ? {\n            value: displayKpis.profitGrowth,\n            isPositive: displayKpis.profitGrowth >= 0,\n            label: \"å‰æ—¥æ¯”\"\n          } : undefined}\n          icon={Percent}\n          tone={operatingProfit >= 0 ? \"success\" : \"danger\"}\n          hint={`åˆ©ç›Šç‡ ${formatPercent(displayKpis.totalSales > 0 ? (operatingProfit / displayKpis.totalSales) * 100 : 0)}`}\n          details={[\n            { label: 'ç²—åˆ©ç›Š', value: formatCurrency(displayKpis.grossProfit) },\n            { label: 'ãã®ä»–çµŒè²»', value: formatCurrency(otherExpenses) }\n          ]}\n        />\n      </div>\n\n\n      {/* Charts */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <SalesChart\n          reports={weekReports}\n          period=\"daily\"\n          targetSales={todayKpis.averageDailySales * 1.2} // 20% above average as target\n          expenseBaseline={expenseBaseline}\n        />\n        <ExpensePie\n          reports={monthReports}\n          period=\"monthly\"\n          title=\"ä»Šæœˆã®çµŒè²»å†…è¨³\"\n          expenseBaseline={expenseBaseline}\n          daysCount={daysIntoMonth}\n        />\n      </div>\n\n      {/* Data Table */}\n      <DataTable\n        reports={allReports}\n        period=\"daily\"\n        groupByStore={false}\n        onPeriodClick={handlePeriodClick}\n        dailyTargets={dailyTargets}\n        baselineMap={new Map()}\n      />\n\n      {/* æ—¥å ±ãƒªã‚¹ãƒˆï¼ˆç·¨é›†å¯èƒ½ï¼‰ */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold\">\n            æ—¥å ±ä¸€è¦§\n            <span className=\"ml-2 text-sm font-normal text-muted-foreground\">\n              {allReports.length}ä»¶\n            </span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {allReports.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\">æ—¥å ±ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>\n          ) : (\n            <>\n              <div className=\"space-y-3\">\n                {allReports.slice(reportListPage * reportsPerPage, (reportListPage + 1) * reportsPerPage).map((report) => {\n                const grossProfit = report.sales - report.purchase\n                const grossProfitMargin = report.sales > 0 ? (grossProfit / report.sales) * 100 : 0\n\n                return (\n                  <div key={report.id} className=\"flex flex-col p-3 sm:p-4 border rounded-lg hover:bg-muted/50 transition-colors\">\n                    <div className=\"flex-1 space-y-2\">\n                      <div className=\"flex flex-wrap items-center gap-2\">\n                        <button\n                          onClick={() => setSelectedDate(report.date)}\n                          className={`font-medium text-sm sm:text-base hover:text-blue-600 transition-colors ${selectedDate === report.date ? 'text-purple-600 underline' : ''}`}\n                        >\n                          {report.date}\n                        </button>\n                        <Badge variant=\"outline\" className=\"text-xs\">{report.storeName}</Badge>\n                        {report.staffName && <span className=\"text-xs sm:text-sm text-muted-foreground\">by {report.staffName}</span>}\n                      </div>\n                      <div className=\"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-4 text-xs sm:text-sm\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-blue-600\">å£²ä¸Š: {formatCurrency(report.sales)}</span>\n                          {dailyTargets[report.date] && (\n                            <Badge\n                              variant={report.sales >= dailyTargets[report.date] ? \"default\" : \"destructive\"}\n                              className={report.sales >= dailyTargets[report.date] ? \"bg-green-600\" : \"\"}\n                            >\n                              {report.sales >= dailyTargets[report.date] ? \"é”æˆ\" : \"æœªé”æˆ\"}\n                            </Badge>\n                          )}\n                        </div>\n                        <span className=\"text-red-600\">ä»•å…¥: {formatCurrency(report.purchase)}</span>\n                        <span className={grossProfit >= 0 ? 'text-green-600' : 'text-red-600'}>\n                          ç²—åˆ©ç›Š: {formatCurrency(grossProfit)} ({formatPercent(grossProfitMargin)})\n                        </span>\n                      </div>\n                      {report.reportText && (\n                        <p className=\"text-xs sm:text-sm text-muted-foreground line-clamp-2\">{report.reportText}</p>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-2 mt-3 pt-3 border-t\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => navigate(`/report?id=${report.id}`)}\n                        className=\"flex-1\"\n                      >\n                        <Edit className=\"h-4 w-4 mr-1\" />\n                        ç·¨é›†\n                      </Button>\n                      <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        onClick={() => handleDelete(report.id, report.date)}\n                        disabled={deleting === report.id}\n                        className=\"flex-1\"\n                      >\n                        <Trash2 className=\"h-4 w-4 mr-1\" />\n                        {deleting === report.id ? 'å‰Šé™¤ä¸­...' : 'å‰Šé™¤'}\n                      </Button>\n                    </div>\n                  </div>\n                )\n              })}\n              </div>\n\n              {/* Pagination */}\n              <div className=\"flex items-center justify-between pt-4 border-t\">\n                <div className=\"text-sm text-muted-foreground\">\n                  {allReports.length} ä»¶ä¸­{' '}\n                  {reportListPage * reportsPerPage + 1}-\n                  {Math.min((reportListPage + 1) * reportsPerPage, allReports.length)} ä»¶ã‚’è¡¨ç¤º\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setReportListPage(prev => Math.max(0, prev - 1))}\n                    disabled={reportListPage === 0}\n                  >\n                    <ChevronLeft className=\"h-4 w-4\" />\n                    å‰ã¸\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setReportListPage(prev => prev + 1)}\n                    disabled={(reportListPage + 1) * reportsPerPage >= allReports.length}\n                  >\n                    æ¬¡ã¸\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}",
  "src/pages/DashboardMonthly.tsx": "import React, { useState, useMemo, useEffect, useCallback } from 'react'\nimport { useLocation, useNavigate } from 'react-router-dom'\nimport { TrendingUp, Wallet, PiggyBank, Percent, FileText } from 'lucide-react'\nimport { Badge } from '@/components/ui/badge'\nimport { MetricCard } from '@/components/ui/MetricCard'\nimport { SalesChart } from '@/components/Charts/SalesChart'\nimport { ExpensePie } from '@/components/Charts/ExpensePie'\nimport { DataTable } from '@/components/data/DataTable'\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { KpiBullets } from '@/components/Charts/KpiBullets'\nimport { CalendarHeatmap } from '@/components/Charts/CalendarHeatmap'\nimport { ProfitWaterfall } from '@/components/Charts/ProfitWaterfall'\nimport { AlertsPanel } from '@/components/alerts/AlertsPanel'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { EmptyState } from '@/components/ui/empty-state'\nimport { ErrorState } from '@/components/ui/error-state'\nimport { useReports } from '@/hooks/useReports'\nimport { useKpis } from '@/hooks/useKpis'\nimport { useExpenseBaseline } from '@/hooks/useExpenseBaseline'\nimport { useTargets } from '@/hooks/useTargets'\nimport { formatCurrency, formatPercent } from '@/lib/format'\nimport { ProfitLossModal } from '@/components/analysis/ProfitLossModal'\nimport { useAuth } from '@/contexts/AuthContext'\n\nexport const DashboardMonthly: React.FC = () => {\n  const location = useLocation()\n  const navigate = useNavigate()\n  const sp = new URLSearchParams(location.search)\n  const storeId = sp.get('store') || 'all'\n  const { user, canAccessStore } = useAuth()\n\n  // ä»Šæœˆã®ãƒ‡ãƒ¼ã‚¿ï¼ˆKPIç”¨ï¼‰- æ—¥ä»˜è¨ˆç®—ã¯ä¸€åº¦ã ã‘å®Ÿè¡Œ\n  const { now, thisMonthStart, today, currentYYYYMM, lastMonthStart, lastMonthEnd, currentYear, currentMonth } = useMemo(() => {\n    const currentDate = new Date()\n    const year = currentDate.getFullYear()\n    const month = currentDate.getMonth()\n    const monthStart = new Date(year, month, 1)\n    const todayStr = currentDate.toISOString().split('T')[0]\n    const yyyymm = `${year}-${String(month + 1).padStart(2, '0')}`\n    const prevMonthStart = new Date(year, month - 1, 1)\n    const prevMonthEnd = new Date(year, month, 0)\n\n    return {\n      now: currentDate,\n      thisMonthStart: monthStart,\n      today: todayStr,\n      currentYYYYMM: yyyymm,\n      lastMonthStart: prevMonthStart,\n      lastMonthEnd: prevMonthEnd,\n      currentYear: year,\n      currentMonth: month\n    }\n  }, [])\n\n  console.log('ğŸ—“ï¸ DashboardMonthly: Date range', {\n    now: now.toISOString(),\n    thisMonthStart: thisMonthStart.toISOString().split('T')[0],\n    today,\n    month: now.getMonth() + 1,\n    year: now.getFullYear()\n  })\n  const { getTargetForStore, getAllStoresTarget } = useTargets(storeId, currentYYYYMM)\n  const { expenseBaseline, monthlyExpenseBaseline } = useExpenseBaseline(storeId, currentYYYYMM)\n\n  // æ¨©é™ãƒã‚§ãƒƒã‚¯\n  useEffect(() => {\n    if (!user) return\n\n    // å…¨åº—èˆ—è¡¨ç¤ºã¯adminã®ã¿è¨±å¯\n    if (storeId === 'all' && user.role !== 'admin') {\n      const accessibleStores = user.storeIds || []\n      if (accessibleStores.length > 0) {\n        navigate(`/dashboard/monthly?store=${accessibleStores[0]}`, { replace: true })\n      }\n      return\n    }\n\n    // ç‰¹å®šåº—èˆ—é¸æŠæ™‚ã®æ¨©é™ãƒã‚§ãƒƒã‚¯\n    if (storeId !== 'all' && !canAccessStore(storeId)) {\n      const accessibleStores = user.storeIds || []\n      if (accessibleStores.length > 0) {\n        navigate(`/dashboard/monthly?store=${accessibleStores[0]}`, { replace: true })\n      } else if (user.role !== 'admin') {\n        navigate('/dashboard/monthly', { replace: true })\n      }\n    }\n  }, [storeId, user?.id, user?.role, canAccessStore, navigate])\n\n  // è¡¨ç¤ºç¯„å›²ï¼š3/6/12ãƒ¶æœˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3ãƒ¶æœˆï¼‰\n  const [rangeMonths, setRangeMonths] = useState<3 | 6 | 12>(3)\n  const [selectedMonth, setSelectedMonth] = useState<string | null>(null)\n\n  // âœ… onPeriodClick ã‚’ãƒ¡ãƒ¢åŒ–ï¼ˆDataTable ã® columns å†ç”Ÿæˆã‚’é˜²ãï¼‰\n  const handlePeriodClick = useCallback((period: string) => {\n    setSelectedMonth(period)\n  }, [])\n\n  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¡ãƒ¢åŒ–ã—ã¦ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é˜²ã\n  const thisMonthFilters = useMemo(() => ({\n    storeId,\n    dateFrom: thisMonthStart.toISOString().split('T')[0],\n    dateTo: today\n  }), [storeId, thisMonthStart, today])\n\n  const lastMonthFilters = useMemo(() => ({\n    storeId,\n    dateFrom: lastMonthStart.toISOString().split('T')[0],\n    dateTo: lastMonthEnd.toISOString().split('T')[0]\n  }), [storeId, lastMonthStart, lastMonthEnd])\n\n  const { data: thisMonthReports, isLoading, isError, error, refetch } = useReports(thisMonthFilters)\n  const { data: lastMonthReports } = useReports(lastMonthFilters)\n\n  // è¡¨ç¤ºç¯„å›²åˆ†ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚°ãƒ©ãƒ•/ãƒ†ãƒ¼ãƒ–ãƒ«/å††ã‚°ãƒ©ãƒ•ç”¨ï¼‰\n  const rangeStartDate = useMemo(() => {\n    // âœ… æ—¥ä»˜æ–‡å­—åˆ—ã¨ã—ã¦è¨ˆç®—ï¼ˆDateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¾å­˜é…åˆ—ã«å…¥ã‚Œãªã„ï¼‰\n    const year = currentYear\n    const month = currentMonth - (rangeMonths - 1)\n    return new Date(year, month, 1).toISOString().split('T')[0]\n  }, [currentYear, currentMonth, rangeMonths])\n\n  const rangeFilters = useMemo(() => ({\n    storeId,\n    dateFrom: rangeStartDate,\n    dateTo: today\n  }), [storeId, rangeStartDate, today])\n\n  const { data: rangeReports } = useReports(rangeFilters)\n\n  const thisMonthKpis = useKpis(thisMonthReports, lastMonthReports)\n  const yearKpis = useKpis(rangeReports)\n\n  // âœ… DataTableç”¨: rangeReportså…¨ä½“ã®baselineMapã‚’ä½œæˆ\n  const baselineMap = useMemo(() => {\n    const map = new Map<string, import('@/services/supabase').ExpenseBaselineDb>()\n    // å¿…è¦ãªæœˆÃ—åº—èˆ—ã®çµ„ã¿åˆã‚ã›ã‚’åé›†\n    const keysNeeded = new Set<string>()\n    rangeReports.forEach(r => {\n      const yyyymm = r.date.slice(0, 7)\n      keysNeeded.add(`${r.storeId}-${yyyymm}`)\n    })\n    // â€» ä»Šã¯ç©ºã®Mapã‚’è¿”ã™ï¼ˆæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè£…ï¼‰\n    return map\n  }, [rangeReports])\n\n  // æœˆæ¬¡ã®ãã®ä»–çµŒè²»ã‚’è¨ˆç®—ï¼ˆå‚è€ƒçµŒè²»ã‚’ä½¿ç”¨ã€äººä»¶è²»ã‚’é™¤å¤–ï¼‰\n  const thisMonthOtherExpenses = useMemo(() => {\n    // å®Ÿéš›ã®ãã®ä»–çµŒè²»ã‚’è¨ˆç®—ï¼ˆäººä»¶è²»ã¯å«ã¾ãªã„ï¼‰\n    const actualOtherExpenses = thisMonthReports.reduce((sum, report) => {\n      return sum + report.utilities + report.promotion + report.cleaning +\n             report.misc + report.communication + report.others +\n             (report.rent || 0) + (report.consumables || 0)\n    }, 0)\n\n    // å®Ÿéš›ã®çµŒè²»ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°å‚è€ƒçµŒè²»ã‚’ä½¿ç”¨\n    if (actualOtherExpenses > 0) {\n      return actualOtherExpenses\n    }\n\n    // å‚è€ƒçµŒè²»ã‹ã‚‰æ—¥æ•°åˆ†ã®çµŒè²»ã‚’è¨ˆç®—ï¼ˆäººä»¶è²»ã‚’é™¤å¤–ï¼‰\n    if (expenseBaseline && expenseBaseline.sumOther > 0) {\n      // sumOtherã«ã¯äººä»¶è²»ãŒå«ã¾ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª\n      return expenseBaseline.sumOther * thisMonthReports.length\n    }\n\n    return 0\n  }, [thisMonthReports, expenseBaseline])\n\n  // æœˆæ¬¡ã®äººä»¶è²»ã¨å–¶æ¥­åˆ©ç›Šã‚’å†è¨ˆç®—\n  const adjustedThisMonthKpis = useMemo(() => {\n    // å‚è€ƒçµŒè²»ã‹ã‚‰æ—¥æ•°ã«å¿œã˜ãŸæœˆã®æƒ³å®šäººä»¶è²»ã‚’è¨ˆç®—\n    const daysInMonth = thisMonthReports.length\n    const monthlyLaborCostFromBaseline = monthlyExpenseBaseline.laborCost > 0\n      ? (monthlyExpenseBaseline.laborCost / 30) * daysInMonth\n      : 0\n\n    // å®Ÿéš›ã®äººä»¶è²»ï¼ˆæ—¥å ±å…¥åŠ›å€¤ï¼‰\n    const actualLaborCost = thisMonthKpis.laborTotal\n\n    // ã©ã¡ã‚‰ã‹å¤§ãã„æ–¹ã‚’ä½¿ç”¨ï¼ˆã¾ãŸã¯å‚è€ƒçµŒè²»ãŒãªã„å ´åˆã¯å®Ÿéš›ã®å€¤ï¼‰\n    const adjustedLaborCost = monthlyLaborCostFromBaseline > 0\n      ? monthlyLaborCostFromBaseline\n      : actualLaborCost\n\n    // FLã‚³ã‚¹ãƒˆã¨ç‡ã‚’å†è¨ˆç®—\n    const adjustedPrimeCost = thisMonthKpis.purchaseTotal + adjustedLaborCost\n    const adjustedLaborRate = thisMonthKpis.totalSales > 0 ? (adjustedLaborCost / thisMonthKpis.totalSales) * 100 : 0\n    const adjustedPrimeCostRate = thisMonthKpis.totalSales > 0 ? (adjustedPrimeCost / thisMonthKpis.totalSales) * 100 : 0\n\n    // å–¶æ¥­åˆ©ç›Šã‚’å†è¨ˆç®—ï¼ˆç²—åˆ©ç›Š - äººä»¶è²» - ãã®ä»–çµŒè²»ï¼‰\n    const operatingProfit = thisMonthKpis.grossProfit - adjustedLaborCost - thisMonthOtherExpenses\n    const profitMargin = thisMonthKpis.totalSales > 0 ? (operatingProfit / thisMonthKpis.totalSales) * 100 : 0\n\n    return {\n      ...thisMonthKpis,\n      laborTotal: adjustedLaborCost,\n      laborRate: adjustedLaborRate,\n      primeCost: adjustedPrimeCost,\n      primeCostRate: adjustedPrimeCostRate,\n      operatingProfit,\n      profitMargin\n    }\n  }, [thisMonthKpis, thisMonthOtherExpenses, monthlyExpenseBaseline, thisMonthReports])\n\n  // åº—èˆ—ã¾ãŸã¯allåº—èˆ—ã®ç›®æ¨™ã‚’å–å¾—\n  const currentTarget = useMemo(() => {\n    if (storeId === 'all') {\n      return getAllStoresTarget()\n    } else {\n      const target = getTargetForStore(storeId)\n      return target ? {\n        targetSales: target.targetSales,\n        targetProfit: target.targetProfit,\n        targetProfitMargin: target.targetProfitMargin,\n        targetCostRate: target.targetCostRate,\n        targetLaborRate: target.targetLaborRate\n      } : null\n    }\n  }, [storeId, getTargetForStore, getAllStoresTarget])\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6\">\n          {Array.from({ length: 5 }).map((_, i) => (\n            <Skeleton key={i} className=\"h-32\" />\n          ))}\n        </div>\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Skeleton className=\"h-96\" />\n          <Skeleton className=\"h-96\" />\n        </div>\n        <Skeleton className=\"h-64\" />\n      </div>\n    )\n  }\n\n  if (isError && error) {\n    return (\n      <ErrorState\n        title=\"ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ\"\n        message={error}\n        onRetry={refetch}\n      />\n    )\n  }\n\n  if (rangeReports.length === 0) {\n    return (\n      <EmptyState\n        icon={FileText}\n        title=\"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“\"\n        description=\"æ—¥æ¬¡å ±å‘Šã‚’ä½œæˆã™ã‚‹ã¨ã€ã“ã“ã«æœˆæ¬¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\"\n        action={{\n          label: \"ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\",\n          onClick: () => window.location.reload()\n        }}\n      />\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground mb-2\">\n          æœˆæ¬¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰\n          {storeId === 'all' && (\n            <Badge variant=\"default\" className=\"ml-2 bg-blue-600\">\n              å…¨åº—èˆ—é›†è¨ˆ\n            </Badge>\n          )}\n        </h1>\n        <p className=\"text-muted-foreground text-sm\">\n          åˆ†ææœŸé–“: {thisMonthStart.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })} ã€œ {now.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}\n        </p>\n        <p className=\"text-muted-foreground text-sm\">\n          {storeId === 'all'\n            ? `å…¨ç™»éŒ²åº—èˆ—ã®ä»Šæœˆã®æ¥­ç¸¾ã¨éå»${rangeMonths}ãƒ¶æœˆã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆåˆè¨ˆå€¤ï¼‰`\n            : `ä»Šæœˆã®æ¥­ç¸¾ã¨éå»${rangeMonths}ãƒ¶æœˆã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ`\n          }\n        </p>\n        {/* è¡¨ç¤ºç¯„å›²åˆ‡æ›¿ */}\n        <div className=\"flex justify-end\">\n          <Tabs value={String(rangeMonths)} onValueChange={(v)=>setRangeMonths(Number(v) as 3|6|12)}>\n            <TabsList>\n              <TabsTrigger value=\"3\">ç›´è¿‘3ãƒ¶æœˆ</TabsTrigger>\n              <TabsTrigger value=\"6\">ç›´è¿‘6ãƒ¶æœˆ</TabsTrigger>\n              <TabsTrigger value=\"12\">ç›´è¿‘12ãƒ¶æœˆ</TabsTrigger>\n            </TabsList>\n          </Tabs>\n        </div>\n      </div>\n\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 gap-6\">\n        <MetricCard\n          label=\"ä»Šæœˆã®å£²ä¸Š\"\n          value={formatCurrency(adjustedThisMonthKpis.totalSales)}\n          delta={adjustedThisMonthKpis.salesGrowth !== undefined ? {\n            value: adjustedThisMonthKpis.salesGrowth,\n            isPositive: adjustedThisMonthKpis.salesGrowth >= 0,\n            label: \"å‰æœˆæ¯”\"\n          } : undefined}\n          icon={TrendingUp}\n          tone=\"info\"\n          hint={`${adjustedThisMonthKpis.reportCount}ä»¶ã®å ±å‘Š`}\n          details={adjustedThisMonthKpis.totalCustomers > 0 ? [\n            { label: 'å¹³å‡å®¢å˜ä¾¡', value: formatCurrency(adjustedThisMonthKpis.averageTicket) },\n            { label: 'å®¢æ•°', value: `${adjustedThisMonthKpis.totalCustomers.toLocaleString()}äºº` }\n          ] : [\n            { label: 'å®¢æ•°ãƒ‡ãƒ¼ã‚¿', value: 'æœªå…¥åŠ›' }\n          ]}\n        />\n\n        <MetricCard\n          label=\"FLã‚³ã‚¹ãƒˆç‡\"\n          value={formatPercent(adjustedThisMonthKpis.primeCostRate)}\n          icon={Percent}\n          tone={adjustedThisMonthKpis.primeCostRate <= 58 ? 'success' : adjustedThisMonthKpis.primeCostRate <= 62 ? 'warning' : 'danger'}\n          hint={`åŸä¾¡ç‡${formatPercent(adjustedThisMonthKpis.purchaseRate)}${currentTarget?.targetCostRate ? ` (ç›®æ¨™${formatPercent(currentTarget.targetCostRate)})` : ''} / äººä»¶è²»ç‡${formatPercent(adjustedThisMonthKpis.laborRate)}${currentTarget?.targetLaborRate ? ` (ç›®æ¨™${formatPercent(currentTarget.targetLaborRate)})` : ''}`}\n          details={[\n            { label: 'ä»•å…¥', value: formatCurrency(adjustedThisMonthKpis.purchaseTotal) },\n            { label: 'äººä»¶è²»', value: formatCurrency(adjustedThisMonthKpis.laborTotal) },\n            { label: 'FLã‚³ã‚¹ãƒˆ', value: formatCurrency(adjustedThisMonthKpis.primeCost) }\n          ]}\n        />\n\n        <MetricCard\n          label=\"FLä»¥å¤–ã®çµŒè²»\"\n          value={formatCurrency(thisMonthOtherExpenses)}\n          icon={Wallet}\n          tone=\"danger\"\n          hint=\"FLä»¥å¤–ã®çµŒè²»ï¼ˆå‚è€ƒçµŒè²»ã‹ã‚‰ç®—å‡ºï¼‰\"\n          details={expenseBaseline ? [\n            { label: 'æ°´é“å…‰ç†±è²»', value: formatCurrency(expenseBaseline.utilities * thisMonthReports.length) },\n            { label: 'å®¶è³ƒ', value: formatCurrency(expenseBaseline.rent * thisMonthReports.length) },\n            { label: 'æ¶ˆè€—å“è²»', value: formatCurrency(expenseBaseline.consumables * thisMonthReports.length) },\n            { label: 'è²©ä¿ƒè²»', value: formatCurrency(expenseBaseline.promotion * thisMonthReports.length) },\n            { label: 'æ¸…æƒè²»', value: formatCurrency(expenseBaseline.cleaning * thisMonthReports.length) },\n            { label: 'é€šä¿¡è²»', value: formatCurrency(expenseBaseline.communication * thisMonthReports.length) },\n            { label: 'ãã®ä»–', value: formatCurrency((expenseBaseline.misc + expenseBaseline.others) * thisMonthReports.length) }\n          ] : []}\n        />\n\n        <MetricCard\n          label=\"ä»Šæœˆã®ç²—åˆ©ç›Š\"\n          value={formatCurrency(adjustedThisMonthKpis.grossProfit)}\n          icon={PiggyBank}\n          tone={adjustedThisMonthKpis.grossProfit >= 0 ? \"success\" : \"danger\"}\n          hint=\"å£²ä¸Š - ä»•å…¥\"\n          details={[\n            { label: 'ç²—åˆ©ç‡', value: formatPercent(100 - adjustedThisMonthKpis.purchaseRate) }\n          ]}\n        />\n\n        <MetricCard\n          label=\"å–¶æ¥­åˆ©ç›Šç‡\"\n          value={formatPercent(adjustedThisMonthKpis.profitMargin)}\n          icon={Percent}\n          tone={adjustedThisMonthKpis.profitMargin >= 15 ? \"success\" : adjustedThisMonthKpis.profitMargin >= 10 ? \"warning\" : \"danger\"}\n          hint=\"å–¶æ¥­åˆ©ç›Š Ã· å£²ä¸Šé«˜\"\n          details={[\n            { label: 'å–¶æ¥­åˆ©ç›Š', value: formatCurrency(adjustedThisMonthKpis.operatingProfit) }\n          ]}\n        />\n\n        <MetricCard\n          label=\"å¹³å‡æ—¥å•†\"\n          value={formatCurrency(adjustedThisMonthKpis.averageDailySales)}\n          icon={FileText}\n          tone=\"neutral\"\n          hint=\"1æ—¥ã‚ãŸã‚Šå¹³å‡\"\n        />\n\n        <MetricCard\n          label=\"å®¢æ•°\"\n          value={adjustedThisMonthKpis.totalCustomers > 0 ? `${adjustedThisMonthKpis.totalCustomers.toLocaleString('ja-JP')} å` : 'æœªå…¥åŠ›'}\n          icon={FileText}\n          tone={adjustedThisMonthKpis.totalCustomers > 0 ? \"info\" : \"neutral\"}\n          hint={adjustedThisMonthKpis.totalCustomers > 0 ? `å¹³å‡å®¢å˜ä¾¡: ${formatCurrency(adjustedThisMonthKpis.averageTicket)}` : \"æ—¥å ±ã§å®¢æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\"}\n        />\n      </div>\n\n      {/* Charts */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <SalesChart\n          reports={rangeReports}\n          period=\"monthly\"\n          maxPoints={rangeMonths}\n          targetSales={currentTarget?.targetSales}\n          onDataPointClick={(period) => setSelectedMonth(period)}\n          expenseBaseline={expenseBaseline}\n        />\n        <ExpensePie\n          reports={rangeReports}\n          period=\"monthly\"\n          expenseBaseline={expenseBaseline}\n        />\n      </div>\n\n      {/* è¦–è¦šã§å…¨ä½“æŠŠæ¡ãƒ»è¦å› æŠŠæ¡ */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <CalendarHeatmap reports={thisMonthReports} />\n        <ProfitWaterfall\n          reports={thisMonthReports}\n          expenseBaseline={expenseBaseline}\n          adjustedLaborCost={adjustedThisMonthKpis.laborTotal}\n        />\n      </div>\n\n      {/* ã‚¢ãƒ©ãƒ¼ãƒˆ */}\n      <AlertsPanel\n        kpis={adjustedThisMonthKpis}\n        targetCostRate={currentTarget?.targetCostRate}\n        targetLaborRate={currentTarget?.targetLaborRate}\n      />\n\n      {/* Data Table */}\n      <DataTable\n        reports={rangeReports}\n        period=\"monthly\"\n        groupByStore={false}\n        onPeriodClick={handlePeriodClick}\n        baselineMap={baselineMap}\n      />\n\n      {/* P&L Modal */}\n      {selectedMonth && (\n        <ProfitLossModal\n          month={selectedMonth}\n          reports={rangeReports}\n          storeId={storeId}\n          onClose={() => setSelectedMonth(null)}\n        />\n      )}\n    </div>\n  )\n}",
  "src/pages/DashboardWeekly.tsx": "import React, { useMemo, useEffect } from 'react'\nimport { useLocation, useNavigate } from 'react-router-dom'\nimport { TrendingUp, Wallet, PiggyBank, Percent, FileText } from 'lucide-react'\nimport { Badge } from '@/components/ui/badge'\nimport { MetricCard } from '@/components/ui/MetricCard'\nimport { SalesChart } from '@/components/Charts/SalesChart'\nimport { ExpensePie } from '@/components/Charts/ExpensePie'\nimport { DataTable } from '@/components/data/DataTable'\nimport { KpiBullets } from '@/components/Charts/KpiBullets'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { EmptyState } from '@/components/ui/empty-state'\nimport { ErrorState } from '@/components/ui/error-state'\nimport { useReports } from '@/hooks/useReports'\nimport { useKpis } from '@/hooks/useKpis'\nimport { useExpenseBaseline } from '@/hooks/useExpenseBaseline'\nimport { useTargets } from '@/hooks/useTargets'\nimport { formatCurrency, formatPercent } from '@/lib/format'\nimport { useAuth } from '@/contexts/AuthContext'\n\nexport const DashboardWeekly: React.FC = () => {\n  const location = useLocation()\n  const navigate = useNavigate()\n  const sp = new URLSearchParams(location.search)\n  const storeId = sp.get('store') || 'all'\n  const { user, canAccessStore } = useAuth()\n  const currentPeriod = new Date().toISOString().substring(0, 7)\n  const { expenseBaseline } = useExpenseBaseline(storeId, currentPeriod)\n  const { getTargetForStore, getAllStoresTarget } = useTargets(storeId, currentPeriod)\n\n  // æ¨©é™ãƒã‚§ãƒƒã‚¯\n  useEffect(() => {\n    if (!user) return\n\n    // å…¨åº—èˆ—è¡¨ç¤ºã¯adminã®ã¿è¨±å¯\n    if (storeId === 'all' && user.role !== 'admin') {\n      const accessibleStores = user.storeIds || []\n      if (accessibleStores.length > 0) {\n        navigate(`/dashboard/weekly?store=${accessibleStores[0]}`, { replace: true })\n      }\n      return\n    }\n\n    // ç‰¹å®šåº—èˆ—é¸æŠæ™‚ã®æ¨©é™ãƒã‚§ãƒƒã‚¯\n    if (storeId !== 'all' && !canAccessStore(storeId)) {\n      const accessibleStores = user.storeIds || []\n      if (accessibleStores.length > 0) {\n        navigate(`/dashboard/weekly?store=${accessibleStores[0]}`, { replace: true })\n      } else if (user.role !== 'admin') {\n        navigate('/dashboard/weekly', { replace: true })\n      }\n    }\n  }, [storeId, user?.id, user?.role, canAccessStore, navigate])\n\n  // Get this week's data - æ—¥ä»˜è¨ˆç®—ã¯ä¸€åº¦ã ã‘å®Ÿè¡Œ\n  const { thisWeekStart, thisWeekEnd, lastWeekStart, lastWeekEnd, twoWeeksStart, now } = useMemo(() => {\n    const currentDate = new Date()\n    const weekStart = new Date(currentDate)\n    weekStart.setDate(currentDate.getDate() - currentDate.getDay())\n\n    const weekEnd = new Date(weekStart)\n    weekEnd.setDate(weekStart.getDate() + 6)\n\n    const prevWeekStart = new Date(weekStart)\n    prevWeekStart.setDate(weekStart.getDate() - 7)\n\n    const prevWeekEnd = new Date(weekStart)\n    prevWeekEnd.setDate(weekStart.getDate() - 1)\n\n    const twoWeeksAgo = new Date(currentDate)\n    twoWeeksAgo.setDate(currentDate.getDate() - 13)\n\n    return {\n      thisWeekStart: weekStart,\n      thisWeekEnd: weekEnd,\n      lastWeekStart: prevWeekStart,\n      lastWeekEnd: prevWeekEnd,\n      twoWeeksStart: twoWeeksAgo,\n      now: currentDate\n    }\n  }, [])\n\n  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¡ãƒ¢åŒ–\n  const thisWeekFilters = useMemo(() => ({\n    storeId,\n    dateFrom: thisWeekStart.toISOString().split('T')[0],\n    dateTo: thisWeekEnd.toISOString().split('T')[0]\n  }), [storeId, thisWeekStart, thisWeekEnd])\n\n  const lastWeekFilters = useMemo(() => ({\n    storeId,\n    dateFrom: lastWeekStart.toISOString().split('T')[0],\n    dateTo: lastWeekEnd.toISOString().split('T')[0]\n  }), [storeId, lastWeekStart, lastWeekEnd])\n\n  const twoWeeksFilters = useMemo(() => ({\n    storeId,\n    dateFrom: twoWeeksStart.toISOString().split('T')[0],\n    dateTo: now.toISOString().split('T')[0]\n  }), [storeId, twoWeeksStart, now])\n\n  const monthFilters = useMemo(() => ({\n    storeId,\n    dateFrom: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n    dateTo: new Date().toISOString().split('T')[0]\n  }), [storeId])\n\n  const { data: thisWeekReports, isLoading, isError, error, refetch } = useReports(thisWeekFilters)\n  const { data: lastWeekReports } = useReports(lastWeekFilters)\n  const { data: twoWeeksReports } = useReports(twoWeeksFilters)\n  const { data: monthReports } = useReports(monthFilters)\n\n  const thisWeekKpis = useKpis(thisWeekReports, lastWeekReports)\n  const monthKpis = useKpis(monthReports)\n\n  // åº—èˆ—ã¾ãŸã¯allåº—èˆ—ã®ç›®æ¨™ã‚’å–å¾—\n  const currentTarget = useMemo(() => {\n    if (storeId === 'all') {\n      return getAllStoresTarget()\n    } else {\n      const target = getTargetForStore(storeId)\n      return target ? {\n        targetSales: target.targetSales,\n        targetProfit: target.targetProfit,\n        targetProfitMargin: target.targetProfitMargin,\n        targetCostRate: target.targetCostRate,\n        targetLaborRate: target.targetLaborRate\n      } : null\n    }\n  }, [storeId, getTargetForStore, getAllStoresTarget])\n\n  // ãã®ä»–çµŒè²»ã‚’è¨ˆç®—ï¼ˆäººä»¶è²»ã‚’é™¤ãï¼‰\n  const otherExpenses = useMemo(() => {\n    return thisWeekReports.reduce((sum, report) => {\n      return sum + report.utilities + report.promotion + report.cleaning +\n             report.misc + report.communication + report.others +\n             (report.rent || 0) + (report.consumables || 0)\n    }, 0)\n  }, [thisWeekReports])\n\n  // ä»Šé€±ã®çµŒè²»ã‚’è¨ˆç®—ï¼ˆä»•å…¥+ãã®ä»–çµŒè²»ï¼‰\n  const weekExpenses = useMemo(() => {\n    return thisWeekKpis.purchaseTotal + otherExpenses\n  }, [thisWeekKpis.purchaseTotal, otherExpenses])\n\n  // å–¶æ¥­åˆ©ç›Šã‚’è¨ˆç®—ï¼ˆç²—åˆ©ç›Š - ãã®ä»–çµŒè²»ï¼‰\n  const operatingProfit = useMemo(() => {\n    return thisWeekKpis.grossProfit - otherExpenses\n  }, [thisWeekKpis.grossProfit, otherExpenses])\n\n  // FLã‚³ã‚¹ãƒˆï¼ˆä»•å…¥+äººä»¶è²»ï¼‰ã‚’è¨ˆç®—\n  const flCost = useMemo(() => {\n    return thisWeekKpis.purchaseTotal + thisWeekKpis.laborTotal\n  }, [thisWeekKpis.purchaseTotal, thisWeekKpis.laborTotal])\n\n  // é€±æ¬¡ç›®æ¨™ã‚’è¨ˆç®—ï¼ˆæœˆæ¬¡ç›®æ¨™ã‚’é€±æ›ç®—ï¼‰\n  const weeklyTargets = useMemo(() => {\n    if (!currentTarget) return null\n    const weeksInMonth = 4.33\n    return {\n      targetSales: currentTarget.targetSales / weeksInMonth,\n      targetFLCost: (currentTarget.targetSales / weeksInMonth) * ((currentTarget.targetCostRate + currentTarget.targetLaborRate) / 100),\n      targetOperatingProfit: (currentTarget.targetSales / weeksInMonth) * (currentTarget.targetProfitMargin / 100)\n    }\n  }, [currentTarget])\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <Skeleton key={i} className=\"h-32\" />\n          ))}\n        </div>\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Skeleton className=\"h-96\" />\n          <Skeleton className=\"h-96\" />\n        </div>\n        <Skeleton className=\"h-64\" />\n      </div>\n    )\n  }\n\n  if (isError && error) {\n    return (\n      <ErrorState\n        title=\"ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ\"\n        message={error}\n        onRetry={refetch}\n      />\n    )\n  }\n\n  if (monthReports.length === 0) {\n    return (\n      <EmptyState\n        icon={FileText}\n        title=\"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“\"\n        description=\"æ—¥æ¬¡å ±å‘Šã‚’ä½œæˆã™ã‚‹ã¨ã€ã“ã“ã«é€±æ¬¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\"\n        action={{\n          label: \"ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\",\n          onClick: () => window.location.reload()\n        }}\n      />\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground mb-2\">\n          é€±æ¬¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰\n          {storeId === 'all' && (\n            <Badge variant=\"default\" className=\"ml-2 bg-blue-600\">\n              å…¨åº—èˆ—é›†è¨ˆ\n            </Badge>\n          )}\n        </h1>\n        <p className=\"text-muted-foreground\">\n          åˆ†ææœŸé–“: {thisWeekStart.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })} ã€œ {thisWeekEnd.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}\n        </p>\n        <p className=\"text-muted-foreground text-sm\">\n          {storeId === 'all'\n            ? 'å…¨ç™»éŒ²åº—èˆ—ã®ä»Šé€±ã®æ¥­ç¸¾ã¨éå»30æ—¥é–“ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆåˆè¨ˆå€¤ï¼‰'\n            : 'ä»Šé€±ã®æ¥­ç¸¾ã¨éå»30æ—¥é–“ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ'\n          }\n        </p>\n      </div>\n\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <MetricCard\n          label=\"ä»Šé€±ã®å£²ä¸Š\"\n          value={formatCurrency(thisWeekKpis.totalSales)}\n          delta={thisWeekKpis.salesGrowth !== undefined ? {\n            value: thisWeekKpis.salesGrowth,\n            isPositive: thisWeekKpis.salesGrowth >= 0,\n            label: \"å…ˆé€±æ¯”\"\n          } : undefined}\n          icon={TrendingUp}\n          tone=\"info\"\n          hint={`${thisWeekKpis.reportCount}ä»¶ã®å ±å‘Š`}\n          details={thisWeekKpis.totalCustomers > 0 ? [\n            { label: 'å¹³å‡å®¢å˜ä¾¡', value: formatCurrency(thisWeekKpis.averageTicket) },\n            { label: 'å®¢æ•°', value: `${thisWeekKpis.totalCustomers.toLocaleString()}äºº` }\n          ] : [\n            { label: 'å®¢æ•°ãƒ‡ãƒ¼ã‚¿', value: 'æœªå…¥åŠ›' }\n          ]}\n        />\n\n        <MetricCard\n          label=\"ä»Šé€±ã®çµŒè²»\"\n          value={formatCurrency(weekExpenses)}\n          icon={Wallet}\n          tone=\"danger\"\n          hint=\"ä»•å…¥+ãã®ä»–çµŒè²»\"\n          details={[\n            { label: 'ä»•å…¥', value: `${formatCurrency(thisWeekKpis.purchaseTotal)} (${formatPercent(thisWeekKpis.purchaseRate)})` },\n            { label: 'ãã®ä»–çµŒè²»', value: formatCurrency(otherExpenses) }\n          ]}\n        />\n\n        <MetricCard\n          label=\"ä»Šé€±ã®ç²—åˆ©ç›Š\"\n          value={formatCurrency(thisWeekKpis.grossProfit)}\n          icon={PiggyBank}\n          tone={thisWeekKpis.grossProfit >= 0 ? \"success\" : \"danger\"}\n          hint=\"å£²ä¸Š - ä»•å…¥\"\n          details={[\n            { label: 'åŸä¾¡ç‡', value: formatPercent(thisWeekKpis.purchaseRate) },\n            { label: 'ç²—åˆ©ç‡', value: formatPercent(100 - thisWeekKpis.purchaseRate) }\n          ]}\n        />\n\n        <MetricCard\n          label=\"ä»Šé€±ã®å–¶æ¥­åˆ©ç›Š\"\n          value={formatCurrency(operatingProfit)}\n          delta={thisWeekKpis.profitGrowth !== undefined ? {\n            value: thisWeekKpis.profitGrowth,\n            isPositive: thisWeekKpis.profitGrowth >= 0,\n            label: \"å…ˆé€±æ¯”\"\n          } : undefined}\n          icon={Percent}\n          tone={operatingProfit >= 0 ? \"success\" : \"danger\"}\n          hint={`åˆ©ç›Šç‡ ${formatPercent(thisWeekKpis.totalSales > 0 ? (operatingProfit / thisWeekKpis.totalSales) * 100 : 0)}`}\n          details={[\n            { label: 'ç²—åˆ©ç›Š', value: formatCurrency(thisWeekKpis.grossProfit) },\n            { label: 'ãã®ä»–çµŒè²»', value: formatCurrency(otherExpenses) }\n          ]}\n        />\n      </div>\n\n      {/* Charts */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <SalesChart\n          reports={monthReports}\n          period=\"weekly\"\n          targetSales={thisWeekKpis.averageDailySales * 7 * 1.15} // 15% above weekly average\n          expenseBaseline={expenseBaseline}\n        />\n        <ExpensePie\n          reports={twoWeeksReports}\n          period=\"weekly\"\n          title=\"éå»2é€±é–“ã®çµŒè²»å†…è¨³\"\n          expenseBaseline={expenseBaseline}\n          daysCount={14}\n        />\n      </div>\n\n      {/* Data Table */}\n      <DataTable reports={monthReports} period=\"weekly\" groupByStore={false} baselineMap={new Map()} />\n    </div>\n  )\n}",
  "src/pages/InvitationAccept.tsx": "import React, { useState, useEffect } from 'react'\nimport { useParams, useNavigate } from 'react-router-dom'\nimport { Card, CardContent } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Building, CheckCircle, XCircle, AlertTriangle, Loader } from 'lucide-react'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { getInvitationByToken, acceptInvitation } from '@/services/organizationService'\n\ninterface Invitation {\n  id: string\n  email: string\n  role: string\n  token: string\n  status: string\n  expires_at: string\n  organization: {\n    id: string\n    name: string\n    slug: string\n  }\n}\n\nexport const InvitationAccept: React.FC = () => {\n  const { token } = useParams<{ token: string }>()\n  const navigate = useNavigate()\n  const { user, isAuthenticated } = useAuth()\n  const [invitation, setInvitation] = useState<Invitation | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [accepting, setAccepting] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [success, setSuccess] = useState(false)\n\n  useEffect(() => {\n    if (token) {\n      loadInvitation()\n    }\n  }, [token])\n\n  const loadInvitation = async () => {\n    if (!token) return\n\n    try {\n      setLoading(true)\n      setError(null)\n\n      const { data, error: fetchError } = await getInvitationByToken(token)\n\n      if (fetchError || !data) {\n        setError('æ‹›å¾…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒªãƒ³ã‚¯ãŒç„¡åŠ¹ã‹ã€æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚')\n        return\n      }\n\n      if (new Date(data.expires_at) < new Date()) {\n        setError('ã“ã®æ‹›å¾…ã¯æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™')\n        return\n      }\n\n      setInvitation(data as Invitation)\n    } catch (err) {\n      setError('æ‹›å¾…æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleAccept = async () => {\n    if (!token || !user?.id || !invitation) return\n\n    try {\n      setAccepting(true)\n      setError(null)\n\n      const { data, error: acceptError } = await acceptInvitation(token, user.id)\n\n      if (acceptError) {\n        setError(acceptError.message || 'æ‹›å¾…ã®æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n\n      if (data) {\n        setSuccess(true)\n        setTimeout(() => {\n          navigate('/dashboard/daily')\n        }, 2000)\n      }\n    } catch (err) {\n      setError('æ‹›å¾…ã®æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setAccepting(false)\n    }\n  }\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"p-8\">\n            <div className=\"text-center\">\n              <AlertTriangle className=\"w-12 h-12 text-yellow-500 mx-auto mb-4\" />\n              <h2 className=\"text-xl font-bold text-slate-900 mb-2\">ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h2>\n              <p className=\"text-slate-600 mb-6\">\n                æ‹›å¾…ã‚’æ‰¿èªã™ã‚‹ã«ã¯ã€ã¾ãšãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„\n              </p>\n              <Button\n                onClick={() => navigate('/login')}\n                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white\"\n              >\n                ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"p-8\">\n            <div className=\"text-center\">\n              <Loader className=\"w-12 h-12 text-blue-600 mx-auto mb-4 animate-spin\" />\n              <p className=\"text-slate-600\">æ‹›å¾…æƒ…å ±ã‚’ç¢ºèªã—ã¦ã„ã¾ã™...</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"p-8\">\n            <div className=\"text-center\">\n              <XCircle className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\n              <h2 className=\"text-xl font-bold text-slate-900 mb-2\">ã‚¨ãƒ©ãƒ¼</h2>\n              <p className=\"text-slate-600 mb-6\">{error}</p>\n              <Button\n                onClick={() => navigate('/dashboard/daily')}\n                className=\"w-full bg-slate-600 hover:bg-slate-700 text-white\"\n              >\n                ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸æˆ»ã‚‹\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  if (success) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"p-8\">\n            <div className=\"text-center\">\n              <CheckCircle className=\"w-12 h-12 text-green-500 mx-auto mb-4\" />\n              <h2 className=\"text-xl font-bold text-slate-900 mb-2\">æ‹›å¾…ã‚’æ‰¿èªã—ã¾ã—ãŸ</h2>\n              <p className=\"text-slate-600 mb-2\">\n                {invitation?.organization.name} ã®ãƒ¡ãƒ³ãƒãƒ¼ã«ãªã‚Šã¾ã—ãŸ\n              </p>\n              <p className=\"text-sm text-slate-500\">\n                ã¾ã‚‚ãªããƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ç§»å‹•ã—ã¾ã™...\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 flex items-center justify-center p-6\">\n      <Card className=\"max-w-md w-full\">\n        <CardContent className=\"p-8\">\n          <div className=\"text-center mb-6\">\n            <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4\">\n              <Building className=\"w-8 h-8 text-white\" />\n            </div>\n            <h2 className=\"text-2xl font-bold text-slate-900 mb-2\">çµ„ç¹”ã¸ã®æ‹›å¾…</h2>\n            <p className=\"text-slate-600\">\n              {invitation?.organization.name} ã«æ‹›å¾…ã•ã‚Œã¦ã„ã¾ã™\n            </p>\n          </div>\n\n          <div className=\"bg-slate-50 border border-slate-200 rounded-lg p-4 mb-6\">\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-600\">çµ„ç¹”å:</span>\n                <span className=\"font-medium text-slate-900\">{invitation?.organization.name}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-600\">å½¹å‰²:</span>\n                <span className=\"font-medium text-slate-900\">\n                  {invitation?.role === 'admin' ? 'ç®¡ç†è€…' : 'ãƒ¡ãƒ³ãƒãƒ¼'}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-600\">æ‹›å¾…å…ˆ:</span>\n                <span className=\"font-medium text-slate-900\">{invitation?.email}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-slate-600\">æœ‰åŠ¹æœŸé™:</span>\n                <span className=\"font-medium text-slate-900\">\n                  {invitation?.expires_at &&\n                    new Date(invitation.expires_at).toLocaleDateString('ja-JP')}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-3\">\n            <Button\n              onClick={handleAccept}\n              disabled={accepting}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white\"\n            >\n              {accepting ? (\n                <>\n                  <Loader className=\"w-4 h-4 mr-2 animate-spin\" />\n                  æ‰¿èªä¸­...\n                </>\n              ) : (\n                'æ‹›å¾…ã‚’æ‰¿èªã™ã‚‹'\n              )}\n            </Button>\n\n            <Button\n              onClick={() => navigate('/dashboard/daily')}\n              disabled={accepting}\n              className=\"w-full bg-slate-200 hover:bg-slate-300 text-slate-700\"\n            >\n              ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n            </Button>\n          </div>\n\n          <p className=\"text-xs text-slate-500 text-center mt-6\">\n            æ‹›å¾…ã‚’æ‰¿èªã™ã‚‹ã¨ã€ã“ã®çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ãªã‚Šã€çµ„ç¹”ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
  "src/pages/MonthlyExpenseForm.tsx": "import React, { useEffect, useMemo, useState } from 'react'\nimport { useNavigate, useSearchParams } from 'react-router-dom'\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { cn } from '@/lib/utils'\nimport { formatCurrency } from '@/lib/format'\nimport { CircleCheck as CheckCircle, Save } from 'lucide-react'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { useAdminData } from '@/contexts/AdminDataContext'\nimport { upsertMonthlyExpense, getMonthlyExpenses } from '@/services/supabase'\n\ntype MonthlyExpense = {\n  id: string\n  storeId: string\n  month: string // 'YYYY-MM'\n  laborCostEmployee: number\n  laborCostPartTime: number\n  utilities: number\n  rent: number\n  consumables: number\n  promotion: number\n  cleaning: number\n  misc: number\n  communication: number\n  others: number\n  memo?: string\n  createdAt: string\n  updatedAt: string\n}\n\nconst numAttr = { inputMode: 'numeric' as const, pattern: '[0-9]*' }\nconst thisMonth = () => new Date().toISOString().slice(0, 7) // YYYY-MM\n\nexport const MonthlyExpenseForm: React.FC = () => {\n  const [params] = useSearchParams()\n  const navigate = useNavigate()\n  const { user, getAccessibleStores } = useAuth()\n  const { stores: adminStores } = useAdminData()\n\n  const getInitialStoreId = () => {\n    const paramStore = params.get('store')\n    if (paramStore && paramStore !== 'all') {\n      const accessibleStores = getAccessibleStores()\n      const storeExists = accessibleStores.find(s => s.id === paramStore)\n      if (storeExists) return paramStore\n    }\n    const accessibleStores = getAccessibleStores()\n    return accessibleStores.length > 0 ? accessibleStores[0].id : ''\n  }\n\n  const initialMonth = params.get('month') || thisMonth()\n\n  const [form, setForm] = useState<MonthlyExpense>({\n    id: '',\n    storeId: '',\n    month: initialMonth,\n    laborCostEmployee: 0,\n    laborCostPartTime: 0,\n    utilities: 0,\n    rent: 0,\n    consumables: 0,\n    promotion: 0,\n    cleaning: 0,\n    misc: 0,\n    communication: 0,\n    others: 0,\n    memo: '',\n    createdAt: '',\n    updatedAt: ''\n  })\n  const [saved, setSaved] = useState<null | 'ok'>(null)\n\n  useEffect(() => {\n    if (!form.storeId && user) {\n      const initialStoreId = getInitialStoreId()\n      setForm(f => ({ ...f, storeId: initialStoreId }))\n    }\n  }, [user])\n\n  // Supabaseã‹ã‚‰æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰\n  useEffect(() => {\n    const fetchExistingData = async () => {\n      if (!user || !form.storeId || !form.month) return\n      \n      try {\n        const { data, error } = await getMonthlyExpenses({\n          storeId: form.storeId,\n          month: form.month,\n          userId: user.id\n        })\n        \n        if (!error && data && data.length > 0) {\n          const existing = data[0]\n          setForm({\n            id: existing.id,\n            storeId: existing.store_id,\n            month: existing.month,\n            laborCostEmployee: existing.labor_cost_employee,\n            laborCostPartTime: existing.labor_cost_part_time,\n            utilities: existing.utilities,\n            rent: existing.rent || 0,\n            consumables: existing.consumables || 0,\n            promotion: existing.promotion,\n            cleaning: existing.cleaning,\n            misc: existing.misc,\n            communication: existing.communication,\n            others: existing.others,\n            memo: existing.memo || '',\n            createdAt: existing.created_at || '',\n            updatedAt: existing.updated_at || ''\n          })\n        } else {\n          // æ–°è¦ä½œæˆã®å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ\n          setForm(f => ({ \n            ...f, \n            id: '', \n            laborCostEmployee: 0,\n            laborCostPartTime: 0,\n            utilities: 0,\n            rent: 0,\n            consumables: 0,\n            promotion: 0,\n            cleaning: 0,\n            misc: 0,\n            communication: 0,\n            others: 0,\n            memo: '' \n          }))\n        }\n      } catch (err) {\n        console.error('âŒ æœˆæ¬¡çµŒè²»ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', err)\n      }\n    }\n    \n    fetchExistingData()\n  }, [form.storeId, form.month, user])\n\n  const total = form.laborCostEmployee + form.laborCostPartTime + form.utilities + form.rent + form.consumables + form.promotion + form.cleaning + form.misc + form.communication + form.others\n\n  const setN = (key: keyof MonthlyExpense, val: number) =>\n    setForm(f => ({ ...f, [key]: Math.max(0, Math.round(val)) }))\n\n  const save = async () => {\n    if (!user) {\n      alert('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™')\n      return\n    }\n\n    if (!form.storeId || form.storeId === 'all') {\n      alert('åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„')\n      return\n    }\n    \n    try {\n      const expenseData = {\n        store_id: form.storeId,\n        user_id: user.id,\n        month: form.month,\n        labor_cost_employee: form.laborCostEmployee,\n        labor_cost_part_time: form.laborCostPartTime,\n        utilities: form.utilities,\n        rent: form.rent,\n        consumables: form.consumables,\n        promotion: form.promotion,\n        cleaning: form.cleaning,\n        misc: form.misc,\n        communication: form.communication,\n        others: form.others,\n        memo: form.memo\n      }\n      \n      const { data, error } = await upsertMonthlyExpense(expenseData)\n      \n      if (error) {\n        throw new Error(error.message)\n      }\n      \n      setSaved('ok')\n      setTimeout(() => setSaved(null), 2000)\n      \n    } catch (err) {\n      console.error('âŒ æœˆæ¬¡çµŒè²»ä¿å­˜ã‚¨ãƒ©ãƒ¼:', err)\n      alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (err instanceof Error ? err.message : 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'))\n    }\n  }\n\n  const storeOptions = useMemo(() => {\n    let accessibleStores = getAccessibleStores()\n\n    // ã‚‚ã— accessibleStores ãŒç©ºã§ã€AdminDataContext ã« stores ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ã†\n    if (accessibleStores.length === 0 && user?.role === 'admin' && adminStores.length > 0) {\n      accessibleStores = adminStores.map(s => ({ id: s.id, name: s.name }))\n    }\n\n    return accessibleStores.map(store => ({\n      id: store.id,\n      name: store.name,\n      disabled: false\n    }))\n  }, [getAccessibleStores, user?.role, adminStores])\n\n  return (\n    <div className=\"max-w-2xl mx-auto space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-2xl font-bold\">æœˆæ¬¡çµŒè²»å…¥åŠ›</h1>\n        <Badge>Demo / Local</Badge>\n      </div>\n\n      <Card>\n        <CardHeader><CardTitle>å¯¾è±¡</CardTitle></CardHeader>\n        <CardContent className=\"grid grid-cols-2 gap-3\">\n          <div>\n            <label className=\"block text-xs text-muted-foreground mb-1\">åº—èˆ—</label>\n            <select\n              value={form.storeId}\n              onChange={(e)=>setForm(f=>({...f, storeId: e.target.value }))}\n              className=\"w-full px-3 py-2 rounded border border-input bg-background\">\n              {storeOptions.map(s=>(\n                <option key={s.id} value={s.id} disabled={(s as any).disabled}>\n                  {'name' in s ? (s as any).name : s}\n                </option>\n              ))}\n            </select>\n          </div>\n          <div>\n            <label className=\"block text-xs text-muted-foreground mb-1\">å¯¾è±¡æœˆ</label>\n            <input\n              type=\"month\"\n              value={form.month}\n              onChange={(e)=>setForm(f=>({...f, month: e.target.value }))}\n              className=\"w-full px-3 py-2 rounded border border-input bg-background\" />\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>é‡‘é¡å…¥åŠ›ï¼ˆ1ãƒ¶æœˆåˆ†ãƒ»ç¨è¾¼ã¿æƒ³å®šï¼‰</CardTitle>\n          <div className=\"text-sm text-muted-foreground mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg\">\n            ğŸ’¡ <strong>äººä»¶è²»ã«ã¤ã„ã¦ï¼š</strong>æ—¥å ±ã§å…¥åŠ›ã•ã‚Œã‚‹äººä»¶è²»ã¯æƒ³å®šå€¤ã§ã™ã€‚æœˆæœ«ã«ã“ã¡ã‚‰ã§æ­£å¼ãªé‡‘é¡ã«ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          {[\n            ['laborCostEmployee','äººä»¶è²»ï¼ˆç¤¾å“¡ï¼‰'],\n            ['laborCostPartTime','äººä»¶è²»ï¼ˆã‚¢ãƒ«ãƒã‚¤ãƒˆï¼‰'],\n            ['utilities','æ°´é“å…‰ç†±è²»'],\n            ['rent','è³ƒæ–™'],\n            ['consumables','æ¶ˆè€—å“è²»'],\n            ['promotion','è²©ä¿ƒè²»'],\n            ['cleaning','æ¸…æƒè²»'],\n            ['misc','é›‘è²»'],\n            ['communication','é€šä¿¡è²»'],\n            ['others','ãã®ä»–'], // å®¶è³ƒãªã©å›ºå®šè²»\n          ].map(([key,label]) => (\n            <div key={key} className=\"flex items-center gap-2\">\n              <div className=\"w-24 text-sm text-muted-foreground\">{label}</div>\n              <div className=\"flex-1\">\n                <input {...numAttr}\n                  value={(form as any)[key] || ''}\n                  onChange={(e)=>setN(key as keyof MonthlyExpense, Number(e.target.value.replace(/[^0-9]/g,''))||0)}\n                  placeholder=\"0\"\n                  className=\"w-full px-3 py-2 rounded border border-input bg-background text-right\" />\n              </div>\n              <div className=\"text-sm w-28 text-right text-muted-foreground\">{formatCurrency((form as any)[key] || 0)}</div>\n            </div>\n          ))}\n          <div className=\"pt-3 border-t border-border flex justify-between text-sm\">\n            <span className=\"text-muted-foreground\">åˆè¨ˆ</span>\n            <span className=\"font-semibold\">{formatCurrency(total)}</span>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader><CardTitle>ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</CardTitle></CardHeader>\n        <CardContent>\n          <textarea\n            value={form.memo || ''}\n            onChange={(e)=>setForm(f=>({...f, memo: e.target.value }))}\n            placeholder=\"ä¾‹ï¼šå®¶è³ƒãƒ»ASPåˆ©ç”¨æ–™ã‚’å«ã‚€ã€‚\"\n            className=\"w-full px-3 py-2 rounded border border-input bg-background min-h-24\"\n          />\n        </CardContent>\n      </Card>\n\n      <div className=\"flex gap-3\">\n        <Button className=\"flex-1\" onClick={save} disabled={form.storeId==='all'}>\n          <Save className=\"h-4 w-4 mr-2\" />\n          ä¿å­˜\n        </Button>\n        <Button variant=\"outline\" className=\"w-36\" onClick={()=>navigate('/dashboard/monthly')}>\n          æœˆæ¬¡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸\n        </Button>\n      </div>\n\n      {saved && (\n        <div className={cn('flex items-center gap-2 text-sm text-green-600')}>\n          <CheckCircle className=\"h-4 w-4\" />\n          ä¿å­˜ã—ã¾ã—ãŸã€‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«åæ˜ ã•ã‚Œã¾ã™ã€‚\n        </div>\n      )}\n    </div>\n  )\n}",
  "src/pages/OrganizationSettings.tsx": "import React, { useState, useEffect } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Building, Users, CreditCard, Save, AlertCircle, CheckCircle } from 'lucide-react'\nimport { useAuth } from '@/contexts/AuthContext'\nimport {\n  getOrganization,\n  updateOrganization,\n  getCurrentUserOrganizationId\n} from '@/services/organizationService'\nimport { OrganizationMembers } from '@/components/Organization/OrganizationMembers'\nimport { SubscriptionInfo } from '@/components/Organization/SubscriptionInfo'\nimport { UsageOverview } from '@/components/Usage/UsageOverview'\n\ninterface Organization {\n  id: string\n  name: string\n  slug: string\n  email: string\n  phone?: string\n  subscription_status: string\n  subscription_plan: string\n  trial_ends_at?: string\n  max_stores: number\n  max_users: number\n  max_ai_requests_per_month: number\n  created_at?: string\n  updated_at?: string\n}\n\nexport const OrganizationSettings: React.FC = () => {\n  const { user } = useAuth()\n  const [organization, setOrganization] = useState<Organization | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [success, setSuccess] = useState<string | null>(null)\n  const [activeTab, setActiveTab] = useState<'general' | 'members' | 'subscription'>('general')\n\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    phone: ''\n  })\n\n  useEffect(() => {\n    if (user?.id) {\n      loadOrganization()\n    }\n  }, [user?.id])\n\n  const loadOrganization = async () => {\n    if (!user?.id) return\n\n    try {\n      setLoading(true)\n      setError(null)\n\n      const organizationId = await getCurrentUserOrganizationId(user.id)\n      if (!organizationId) {\n        setError('çµ„ç¹”ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')\n        return\n      }\n\n      const { data, error: fetchError } = await getOrganization(organizationId)\n      if (fetchError) {\n        setError('çµ„ç¹”æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n\n      if (data) {\n        setOrganization(data)\n        setFormData({\n          name: data.name,\n          email: data.email,\n          phone: data.phone || ''\n        })\n      }\n    } catch (err) {\n      setError('çµ„ç¹”æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData(prev => ({\n      ...prev,\n      [e.target.name]: e.target.value\n    }))\n    setError(null)\n    setSuccess(null)\n  }\n\n  const handleSave = async () => {\n    if (!organization) return\n\n    try {\n      setSaving(true)\n      setError(null)\n      setSuccess(null)\n\n      const { data, error: updateError } = await updateOrganization(organization.id, {\n        name: formData.name,\n        email: formData.email,\n        phone: formData.phone\n      })\n\n      if (updateError) {\n        setError('çµ„ç¹”æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ')\n        return\n      }\n\n      if (data) {\n        setOrganization(data)\n        setSuccess('çµ„ç¹”æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ')\n      }\n    } catch (err) {\n      setError('çµ„ç¹”æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 p-6 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n          <p className=\"text-slate-600\">èª­ã¿è¾¼ã¿ä¸­...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (!organization) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 p-6 flex items-center justify-center\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <AlertCircle className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\n              <p className=\"text-slate-700\">çµ„ç¹”æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 p-6\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-3xl font-bold text-slate-900 mb-2\">çµ„ç¹”è¨­å®š</h1>\n          <p className=\"text-slate-600\">çµ„ç¹”ã®æƒ…å ±ã‚„ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç®¡ç†ã—ã¾ã™</p>\n        </div>\n\n        <div className=\"mb-6 border-b border-slate-200\">\n          <div className=\"flex gap-4\">\n            <button\n              onClick={() => setActiveTab('general')}\n              className={`px-4 py-3 font-medium transition-colors relative ${\n                activeTab === 'general'\n                  ? 'text-blue-600'\n                  : 'text-slate-600 hover:text-slate-900'\n              }`}\n            >\n              <Building className=\"w-4 h-4 inline mr-2\" />\n              åŸºæœ¬æƒ…å ±\n              {activeTab === 'general' && (\n                <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600\"></div>\n              )}\n            </button>\n            <button\n              onClick={() => setActiveTab('members')}\n              className={`px-4 py-3 font-medium transition-colors relative ${\n                activeTab === 'members'\n                  ? 'text-blue-600'\n                  : 'text-slate-600 hover:text-slate-900'\n              }`}\n            >\n              <Users className=\"w-4 h-4 inline mr-2\" />\n              ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†\n              {activeTab === 'members' && (\n                <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600\"></div>\n              )}\n            </button>\n            <button\n              onClick={() => setActiveTab('subscription')}\n              className={`px-4 py-3 font-medium transition-colors relative ${\n                activeTab === 'subscription'\n                  ? 'text-blue-600'\n                  : 'text-slate-600 hover:text-slate-900'\n              }`}\n            >\n              <CreditCard className=\"w-4 h-4 inline mr-2\" />\n              ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³\n              {activeTab === 'subscription' && (\n                <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600\"></div>\n              )}\n            </button>\n          </div>\n        </div>\n\n        {activeTab === 'general' && (\n          <Card>\n            <CardHeader>\n              <CardTitle>åŸºæœ¬æƒ…å ±</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {error && (\n                <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2\">\n                  <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\n                  <p className=\"text-sm text-red-800\">{error}</p>\n                </div>\n              )}\n\n              {success && (\n                <div className=\"p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-2\">\n                  <CheckCircle className=\"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5\" />\n                  <p className=\"text-sm text-green-800\">{success}</p>\n                </div>\n              )}\n\n              <div>\n                <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                  çµ„ç¹”å\n                </label>\n                <input\n                  type=\"text\"\n                  name=\"name\"\n                  value={formData.name}\n                  onChange={handleInputChange}\n                  className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  placeholder=\"æ ªå¼ä¼šç¤¾ã€‡ã€‡\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                  çµ„ç¹”ã‚¹ãƒ©ãƒƒã‚°\n                </label>\n                <input\n                  type=\"text\"\n                  value={organization.slug}\n                  disabled\n                  className=\"w-full px-4 py-2 border border-slate-200 rounded-lg bg-slate-50 text-slate-500\"\n                />\n                <p className=\"text-xs text-slate-500 mt-1\">\n                  çµ„ç¹”ã®ä¸€æ„ãªè­˜åˆ¥å­ã§ã™ï¼ˆå¤‰æ›´ä¸å¯ï¼‰\n                </p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹\n                </label>\n                <input\n                  type=\"email\"\n                  name=\"email\"\n                  value={formData.email}\n                  onChange={handleInputChange}\n                  className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  placeholder=\"info@example.com\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-slate-700 mb-2\">\n                  é›»è©±ç•ªå·ï¼ˆä»»æ„ï¼‰\n                </label>\n                <input\n                  type=\"tel\"\n                  name=\"phone\"\n                  value={formData.phone}\n                  onChange={handleInputChange}\n                  className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  placeholder=\"03-1234-5678\"\n                />\n              </div>\n\n              <div className=\"pt-4\">\n                <Button\n                  onClick={handleSave}\n                  disabled={saving}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                >\n                  {saving ? (\n                    <>\n                      <span className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2\"></span>\n                      ä¿å­˜ä¸­...\n                    </>\n                  ) : (\n                    <>\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      å¤‰æ›´ã‚’ä¿å­˜\n                    </>\n                  )}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {activeTab === 'members' && (\n          <OrganizationMembers organizationId={organization.id} />\n        )}\n\n        {activeTab === 'subscription' && (\n          <div className=\"space-y-6\">\n            <UsageOverview />\n            <SubscriptionInfo organization={organization} onUpdate={loadOrganization} />\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n",
  "src/pages/PrivacyPolicy.tsx": "import React from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { ArrowLeft, Shield } from 'lucide-react'\nimport { useNavigate } from 'react-router-dom'\n\nexport const PrivacyPolicy: React.FC = () => {\n  const navigate = useNavigate()\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 py-8\">\n      <div className=\"max-w-4xl mx-auto px-4\">\n        <Button\n          onClick={() => navigate(-1)}\n          className=\"mb-6 bg-slate-600 hover:bg-slate-700 text-white\"\n        >\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          æˆ»ã‚‹\n        </Button>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-3 text-2xl\">\n              <Shield className=\"w-6 h-6\" />\n              ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼\n            </CardTitle>\n            <p className=\"text-sm text-slate-600 mt-2\">æœ€çµ‚æ›´æ–°æ—¥: 2025å¹´10æœˆ11æ—¥</p>\n          </CardHeader>\n\n          <CardContent className=\"prose prose-slate max-w-none\">\n            <section className=\"mb-8\">\n              <p className=\"text-slate-700 leading-relaxed\">\n                å½“ç¤¾ã¯ã€å½“ç¤¾ãŒæä¾›ã™ã‚‹ã€ŒAIçµŒå–¶ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€ï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ã¨ã„ã„ã¾ã™ï¼‰ã«ãŠã‘ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººæƒ…å ±ã®å–æ‰±ã„ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®ã¨ãŠã‚Šãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ï¼ˆä»¥ä¸‹ã€Œæœ¬ãƒãƒªã‚·ãƒ¼ã€ã¨ã„ã„ã¾ã™ï¼‰ã‚’å®šã‚ã¾ã™ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬1æ¡ï¼ˆå€‹äººæƒ…å ±ï¼‰</h2>\n              <p className=\"text-slate-700 leading-relaxed\">\n                ã€Œå€‹äººæƒ…å ±ã€ã¨ã¯ã€å€‹äººæƒ…å ±ä¿è­·æ³•ã«ã„ã†ã€Œå€‹äººæƒ…å ±ã€ã‚’æŒ‡ã™ã‚‚ã®ã¨ã—ã€ç”Ÿå­˜ã™ã‚‹å€‹äººã«é–¢ã™ã‚‹æƒ…å ±ã§ã‚ã£ã¦ã€å½“è©²æƒ…å ±ã«å«ã¾ã‚Œã‚‹æ°åã€ç”Ÿå¹´æœˆæ—¥ã€ä½æ‰€ã€é›»è©±ç•ªå·ã€é€£çµ¡å…ˆãã®ä»–ã®è¨˜è¿°ç­‰ã«ã‚ˆã‚Šç‰¹å®šã®å€‹äººã‚’è­˜åˆ¥ã§ãã‚‹æƒ…å ±åŠã³å®¹è²Œã€æŒ‡ç´‹ã€å£°ç´‹ã«ã‹ã‹ã‚‹ãƒ‡ãƒ¼ã‚¿ã€åŠã³å¥åº·ä¿é™ºè¨¼ã®ä¿é™ºè€…ç•ªå·ãªã©ã®å½“è©²æƒ…å ±å˜ä½“ã‹ã‚‰ç‰¹å®šã®å€‹äººã‚’è­˜åˆ¥ã§ãã‚‹æƒ…å ±ï¼ˆå€‹äººè­˜åˆ¥æƒ…å ±ï¼‰ã‚’æŒ‡ã—ã¾ã™ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬2æ¡ï¼ˆå€‹äººæƒ…å ±ã®åé›†æ–¹æ³•ï¼‰</h2>\n              <p className=\"text-slate-700 leading-relaxed mb-3\">\n                å½“ç¤¾ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨ç™»éŒ²ã‚’ã™ã‚‹éš›ã«ã€æ°åã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€é›»è©±ç•ªå·ã€ä¼šç¤¾åãªã©ã®å€‹äººæƒ…å ±ã‚’ãŠå°‹ã­ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ææºå…ˆãªã©ã¨ã®é–“ã§ãªã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººæƒ…å ±ã‚’å«ã‚€å–å¼•è¨˜éŒ²ã‚„æ±ºæ¸ˆã«é–¢ã™ã‚‹æƒ…å ±ã‚’ã€å½“ç¤¾ã®ææºå…ˆï¼ˆæƒ…å ±æä¾›å…ƒã€åºƒå‘Šä¸»ã€åºƒå‘Šé…ä¿¡å…ˆãªã©ã‚’å«ã¿ã¾ã™ã€‚ä»¥ä¸‹ã€Œææºå…ˆã€ã¨ã„ã„ã¾ã™ï¼‰ãªã©ã‹ã‚‰åé›†ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬3æ¡ï¼ˆå€‹äººæƒ…å ±ã‚’åé›†ãƒ»åˆ©ç”¨ã™ã‚‹ç›®çš„ï¼‰</h2>\n              <p className=\"text-slate-700 mb-3\">å½“ç¤¾ãŒå€‹äººæƒ…å ±ã‚’åé›†ãƒ»åˆ©ç”¨ã™ã‚‹ç›®çš„ã¯ã€ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚</p>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ãƒ»é‹å–¶ã®ãŸã‚</li>\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãŠå•ã„åˆã‚ã›ã«å›ç­”ã™ã‚‹ãŸã‚ï¼ˆæœ¬äººç¢ºèªã‚’è¡Œã†ã“ã¨ã‚’å«ã‚€ï¼‰</li>\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨ä¸­ã®ã‚µãƒ¼ãƒ“ã‚¹ã®æ–°æ©Ÿèƒ½ã€æ›´æ–°æƒ…å ±ã€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ç­‰åŠã³å½“ç¤¾ãŒæä¾›ã™ã‚‹ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã®æ¡ˆå†…ã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä»˜ã™ã‚‹ãŸã‚</li>\n                <li>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€é‡è¦ãªãŠçŸ¥ã‚‰ã›ãªã©å¿…è¦ã«å¿œã˜ãŸã”é€£çµ¡ã®ãŸã‚</li>\n                <li>åˆ©ç”¨è¦ç´„ã«é•åã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ã€ä¸æ­£ãƒ»ä¸å½“ãªç›®çš„ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç‰¹å®šã‚’ã—ã€ã”åˆ©ç”¨ã‚’ãŠæ–­ã‚Šã™ã‚‹ãŸã‚</li>\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã”è‡ªèº«ã®ç™»éŒ²æƒ…å ±ã®é–²è¦§ã‚„å¤‰æ›´ã€å‰Šé™¤ã€ã”åˆ©ç”¨çŠ¶æ³ã®é–²è¦§ã‚’è¡Œã£ã¦ã„ãŸã ããŸã‚</li>\n                <li>æœ‰æ–™ã‚µãƒ¼ãƒ“ã‚¹ã«ãŠã„ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ©ç”¨æ–™é‡‘ã‚’è«‹æ±‚ã™ã‚‹ãŸã‚</li>\n                <li>ä¸Šè¨˜ã®åˆ©ç”¨ç›®çš„ã«ä»˜éšã™ã‚‹ç›®çš„</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬4æ¡ï¼ˆåˆ©ç”¨ç›®çš„ã®å¤‰æ›´ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>å½“ç¤¾ã¯ã€åˆ©ç”¨ç›®çš„ãŒå¤‰æ›´å‰ã¨é–¢é€£æ€§ã‚’æœ‰ã™ã‚‹ã¨åˆç†çš„ã«èªã‚ã‚‰ã‚Œã‚‹å ´åˆã«é™ã‚Šã€å€‹äººæƒ…å ±ã®åˆ©ç”¨ç›®çš„ã‚’å¤‰æ›´ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n                <li>åˆ©ç”¨ç›®çš„ã®å¤‰æ›´ã‚’è¡Œã£ãŸå ´åˆã«ã¯ã€å¤‰æ›´å¾Œã®ç›®çš„ã«ã¤ã„ã¦ã€å½“ç¤¾æ‰€å®šã®æ–¹æ³•ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã—ã€ã¾ãŸã¯æœ¬ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã«å…¬è¡¨ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬5æ¡ï¼ˆå€‹äººæƒ…å ±ã®ç¬¬ä¸‰è€…æä¾›ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>å½“ç¤¾ã¯ã€æ¬¡ã«æ²ã’ã‚‹å ´åˆã‚’é™¤ã„ã¦ã€ã‚ã‚‰ã‹ã˜ã‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ„ã‚’å¾—ã‚‹ã“ã¨ãªãã€ç¬¬ä¸‰è€…ã«å€‹äººæƒ…å ±ã‚’æä¾›ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãŸã ã—ã€å€‹äººæƒ…å ±ä¿è­·æ³•ãã®ä»–ã®æ³•ä»¤ã§èªã‚ã‚‰ã‚Œã‚‹å ´åˆã‚’é™¤ãã¾ã™ã€‚\n                  <ul className=\"list-disc list-inside ml-6 mt-2 space-y-1\">\n                    <li>äººã®ç”Ÿå‘½ã€èº«ä½“ã¾ãŸã¯è²¡ç”£ã®ä¿è­·ã®ãŸã‚ã«å¿…è¦ãŒã‚ã‚‹å ´åˆã§ã‚ã£ã¦ã€æœ¬äººã®åŒæ„ã‚’å¾—ã‚‹ã“ã¨ãŒå›°é›£ã§ã‚ã‚‹ã¨ã</li>\n                    <li>å…¬è¡†è¡›ç”Ÿã®å‘ä¸Šã¾ãŸã¯å…ç«¥ã®å¥å…¨ãªè‚²æˆã®æ¨é€²ã®ãŸã‚ã«ç‰¹ã«å¿…è¦ãŒã‚ã‚‹å ´åˆã§ã‚ã£ã¦ã€æœ¬äººã®åŒæ„ã‚’å¾—ã‚‹ã“ã¨ãŒå›°é›£ã§ã‚ã‚‹ã¨ã</li>\n                    <li>å›½ã®æ©Ÿé–¢ã‚‚ã—ãã¯åœ°æ–¹å…¬å…±å›£ä½“ã¾ãŸã¯ãã®å§”è¨—ã‚’å—ã‘ãŸè€…ãŒæ³•ä»¤ã®å®šã‚ã‚‹äº‹å‹™ã‚’é‚è¡Œã™ã‚‹ã“ã¨ã«å¯¾ã—ã¦å”åŠ›ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã§ã‚ã£ã¦ã€æœ¬äººã®åŒæ„ã‚’å¾—ã‚‹ã“ã¨ã«ã‚ˆã‚Šå½“è©²äº‹å‹™ã®é‚è¡Œã«æ”¯éšœã‚’åŠã¼ã™ãŠãã‚ŒãŒã‚ã‚‹ã¨ã</li>\n                  </ul>\n                </li>\n                <li>å‰é …ã®å®šã‚ã«ã‹ã‹ã‚ã‚‰ãšã€æ¬¡ã«æ²ã’ã‚‹å ´åˆã«ã¯ã€å½“è©²æƒ…å ±ã®æä¾›å…ˆã¯ç¬¬ä¸‰è€…ã«è©²å½“ã—ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚\n                  <ul className=\"list-disc list-inside ml-6 mt-2 space-y-1\">\n                    <li>å½“ç¤¾ãŒåˆ©ç”¨ç›®çš„ã®é”æˆã«å¿…è¦ãªç¯„å›²å†…ã«ãŠã„ã¦å€‹äººæƒ…å ±ã®å–æ‰±ã„ã®å…¨éƒ¨ã¾ãŸã¯ä¸€éƒ¨ã‚’å§”è¨—ã™ã‚‹å ´åˆ</li>\n                    <li>åˆä½µãã®ä»–ã®äº‹ç”±ã«ã‚ˆã‚‹äº‹æ¥­ã®æ‰¿ç¶™ã«ä¼´ã£ã¦å€‹äººæƒ…å ±ãŒæä¾›ã•ã‚Œã‚‹å ´åˆ</li>\n                  </ul>\n                </li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬6æ¡ï¼ˆå€‹äººæƒ…å ±ã®é–‹ç¤ºï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>å½“ç¤¾ã¯ã€æœ¬äººã‹ã‚‰å€‹äººæƒ…å ±ã®é–‹ç¤ºã‚’æ±‚ã‚ã‚‰ã‚ŒãŸã¨ãã¯ã€æœ¬äººã«å¯¾ã—ã€é…æ»ãªãã“ã‚Œã‚’é–‹ç¤ºã—ã¾ã™ã€‚ãŸã ã—ã€é–‹ç¤ºã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šæ¬¡ã®ã„ãšã‚Œã‹ã«è©²å½“ã™ã‚‹å ´åˆã¯ã€ãã®å…¨éƒ¨ã¾ãŸã¯ä¸€éƒ¨ã‚’é–‹ç¤ºã—ãªã„ã“ã¨ã‚‚ã‚ã‚Šã€é–‹ç¤ºã—ãªã„æ±ºå®šã‚’ã—ãŸå ´åˆã«ã¯ã€ãã®æ—¨ã‚’é…æ»ãªãé€šçŸ¥ã—ã¾ã™ã€‚\n                  <ul className=\"list-disc list-inside ml-6 mt-2 space-y-1\">\n                    <li>æœ¬äººã¾ãŸã¯ç¬¬ä¸‰è€…ã®ç”Ÿå‘½ã€èº«ä½“ã€è²¡ç”£ãã®ä»–ã®æ¨©åˆ©åˆ©ç›Šã‚’å®³ã™ã‚‹ãŠãã‚ŒãŒã‚ã‚‹å ´åˆ</li>\n                    <li>å½“ç¤¾ã®æ¥­å‹™ã®é©æ­£ãªå®Ÿæ–½ã«è‘—ã—ã„æ”¯éšœã‚’åŠã¼ã™ãŠãã‚ŒãŒã‚ã‚‹å ´åˆ</li>\n                    <li>ãã®ä»–æ³•ä»¤ã«é•åã™ã‚‹ã“ã¨ã¨ãªã‚‹å ´åˆ</li>\n                  </ul>\n                </li>\n                <li>å‰é …ã®å®šã‚ã«ã‹ã‹ã‚ã‚‰ãšã€å±¥æ­´æƒ…å ±ãŠã‚ˆã³ç‰¹æ€§æƒ…å ±ãªã©ã®å€‹äººæƒ…å ±ä»¥å¤–ã®æƒ…å ±ã«ã¤ã„ã¦ã¯ã€åŸå‰‡ã¨ã—ã¦é–‹ç¤ºã„ãŸã—ã¾ã›ã‚“ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬7æ¡ï¼ˆå€‹äººæƒ…å ±ã®è¨‚æ­£ãŠã‚ˆã³å‰Šé™¤ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€å½“ç¤¾ã®ä¿æœ‰ã™ã‚‹è‡ªå·±ã®å€‹äººæƒ…å ±ãŒèª¤ã£ãŸæƒ…å ±ã§ã‚ã‚‹å ´åˆã«ã¯ã€å½“ç¤¾ãŒå®šã‚ã‚‹æ‰‹ç¶šãã«ã‚ˆã‚Šã€å½“ç¤¾ã«å¯¾ã—ã¦å€‹äººæƒ…å ±ã®è¨‚æ­£ã€è¿½åŠ ã¾ãŸã¯å‰Šé™¤ï¼ˆä»¥ä¸‹ã€Œè¨‚æ­£ç­‰ã€ã¨ã„ã„ã¾ã™ï¼‰ã‚’è«‹æ±‚ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</li>\n                <li>å½“ç¤¾ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰å‰é …ã®è«‹æ±‚ã‚’å—ã‘ã¦ãã®è«‹æ±‚ã«å¿œã˜ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨åˆ¤æ–­ã—ãŸå ´åˆã«ã¯ã€é…æ»ãªãã€å½“è©²å€‹äººæƒ…å ±ã®è¨‚æ­£ç­‰ã‚’è¡Œã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n                <li>å½“ç¤¾ã¯ã€å‰é …ã®è¦å®šã«åŸºã¥ãè¨‚æ­£ç­‰ã‚’è¡Œã£ãŸå ´åˆã€ã¾ãŸã¯è¨‚æ­£ç­‰ã‚’è¡Œã‚ãªã„æ—¨ã®æ±ºå®šã‚’ã—ãŸã¨ãã¯é…æ»ãªãã€ã“ã‚Œã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã—ã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬8æ¡ï¼ˆå€‹äººæƒ…å ±ã®åˆ©ç”¨åœæ­¢ç­‰ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>å½“ç¤¾ã¯ã€æœ¬äººã‹ã‚‰ã€å€‹äººæƒ…å ±ãŒã€åˆ©ç”¨ç›®çš„ã®ç¯„å›²ã‚’è¶…ãˆã¦å–ã‚Šæ‰±ã‚ã‚Œã¦ã„ã‚‹ã¨ã„ã†ç†ç”±ã€ã¾ãŸã¯ä¸æ­£ã®æ‰‹æ®µã«ã‚ˆã‚Šå–å¾—ã•ã‚ŒãŸã‚‚ã®ã§ã‚ã‚‹ã¨ã„ã†ç†ç”±ã«ã‚ˆã‚Šã€ãã®åˆ©ç”¨ã®åœæ­¢ã¾ãŸã¯æ¶ˆå»ï¼ˆä»¥ä¸‹ã€Œåˆ©ç”¨åœæ­¢ç­‰ã€ã¨ã„ã„ã¾ã™ï¼‰ã‚’æ±‚ã‚ã‚‰ã‚ŒãŸå ´åˆã«ã¯ã€é…æ»ãªãå¿…è¦ãªèª¿æŸ»ã‚’è¡Œã„ã¾ã™ã€‚</li>\n                <li>å‰é …ã®èª¿æŸ»çµæœã«åŸºã¥ãã€ãã®è«‹æ±‚ã«å¿œã˜ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨åˆ¤æ–­ã—ãŸå ´åˆã«ã¯ã€é…æ»ãªãã€å½“è©²å€‹äººæƒ…å ±ã®åˆ©ç”¨åœæ­¢ç­‰ã‚’è¡Œã„ã¾ã™ã€‚</li>\n                <li>å½“ç¤¾ã¯ã€å‰é …ã®è¦å®šã«åŸºã¥ãåˆ©ç”¨åœæ­¢ç­‰ã‚’è¡Œã£ãŸå ´åˆã€ã¾ãŸã¯åˆ©ç”¨åœæ­¢ç­‰ã‚’è¡Œã‚ãªã„æ—¨ã®æ±ºå®šã‚’ã—ãŸã¨ãã¯ã€é…æ»ãªãã€ã“ã‚Œã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã—ã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬9æ¡ï¼ˆCookieï¼ˆã‚¯ãƒƒã‚­ãƒ¼ï¼‰ãã®ä»–ã®æŠ€è¡“ã®åˆ©ç”¨ï¼‰</h2>\n              <p className=\"text-slate-700 leading-relaxed mb-3\">\n                æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€CookieãŠã‚ˆã³ã“ã‚Œã«é¡ã™ã‚‹æŠ€è¡“ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®æŠ€è¡“ã¯ã€å½“ç¤¾ã«ã‚ˆã‚‹æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨çŠ¶æ³ç­‰ã®æŠŠæ¡ã«å½¹ç«‹ã¡ã€ã‚µãƒ¼ãƒ“ã‚¹å‘ä¸Šã«è³‡ã™ã‚‹ã‚‚ã®ã§ã™ã€‚\n              </p>\n              <p className=\"text-slate-700 leading-relaxed\">\n                Cookieã‚’ç„¡åŠ¹åŒ–ã•ã‚ŒãŸã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã«ã‚ˆã‚Šã€Cookieã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€Cookieã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã¨ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®ä¸€éƒ¨ã®æ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ãªããªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬10æ¡ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®å¤‰æ›´ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>æœ¬ãƒãƒªã‚·ãƒ¼ã®å†…å®¹ã¯ã€æ³•ä»¤ãã®ä»–æœ¬ãƒãƒªã‚·ãƒ¼ã«åˆ¥æ®µã®å®šã‚ã®ã‚ã‚‹äº‹é …ã‚’é™¤ã„ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã™ã‚‹ã“ã¨ãªãã€å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n                <li>å½“ç¤¾ãŒåˆ¥é€”å®šã‚ã‚‹å ´åˆã‚’é™¤ã„ã¦ã€å¤‰æ›´å¾Œã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã¯ã€æœ¬ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«æ²è¼‰ã—ãŸã¨ãã‹ã‚‰åŠ¹åŠ›ã‚’ç”Ÿã˜ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬11æ¡ï¼ˆãƒ‡ãƒ¼ã‚¿ã®ä¿ç®¡ã¨å‰Šé™¤ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>å½“ç¤¾ã¯ã€åé›†ã—ãŸå€‹äººæƒ…å ±ã‚’é©åˆ‡ãªå®‰å…¨å¯¾ç­–ã®ã‚‚ã¨ä¿ç®¡ã—ã¾ã™ã€‚</li>\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã—ãŸå ´åˆã€ã¾ãŸã¯åˆ©ç”¨å¥‘ç´„ãŒçµ‚äº†ã—ãŸå ´åˆã€å½“ç¤¾ã¯åˆç†çš„ãªæœŸé–“å†…ã«å€‹äººæƒ…å ±ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ãŸã ã—ã€æ³•ä»¤ã«ã‚ˆã‚Šä¿ç®¡ãŒç¾©å‹™ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹æƒ…å ±ã€ã¾ãŸã¯ç´›äº‰è§£æ±ºã®ãŸã‚ã«å¿…è¦ãªæƒ…å ±ã«ã¤ã„ã¦ã¯ã€ã“ã®é™ã‚Šã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹å†…ã®è¨­å®šç”»é¢ã‹ã‚‰ã€ã„ã¤ã§ã‚‚è‡ªèº«ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬12æ¡ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰</h2>\n              <p className=\"text-slate-700 leading-relaxed\">\n                å½“ç¤¾ã¯ã€å€‹äººæƒ…å ±ã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã€å€‹äººæƒ…å ±ã®ç´›å¤±ã€ç ´å£Šã€æ”¹ã–ã‚“ã€æ¼æ´©ç­‰ã®ãƒªã‚¹ã‚¯ã«å¯¾ã—ã¦ã€æŠ€è¡“é¢åŠã³çµ„ç¹”é¢ã«ãŠã„ã¦åˆç†çš„ãªå®‰å…¨å¯¾ç­–ã‚’è¬›ã˜ã¾ã™ã€‚ãŸã ã—ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã§ã®æƒ…å ±ä¼é€ã«å®Œå…¨ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ä¿è¨¼ã™ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ã”ç†è§£ãã ã•ã„ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬13æ¡ï¼ˆãŠå•ã„åˆã‚ã›çª“å£ï¼‰</h2>\n              <p className=\"text-slate-700 leading-relaxed mb-3\">\n                æœ¬ãƒãƒªã‚·ãƒ¼ã«é–¢ã™ã‚‹ãŠå•ã„åˆã‚ã›ã¯ã€ä¸‹è¨˜ã®çª“å£ã¾ã§ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚\n              </p>\n              <div className=\"bg-slate-100 border border-slate-200 rounded-lg p-4\">\n                <p className=\"text-slate-700 mb-2\"><strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong> privacy@izakaya-ikki.example.com</p>\n                <p className=\"text-slate-700\"><strong>å—ä»˜æ™‚é–“:</strong> å¹³æ—¥ 10:00-18:00ï¼ˆåœŸæ—¥ç¥æ—¥ã‚’é™¤ãï¼‰</p>\n              </div>\n            </section>\n\n            <div className=\"mt-8 pt-6 border-t border-slate-200\">\n              <p className=\"text-sm text-slate-600\">ä»¥ä¸Š</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n",
  "src/pages/ProjectDownload.tsx": "import React, { useState, useEffect } from 'react'\nimport { Download, FileArchive, AlertCircle, CheckCircle } from 'lucide-react'\nimport JSZip from 'jszip'\nimport { saveAs } from 'file-saver'\n\nexport function ProjectDownload() {\n  const [isGenerating, setIsGenerating] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [success, setSuccess] = useState(false)\n  const [projectFiles, setProjectFiles] = useState<Record<string, string>>({})\n  const [isLoading, setIsLoading] = useState(true)\n\n  useEffect(() => {\n    const loadProjectFiles = async () => {\n      try {\n        const imported = await import('../lib/projectFiles')\n        setProjectFiles(imported.projectFiles || {})\n        setIsLoading(false)\n      } catch (e) {\n        console.error('projectFiles.ts not found:', e)\n        setError('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã§ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™ã€‚')\n        setIsLoading(false)\n      }\n    }\n    loadProjectFiles()\n  }, [])\n\n  const handleDownload = async () => {\n    if (Object.keys(projectFiles).length === 0) {\n      setError('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚')\n      return\n    }\n\n    setIsGenerating(true)\n    setError(null)\n    setSuccess(false)\n\n    try {\n      const zip = new JSZip()\n\n      for (const [filePath, content] of Object.entries(projectFiles)) {\n        const relativePath = filePath.replace(/^\\//, '')\n        zip.file(relativePath, content)\n      }\n\n      const blob = await zip.generateAsync({ type: 'blob' })\n      const fileName = `ai-management-system-${new Date().toISOString().split('T')[0]}.zip`\n      saveAs(blob, fileName)\n      setSuccess(true)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setIsGenerating(false)\n    }\n  }\n\n  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•çš„ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹\n  useEffect(() => {\n    if (!isLoading && Object.keys(projectFiles).length > 0) {\n      handleDownload()\n    }\n  }, [isLoading, projectFiles])\n\n  const fileCount = Object.keys(projectFiles).length\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4\">\n      <div className=\"max-w-2xl w-full bg-white rounded-2xl shadow-xl p-8\">\n        <div className=\"text-center mb-8\">\n          <div className=\"inline-flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mb-4\">\n            <FileArchive className=\"w-10 h-10 text-blue-600\" />\n          </div>\n          <h1 className=\"text-3xl font-bold text-slate-800 mb-2\">\n            ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\n          </h1>\n          <p className=\"text-slate-600\">\n            ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ZIPå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™\n          </p>\n        </div>\n\n        <div className=\"bg-slate-50 rounded-lg p-6 mb-6\">\n          <h2 className=\"font-semibold text-slate-800 mb-3\">å«ã¾ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼š</h2>\n          <div className=\"mb-4\">\n            <div className=\"inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium\">\n              {fileCount} ãƒ•ã‚¡ã‚¤ãƒ«\n            </div>\n          </div>\n          <ul className=\"space-y-2 text-sm text-slate-600\">\n            <li className=\"flex items-start\">\n              <span className=\"inline-block w-2 h-2 bg-blue-600 rounded-full mt-1.5 mr-2\"></span>\n              <span>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆsrc/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰</span>\n            </li>\n            <li className=\"flex items-start\">\n              <span className=\"inline-block w-2 h-2 bg-blue-600 rounded-full mt-1.5 mr-2\"></span>\n              <span>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆsupabase/migrations/ï¼‰</span>\n            </li>\n            <li className=\"flex items-start\">\n              <span className=\"inline-block w-2 h-2 bg-blue-600 rounded-full mt-1.5 mr-2\"></span>\n              <span>Edge Functionsï¼ˆsupabase/functions/ï¼‰</span>\n            </li>\n            <li className=\"flex items-start\">\n              <span className=\"inline-block w-2 h-2 bg-blue-600 rounded-full mt-1.5 mr-2\"></span>\n              <span>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆpackage.jsonã€vite.config.tsç­‰ï¼‰</span>\n            </li>\n            <li className=\"flex items-start\">\n              <span className=\"inline-block w-2 h-2 bg-blue-600 rounded-full mt-1.5 mr-2\"></span>\n              <span>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆREADME.mdç­‰ï¼‰</span>\n            </li>\n          </ul>\n        </div>\n\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start\">\n            <AlertCircle className=\"w-5 h-5 text-red-600 mr-2 flex-shrink-0 mt-0.5\" />\n            <div className=\"text-sm text-red-800\">{error}</div>\n          </div>\n        )}\n\n        {success && (\n          <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 mb-6 flex items-start\">\n            <CheckCircle className=\"w-5 h-5 text-green-600 mr-2 flex-shrink-0 mt-0.5\" />\n            <div className=\"text-sm text-green-800\">\n              ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n            </div>\n          </div>\n        )}\n\n        <button\n          onClick={handleDownload}\n          disabled={isGenerating}\n          className=\"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 text-white font-semibold py-4 px-6 rounded-lg transition-colors flex items-center justify-center\"\n        >\n          {isGenerating ? (\n            <>\n              <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n              ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆä¸­...\n            </>\n          ) : (\n            <>\n              <Download className=\"w-5 h-5 mr-2\" />\n              ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\n            </>\n          )}\n        </button>\n\n        <div className=\"mt-6 text-center text-sm text-slate-500\">\n          <p>\n            æ³¨æ„: .envãƒ•ã‚¡ã‚¤ãƒ«ã¯å«ã¾ã‚Œã¾ã›ã‚“ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€\n            ç’°å¢ƒå¤‰æ•°ã¯åˆ¥é€”ç®¡ç†ã—ã¦ãã ã•ã„ã€‚\n          </p>\n        </div>\n      </div>\n    </div>\n  )\n}\n",
  "src/pages/ReportForm.tsx": "import React, { useMemo, useState, useEffect } from 'react'\nimport { useSearchParams, useNavigate } from 'react-router-dom'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { type DailyReportData } from '@/types'\nimport { formatCurrency, formatPercent } from '@/lib/format'\nimport { cn } from '@/lib/utils'\nimport { CircleCheck as CheckCircle, Save, CloudUpload as UploadCloud, Trophy } from 'lucide-react'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { useAdminData } from '@/contexts/AdminDataContext'\nimport { createDailyReport, updateDailyReport, isSupabaseReady, getDailyReports, getDailyTarget } from '@/services/supabase'\nimport { useExpenseBaseline } from '@/hooks/useExpenseBaseline'\n\nconst numberAttrs = {\n  inputMode: 'numeric' as const,\n  pattern: '[0-9]*',\n}\n\ntype FormState = {\n  date: string\n  storeId: string\n  salesCash10: number\n  salesCash8: number\n  salesCredit10: number\n  salesCredit8: number\n  sales: number\n  // æ¥­è€…åˆ¥ä»•å…¥ï¼ˆå‹•çš„ï¼‰\n  vendorPurchases: Record<string, number>\n  purchase: number\n  laborCost: number\n  utilities: number\n  rent: number\n  consumables: number\n  promotion: number\n  cleaning: number\n  misc: number\n  communication: number\n  others: number\n  customers: number\n  reportText: string\n}\n\nconst todayISO = () => new Date().toISOString().split('T')[0]\n\nexport const ReportForm: React.FC = () => {\n  const [params] = useSearchParams()\n  const navigate = useNavigate()\n  const { user, getAccessibleStores } = useAuth()\n  const { getStoreVendors, vendors, storeVendorAssignments, stores: adminStores } = useAdminData()\n\n  // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼šURLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§idã‚’å—ã‘å–ã‚‹\n  const editingReportId = params.get('id')\n  const isEditMode = !!editingReportId\n\n  // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¾ãŸã¯ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªæœ€åˆã®åº—èˆ—ã‚’åˆæœŸå€¤ã«ã™ã‚‹\n  const getInitialStoreId = () => {\n    const paramStore = params.get('store')\n    if (paramStore && paramStore !== 'all') {\n      const accessibleStores = getAccessibleStores()\n      const storeExists = accessibleStores.find(s => s.id === paramStore)\n      if (storeExists) return paramStore\n    }\n    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒç„¡åŠ¹ãªå ´åˆã¯ã€ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªæœ€åˆã®åº—èˆ—ã‚’ä½¿ã†\n    const accessibleStores = getAccessibleStores()\n    return accessibleStores.length > 0 ? accessibleStores[0].id : 'all'\n  }\n\n  const [form, setForm] = useState<FormState>({\n    date: todayISO(),\n    storeId: '',\n    salesCash10: 0, salesCash8: 0, salesCredit10: 0, salesCredit8: 0,\n    sales: 0,\n    vendorPurchases: {},\n    purchase: 0, laborCost: 0, utilities: 0, rent: 0, consumables: 0,\n    promotion: 0, cleaning: 0, misc: 0, communication: 0, others: 0,\n    customers: 0,\n    reportText: ''\n  })\n  const [saving, setSaving] = useState(false)\n  const [saved, setSaved] = useState<null | 'local' | 'sent'>(null)\n  const [monthlyManaged, setMonthlyManaged] = useState(true)\n  const [loading, setLoading] = useState(false)\n  const [targetAchieved, setTargetAchieved] = useState(false)\n\n  useEffect(() => {\n    if (!form.storeId && user) {\n      const initialStoreId = getInitialStoreId()\n      setForm(f => ({ ...f, storeId: initialStoreId }))\n    }\n  }, [user])\n\n  // åº—èˆ—ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸæ¥­è€…ã‚’AdminDataContextã‹ã‚‰å–å¾—ï¼ˆuseMemoã§è‡ªå‹•æ›´æ–°ï¼‰\n  const storeVendors = useMemo(() => {\n    if (!form.storeId || form.storeId === 'all') {\n      console.log('ğŸ“‹ ReportForm: storeId ãŒ \"all\" ã¾ãŸã¯ç©ºã®ãŸã‚æ¥­è€…ãƒªã‚¹ãƒˆã¯ç©ºã§ã™')\n      return []\n    }\n    const result = getStoreVendors(form.storeId)\n    console.log('ğŸ“‹ ReportForm: åº—èˆ—æ¥­è€…å–å¾—:', { storeId: form.storeId, count: result.length, result })\n    return result\n  }, [form.storeId, getStoreVendors])\n\n  // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼šæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€\n  useEffect(() => {\n    if (isEditMode && editingReportId) {\n      const loadReport = async () => {\n        setLoading(true)\n        let existingReport: DailyReportData | undefined\n\n        // ãƒ­ãƒ¼ã‚«ãƒ«IDã®å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰\n        if (editingReportId.startsWith('local-')) {\n          const localReports: DailyReportData[] = JSON.parse(localStorage.getItem('userReports') || '[]')\n          existingReport = localReports.find(r => r.id === editingReportId)\n        } else if (isSupabaseReady()) {\n          // Supabaseã‹ã‚‰å–å¾—\n          const { data } = await getDailyReports({ userId: user?.id })\n          if (data) {\n            existingReport = data.find(r => r.id === editingReportId)\n          }\n        }\n\n        if (existingReport) {\n          console.log('ğŸ“ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿', existingReport)\n          // å£²ä¸Šã‚’é€†ç®—ï¼ˆä»®ã«å…¨ã¦ç¾é‡‘10%ã¨ã—ã¦æ‰±ã†ï¼‰\n          const salesCash10 = existingReport.sales || 0\n          setForm({\n            date: existingReport.date,\n            storeId: existingReport.storeId,\n            salesCash10,\n            salesCash8: 0,\n            salesCredit10: 0,\n            salesCredit8: 0,\n            sales: existingReport.sales,\n            vendorPurchases: existingReport.vendorPurchases || {},\n            purchase: existingReport.purchase,\n            laborCost: existingReport.laborCost,\n            utilities: existingReport.utilities || 0,\n            rent: (existingReport as any).rent || 0,\n            consumables: (existingReport as any).consumables || 0,\n            promotion: existingReport.promotion || 0,\n            cleaning: existingReport.cleaning || 0,\n            misc: existingReport.misc || 0,\n            communication: existingReport.communication || 0,\n            others: existingReport.others || 0,\n            customers: existingReport.customers || 0,\n            reportText: existingReport.reportText || ''\n          })\n          // æœˆæ¬¡ç®¡ç†ãƒ•ãƒ©ã‚°ã‚‚åˆ¤å®š\n          if (existingReport.utilities > 0 || existingReport.promotion > 0) {\n            setMonthlyManaged(false)\n          }\n        } else {\n          alert('æŒ‡å®šã•ã‚ŒãŸæ—¥å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ')\n          navigate('/dashboard/daily')\n        }\n        setLoading(false)\n      }\n\n      loadReport()\n    }\n  }, [isEditMode, editingReportId, navigate, user])\n\n  // å‰å›å…¥åŠ›ã®å‘¼ã³å‡ºã—ï¼ˆåº—èˆ—å˜ä½ã§è¨˜æ†¶ï¼‰ - æ–°è¦ä½œæˆæ™‚ã®ã¿\n  useEffect(() => {\n    if (!isEditMode) {\n      const last = localStorage.getItem(`lastReport_${form.storeId}`)\n      if (last) {\n        const v = JSON.parse(last)\n        setForm((f) => ({ ...f, ...v, date: todayISO() }))\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [form.storeId, isEditMode])\n\n  // æ¥­è€…åˆ¥ä»•å…¥ã®åˆè¨ˆã‚’è‡ªå‹•è¨ˆç®—\n  const purchase = Object.values(form.vendorPurchases).reduce((sum, val) => sum + (val || 0), 0)\n  \n  // purchaseã‚’formã«åæ˜ \n  React.useEffect(() => {\n    setForm(f => ({ ...f, purchase }))\n  }, [purchase])\n\n  // å£²ä¸Šåˆè¨ˆã‚’è‡ªå‹•è¨ˆç®—\n  const sales = (form.salesCash10 || 0) + (form.salesCash8 || 0) + (form.salesCredit10 || 0) + (form.salesCredit8 || 0)\n  // salesã‚’formã«åæ˜ \n  React.useEffect(() => {\n    setForm(f => ({ ...f, sales }))\n  }, [sales])\n\n  // å‚è€ƒçµŒè²»ï¼ˆæœˆæ¬¡å¹³å‡ã®æ—¥å‰²ã‚Šï¼‰\n  const yyyymm = form.date.slice(0, 7)\n  const { expenseBaseline: refDaily } = useExpenseBaseline(form.storeId, yyyymm)\n\n  // å®Ÿç¸¾KPIï¼ˆå…¥åŠ›ã•ã‚ŒãŸå€¤ã®ã¿ï¼‰\n  const totalExpenses = form.purchase + form.laborCost + form.utilities + form.rent + form.consumables + form.promotion + form.cleaning + form.misc + form.communication + form.others\n  const grossProfit   = form.sales - form.purchase\n  const operatingProfit = form.sales - totalExpenses\n  const profitMargin  = form.sales > 0 ? (operatingProfit / form.sales) * 100 : 0\n\n  // å‚è€ƒKPIï¼ˆé£Ÿæè²»+æœˆæ¬¡ç®¡ç†ã®å ´åˆã¯å‚è€ƒçµŒè²»ã‚’åˆç®—ï¼‰\n  const referenceExpenses = form.purchase + (monthlyManaged ? refDaily.totalExpense : form.laborCost + form.utilities + form.rent + form.consumables + form.promotion + form.cleaning + form.misc + form.communication + form.others)\n  const referenceOperatingProfit = form.sales - referenceExpenses\n  const referenceProfitMargin = form.sales > 0 ? (referenceOperatingProfit / form.sales) * 100 : 0\n\n  const purchaseRate  = form.sales > 0 ? (form.purchase / form.sales) * 100 : 0\n  const laborRate     = form.sales > 0 ? (form.laborCost / form.sales) * 100 : 0\n  const primeRate     = form.sales > 0 ? ((form.purchase + form.laborCost) / form.sales) * 100 : 0\n  const averageTicket = form.customers > 0 ? Math.round(form.sales / form.customers) : 0\n\n  const setN = (key: keyof FormState, val: number) => setForm((f) => ({ ...f, [key]: Math.max(0, Math.round(val)) }))\n  const setVendorPurchase = (vendorId: string, val: number) => setForm(f => ({\n    ...f,\n    vendorPurchases: { ...f.vendorPurchases, [vendorId]: Math.max(0, Math.round(val)) }\n  }))\n  const bump = (key: keyof FormState, step: number) => setN(key, Number((form as any)[key] || 0) + step)\n  const bumpVendor = (vendorId: string, step: number) => setVendorPurchase(vendorId, (form.vendorPurchases[vendorId] || 0) + step)\n\n\n  const submit = async () => {\n    if (!user) {\n      alert('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™')\n      return\n    }\n\n    setSaving(true); setSaved(null)\n\n    const selectedStore = getAccessibleStores().find(s => s.id === form.storeId)\n    if (!selectedStore) {\n      alert('é¸æŠã•ã‚ŒãŸåº—èˆ—ã«ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“')\n      setSaving(false)\n      return\n    }\n\n    const reportData = {\n      date: form.date,\n      storeId: form.storeId,\n      storeName: selectedStore.name,\n      staffName: user.name,\n      sales: form.sales,\n      purchase: form.purchase,\n      laborCost: form.laborCost,\n      utilities: monthlyManaged ? 0 : form.utilities,\n      rent: monthlyManaged ? 0 : form.rent,\n      consumables: monthlyManaged ? 0 : form.consumables,\n      promotion: monthlyManaged ? 0 : form.promotion,\n      cleaning: monthlyManaged ? 0 : form.cleaning,\n      misc: monthlyManaged ? 0 : form.misc,\n      communication: monthlyManaged ? 0 : form.communication,\n      others: monthlyManaged ? 0 : form.others,\n      reportText: form.reportText,\n      customers: form.customers,\n      userId: user.id,\n      vendorPurchases: form.vendorPurchases\n    }\n\n    // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜é–¢æ•°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰\n    const saveToLocal = () => {\n      const key = 'userReports'\n      const current = JSON.parse(localStorage.getItem(key) || '[]')\n\n      if (isEditMode && editingReportId) {\n        // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼šæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n        const index = current.findIndex((r: any) => r.id === editingReportId)\n        if (index !== -1) {\n          current[index] = {\n            ...current[index],\n            ...reportData,\n            updated_at: new Date().toISOString()\n          }\n          localStorage.setItem(key, JSON.stringify(current))\n          setSaved('local')\n          console.log('ğŸ“¦ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§æ›´æ–°:', current[index])\n        }\n      } else {\n        // æ–°è¦ä½œæˆ\n        const localReport = {\n          id: `local-${Date.now()}`,\n          ...reportData,\n          createdAt: new Date().toISOString()\n        }\n        localStorage.setItem(key, JSON.stringify([localReport, ...current]))\n        setSaved('local')\n        console.log('ğŸ“¦ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜:', localReport)\n      }\n    }\n\n    try {\n      // Supabaseæœªè¨­å®šã®å ´åˆã¯å³ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜\n      if (!isSupabaseReady()) {\n        console.log('ğŸ”§ Supabaseæœªè¨­å®šã€ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã—ã¾ã™')\n        saveToLocal()\n\n        // æ¬¡å›å…¥åŠ›ã®è£œåŠ©ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆæ–°è¦ä½œæˆæ™‚ã®ã¿ï¼‰\n        // ä»•å…¥ã‚Œãƒ‡ãƒ¼ã‚¿ã¯ãƒªã‚»ãƒƒãƒˆã—ã€ãã®ä»–ã®çµŒè²»ã®ã¿ä¿æŒ\n        if (!isEditMode) {\n          localStorage.setItem(`lastReport_${form.storeId}`, JSON.stringify({\n            storeId: form.storeId,\n            vendorPurchases: {}, // ä»•å…¥ã‚Œã¯ãƒªã‚»ãƒƒãƒˆ\n            laborCost: form.laborCost,\n            utilities: form.utilities,\n            rent: form.rent,\n            consumables: form.consumables,\n            promotion: form.promotion,\n            cleaning: form.cleaning,\n            misc: form.misc,\n            communication: form.communication,\n            others: form.others\n          }))\n        }\n\n        setTimeout(() => {\n          navigate('/dashboard/daily')\n        }, 800)\n        return\n      }\n\n      // Supabaseã«ä¿å­˜ã¾ãŸã¯æ›´æ–°\n      let data, error\n      if (isEditMode && editingReportId) {\n        // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼šæ›´æ–°\n        const updates = {\n          date: reportData.date,\n          store_id: reportData.storeId,\n          user_id: reportData.userId,\n          sales: reportData.sales,\n          purchase: reportData.purchase,\n          labor_cost: reportData.laborCost,\n          utilities: reportData.utilities,\n          rent: reportData.rent,\n          consumables: reportData.consumables,\n          promotion: reportData.promotion,\n          cleaning: reportData.cleaning,\n          misc: reportData.misc,\n          communication: reportData.communication,\n          others: reportData.others,\n          customers: reportData.customers,\n          report_text: reportData.reportText\n        }\n        const result = await updateDailyReport(editingReportId, updates)\n        data = result.data\n        error = result.error\n      } else {\n        // æ–°è¦ä½œæˆ\n        const result = await createDailyReport(reportData)\n        data = result.data\n        error = result.error\n      }\n\n      if (error) {\n        // RLSç­‰ã®å¤±æ•—ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n        console.warn('âš ï¸ æ—¥å ±ä¿å­˜å¤±æ•—ã€ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:', error)\n        saveToLocal()\n      } else {\n        console.log('âœ… Supabaseã«ä¿å­˜æˆåŠŸ:', data)\n        setSaved('sent')\n\n        // ç›®æ¨™é”æˆåˆ¤å®šï¼ˆæ–°è¦ä½œæˆæ™‚ã®ã¿ï¼‰\n        if (!isEditMode) {\n          try {\n            const { data: targetData } = await getDailyTarget(form.storeId, form.date)\n            if (targetData && targetData.target_sales > 0) {\n              const achieved = form.sales >= targetData.target_sales\n              setTargetAchieved(achieved)\n              if (achieved) {\n                console.log('ğŸ‰ ç›®æ¨™é”æˆï¼', {\n                  target: targetData.target_sales,\n                  actual: form.sales\n                })\n              }\n            }\n          } catch (e) {\n            console.log('ç›®æ¨™é”æˆåˆ¤å®šã‚¨ãƒ©ãƒ¼:', e)\n          }\n        }\n      }\n\n      // æ¬¡å›å…¥åŠ›ã®è£œåŠ©ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆæ–°è¦ä½œæˆæ™‚ã®ã¿ï¼‰\n      // ä»•å…¥ã‚Œãƒ‡ãƒ¼ã‚¿ã¯ãƒªã‚»ãƒƒãƒˆã—ã€ãã®ä»–ã®çµŒè²»ã®ã¿ä¿æŒ\n      if (!isEditMode) {\n        localStorage.setItem(`lastReport_${form.storeId}`, JSON.stringify({\n          storeId: form.storeId,\n          vendorPurchases: {}, // ä»•å…¥ã‚Œã¯ãƒªã‚»ãƒƒãƒˆ\n          laborCost: form.laborCost,\n          utilities: form.utilities,\n          rent: form.rent,\n          consumables: form.consumables,\n          promotion: form.promotion,\n          cleaning: form.cleaning,\n          misc: form.misc,\n          communication: form.communication,\n          others: form.others\n        }))\n      }\n\n      // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹ï¼ˆç›®æ¨™é”æˆæ™‚ã¯å°‘ã—é•·ã‚ã«è¡¨ç¤ºï¼‰\n      setTimeout(() => {\n        navigate('/dashboard/daily')\n      }, targetAchieved ? 2000 : 800)\n\n    } catch (e) {\n      console.error('âŒ å ±å‘Šä½œæˆã‚¨ãƒ©ãƒ¼:', e)\n      // äºˆæœŸã›ã¬ä¾‹å¤–ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ã¸\n      saveToLocal()\n      alert('å ±å‘Šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã«é€€é¿ã—ã¾ã—ãŸï¼‰')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const storeOptions = useMemo(() => {\n    let accessibleStores = getAccessibleStores()\n\n    // ã‚‚ã— accessibleStores ãŒç©ºã§ã€AdminDataContext ã« stores ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ã†\n    if (accessibleStores.length === 0 && user?.role === 'admin' && adminStores.length > 0) {\n      accessibleStores = adminStores.map(s => ({ id: s.id, name: s.name }))\n    }\n\n    return accessibleStores.map(store => ({\n      id: store.id,\n      name: store.name,\n      disabled: false\n    }))\n  }, [getAccessibleStores, user?.role, adminStores])\n\n  return (\n    <div className=\"max-w-4xl mx-auto space-y-4 px-2 sm:px-4 lg:px-6\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-xl sm:text-2xl font-bold\">{isEditMode ? 'æ—¥å ±ç·¨é›†' : 'æ—¥å ±å…¥åŠ›'}</h1>\n        <Badge>Mobile Friendly</Badge>\n      </div>\n\n      <Card>\n        <CardHeader><CardTitle>åŸºæœ¬æƒ…å ±</CardTitle></CardHeader>\n        <CardContent className=\"space-y-3 sm:space-y-4\">\n          <div className=\"flex items-center gap-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n            <input id=\"monthlyManaged\" type=\"checkbox\" checked={monthlyManaged} onChange={e=>setMonthlyManaged(e.target.checked)} />\n            <label htmlFor=\"monthlyManaged\" className=\"text-sm\">\n              æ°´é“å…‰ç†±è²»/è³ƒæ–™/æ¶ˆè€—å“è²»/è²©ä¿ƒè²»/æ¸…æƒè²»/é€šä¿¡è²»/é›‘è²»/ãã®ä»–ã¯<strong>æœˆæ¬¡å…¥åŠ›ã§ç®¡ç†</strong>ã™ã‚‹\n            </label>\n          </div>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n            <div>\n              <label className=\"block text-xs text-muted-foreground mb-1\">æ—¥ä»˜</label>\n              <input type=\"date\" value={form.date} onChange={(e)=>setForm(f=>({...f, date: e.target.value}))}\n                className=\"w-full px-3 py-3 rounded border border-input bg-background text-base min-h-[44px]\" />\n            </div>\n            <div>\n              <label className=\"block text-xs text-muted-foreground mb-1\">åº—èˆ—</label>\n              <select value={form.storeId} onChange={(e)=>setForm(f=>({...f, storeId: e.target.value}))}\n                className=\"w-full px-3 py-3 rounded border border-input bg-background text-base min-h-[44px]\">\n                {storeOptions.map(s=>(\n                  <option key={s.id} value={s.id} disabled={(s as any).disabled}>{'name' in s ? (s as any).name : s.name}</option>\n                ))}\n              </select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader><CardTitle>æ•°å€¤å…¥åŠ›</CardTitle></CardHeader>\n        <CardContent className=\"space-y-3 sm:space-y-4\">\n        {/* å£²ä¸Šã®å†…è¨³å…¥åŠ› */}\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-blue-800 mb-3 flex items-center gap-2\">\n            ğŸ’° å£²ä¸Šå†…è¨³ï¼ˆæ±ºæ¸ˆæ–¹æ³•ãƒ»ç¨ç‡åˆ¥ï¼‰\n          </h3>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n            <div>\n              <label className=\"block text-xs text-muted-foreground mb-1\">ğŸ’µ ç¾é‡‘ãƒ»10%é£²é£Ÿ</label>\n              <input {...numberAttrs} inputMode=\"numeric\"\n                value={form.salesCash10 || ''} \n                onChange={(e)=>setN('salesCash10', Number(e.target.value.replace(/[^0-9]/g,''))||0)}\n                placeholder=\"0\"\n                className=\"w-full px-4 py-3 rounded border border-input bg-background text-right text-lg sm:text-base font-mono min-h-[44px]\" />\n            </div>\n            <div>\n              <label className=\"block text-xs text-muted-foreground mb-1\">ğŸ’µ ç¾é‡‘ãƒ»8%è»½æ¸›</label>\n              <input {...numberAttrs} inputMode=\"numeric\"\n                value={form.salesCash8 || ''} \n                onChange={(e)=>setN('salesCash8', Number(e.target.value.replace(/[^0-9]/g,''))||0)}\n                placeholder=\"0\"\n                className=\"w-full px-4 py-3 rounded border border-input bg-background text-right text-lg sm:text-base font-mono min-h-[44px]\" />\n            </div>\n            <div>\n              <label className=\"block text-xs text-muted-foreground mb-1\">ğŸ’³ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»10%é£²é£Ÿ</label>\n              <input {...numberAttrs} inputMode=\"numeric\"\n                value={form.salesCredit10 || ''} \n                onChange={(e)=>setN('salesCredit10', Number(e.target.value.replace(/[^0-9]/g,''))||0)}\n                placeholder=\"0\"\n                className=\"w-full px-4 py-3 rounded border border-input bg-background text-right text-lg sm:text-base font-mono min-h-[44px]\" />\n            </div>\n            <div>\n              <label className=\"block text-xs text-muted-foreground mb-1\">ğŸ’³ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»8%è»½æ¸›</label>\n              <input {...numberAttrs} inputMode=\"numeric\"\n                value={form.salesCredit8 || ''} \n                onChange={(e)=>setN('salesCredit8', Number(e.target.value.replace(/[^0-9]/g,''))||0)}\n                placeholder=\"0\"\n                className=\"w-full px-4 py-3 rounded border border-input bg-background text-right text-lg sm:text-base font-mono min-h-[44px]\" />\n            </div>\n          </div>\n          <div className=\"mt-3 p-3 bg-white rounded border border-blue-200\">\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">ç¾é‡‘è¨ˆï¼š</span>\n                <span className=\"font-mono\">{formatCurrency((form.salesCash10 || 0) + (form.salesCash8 || 0))}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¨ˆï¼š</span>\n                <span className=\"font-mono\">{formatCurrency((form.salesCredit10 || 0) + (form.salesCredit8 || 0))}</span>\n              </div>\n            </div>\n            <div className=\"mt-2 pt-2 border-t border-blue-200 flex justify-between text-base font-medium\">\n              <span className=\"text-blue-800\">å£²ä¸Šåˆè¨ˆï¼š</span>\n              <span className=\"font-mono text-blue-900\">{formatCurrency(form.sales)}</span>\n            </div>\n          </div>\n        </div>\n\n        {/* æ¥­è€…åˆ¥ä»•å…¥å…¥åŠ› */}\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-red-800 mb-3 flex items-center gap-2\">\n            ğŸ›’ ä»•å…¥å†…è¨³ï¼ˆåº—èˆ—ç™»éŒ²æ¥­è€…åˆ¥ï¼‰\n          </h3>\n          {(!form.storeId || form.storeId === 'all') ? (\n            <div className=\"text-center py-6 text-muted-foreground\">\n              <p className=\"text-sm\">\n                ä»•å…¥å†…è¨³ã‚’å…¥åŠ›ã™ã‚‹ã«ã¯ã€å…ˆã«åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚\n              </p>\n            </div>\n          ) : storeVendors.length === 0 ? (\n            <div className=\"text-center py-6 text-muted-foreground\">\n              <p className=\"text-sm\">\n                ã“ã®åº—èˆ—ã«æ¥­è€…ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n              </p>\n              <p className=\"text-xs mt-1\">è¨­å®šç”»é¢ã§æ¥­è€…ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n              {storeVendors.map(vendor => (\n                <div key={vendor.id} className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3\">\n                  <div className=\"w-full sm:w-32 text-xs text-muted-foreground\">\n                    {vendor.name}\n                  </div>\n                  <div className=\"flex-1 w-full\">\n                    <input {...numberAttrs} inputMode=\"numeric\"\n                      value={form.vendorPurchases[vendor.id] || ''} \n                      onChange={(e)=>setVendorPurchase(vendor.id, Number(e.target.value.replace(/[^0-9]/g,''))||0)}\n                      placeholder=\"0\"\n                      className=\"w-full px-3 py-2 rounded border border-input bg-background text-right text-sm font-mono min-h-[36px]\" />\n                  </div>\n                  <div className=\"flex gap-1 w-full sm:w-auto\">\n                    <Button variant=\"outline\" size=\"sm\" onClick={()=>bumpVendor(vendor.id, -1000)}\n                      className=\"flex-1 sm:flex-none min-h-[36px] sm:h-7 text-xs\">-1k</Button>\n                    <Button variant=\"outline\" size=\"sm\" onClick={()=>bumpVendor(vendor.id, +1000)}\n                      className=\"flex-1 sm:flex-none min-h-[36px] sm:h-7 text-xs\">+1k</Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n          <div className=\"mt-3 p-3 bg-white rounded border border-red-200\">\n            <div className=\"flex justify-between text-base font-medium\">\n              <span className=\"text-red-800\">ä»•å…¥åˆè¨ˆï¼š</span>\n              <span className=\"font-mono text-red-900\">{formatCurrency(form.purchase)}</span>\n            </div>\n          </div>\n        </div>\n\n          {[\n            ['laborCost','äººä»¶è²»'],\n            ['utilities','æ°´é“å…‰ç†±è²»', 'monthly'],\n            ['rent','è³ƒæ–™', 'monthly'],\n            ['consumables','æ¶ˆè€—å“è²»', 'monthly'],\n            ['promotion','è²©ä¿ƒè²»', 'monthly'],\n            ['cleaning','æ¸…æƒè²»', 'monthly'],\n            ['misc','é›‘è²»', 'monthly'],\n            ['communication','é€šä¿¡è²»', 'monthly'],\n            ['others','ãã®ä»–', 'monthly'],\n          ].map(([key,label, category]) => (\n            <div key={key} className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3\">\n              <div className=\"w-full sm:w-20 text-sm font-medium text-foreground sm:text-muted-foreground\">\n                {label}\n                {category === 'monthly' && monthlyManaged && <span className=\"text-xs text-blue-600 ml-1\">(æœˆæ¬¡)</span>}\n              </div>\n              <div className=\"flex-1 w-full\">\n                <input {...numberAttrs} inputMode=\"numeric\"\n                  value={(form as any)[key] || ''} \n                  onChange={(e)=>setN(key as keyof FormState, Number(e.target.value.replace(/[^0-9]/g,''))||0)}\n                  disabled={category === 'monthly' && monthlyManaged}\n                  placeholder=\"0\"\n                  className=\"w-full px-4 py-3 rounded border border-input bg-background text-right text-lg sm:text-base font-mono min-h-[44px] disabled:bg-muted disabled:text-muted-foreground\" />\n              </div>\n              <div className=\"flex gap-1 sm:gap-2 w-full sm:w-auto\">\n                <Button variant=\"outline\" size=\"sm\" onClick={()=>bump(key as keyof FormState, -1000)} \n                  disabled={category === 'monthly' && monthlyManaged}\n                  className=\"flex-1 sm:flex-none min-h-[44px] sm:h-8 text-xs sm:text-sm\">-1,000</Button>\n                <Button variant=\"outline\" size=\"sm\" onClick={()=>bump(key as keyof FormState, +1000)}\n                  disabled={category === 'monthly' && monthlyManaged}\n                  className=\"flex-1 sm:flex-none min-h-[44px] sm:h-8 text-xs sm:text-sm\">+1,000</Button>\n              </div>\n            </div>\n          ))}\n\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3\">\n            <div className=\"w-full sm:w-20 text-sm font-medium text-foreground sm:text-muted-foreground\">å®¢æ•°</div>\n            <div className=\"flex-1 w-full\">\n              <input {...numberAttrs}\n                value={form.customers || ''} onChange={(e)=>setN('customers', Number(e.target.value.replace(/[^0-9]/g,''))||0)}\n                placeholder=\"0\"\n                className=\"w-full px-4 py-3 rounded border border-input bg-background text-right text-lg sm:text-base font-mono min-h-[44px]\" />\n            </div>\n            <div className=\"flex gap-1 sm:gap-2 w-full sm:w-auto\">\n              <Button variant=\"outline\" size=\"sm\" onClick={()=>bump('customers', -1)}\n                className=\"flex-1 sm:flex-none min-h-[44px] sm:h-8 text-xs sm:text-sm\">-1</Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={()=>bump('customers', +1)}\n                className=\"flex-1 sm:flex-none min-h-[44px] sm:h-8 text-xs sm:text-sm\">+1</Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader><CardTitle>è‡ªå‹•è¨ˆç®—ï¼ˆå®Ÿç¸¾ï¼‰</CardTitle></CardHeader>\n        <CardContent className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 text-sm\">\n          <Stat label=\"çµŒè²»åˆè¨ˆ\" value={formatCurrency(totalExpenses)} />\n          <Stat label=\"ç²—åˆ©ç›Š\" value={formatCurrency(grossProfit)} pos={grossProfit>=0} />\n          <Stat label=\"å–¶æ¥­åˆ©ç›Š\" value={formatCurrency(operatingProfit)} pos={operatingProfit>=0} />\n          <Stat label=\"åˆ©ç›Šç‡\" value={formatPercent(profitMargin)} pos={profitMargin>=0} />\n          <Stat label=\"åŸä¾¡ç‡\" value={formatPercent(purchaseRate)} pos={purchaseRate<=32} />\n          <Stat label=\"äººä»¶è²»ç‡\" value={formatPercent(laborRate)} pos={laborRate<=27} />\n          <Stat label=\"ãƒ—ãƒ©ã‚¤ãƒ ã‚³ã‚¹ãƒˆç‡\" value={formatPercent(primeRate)} pos={primeRate<=58} />\n          <Stat label=\"å®¢å˜ä¾¡\" value={averageTicket ? formatCurrency(averageTicket) : '-'} />\n        </CardContent>\n      </Card>\n\n      {monthlyManaged && refDaily.totalExpense > 0 && (\n        <Card className=\"border-amber-200 bg-amber-50\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-amber-900\">\n              <span>ğŸ“Š</span>\n              å‚è€ƒKPIï¼ˆæœˆæ¬¡å¹³å‡çµŒè²»ã‚’ä½¿ç”¨ï¼‰\n            </CardTitle>\n            <p className=\"text-xs text-amber-700 mt-1\">\n              é£Ÿæè²»ä»¥å¤–ã®çµŒè²»ã‚’æœˆæ¬¡å¹³å‡ã®æ—¥å‰²ã‚Šå€¤ã§è¨ˆç®—ã—ãŸå‚è€ƒå€¤ã§ã™ã€‚ç¿Œæœˆã«ç¢ºå®šå€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n            </p>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 text-sm\">\n              <Stat label=\"å‚è€ƒ å–¶æ¥­åˆ©ç›Š\" value={formatCurrency(referenceOperatingProfit)} pos={referenceOperatingProfit>=0} />\n              <Stat label=\"å‚è€ƒ åˆ©ç›Šç‡\" value={formatPercent(referenceProfitMargin)} pos={referenceProfitMargin>=0} />\n            </div>\n\n            <div className=\"rounded-lg border border-amber-300 bg-white p-3\">\n              <div className=\"text-xs font-medium text-amber-900 mb-2\">å‚è€ƒçµŒè²»ã®å†…è¨³ï¼ˆ1æ—¥ã‚ãŸã‚Šï¼‰</div>\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs text-amber-800\">\n                {refDaily.laborCost > 0 && <div>äººä»¶è²»ï¼š{formatCurrency(refDaily.laborCost)}</div>}\n                {refDaily.utilities > 0 && <div>æ°´é“å…‰ç†±è²»ï¼š{formatCurrency(refDaily.utilities)}</div>}\n                {refDaily.rent > 0 && <div>è³ƒæ–™ï¼š{formatCurrency(refDaily.rent)}</div>}\n                {refDaily.consumables > 0 && <div>æ¶ˆè€—å“è²»ï¼š{formatCurrency(refDaily.consumables)}</div>}\n                {refDaily.promotion > 0 && <div>è²©ä¿ƒè²»ï¼š{formatCurrency(refDaily.promotion)}</div>}\n                {refDaily.cleaning > 0 && <div>æ¸…æƒè²»ï¼š{formatCurrency(refDaily.cleaning)}</div>}\n                {refDaily.communication > 0 && <div>é€šä¿¡è²»ï¼š{formatCurrency(refDaily.communication)}</div>}\n                {refDaily.misc > 0 && <div>é›‘è²»ï¼š{formatCurrency(refDaily.misc)}</div>}\n                {refDaily.others > 0 && <div>ãã®ä»–ï¼š{formatCurrency(refDaily.others)}</div>}\n              </div>\n              <div className=\"mt-2 pt-2 border-t border-amber-200 text-sm font-medium text-amber-900 flex justify-between\">\n                <span>åˆè¨ˆ</span>\n                <span>{formatCurrency(refDaily.totalExpense)}</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader><CardTitle>ãƒ¡ãƒ¢</CardTitle></CardHeader>\n        <CardContent>\n          <textarea\n            value={form.reportText}\n            onChange={(e)=>setForm(f=>({...f, reportText: e.target.value}))}\n            placeholder=\"ä¾‹ï¼šé›¨ã§æ¥å®¢æ¸›ã€‚ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆå¼·åŒ–ã§å®¢å˜ä¾¡ç¶­æŒã€‚\"\n            className=\"w-full px-4 py-3 rounded border border-input bg-background min-h-24 text-base resize-none min-h-[44px]\"\n          />\n          <p className=\"text-xs text-muted-foreground mt-2\">ğŸ’¬ éŸ³å£°å…¥åŠ›ã‚‚å¯ï¼ˆã‚¹ãƒãƒ›ã®ãƒã‚¤ã‚¯æ©Ÿèƒ½ï¼‰</p>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex flex-col sm:flex-row gap-3 sticky bottom-4 bg-background p-4 -mx-2 sm:mx-0 sm:p-0 sm:bg-transparent rounded-lg sm:rounded-none border sm:border-none\">\n        <Button className=\"flex-1 min-h-[44px] sm:h-10 text-base sm:text-sm\" onClick={submit} disabled={saving || form.storeId==='all' || loading}>\n          {saving ? <UploadCloud className=\"h-4 w-4 mr-2 animate-pulse\" /> : <Save className=\"h-4 w-4 mr-2\" />}\n          {isEditMode ? 'æ›´æ–°' : 'ä¿å­˜'}\n        </Button>\n        <Button variant=\"outline\" className=\"w-full sm:w-36 min-h-[44px] sm:h-10 text-base sm:text-sm\" onClick={()=>navigate('/dashboard/daily')}>\n          ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸\n        </Button>\n      </div>\n\n      {saved && (\n        <div className={cn('flex items-center gap-2 text-sm p-3 rounded-lg border',\n          saved==='local' ? 'text-blue-700 bg-blue-50 border-blue-200' : 'text-green-700 bg-green-50 border-green-200')}>\n          <CheckCircle className=\"h-4 w-4\" />\n          {saved==='sent' ? (\n            <div>\n              ä¿å­˜ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\n              {monthlyManaged && <div className=\"text-xs mt-1\">ğŸ’¡ æœˆæ¬¡çµŒè²»ã¯åˆ¥é€”ã€Œæœˆæ¬¡çµŒè²»å…¥åŠ›ã€ç”»é¢ã§ç®¡ç†ã—ã¦ãã ã•ã„</div>}\n            </div>\n          ) : 'ä¿å­˜ã—ã¾ã—ãŸ'}\n        </div>\n      )}\n\n      {targetAchieved && (\n        <div className=\"flex items-center gap-3 text-lg p-4 rounded-lg border bg-green-50 border-green-200 animate-pulse\">\n          <Trophy className=\"h-6 w-6 text-green-600\" />\n          <div className=\"font-bold text-green-700\">\n            æœ¬æ—¥ã®å£²ä¸Šç›®æ¨™ã‚’é”æˆã—ã¾ã—ãŸï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nconst Stat: React.FC<{label:string; value:string; pos?: boolean}> = ({label, value, pos}) => (\n  <div className=\"p-3 sm:p-4 rounded border border-border\">\n    <div className=\"text-xs text-muted-foreground\">{label}</div>\n    <div className={cn('text-sm sm:text-base font-semibold leading-tight', pos==null ? '' : pos ? 'text-green-600' : 'text-red-600')}>\n      {value}\n    </div>\n  </div>\n)",
  "src/pages/SharedReport.tsx": "import { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { supabase } from '../lib/supabase';\nimport { FileText, TrendingUp, TrendingDown, Calendar, Store } from 'lucide-react';\n\ninterface Report {\n  id: string;\n  title: string;\n  summary: string;\n  report_type: string;\n  period_start: string;\n  period_end: string;\n  key_insights: string[];\n  recommendations: string[];\n  metrics: {\n    totalSales?: number;\n    totalExpenses?: number;\n    grossProfit?: number;\n    operatingProfit?: number;\n    profitMargin?: number;\n    costRate?: number;\n    laborRate?: number;\n  };\n  generated_at: string;\n  store_id?: string;\n  store_name?: string;\n}\n\nexport default function SharedReport() {\n  const { shareToken } = useParams<{ shareToken: string }>();\n  const [report, setReport] = useState<Report | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    async function loadReport() {\n      try {\n        setLoading(true);\n        setError(null);\n\n        const { data, error: fetchError } = await supabase\n          .from('ai_generated_reports')\n          .select(`\n            *,\n            stores!ai_generated_reports_store_id_fkey(name)\n          `)\n          .eq('share_token', shareToken)\n          .eq('is_public', true)\n          .maybeSingle();\n\n        if (fetchError) throw fetchError;\n\n        if (!data) {\n          setError('ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯è¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€å…±æœ‰ãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚');\n          return;\n        }\n\n        setReport({\n          ...data,\n          store_name: data.stores?.name,\n        });\n      } catch (err) {\n        console.error('Error loading shared report:', err);\n        setError('ãƒ¬ãƒãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    if (shareToken) {\n      loadReport();\n    }\n  }, [shareToken]);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">ãƒ¬ãƒãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !report) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center max-w-md\">\n          <FileText className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h2>\n          <p className=\"text-gray-600\">{error || 'ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯å­˜åœ¨ã—ãªã„ã‹ã€ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚'}</p>\n        </div>\n      </div>\n    );\n  }\n\n  const metrics = report.metrics || {};\n  const formatCurrency = (value: number) => `Â¥${value.toLocaleString('ja-JP')}`;\n  const formatPercent = (value: number) => `${value.toFixed(1)}%`;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-8\">\n      <div className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8\">\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow-lg p-8 text-white mb-6\">\n          <div className=\"flex items-start justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold mb-3\">{report.title}</h1>\n              <div className=\"flex flex-wrap gap-4 text-blue-100\">\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"h-4 w-4\" />\n                  <span>{report.period_start} ã€œ {report.period_end}</span>\n                </div>\n                {report.store_name && (\n                  <div className=\"flex items-center gap-2\">\n                    <Store className=\"h-4 w-4\" />\n                    <span>{report.store_name}</span>\n                  </div>\n                )}\n              </div>\n            </div>\n            <div className=\"bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg\">\n              <div className=\"text-sm text-blue-100\">ãƒ¬ãƒãƒ¼ãƒˆç¨®é¡</div>\n              <div className=\"font-semibold\">\n                {report.report_type === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡'}ãƒ¬ãƒãƒ¼ãƒˆ\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Summary */}\n        <div className=\"bg-white rounded-lg shadow p-6 mb-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n            <FileText className=\"h-5 w-5 text-blue-600\" />\n            ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼\n          </h2>\n          <p className=\"text-gray-700 leading-relaxed\">{report.summary}</p>\n        </div>\n\n        {/* Key Metrics */}\n        <div className=\"bg-white rounded-lg shadow p-6 mb-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">ä¸»è¦æŒ‡æ¨™</h2>\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n            {metrics.totalSales !== undefined && (\n              <div className=\"bg-blue-50 rounded-lg p-4\">\n                <div className=\"text-sm text-gray-600 mb-1\">ç·å£²ä¸Š</div>\n                <div className=\"text-2xl font-bold text-blue-600\">\n                  {formatCurrency(metrics.totalSales)}\n                </div>\n              </div>\n            )}\n            {metrics.totalExpenses !== undefined && (\n              <div className=\"bg-red-50 rounded-lg p-4\">\n                <div className=\"text-sm text-gray-600 mb-1\">ç·çµŒè²»</div>\n                <div className=\"text-2xl font-bold text-red-600\">\n                  {formatCurrency(metrics.totalExpenses)}\n                </div>\n              </div>\n            )}\n            {metrics.grossProfit !== undefined && (\n              <div className=\"bg-green-50 rounded-lg p-4\">\n                <div className=\"text-sm text-gray-600 mb-1\">ç²—åˆ©ç›Š</div>\n                <div className=\"text-2xl font-bold text-green-600\">\n                  {formatCurrency(metrics.grossProfit)}\n                </div>\n              </div>\n            )}\n            {metrics.operatingProfit !== undefined && (\n              <div className={`${metrics.operatingProfit >= 0 ? 'bg-emerald-50' : 'bg-orange-50'} rounded-lg p-4`}>\n                <div className=\"text-sm text-gray-600 mb-1\">å–¶æ¥­åˆ©ç›Š</div>\n                <div className={`text-2xl font-bold flex items-center gap-1 ${metrics.operatingProfit >= 0 ? 'text-emerald-600' : 'text-orange-600'}`}>\n                  {metrics.operatingProfit >= 0 ? (\n                    <TrendingUp className=\"h-5 w-5\" />\n                  ) : (\n                    <TrendingDown className=\"h-5 w-5\" />\n                  )}\n                  {formatCurrency(metrics.operatingProfit)}\n                </div>\n              </div>\n            )}\n            {metrics.profitMargin !== undefined && (\n              <div className=\"bg-purple-50 rounded-lg p-4\">\n                <div className=\"text-sm text-gray-600 mb-1\">åˆ©ç›Šç‡</div>\n                <div className=\"text-2xl font-bold text-purple-600\">\n                  {formatPercent(metrics.profitMargin)}\n                </div>\n              </div>\n            )}\n            {metrics.costRate !== undefined && (\n              <div className=\"bg-amber-50 rounded-lg p-4\">\n                <div className=\"text-sm text-gray-600 mb-1\">åŸä¾¡ç‡</div>\n                <div className=\"text-2xl font-bold text-amber-600\">\n                  {formatPercent(metrics.costRate)}\n                </div>\n              </div>\n            )}\n            {metrics.laborRate !== undefined && (\n              <div className=\"bg-cyan-50 rounded-lg p-4\">\n                <div className=\"text-sm text-gray-600 mb-1\">äººä»¶è²»ç‡</div>\n                <div className=\"text-2xl font-bold text-cyan-600\">\n                  {formatPercent(metrics.laborRate)}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Key Insights */}\n        {report.key_insights && report.key_insights.length > 0 && (\n          <div className=\"bg-white rounded-lg shadow p-6 mb-6\">\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">é‡è¦ãªç™ºè¦‹</h2>\n            <div className=\"space-y-3\">\n              {report.key_insights.map((insight, index) => (\n                <div key={index} className=\"bg-blue-50 border-l-4 border-blue-500 p-4 rounded\">\n                  <p className=\"text-gray-700\">{insight}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Recommendations */}\n        {report.recommendations && report.recommendations.length > 0 && (\n          <div className=\"bg-white rounded-lg shadow p-6 mb-6\">\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">æ”¹å–„ææ¡ˆ</h2>\n            <div className=\"space-y-3\">\n              {report.recommendations.map((rec, index) => (\n                <div key={index} className=\"bg-green-50 border-l-4 border-green-500 p-4 rounded\">\n                  <p className=\"text-gray-700\">{rec}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Footer */}\n        <div className=\"text-center text-sm text-gray-500 py-6\">\n          <p>ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ AI ã«ã‚ˆã£ã¦è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ</p>\n          <p className=\"mt-1\">ç”Ÿæˆæ—¥æ™‚: {new Date(report.generated_at).toLocaleString('ja-JP')}</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
  "src/pages/StaffManagement.tsx": "import React, { useState, useEffect } from 'react'\nimport { Card, CardHeader, CardContent, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { PermissionGuard } from '@/components/Auth/PermissionGuard'\nimport { supabase } from '@/lib/supabase'\nimport { Users, Mail, Shield, Store, ChevronDown, ChevronUp } from 'lucide-react'\n\ntype UserRole = 'staff' | 'manager' | 'admin'\n\ninterface UserProfile {\n  id: string\n  email: string\n  name: string\n  role: UserRole\n  created_at: string\n}\n\ninterface StoreAssignment {\n  store_id: string\n  store_name: string\n}\n\nexport const StaffManagement: React.FC = () => {\n  const [users, setUsers] = useState<UserProfile[]>([])\n  const [stores, setStores] = useState<Array<{ id: string; name: string }>>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string>('')\n  const [expandedUserId, setExpandedUserId] = useState<string | null>(null)\n  const [storeAssignments, setStoreAssignments] = useState<Record<string, StoreAssignment[]>>({})\n\n  useEffect(() => {\n    loadData()\n  }, [])\n\n  const loadData = async () => {\n    setLoading(true)\n    setError('')\n\n    try {\n      if (!supabase) {\n        setError('Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒåˆ©ç”¨ã§ãã¾ã›ã‚“')\n        setLoading(false)\n        return\n      }\n\n      const [usersResult, storesResult] = await Promise.all([\n        supabase.from('profiles').select('id, email, name, role, created_at').order('created_at', { ascending: false }),\n        supabase.from('stores').select('id, name').eq('is_active', true).order('name')\n      ])\n\n      if (usersResult.error) throw usersResult.error\n      if (storesResult.error) throw storesResult.error\n\n      setUsers(usersResult.data || [])\n      setStores(storesResult.data || [])\n\n      const assignmentsMap: Record<string, StoreAssignment[]> = {}\n      for (const user of usersResult.data || []) {\n        const { data: assignments } = await supabase\n          .from('store_assignments')\n          .select(`\n            store_id,\n            stores:store_id (\n              name\n            )\n          `)\n          .eq('user_id', user.id)\n\n        assignmentsMap[user.id] = (assignments || []).map((a: any) => ({\n          store_id: a.store_id,\n          store_name: a.stores?.name || 'ä¸æ˜ãªåº—èˆ—'\n        }))\n      }\n\n      setStoreAssignments(assignmentsMap)\n    } catch (err) {\n      console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', err)\n      setError(err instanceof Error ? err.message : 'ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const updateUserRole = async (userId: string, newRole: UserRole) => {\n    if (!supabase) return\n\n    try {\n      const { error } = await supabase\n        .from('profiles')\n        .update({ role: newRole })\n        .eq('id', userId)\n\n      if (error) throw error\n\n      setUsers(users.map(u => u.id === userId ? { ...u, role: newRole } : u))\n      alert('æ¨©é™ã‚’æ›´æ–°ã—ã¾ã—ãŸ')\n    } catch (err) {\n      console.error('æ¨©é™æ›´æ–°ã‚¨ãƒ©ãƒ¼:', err)\n      alert('æ¨©é™ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (err instanceof Error ? err.message : 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'))\n    }\n  }\n\n  const assignStoreToUser = async (userId: string, storeId: string) => {\n    if (!supabase) return\n\n    try {\n      const { error } = await supabase\n        .from('store_assignments')\n        .insert({\n          user_id: userId,\n          store_id: storeId\n        })\n\n      if (error) throw error\n\n      await loadData()\n      alert('åº—èˆ—ã‚’å‰²ã‚Šå½“ã¦ã¾ã—ãŸ')\n    } catch (err) {\n      console.error('åº—èˆ—å‰²ã‚Šå½“ã¦ã‚¨ãƒ©ãƒ¼:', err)\n      alert('åº—èˆ—ã®å‰²ã‚Šå½“ã¦ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (err instanceof Error ? err.message : 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'))\n    }\n  }\n\n  const unassignStoreFromUser = async (userId: string, storeId: string) => {\n    if (!supabase) return\n\n    try {\n      const { error } = await supabase\n        .from('store_assignments')\n        .delete()\n        .eq('user_id', userId)\n        .eq('store_id', storeId)\n\n      if (error) throw error\n\n      await loadData()\n      alert('åº—èˆ—ã®å‰²ã‚Šå½“ã¦ã‚’è§£é™¤ã—ã¾ã—ãŸ')\n    } catch (err) {\n      console.error('åº—èˆ—å‰²ã‚Šå½“ã¦è§£é™¤ã‚¨ãƒ©ãƒ¼:', err)\n      alert('åº—èˆ—ã®å‰²ã‚Šå½“ã¦è§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (err instanceof Error ? err.message : 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'))\n    }\n  }\n\n  const getRoleBadgeVariant = (role: UserRole) => {\n    switch (role) {\n      case 'admin': return 'default'\n      case 'manager': return 'secondary'\n      case 'staff': return 'outline'\n      default: return 'outline'\n    }\n  }\n\n  const getRoleLabel = (role: UserRole) => {\n    switch (role) {\n      case 'admin': return 'ç®¡ç†è€…'\n      case 'manager': return 'åº—é•·'\n      case 'staff': return 'ã‚¹ã‚¿ãƒƒãƒ•'\n      default: return role\n    }\n  }\n\n  if (loading) {\n    return (\n      <PermissionGuard requiredRole=\"manager\">\n        <div className=\"flex items-center justify-center min-h-[400px]\">\n          <div className=\"text-muted-foreground\">èª­ã¿è¾¼ã¿ä¸­...</div>\n        </div>\n      </PermissionGuard>\n    )\n  }\n\n  return (\n    <PermissionGuard requiredRole=\"manager\">\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-foreground flex items-center gap-2\">\n            <Users className=\"w-6 h-6\" />\n            ã‚¹ã‚¿ãƒƒãƒ•æ¨©é™ç®¡ç†\n          </h1>\n          <p className=\"text-sm text-muted-foreground\">ç™»éŒ²ã‚¹ã‚¿ãƒƒãƒ•ã®æ¨©é™ã¨åº—èˆ—å‰²ã‚Šå½“ã¦ã‚’ç®¡ç†ã—ã¾ã™ã€‚</p>\n        </div>\n\n        {error && (\n          <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg text-red-700\">\n            {error}\n          </div>\n        )}\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center justify-between\">\n              <span>ç™»éŒ²æ¸ˆã¿ã‚¹ã‚¿ãƒƒãƒ•ï¼ˆ{users.length}åï¼‰</span>\n              <Button variant=\"outline\" size=\"sm\" onClick={loadData}>\n                æ›´æ–°\n              </Button>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {users.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Users className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                  <p>ç™»éŒ²æ¸ˆã¿ã‚¹ã‚¿ãƒƒãƒ•ãŒã„ã¾ã›ã‚“</p>\n                </div>\n              ) : (\n                users.map(user => {\n                  const isExpanded = expandedUserId === user.id\n                  const userStores = storeAssignments[user.id] || []\n                  const unassignedStores = stores.filter(\n                    s => !userStores.some(us => us.store_id === s.id)\n                  )\n\n                  return (\n                    <div key={user.id} className=\"border border-border rounded-lg\">\n                      <div className=\"p-3 sm:p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3\">\n                            <div className=\"flex items-center gap-2 min-w-0\">\n                              <Mail className=\"w-4 h-4 text-muted-foreground flex-shrink-0\" />\n                              <span className=\"font-medium text-sm sm:text-base truncate\">{user.email}</span>\n                            </div>\n                            <Badge variant={getRoleBadgeVariant(user.role)} className=\"self-start\">\n                              <Shield className=\"w-3 h-3 mr-1\" />\n                              {getRoleLabel(user.role)}\n                            </Badge>\n                          </div>\n                          <div className=\"text-xs sm:text-sm text-muted-foreground mt-2\">\n                            åå‰: {user.name} | ç™»éŒ²æ—¥: {new Date(user.created_at).toLocaleDateString('ja-JP')}\n                          </div>\n                          {userStores.length > 0 && (\n                            <div className=\"flex items-center gap-2 mt-2\">\n                              <Store className=\"w-4 h-4 text-muted-foreground\" />\n                              <span className=\"text-xs sm:text-sm text-muted-foreground\">\n                                å‰²ã‚Šå½“ã¦åº—èˆ—: {userStores.length}åº—èˆ—\n                              </span>\n                            </div>\n                          )}\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setExpandedUserId(isExpanded ? null : user.id)}\n                            className=\"w-full sm:w-auto\"\n                          >\n                            {isExpanded ? <ChevronUp className=\"w-4 h-4 mr-1\" /> : <ChevronDown className=\"w-4 h-4 mr-1\" />}\n                            {isExpanded ? 'é–‰ã˜ã‚‹' : 'ç®¡ç†'}\n                          </Button>\n                        </div>\n                      </div>\n\n                      {isExpanded && (\n                        <div className=\"border-t border-border p-4 bg-muted/30 space-y-4\">\n                          <div>\n                            <h4 className=\"text-sm font-medium mb-3 flex items-center gap-2\">\n                              <Shield className=\"w-4 h-4\" />\n                              æ¨©é™å¤‰æ›´\n                            </h4>\n                            <div className=\"flex gap-2 flex-wrap\">\n                              {(['staff', 'manager', 'admin'] as UserRole[]).map(role => (\n                                <Button\n                                  key={role}\n                                  size=\"sm\"\n                                  variant={user.role === role ? 'default' : 'outline'}\n                                  onClick={() => {\n                                    if (user.role !== role) {\n                                      if (confirm(`${user.email}ã®æ¨©é™ã‚’ã€Œ${getRoleLabel(role)}ã€ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ`)) {\n                                        updateUserRole(user.id, role)\n                                      }\n                                    }\n                                  }}\n                                  disabled={user.role === role}\n                                >\n                                  {getRoleLabel(role)}\n                                </Button>\n                              ))}\n                            </div>\n                          </div>\n\n                          <div>\n                            <h4 className=\"text-sm font-medium mb-3 flex items-center gap-2\">\n                              <Store className=\"w-4 h-4\" />\n                              åº—èˆ—å‰²ã‚Šå½“ã¦\n                            </h4>\n\n                            {userStores.length > 0 && (\n                              <div className=\"mb-3\">\n                                <div className=\"text-xs text-muted-foreground mb-2\">å‰²ã‚Šå½“ã¦æ¸ˆã¿åº—èˆ—</div>\n                                <div className=\"flex flex-wrap gap-2\">\n                                  {userStores.map(store => (\n                                    <Badge key={store.store_id} variant=\"secondary\" className=\"flex items-center gap-1\">\n                                      {store.store_name}\n                                      <button\n                                        onClick={() => {\n                                          if (confirm(`${store.store_name}ã®å‰²ã‚Šå½“ã¦ã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {\n                                            unassignStoreFromUser(user.id, store.store_id)\n                                          }\n                                        }}\n                                        className=\"ml-1 hover:text-destructive\"\n                                      >\n                                        Ã—\n                                      </button>\n                                    </Badge>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {unassignedStores.length > 0 ? (\n                              <div>\n                                <div className=\"text-xs text-muted-foreground mb-2\">è¿½åŠ å¯èƒ½ãªåº—èˆ—</div>\n                                <div className=\"flex flex-wrap gap-2\">\n                                  {unassignedStores.map(store => (\n                                    <Button\n                                      key={store.id}\n                                      size=\"sm\"\n                                      variant=\"outline\"\n                                      onClick={() => {\n                                        if (confirm(`${store.name}ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã‹ï¼Ÿ`)) {\n                                          assignStoreToUser(user.id, store.id)\n                                        }\n                                      }}\n                                    >\n                                      + {store.name}\n                                    </Button>\n                                  ))}\n                                </div>\n                              </div>\n                            ) : (\n                              <div className=\"text-sm text-muted-foreground text-center py-2\">\n                                ã™ã¹ã¦ã®åº—èˆ—ãŒå‰²ã‚Šå½“ã¦æ¸ˆã¿ã§ã™\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  )\n                })\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>æ¨©é™ãƒ¬ãƒ™ãƒ«ã®èª¬æ˜</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3 text-sm\">\n              <div className=\"flex items-start gap-3\">\n                <Badge variant=\"default\" className=\"mt-0.5\">\n                  <Shield className=\"w-3 h-3 mr-1\" />\n                  ç®¡ç†è€…\n                </Badge>\n                <div>\n                  <p className=\"font-medium\">ã™ã¹ã¦ã®æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½</p>\n                  <p className=\"text-muted-foreground\">å…¨åº—èˆ—ã®ç®¡ç†ã€ã‚¹ã‚¿ãƒƒãƒ•ã®æ¨©é™å¤‰æ›´ã€ã‚·ã‚¹ãƒ†ãƒ è¨­å®šãªã©</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <Badge variant=\"secondary\" className=\"mt-0.5\">\n                  <Shield className=\"w-3 h-3 mr-1\" />\n                  åº—é•·\n                </Badge>\n                <div>\n                  <p className=\"font-medium\">å‰²ã‚Šå½“ã¦åº—èˆ—ã®ç®¡ç†ãŒå¯èƒ½</p>\n                  <p className=\"text-muted-foreground\">æ—¥å ±ã®ç¢ºèªãƒ»ç·¨é›†ã€æœˆæ¬¡çµŒè²»å…¥åŠ›ã€ç›®æ¨™è¨­å®šãªã©</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <Badge variant=\"outline\" className=\"mt-0.5\">\n                  <Shield className=\"w-3 h-3 mr-1\" />\n                  ã‚¹ã‚¿ãƒƒãƒ•\n                </Badge>\n                <div>\n                  <p className=\"font-medium\">åŸºæœ¬çš„ãªæ—¥å ±å…¥åŠ›ã®ã¿</p>\n                  <p className=\"text-muted-foreground\">å‰²ã‚Šå½“ã¦åº—èˆ—ã®æ—¥å ±å…¥åŠ›ã®ã¿ãŒå¯èƒ½</p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </PermissionGuard>\n  )\n}\n",
  "src/pages/Targets.tsx": "import React from 'react'\nimport { useLocation } from 'react-router-dom'\nimport { Target, TrendingUp, Users, Calendar, AlertCircle, CheckCircle, Percent } from 'lucide-react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Progress } from '@/components/ui/progress'\nimport { Badge } from '@/components/ui/badge'\nimport { MetricCard } from '@/components/ui/MetricCard'\nimport { SalesChart } from '@/components/Charts/SalesChart'\nimport { useReports } from '@/hooks/useReports'\nimport { useTargets } from '@/hooks/useTargets'\nimport { useKpis } from '@/hooks/useKpis'\nimport { useExpenseBaseline } from '@/hooks/useExpenseBaseline'\nimport { formatCurrency, formatPercent, formatNumber } from '@/lib/format'\n\nexport const Targets: React.FC = () => {\n  const location = useLocation()\n  const sp = new URLSearchParams(location.search)\n  const storeId = sp.get('store') || 'all'\n  const currentPeriod = new Date().toISOString().substring(0, 7) // YYYY-MM\n  const { expenseBaseline, monthlyExpenseBaseline } = useExpenseBaseline(storeId, currentPeriod)\n  \n  const { data: monthReports, isLoading } = useReports({\n    storeId,\n    dateFrom: new Date().toISOString().substring(0, 8) + '01', // First day of month\n    dateTo: new Date().toISOString().split('T')[0] // Today\n  })\n\n  const { getAllStoresTarget, calculateTargetMetrics } = useTargets(storeId, currentPeriod)\n  const baseKpis = useKpis(monthReports)\n\n  // æœˆæ¬¡çµŒè²»ã‚’æ—¥å ±ãƒ‡ãƒ¼ã‚¿åˆ†ã ã‘æ—¥å‰²ã‚Šã§åŠ ç®—ã—ã¦æ­£ã—ã„å–¶æ¥­åˆ©ç›Šã‚’è¨ˆç®—\n  const monthKpis = React.useMemo(() => {\n    if (storeId === 'all' || !monthlyExpenseBaseline || monthReports.length === 0) {\n      return baseKpis\n    }\n\n    // æ—¥å ±ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹æ—¥æ•°åˆ†ã®æœˆæ¬¡çµŒè²»ã‚’æ—¥å‰²ã‚Šè¨ˆç®—\n    const daysWithReports = monthReports.length\n    const monthlyTotal = monthlyExpenseBaseline.totalExpense\n    const openDays = expenseBaseline.monthly?.open_days || 31\n    const proRatedMonthlyExpense = Math.round((monthlyTotal / openDays) * daysWithReports)\n\n    // å–¶æ¥­åˆ©ç›Š = å£²ä¸Š - ï¼ˆä»•å…¥çµŒè²» + ãã®ä»–çµŒè²»ï¼‰\n    // ãã®ä»–çµŒè²» = æ—¥å ±ã®ãã®ä»–çµŒè²» + æœˆæ¬¡çµŒè²»ã®æ—¥å‰²ã‚Šåˆ†\n    const totalExpenses = baseKpis.totalExpenses + proRatedMonthlyExpense\n    const operatingProfit = baseKpis.totalSales - totalExpenses\n    const profitMargin = baseKpis.totalSales > 0 ? (operatingProfit / baseKpis.totalSales) * 100 : 0\n\n    return {\n      ...baseKpis,\n      totalExpenses,\n      operatingProfit,\n      profitMargin\n    }\n  }, [baseKpis, monthlyExpenseBaseline, expenseBaseline, monthReports.length, storeId])\n  \n  const allStoresTarget = getAllStoresTarget()\n  const targetMetrics = calculateTargetMetrics(\n    monthKpis.totalSales,\n    monthKpis.operatingProfit,\n    allStoresTarget.targetSales,\n    allStoresTarget.targetProfit\n  )\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <div key={i} className=\"animate-pulse\">\n              <div className=\"h-32 bg-muted rounded-lg\"></div>\n            </div>\n          ))}\n        </div>\n        <div className=\"h-96 bg-muted rounded-lg animate-pulse\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground mb-2\">\n          ç›®æ¨™é”æˆåº¦\n        </h1>\n        <p className=\"text-muted-foreground\">\n          {new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' })}ã®ç›®æ¨™é€²æ—\n        </p>\n      </div>\n\n      {/* Achievement Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <MetricCard\n          label=\"å£²ä¸Šé”æˆç‡\"\n          value={`${targetMetrics.salesAchievement.toFixed(1)}%`}\n          icon={TrendingUp}\n          tone={\n            targetMetrics.salesAchievement >= 90 ? \"success\" : \n            targetMetrics.salesAchievement >= 70 ? \"warning\" : \"danger\"\n          }\n          hint={`ç›®æ¨™: ${formatCurrency(allStoresTarget.targetSales)}`}\n        />\n        \n        <MetricCard\n          label=\"å–¶æ¥­åˆ©ç›Šé”æˆç‡\"\n          value={`${targetMetrics.profitAchievement.toFixed(1)}%`}\n          icon={Target}\n          tone={\n            targetMetrics.profitAchievement >= 90 ? \"success\" : \n            targetMetrics.profitAchievement >= 70 ? \"warning\" : \"danger\"\n          }\n          hint={`ç›®æ¨™: ${formatCurrency(allStoresTarget.targetProfit)}`}\n        />\n        \n        <MetricCard\n          label=\"å¿…è¦å£²ä¸Šæ®‹\"\n          value={formatCurrency(targetMetrics.remainingSales)}\n          icon={Calendar}\n          tone=\"info\"\n          hint={`æ®‹ã‚Š${targetMetrics.daysRemaining}æ—¥`}\n        />\n        \n        <MetricCard\n          label=\"å¿…è¦æ—¥å•†\"\n          value={formatCurrency(targetMetrics.requiredDailySales)}\n          icon={Users}\n          tone=\"neutral\"\n          hint={`å¿…è¦å®¢æ•°: ${formatNumber(targetMetrics.requiredCustomers)}å`}\n        />\n      </div>\n\n      {/* Cost and Labor Rate Targets */}\n      {(allStoresTarget.targetCostRate > 0 || allStoresTarget.targetLaborRate > 0) && (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {allStoresTarget.targetCostRate > 0 && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Percent className=\"h-5 w-5 text-orange-600\" />\n                  åŸä¾¡ç‡\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-muted-foreground\">å®Ÿç¸¾</span>\n                    <span className={`text-2xl font-bold ${\n                      monthKpis.purchaseRate <= allStoresTarget.targetCostRate ? 'text-green-600' :\n                      monthKpis.purchaseRate <= allStoresTarget.targetCostRate + 5 ? 'text-yellow-600' : 'text-red-600'\n                    }`}>\n                      {formatPercent(monthKpis.purchaseRate)}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between items-center text-sm\">\n                    <span className=\"text-muted-foreground\">ç›®æ¨™</span>\n                    <span className=\"font-medium\">{formatPercent(allStoresTarget.targetCostRate)}</span>\n                  </div>\n                  <div className=\"flex justify-between items-center text-sm pt-2 border-t\">\n                    <span className=\"text-muted-foreground\">å·®ç•°</span>\n                    <span className={`font-medium ${\n                      monthKpis.purchaseRate <= allStoresTarget.targetCostRate ? 'text-green-600' : 'text-red-600'\n                    }`}>\n                      {monthKpis.purchaseRate <= allStoresTarget.targetCostRate ? 'âœ“ é”æˆ' : `+${formatPercent(monthKpis.purchaseRate - allStoresTarget.targetCostRate)}`}\n                    </span>\n                  </div>\n                  {monthKpis.purchaseRate > allStoresTarget.targetCostRate && (\n                    <div className=\"flex items-center gap-2 p-2 mt-2 bg-red-50 dark:bg-red-950 rounded-lg border border-red-200 dark:border-red-900\">\n                      <AlertCircle className=\"h-4 w-4 text-red-700 dark:text-red-400 flex-shrink-0\" />\n                      <p className=\"text-xs text-red-700 dark:text-red-300\">\n                        åŸä¾¡ç‡ãŒç›®æ¨™ã‚’ä¸Šå›ã£ã¦ã„ã¾ã™ã€‚ä»•å…¥ç®¡ç†ã®è¦‹ç›´ã—ãŒå¿…è¦ã§ã™ã€‚\n                      </p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {allStoresTarget.targetLaborRate > 0 && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Users className=\"h-5 w-5 text-cyan-600\" />\n                  äººä»¶è²»ç‡\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-muted-foreground\">å®Ÿç¸¾</span>\n                    <span className={`text-2xl font-bold ${\n                      monthKpis.laborRate <= allStoresTarget.targetLaborRate ? 'text-green-600' :\n                      monthKpis.laborRate <= allStoresTarget.targetLaborRate + 5 ? 'text-yellow-600' : 'text-red-600'\n                    }`}>\n                      {formatPercent(monthKpis.laborRate)}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between items-center text-sm\">\n                    <span className=\"text-muted-foreground\">ç›®æ¨™</span>\n                    <span className=\"font-medium\">{formatPercent(allStoresTarget.targetLaborRate)}</span>\n                  </div>\n                  <div className=\"flex justify-between items-center text-sm pt-2 border-t\">\n                    <span className=\"text-muted-foreground\">å·®ç•°</span>\n                    <span className={`font-medium ${\n                      monthKpis.laborRate <= allStoresTarget.targetLaborRate ? 'text-green-600' : 'text-red-600'\n                    }`}>\n                      {monthKpis.laborRate <= allStoresTarget.targetLaborRate ? 'âœ“ é”æˆ' : `+${formatPercent(monthKpis.laborRate - allStoresTarget.targetLaborRate)}`}\n                    </span>\n                  </div>\n                  {monthKpis.laborRate > allStoresTarget.targetLaborRate && (\n                    <div className=\"flex items-center gap-2 p-2 mt-2 bg-red-50 dark:bg-red-950 rounded-lg border border-red-200 dark:border-red-900\">\n                      <AlertCircle className=\"h-4 w-4 text-red-700 dark:text-red-400 flex-shrink-0\" />\n                      <p className=\"text-xs text-red-700 dark:text-red-300\">\n                        äººä»¶è²»ç‡ãŒç›®æ¨™ã‚’ä¸Šå›ã£ã¦ã„ã¾ã™ã€‚ã‚·ãƒ•ãƒˆèª¿æ•´ã®æ¤œè¨ãŒå¿…è¦ã§ã™ã€‚\n                      </p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      )}\n\n      {/* Progress Overview */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Target className=\"h-5 w-5 text-primary\" />\n              å£²ä¸Šç›®æ¨™é€²æ—\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span>ç¾åœ¨ã®å£²ä¸Š</span>\n                <span className=\"font-medium\">{formatCurrency(monthKpis.totalSales)}</span>\n              </div>\n              <Progress \n                value={targetMetrics.salesAchievement} \n                className=\"h-3\"\n              />\n              <div className=\"flex justify-between text-xs text-muted-foreground\">\n                <span>0å††</span>\n                <span>{formatCurrency(allStoresTarget.targetSales)}</span>\n              </div>\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-4 pt-4 border-t border-border\">\n              <div className=\"text-center\">\n                <p className=\"text-xs text-muted-foreground mb-1\">é”æˆç‡</p>\n                <p className={`text-lg font-bold ${\n                  targetMetrics.salesAchievement >= 90 ? 'text-green-600' : \n                  targetMetrics.salesAchievement >= 70 ? 'text-yellow-600' : 'text-red-600'\n                }`}>\n                  {targetMetrics.salesAchievement.toFixed(1)}%\n                </p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"text-xs text-muted-foreground mb-1\">å¿…è¦æ®‹é¡</p>\n                <p className=\"text-lg font-bold text-foreground\">\n                  {formatCurrency(targetMetrics.remainingSales)}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5 text-green-600\" />\n              åˆ©ç›Šç›®æ¨™é€²æ—\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span>ç¾åœ¨ã®å–¶æ¥­åˆ©ç›Š</span>\n                <span className=\"font-medium\">{formatCurrency(monthKpis.operatingProfit)}</span>\n              </div>\n              <Progress \n                value={targetMetrics.profitAchievement} \n                className=\"h-3\"\n              />\n              <div className=\"flex justify-between text-xs text-muted-foreground\">\n                <span>0å††</span>\n                <span>{formatCurrency(allStoresTarget.targetProfit)}</span>\n              </div>\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-4 pt-4 border-t border-border\">\n              <div className=\"text-center\">\n                <p className=\"text-xs text-muted-foreground mb-1\">åˆ©ç›Šç‡</p>\n                <p className={`text-lg font-bold ${\n                  monthKpis.profitMargin >= 20 ? 'text-green-600' : \n                  monthKpis.profitMargin >= 15 ? 'text-yellow-600' : 'text-red-600'\n                }`}>\n                  {formatPercent(monthKpis.profitMargin)}\n                </p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"text-xs text-muted-foreground mb-1\">ç›®æ¨™å–¶æ¥­åˆ©ç›Šç‡</p>\n                <p className=\"text-lg font-bold text-foreground\">\n                  {formatPercent(allStoresTarget.targetProfitMargin)}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Action Items */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <AlertCircle className=\"h-5 w-5 text-yellow-600\" />\n            ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é …ç›®\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            {targetMetrics.salesAchievement < 90 && (\n              <div className=\"flex items-center gap-3 p-3 bg-yellow-50 dark:bg-yellow-950 rounded-lg\">\n                <AlertCircle className=\"h-4 w-4 text-yellow-700 dark:text-yellow-400\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-yellow-900 dark:text-yellow-100\">å£²ä¸Šç›®æ¨™é”æˆã®ãŸã‚æ—¥å•†å‘ä¸ŠãŒå¿…è¦</p>\n                  <p className=\"text-xs text-yellow-700 dark:text-yellow-300\">\n                    æ®‹ã‚Š{targetMetrics.daysRemaining}æ—¥ã§{formatCurrency(targetMetrics.requiredDailySales)}/æ—¥ã®å£²ä¸ŠãŒå¿…è¦\n                  </p>\n                </div>\n                <Badge variant=\"outline\">é«˜å„ªå…ˆåº¦</Badge>\n              </div>\n            )}\n            \n            {monthKpis.profitMargin < 15 && (\n              <div className=\"flex items-center gap-3 p-3 bg-red-50 dark:bg-red-950 rounded-lg\">\n                <AlertCircle className=\"h-4 w-4 text-red-700 dark:text-red-400\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-red-900 dark:text-red-100\">åˆ©ç›Šç‡æ”¹å–„ãŒå¿…è¦</p>\n                  <p className=\"text-xs text-red-700 dark:text-red-300\">\n                    ç¾åœ¨{formatPercent(monthKpis.profitMargin)}ã€ç›®æ¨™{formatPercent(allStoresTarget.targetProfitMargin)}\n                  </p>\n                </div>\n                <Badge variant=\"destructive\">é‡è¦</Badge>\n              </div>\n            )}\n            \n            {targetMetrics.salesAchievement >= 100 && targetMetrics.profitAchievement >= 100 && (\n              <div className=\"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-950 rounded-lg\">\n                <CheckCircle className=\"h-4 w-4 text-green-700 dark:text-green-400\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-green-900 dark:text-green-100\">ç›®æ¨™é”æˆãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</p>\n                  <p className=\"text-xs text-green-700 dark:text-green-300\">\n                    å£²ä¸Šãƒ»åˆ©ç›Šã¨ã‚‚ã«ç›®æ¨™ã‚’ä¸Šå›ã£ã¦ã„ã¾ã™\n                  </p>\n                </div>\n                <Badge>é”æˆ</Badge>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Sales Chart with Target Line */}\n      <SalesChart\n        reports={monthReports}\n        period=\"daily\"\n        targetSales={allStoresTarget.targetSales / 30} // Daily target\n        expenseBaseline={expenseBaseline}\n      />\n    </div>\n  )\n}",
  "src/pages/TermsOfService.tsx": "import React from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { ArrowLeft, FileText } from 'lucide-react'\nimport { useNavigate } from 'react-router-dom'\n\nexport const TermsOfService: React.FC = () => {\n  const navigate = useNavigate()\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 py-8\">\n      <div className=\"max-w-4xl mx-auto px-4\">\n        <Button\n          onClick={() => navigate(-1)}\n          className=\"mb-6 bg-slate-600 hover:bg-slate-700 text-white\"\n        >\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          æˆ»ã‚‹\n        </Button>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-3 text-2xl\">\n              <FileText className=\"w-6 h-6\" />\n              åˆ©ç”¨è¦ç´„\n            </CardTitle>\n            <p className=\"text-sm text-slate-600 mt-2\">æœ€çµ‚æ›´æ–°æ—¥: 2025å¹´10æœˆ11æ—¥</p>\n          </CardHeader>\n\n          <CardContent className=\"prose prose-slate max-w-none\">\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬1æ¡ï¼ˆé©ç”¨ï¼‰</h2>\n              <p className=\"text-slate-700 leading-relaxed mb-3\">\n                æœ¬åˆ©ç”¨è¦ç´„ï¼ˆä»¥ä¸‹ã€Œæœ¬è¦ç´„ã€ã¨ã„ã„ã¾ã™ï¼‰ã¯ã€å½“ç¤¾ãŒæä¾›ã™ã‚‹ã€ŒAIçµŒå–¶ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€ï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ã¨ã„ã„ã¾ã™ï¼‰ã®åˆ©ç”¨æ¡ä»¶ã‚’å®šã‚ã‚‹ã‚‚ã®ã§ã™ã€‚\n              </p>\n              <p className=\"text-slate-700 leading-relaxed\">\n                ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çš†æ§˜ï¼ˆä»¥ä¸‹ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã¨ã„ã„ã¾ã™ï¼‰ã«ã¯ã€æœ¬è¦ç´„ã«å¾“ã£ã¦æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã”åˆ©ç”¨ã„ãŸã ãã¾ã™ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬2æ¡ï¼ˆåˆ©ç”¨ç™»éŒ²ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã‚’å¸Œæœ›ã™ã‚‹æ–¹ã¯ã€æœ¬è¦ç´„ã«åŒæ„ã®ä¸Šã€å½“ç¤¾ã®å®šã‚ã‚‹æ–¹æ³•ã«ã‚ˆã£ã¦åˆ©ç”¨ç™»éŒ²ã‚’ç”³è«‹ã—ã€å½“ç¤¾ãŒã“ã‚Œã‚’æ‰¿èªã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€åˆ©ç”¨ç™»éŒ²ãŒå®Œäº†ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n                <li>å½“ç¤¾ã¯ã€åˆ©ç”¨ç™»éŒ²ã®ç”³è«‹è€…ã«ä»¥ä¸‹ã®äº‹ç”±ãŒã‚ã‚‹ã¨åˆ¤æ–­ã—ãŸå ´åˆã€åˆ©ç”¨ç™»éŒ²ã®ç”³è«‹ã‚’æ‰¿èªã—ãªã„ã“ã¨ãŒã‚ã‚Šã€ãã®ç†ç”±ã«ã¤ã„ã¦ã¯ä¸€åˆ‡ã®é–‹ç¤ºç¾©å‹™ã‚’è² ã‚ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚\n                  <ul className=\"list-disc list-inside ml-6 mt-2 space-y-1\">\n                    <li>åˆ©ç”¨ç™»éŒ²ã®ç”³è«‹ã«éš›ã—ã¦è™šå½ã®äº‹é …ã‚’å±Šã‘å‡ºãŸå ´åˆ</li>\n                    <li>æœ¬è¦ç´„ã«é•åã—ãŸã“ã¨ãŒã‚ã‚‹è€…ã‹ã‚‰ã®ç”³è«‹ã§ã‚ã‚‹å ´åˆ</li>\n                    <li>ãã®ä»–ã€å½“ç¤¾ãŒåˆ©ç”¨ç™»éŒ²ã‚’ç›¸å½“ã§ãªã„ã¨åˆ¤æ–­ã—ãŸå ´åˆ</li>\n                  </ul>\n                </li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬3æ¡ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŠã‚ˆã³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç®¡ç†ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€è‡ªå·±ã®è²¬ä»»ã«ãŠã„ã¦ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŠã‚ˆã³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é©åˆ‡ã«ç®¡ç†ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã„ã‹ãªã‚‹å ´åˆã«ã‚‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŠã‚ˆã³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¬¬ä¸‰è€…ã«è­²æ¸¡ã¾ãŸã¯è²¸ä¸ã—ã€ã‚‚ã—ãã¯ç¬¬ä¸‰è€…ã¨å…±ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚</li>\n                <li>å½“ç¤¾ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®çµ„ã¿åˆã‚ã›ãŒç™»éŒ²æƒ…å ±ã¨ä¸€è‡´ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã•ã‚ŒãŸå ´åˆã«ã¯ã€ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™»éŒ²ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã«ã‚ˆã‚‹åˆ©ç”¨ã¨ã¿ãªã—ã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬4æ¡ï¼ˆæ–™é‡‘ãŠã‚ˆã³æ”¯æ‰•æ–¹æ³•ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨ã®å¯¾ä¾¡ã¨ã—ã¦ã€å½“ç¤¾ãŒåˆ¥é€”å®šã‚ã€æœ¬ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«è¡¨ç¤ºã™ã‚‹åˆ©ç”¨æ–™é‡‘ã‚’ã€å½“ç¤¾ãŒæŒ‡å®šã™ã‚‹æ–¹æ³•ã«ã‚ˆã‚Šæ”¯æ‰•ã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨æ–™é‡‘ã®æ”¯æ‰•ã‚’é…æ»ã—ãŸå ´åˆã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å¹´14.6ï¼…ã®å‰²åˆã«ã‚ˆã‚‹é…å»¶æå®³é‡‘ã‚’æ”¯æ‰•ã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬5æ¡ï¼ˆç¦æ­¢äº‹é …ï¼‰</h2>\n              <p className=\"text-slate-700 mb-3\">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ãŸã‚Šã€ä»¥ä¸‹ã®è¡Œç‚ºã‚’ã—ã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚</p>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>æ³•ä»¤ã¾ãŸã¯å…¬åºè‰¯ä¿—ã«é•åã™ã‚‹è¡Œç‚º</li>\n                <li>çŠ¯ç½ªè¡Œç‚ºã«é–¢é€£ã™ã‚‹è¡Œç‚º</li>\n                <li>å½“ç¤¾ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã¾ãŸã¯ç¬¬ä¸‰è€…ã®ã‚µãƒ¼ãƒãƒ¼ã¾ãŸã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ©Ÿèƒ½ã‚’ç ´å£Šã—ãŸã‚Šã€å¦¨å®³ã—ãŸã‚Šã™ã‚‹è¡Œç‚º</li>\n                <li>å½“ç¤¾ã®ã‚µãƒ¼ãƒ“ã‚¹ã®é‹å–¶ã‚’å¦¨å®³ã™ã‚‹ãŠãã‚Œã®ã‚ã‚‹è¡Œç‚º</li>\n                <li>ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã™ã‚‹å€‹äººæƒ…å ±ç­‰ã‚’åé›†ã¾ãŸã¯è“„ç©ã™ã‚‹è¡Œç‚º</li>\n                <li>ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã—ã€ã¾ãŸã¯ã“ã‚Œã‚’è©¦ã¿ã‚‹è¡Œç‚º</li>\n                <li>ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æˆã‚Šã™ã¾ã™è¡Œç‚º</li>\n                <li>å½“ç¤¾ãŒè¨±è«¾ã—ãªã„æœ¬ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã§ã®å®£ä¼ã€åºƒå‘Šã€å‹§èª˜ã€ã¾ãŸã¯å–¶æ¥­è¡Œç‚º</li>\n                <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ç¬¬ä¸‰è€…ã«ä¸åˆ©ç›Šã€æå®³ã€ä¸å¿«æ„Ÿã‚’ä¸ãˆã‚‹è¡Œç‚º</li>\n                <li>å½“ç¤¾ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ç¬¬ä¸‰è€…ã®çŸ¥çš„è²¡ç”£æ¨©ã€è‚–åƒæ¨©ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã€åèª‰ãã®ä»–ã®æ¨©åˆ©ã¾ãŸã¯åˆ©ç›Šã‚’ä¾µå®³ã™ã‚‹è¡Œç‚º</li>\n                <li>åç¤¾ä¼šçš„å‹¢åŠ›ã«å¯¾ã™ã‚‹åˆ©ç›Šä¾›ä¸ãã®ä»–ã®å”åŠ›è¡Œç‚º</li>\n                <li>ãã®ä»–ã€å½“ç¤¾ãŒä¸é©åˆ‡ã¨åˆ¤æ–­ã™ã‚‹è¡Œç‚º</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬6æ¡ï¼ˆæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ã®åœæ­¢ç­‰ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>å½“ç¤¾ã¯ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®äº‹ç”±ãŒã‚ã‚‹ã¨åˆ¤æ–­ã—ãŸå ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«äº‹å‰ã«é€šçŸ¥ã™ã‚‹ã“ã¨ãªãæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®å…¨éƒ¨ã¾ãŸã¯ä¸€éƒ¨ã®æä¾›ã‚’åœæ­¢ã¾ãŸã¯ä¸­æ–­ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚\n                  <ul className=\"list-disc list-inside ml-6 mt-2 space-y-1\">\n                    <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«ã‹ã‹ã‚‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã®ä¿å®ˆç‚¹æ¤œã¾ãŸã¯æ›´æ–°ã‚’è¡Œã†å ´åˆ</li>\n                    <li>åœ°éœ‡ã€è½é›·ã€ç«ç½ã€åœé›»ã¾ãŸã¯å¤©ç½ãªã©ã®ä¸å¯æŠ—åŠ›ã«ã‚ˆã‚Šã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ãŒå›°é›£ã¨ãªã£ãŸå ´åˆ</li>\n                    <li>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¾ãŸã¯é€šä¿¡å›ç·šç­‰ãŒäº‹æ•…ã«ã‚ˆã‚Šåœæ­¢ã—ãŸå ´åˆ</li>\n                    <li>ãã®ä»–ã€å½“ç¤¾ãŒæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ãŒå›°é›£ã¨åˆ¤æ–­ã—ãŸå ´åˆ</li>\n                  </ul>\n                </li>\n                <li>å½“ç¤¾ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ã®åœæ­¢ã¾ãŸã¯ä¸­æ–­ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ç¬¬ä¸‰è€…ãŒè¢«ã£ãŸã„ã‹ãªã‚‹ä¸åˆ©ç›Šã¾ãŸã¯æå®³ã«ã¤ã„ã¦ã‚‚ã€ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã‚ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬7æ¡ï¼ˆåˆ©ç”¨åˆ¶é™ãŠã‚ˆã³ç™»éŒ²æŠ¹æ¶ˆï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>å½“ç¤¾ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»¥ä¸‹ã®ã„ãšã‚Œã‹ã«è©²å½“ã™ã‚‹å ´åˆã«ã¯ã€äº‹å‰ã®é€šçŸ¥ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®å…¨éƒ¨ã‚‚ã—ãã¯ä¸€éƒ¨ã®åˆ©ç”¨ã‚’åˆ¶é™ã—ã€ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã®ç™»éŒ²ã‚’æŠ¹æ¶ˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚\n                  <ul className=\"list-disc list-inside ml-6 mt-2 space-y-1\">\n                    <li>æœ¬è¦ç´„ã®ã„ãšã‚Œã‹ã®æ¡é …ã«é•åã—ãŸå ´åˆ</li>\n                    <li>ç™»éŒ²äº‹é …ã«è™šå½ã®äº‹å®ŸãŒã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã—ãŸå ´åˆ</li>\n                    <li>æ–™é‡‘ç­‰ã®æ”¯æ‰•å‚µå‹™ã®ä¸å±¥è¡ŒãŒã‚ã£ãŸå ´åˆ</li>\n                    <li>å½“ç¤¾ã‹ã‚‰ã®é€£çµ¡ã«å¯¾ã—ã€ä¸€å®šæœŸé–“è¿”ç­”ãŒãªã„å ´åˆ</li>\n                    <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ã€æœ€çµ‚ã®åˆ©ç”¨ã‹ã‚‰ä¸€å®šæœŸé–“åˆ©ç”¨ãŒãªã„å ´åˆ</li>\n                    <li>ãã®ä»–ã€å½“ç¤¾ãŒæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã‚’é©å½“ã§ãªã„ã¨åˆ¤æ–­ã—ãŸå ´åˆ</li>\n                  </ul>\n                </li>\n                <li>å½“ç¤¾ã¯ã€æœ¬æ¡ã«åŸºã¥ãå½“ç¤¾ãŒè¡Œã£ãŸè¡Œç‚ºã«ã‚ˆã‚Šãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç”Ÿã˜ãŸæå®³ã«ã¤ã„ã¦ã€ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬8æ¡ï¼ˆä¿è¨¼ã®å¦èªãŠã‚ˆã³å…è²¬äº‹é …ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>å½“ç¤¾ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«äº‹å®Ÿä¸Šã¾ãŸã¯æ³•å¾‹ä¸Šã®ç‘•ç–µï¼ˆå®‰å…¨æ€§ã€ä¿¡é ¼æ€§ã€æ­£ç¢ºæ€§ã€å®Œå…¨æ€§ã€æœ‰åŠ¹æ€§ã€ç‰¹å®šã®ç›®çš„ã¸ã®é©åˆæ€§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãªã©ã«é–¢ã™ã‚‹æ¬ é™¥ã€ã‚¨ãƒ©ãƒ¼ã‚„ãƒã‚°ã€æ¨©åˆ©ä¾µå®³ãªã©ã‚’å«ã¿ã¾ã™ï¼‰ãŒãªã„ã“ã¨ã‚’æ˜ç¤ºçš„ã«ã‚‚é»™ç¤ºçš„ã«ã‚‚ä¿è¨¼ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚</li>\n                <li>å½“ç¤¾ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«èµ·å› ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç”Ÿã˜ãŸã‚ã‚‰ã‚†ã‚‹æå®³ã«ã¤ã„ã¦ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚ãŸã ã—ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹å½“ç¤¾ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®é–“ã®å¥‘ç´„ãŒæ¶ˆè²»è€…å¥‘ç´„æ³•ã«å®šã‚ã‚‹æ¶ˆè²»è€…å¥‘ç´„ã¨ãªã‚‹å ´åˆã€ã“ã®å…è²¬è¦å®šã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚</li>\n                <li>å‰é …ãŸã ã—æ›¸ã«å®šã‚ã‚‹å ´åˆã§ã‚ã£ã¦ã‚‚ã€å½“ç¤¾ã¯ã€å½“ç¤¾ã®éå¤±ï¼ˆé‡éå¤±ã‚’é™¤ãã¾ã™ï¼‰ã«ã‚ˆã‚‹å‚µå‹™ä¸å±¥è¡Œã¾ãŸã¯ä¸æ³•è¡Œç‚ºã«ã‚ˆã‚Šãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç”Ÿã˜ãŸæå®³ã®ã†ã¡ç‰¹åˆ¥ãªäº‹æƒ…ã‹ã‚‰ç”Ÿã˜ãŸæå®³ï¼ˆå½“ç¤¾ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæå®³ç™ºç”Ÿã«ã¤ãäºˆè¦‹ã—ã€ã¾ãŸã¯äºˆè¦‹ã—å¾—ãŸå ´åˆã‚’å«ã¿ã¾ã™ï¼‰ã«ã¤ã„ã¦ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬9æ¡ï¼ˆã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã®å¤‰æ›´ç­‰ï¼‰</h2>\n              <p className=\"text-slate-700\">\n                å½“ç¤¾ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã™ã‚‹ã“ã¨ãªãã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®å†…å®¹ã‚’å¤‰æ›´ã—ã¾ãŸã¯æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ã‚’ä¸­æ­¢ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã¨ã—ã€ã“ã‚Œã«ã‚ˆã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç”Ÿã˜ãŸæå®³ã«ã¤ã„ã¦ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬10æ¡ï¼ˆåˆ©ç”¨è¦ç´„ã®å¤‰æ›´ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>å½“ç¤¾ã¯ã€å¿…è¦ã¨åˆ¤æ–­ã—ãŸå ´åˆã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã™ã‚‹ã“ã¨ãªãã„ã¤ã§ã‚‚æœ¬è¦ç´„ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n                <li>å¤‰æ›´å¾Œã®æœ¬è¦ç´„ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«æ²ç¤ºã•ã‚ŒãŸæ™‚ç‚¹ã‚ˆã‚ŠåŠ¹åŠ›ã‚’ç”Ÿã˜ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬11æ¡ï¼ˆå€‹äººæƒ…å ±ã®å–æ‰±ã„ï¼‰</h2>\n              <p className=\"text-slate-700\">\n                å½“ç¤¾ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ˆã£ã¦å–å¾—ã™ã‚‹å€‹äººæƒ…å ±ã«ã¤ã„ã¦ã¯ã€å½“ç¤¾ã€Œãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã€ã«å¾“ã„é©åˆ‡ã«å–ã‚Šæ‰±ã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬12æ¡ï¼ˆé€šçŸ¥ã¾ãŸã¯é€£çµ¡ï¼‰</h2>\n              <p className=\"text-slate-700\">\n                ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨å½“ç¤¾ã¨ã®é–“ã®é€šçŸ¥ã¾ãŸã¯é€£çµ¡ã¯ã€å½“ç¤¾ã®å®šã‚ã‚‹æ–¹æ³•ã«ã‚ˆã£ã¦è¡Œã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚å½“ç¤¾ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã€å½“ç¤¾ãŒåˆ¥é€”å®šã‚ã‚‹æ–¹å¼ã«å¾“ã£ãŸå¤‰æ›´å±Šã‘å‡ºãŒãªã„é™ã‚Šã€ç¾åœ¨ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹é€£çµ¡å…ˆãŒæœ‰åŠ¹ãªã‚‚ã®ã¨ã¿ãªã—ã¦å½“è©²é€£çµ¡å…ˆã¸é€šçŸ¥ã¾ãŸã¯é€£çµ¡ã‚’è¡Œã„ã€ã“ã‚Œã‚‰ã¯ã€ç™ºä¿¡æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸åˆ°é”ã—ãŸã‚‚ã®ã¨ã¿ãªã—ã¾ã™ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬13æ¡ï¼ˆæ¨©åˆ©ç¾©å‹™ã®è­²æ¸¡ã®ç¦æ­¢ï¼‰</h2>\n              <p className=\"text-slate-700\">\n                ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€å½“ç¤¾ã®æ›¸é¢ã«ã‚ˆã‚‹äº‹å‰ã®æ‰¿è«¾ãªãã€åˆ©ç”¨å¥‘ç´„ä¸Šã®åœ°ä½ã¾ãŸã¯æœ¬è¦ç´„ã«åŸºã¥ãæ¨©åˆ©ã‚‚ã—ãã¯ç¾©å‹™ã‚’ç¬¬ä¸‰è€…ã«è­²æ¸¡ã—ã€ã¾ãŸã¯æ‹…ä¿ã«ä¾›ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-bold text-slate-900 mb-4\">ç¬¬14æ¡ï¼ˆæº–æ‹ æ³•ãƒ»è£åˆ¤ç®¡è½„ï¼‰</h2>\n              <ol className=\"list-decimal list-inside space-y-2 text-slate-700\">\n                <li>æœ¬è¦ç´„ã®è§£é‡ˆã«ã‚ãŸã£ã¦ã¯ã€æ—¥æœ¬æ³•ã‚’æº–æ‹ æ³•ã¨ã—ã¾ã™ã€‚</li>\n                <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã—ã¦ç´›äº‰ãŒç”Ÿã˜ãŸå ´åˆã«ã¯ã€å½“ç¤¾ã®æœ¬åº—æ‰€åœ¨åœ°ã‚’ç®¡è½„ã™ã‚‹è£åˆ¤æ‰€ã‚’å°‚å±çš„åˆæ„ç®¡è½„ã¨ã—ã¾ã™ã€‚</li>\n              </ol>\n            </section>\n\n            <div className=\"mt-8 pt-6 border-t border-slate-200\">\n              <p className=\"text-sm text-slate-600\">ä»¥ä¸Š</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n",
  "src/services/api.ts": "// Python API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ\nimport { DailyReport, SummaryData } from '../types';\n\nconst API_BASE_URL = import.meta.env.DEV ? 'http://localhost:8000/api' : '/api';\n\n// API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåŸºåº•ã‚¯ãƒ©ã‚¹\nclass ApiClient {\n  private async request(endpoint: string, options: RequestInit = {}): Promise<any> {\n    try {\n      const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n        headers: {\n          'Content-Type': 'application/json',\n          ...options.headers,\n        },\n        ...options,\n      });\n\n      if (!response.ok && response.status !== 404) {\n        // 404ã®å ´åˆã¯Python APIãŒåˆ©ç”¨ã§ããªã„ã®ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      if (response.status === 404) {\n        // Python APIãŒåˆ©ç”¨ã§ããªã„å ´åˆã¯nullã‚’è¿”ã™\n        return null;\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.warn('API request failed, falling back to mock data:', error);\n      return null;\n    }\n  }\n\n  // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯\n  async healthCheck() {\n    return this.request('/health');\n  }\n\n  // æ—¥æ¬¡å ±å‘Šé–¢é€£\n  async getReports(startDate?: string, endDate?: string) {\n    const params = new URLSearchParams();\n    if (startDate) params.append('start_date', startDate);\n    if (endDate) params.append('end_date', endDate);\n    \n    const query = params.toString();\n    return this.request(`/reports${query ? `?${query}` : ''}`);\n  }\n\n  async createReport(reportData: Omit<DailyReport, 'id' | 'createdAt'>) {\n    return this.request('/reports', {\n      method: 'POST',\n      body: JSON.stringify({\n        date: reportData.date,\n        store_name: reportData.storeName,\n        staff_name: reportData.staffName,\n        sales: reportData.sales,\n        purchase: reportData.purchase,\n        labor_cost: reportData.laborCost,\n        utilities: reportData.utilities,\n        promotion: reportData.promotion,\n        cleaning: reportData.cleaning,\n        misc: reportData.misc,\n        communication: reportData.communication,\n        others: reportData.others,\n        report_text: reportData.reportText,\n        line_user_id: reportData.lineUserId,\n      }),\n    });\n  }\n\n  // é›†è¨ˆãƒ‡ãƒ¼ã‚¿\n  async getSummary(periodType: 'daily' | 'weekly' | 'monthly', startDate?: string, endDate?: string) {\n    const params = new URLSearchParams({ period_type: periodType });\n    if (startDate) params.append('start_date', startDate);\n    if (endDate) params.append('end_date', endDate);\n    \n    return this.request(`/summary?${params.toString()}`);\n  }\n}\n\n// ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç”¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹\nexport const apiClient = new ApiClient();\n\n// å¾“æ¥ã®Supabaseé–¢æ•°ã‚’APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçµŒç”±ã«å¤‰æ›´\nexport const getDailyReports = (startDate?: string, endDate?: string) => {\n  return apiClient.getReports(startDate, endDate);\n};\n\nexport const createDailyReport = (reportData: Omit<DailyReport, 'id' | 'createdAt'>) => {\n  return apiClient.createReport(reportData);\n};\n\nexport const getSummaryData = (periodType: 'daily' | 'weekly' | 'monthly', startDate?: string, endDate?: string) => {\n  return apiClient.getSummary(periodType, startDate, endDate);\n};\n\nexport const getDashboardStats = async () => {\n  const today = new Date().toISOString().split('T')[0];\n  return apiClient.getSummary('daily', today, today);\n};\n\n// ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯\nexport const checkApiHealth = () => {\n  return apiClient.healthCheck();\n};\n\n// Legacy functions for compatibility with useAuth hook\nexport const getUserProfile = async (userId: string) => {\n  // For now, return mock data to maintain compatibility\n  // This will be replaced when auth system is fully updated\n  return { data: null, error: { message: 'Function not implemented' } };\n};\n\nexport const createUserProfile = async (profile: any) => {\n  // For now, return mock data to maintain compatibility  \n  // This will be replaced when auth system is fully updated\n  return { data: null, error: { message: 'Function not implemented' } };\n};",
  "src/services/auditLog.ts": "import { supabase } from '@/lib/supabase'\nimport { getCurrentUserOrganizationId } from './organizationService'\n\nexport type AuditAction =\n  | 'user.created'\n  | 'user.updated'\n  | 'user.deleted'\n  | 'user.invited'\n  | 'user.role_changed'\n  | 'store.created'\n  | 'store.updated'\n  | 'store.deleted'\n  | 'report.created'\n  | 'report.updated'\n  | 'report.deleted'\n  | 'report.shared'\n  | 'organization.updated'\n  | 'organization.settings_changed'\n  | 'subscription.upgraded'\n  | 'subscription.downgraded'\n  | 'subscription.cancelled'\n  | 'auth.login'\n  | 'auth.logout'\n  | 'auth.failed_login'\n\nexport type ResourceType = 'user' | 'store' | 'report' | 'organization' | 'subscription' | 'auth'\n\nexport interface AuditLogEntry {\n  id: string\n  organization_id: string\n  user_id: string | null\n  action: AuditAction\n  resource_type: ResourceType\n  resource_id?: string\n  details: Record<string, any>\n  ip_address?: string\n  user_agent?: string\n  status: 'success' | 'failure'\n  error_message?: string\n  created_at: string\n}\n\nexport interface AuditLogFilters {\n  userId?: string\n  action?: AuditAction\n  resourceType?: ResourceType\n  resourceId?: string\n  status?: 'success' | 'failure'\n  startDate?: Date\n  endDate?: Date\n  limit?: number\n  offset?: number\n}\n\n/**\n * ç›£æŸ»ãƒ­ã‚°ã‚’ä½œæˆ\n */\nexport async function createAuditLog(\n  userId: string,\n  action: AuditAction,\n  resourceType: ResourceType,\n  options?: {\n    resourceId?: string\n    details?: Record<string, any>\n    status?: 'success' | 'failure'\n    errorMessage?: string\n  }\n): Promise<{ success: boolean; error?: any }> {\n  try {\n    const organizationId = await getCurrentUserOrganizationId(userId)\n\n    if (!organizationId) {\n      console.error('Cannot create audit log: organization not found')\n      return { success: false, error: 'Organization not found' }\n    }\n\n    const { error } = await supabase.from('audit_logs').insert({\n      organization_id: organizationId,\n      user_id: userId,\n      action,\n      resource_type: resourceType,\n      resource_id: options?.resourceId,\n      details: options?.details || {},\n      status: options?.status || 'success',\n      error_message: options?.errorMessage\n    })\n\n    if (error) {\n      console.error('Failed to create audit log:', error)\n      return { success: false, error }\n    }\n\n    return { success: true }\n  } catch (error) {\n    console.error('Error creating audit log:', error)\n    return { success: false, error }\n  }\n}\n\n/**\n * ç›£æŸ»ãƒ­ã‚°ã‚’å–å¾—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¯èƒ½ï¼‰\n */\nexport async function getAuditLogs(\n  organizationId: string,\n  filters?: AuditLogFilters\n): Promise<{ data: AuditLogEntry[] | null; error: any }> {\n  try {\n    let query = supabase\n      .from('audit_logs')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .order('created_at', { ascending: false })\n\n    if (filters?.userId) {\n      query = query.eq('user_id', filters.userId)\n    }\n\n    if (filters?.action) {\n      query = query.eq('action', filters.action)\n    }\n\n    if (filters?.resourceType) {\n      query = query.eq('resource_type', filters.resourceType)\n    }\n\n    if (filters?.resourceId) {\n      query = query.eq('resource_id', filters.resourceId)\n    }\n\n    if (filters?.status) {\n      query = query.eq('status', filters.status)\n    }\n\n    if (filters?.startDate) {\n      query = query.gte('created_at', filters.startDate.toISOString())\n    }\n\n    if (filters?.endDate) {\n      query = query.lte('created_at', filters.endDate.toISOString())\n    }\n\n    if (filters?.limit) {\n      query = query.limit(filters.limit)\n    }\n\n    if (filters?.offset) {\n      query = query.range(filters.offset, filters.offset + (filters.limit || 50) - 1)\n    }\n\n    const { data, error } = await query\n\n    return { data, error }\n  } catch (error) {\n    console.error('Error fetching audit logs:', error)\n    return { data: null, error }\n  }\n}\n\n/**\n * ç‰¹å®šãƒªã‚½ãƒ¼ã‚¹ã®ç›£æŸ»ãƒ­ã‚°ã‚’å–å¾—\n */\nexport async function getResourceAuditLogs(\n  organizationId: string,\n  resourceType: ResourceType,\n  resourceId: string\n): Promise<{ data: AuditLogEntry[] | null; error: any }> {\n  return getAuditLogs(organizationId, {\n    resourceType,\n    resourceId,\n    limit: 100\n  })\n}\n\n/**\n * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’å–å¾—\n */\nexport async function getUserActivity(\n  organizationId: string,\n  userId: string,\n  limit: number = 50\n): Promise<{ data: AuditLogEntry[] | null; error: any }> {\n  return getAuditLogs(organizationId, {\n    userId,\n    limit\n  })\n}\n\n/**\n * ç›£æŸ»ãƒ­ã‚°ã®çµ±è¨ˆã‚’å–å¾—\n */\nexport async function getAuditLogStats(\n  organizationId: string,\n  startDate?: Date,\n  endDate?: Date\n): Promise<{\n  totalLogs: number\n  successCount: number\n  failureCount: number\n  actionCounts: Record<string, number>\n  userCounts: Record<string, number>\n}> {\n  const filters: AuditLogFilters = { startDate, endDate }\n  const { data: logs } = await getAuditLogs(organizationId, filters)\n\n  if (!logs) {\n    return {\n      totalLogs: 0,\n      successCount: 0,\n      failureCount: 0,\n      actionCounts: {},\n      userCounts: {}\n    }\n  }\n\n  const actionCounts: Record<string, number> = {}\n  const userCounts: Record<string, number> = {}\n  let successCount = 0\n  let failureCount = 0\n\n  logs.forEach((log) => {\n    if (log.status === 'success') successCount++\n    else failureCount++\n\n    actionCounts[log.action] = (actionCounts[log.action] || 0) + 1\n\n    if (log.user_id) {\n      userCounts[log.user_id] = (userCounts[log.user_id] || 0) + 1\n    }\n  })\n\n  return {\n    totalLogs: logs.length,\n    successCount,\n    failureCount,\n    actionCounts,\n    userCounts\n  }\n}\n\n/**\n * ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åã‚’æ—¥æœ¬èªã«å¤‰æ›\n */\nexport function getActionLabel(action: AuditAction): string {\n  const labels: Record<AuditAction, string> = {\n    'user.created': 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ',\n    'user.updated': 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°',\n    'user.deleted': 'ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤',\n    'user.invited': 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…',\n    'user.role_changed': 'æ¨©é™å¤‰æ›´',\n    'store.created': 'åº—èˆ—ä½œæˆ',\n    'store.updated': 'åº—èˆ—æ›´æ–°',\n    'store.deleted': 'åº—èˆ—å‰Šé™¤',\n    'report.created': 'ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ',\n    'report.updated': 'ãƒ¬ãƒãƒ¼ãƒˆæ›´æ–°',\n    'report.deleted': 'ãƒ¬ãƒãƒ¼ãƒˆå‰Šé™¤',\n    'report.shared': 'ãƒ¬ãƒãƒ¼ãƒˆå…±æœ‰',\n    'organization.updated': 'çµ„ç¹”æƒ…å ±æ›´æ–°',\n    'organization.settings_changed': 'çµ„ç¹”è¨­å®šå¤‰æ›´',\n    'subscription.upgraded': 'ãƒ—ãƒ©ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰',\n    'subscription.downgraded': 'ãƒ—ãƒ©ãƒ³ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰',\n    'subscription.cancelled': 'ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³è§£ç´„',\n    'auth.login': 'ãƒ­ã‚°ã‚¤ãƒ³',\n    'auth.logout': 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ',\n    'auth.failed_login': 'ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—'\n  }\n\n  return labels[action] || action\n}\n\n/**\n * ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—åã‚’æ—¥æœ¬èªã«å¤‰æ›\n */\nexport function getResourceTypeLabel(resourceType: ResourceType): string {\n  const labels: Record<ResourceType, string> = {\n    user: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼',\n    store: 'åº—èˆ—',\n    report: 'ãƒ¬ãƒãƒ¼ãƒˆ',\n    organization: 'çµ„ç¹”',\n    subscription: 'ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³',\n    auth: 'èªè¨¼'\n  }\n\n  return labels[resourceType] || resourceType\n}\n",
  "src/services/chatArchive.ts": "import { supabase, isSupabaseReady } from '../lib/supabase'\n\nexport type ChatRole = 'system' | 'user' | 'assistant'\n\nexport interface Conversation {\n  id: string\n  user_id: string\n  store_id?: string | null\n  title?: string | null\n  archived: boolean\n  created_at: string\n  updated_at: string\n}\n\nexport interface Message {\n  id: string\n  conversation_id: string\n  role: ChatRole\n  content: string\n  tokens?: number | null\n  meta?: any\n  created_at: string\n}\n\nconst LS_CONV = 'ai_conversations'\nconst LS_MSG = 'ai_messages'\nconst useMock = () => !isSupabaseReady()\n\nconst readLS = <T>(k: string, def: T): T => {\n  try {\n    return JSON.parse(localStorage.getItem(k) || 'null') ?? def\n  } catch {\n    return def\n  }\n}\n\nconst writeLS = (k: string, v: any) => localStorage.setItem(k, JSON.stringify(v))\n\nexport async function createConversation(userId: string, storeId?: string, title?: string) {\n  if (useMock()) {\n    const now = new Date().toISOString()\n    const id = crypto.randomUUID()\n    const conv: Conversation = {\n      id,\n      user_id: userId,\n      store_id: storeId ?? 'all',\n      title: title ?? 'æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ',\n      archived: false,\n      created_at: now,\n      updated_at: now\n    }\n    const list = readLS<Conversation[]>(LS_CONV, [])\n    list.unshift(conv)\n    writeLS(LS_CONV, list)\n    return { data: conv, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('ai_conversations')\n    .insert({ user_id: userId, store_id: storeId ?? 'all', title })\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport async function listConversations({ archived = false }: { archived?: boolean } = {}) {\n  if (useMock()) {\n    const all = readLS<Conversation[]>(LS_CONV, [])\n    return {\n      data: all\n        .filter(c => c.archived === archived)\n        .sort((a, b) => b.updated_at.localeCompare(a.updated_at)),\n      error: null\n    }\n  }\n\n  const { data, error } = await supabase!\n    .from('ai_conversations')\n    .select('*')\n    .eq('archived', archived)\n    .order('updated_at', { ascending: false })\n\n  return { data, error }\n}\n\nexport async function updateConversation(\n  id: string,\n  patch: Partial<Pick<Conversation, 'title' | 'archived'>>\n) {\n  if (useMock()) {\n    const all = readLS<Conversation[]>(LS_CONV, [])\n    const idx = all.findIndex(c => c.id === id)\n    if (idx >= 0) {\n      all[idx] = { ...all[idx], ...patch, updated_at: new Date().toISOString() }\n      writeLS(LS_CONV, all)\n      return { data: all[idx], error: null }\n    }\n    return { data: null, error: { message: 'not found' } as any }\n  }\n\n  const { data, error } = await supabase!\n    .from('ai_conversations')\n    .update({ ...patch, updated_at: new Date().toISOString() })\n    .eq('id', id)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport async function fetchMessages(conversationId: string) {\n  if (useMock()) {\n    const all = readLS<Message[]>(LS_MSG, [])\n    return {\n      data: all\n        .filter(m => m.conversation_id === conversationId)\n        .sort((a, b) => a.created_at.localeCompare(b.created_at)),\n      error: null\n    }\n  }\n\n  const { data, error } = await supabase!\n    .from('ai_messages')\n    .select('*')\n    .eq('conversation_id', conversationId)\n    .order('created_at', { ascending: true })\n\n  return { data, error }\n}\n\nexport async function addMessage(\n  conversationId: string,\n  role: ChatRole,\n  content: string,\n  meta?: any\n) {\n  if (useMock()) {\n    const now = new Date().toISOString()\n    const msg: Message = {\n      id: crypto.randomUUID(),\n      conversation_id: conversationId,\n      role,\n      content,\n      meta,\n      created_at: now\n    }\n    const msgs = readLS<Message[]>(LS_MSG, [])\n    msgs.push(msg)\n    writeLS(LS_MSG, msgs)\n\n    const convs = readLS<Conversation[]>(LS_CONV, [])\n    const i = convs.findIndex(c => c.id === conversationId)\n    if (i >= 0) {\n      convs[i].updated_at = now\n      writeLS(LS_CONV, convs)\n    }\n    return { data: msg, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('ai_messages')\n    .insert({ conversation_id: conversationId, role, content, meta })\n    .select()\n    .single()\n\n  if (!error) {\n    await supabase!\n      .from('ai_conversations')\n      .update({ updated_at: new Date().toISOString() })\n      .eq('id', conversationId)\n  }\n\n  return { data, error }\n}\n\nexport async function searchConversations(q: string) {\n  if (useMock()) {\n    const msgs = readLS<Message[]>(LS_MSG, [])\n    const convs = readLS<Conversation[]>(LS_CONV, [])\n    const hits = msgs\n      .filter(m => m.content.toLowerCase().includes(q.toLowerCase()))\n      .map(m => ({\n        conversation_id: m.conversation_id,\n        snippet: m.content.slice(0, 160),\n        created_at: m.created_at\n      }))\n\n    return {\n      data: hits.map(h => ({\n        ...h,\n        title: convs.find(c => c.id === h.conversation_id)?.title ?? 'ï¼ˆç„¡é¡Œï¼‰'\n      })),\n      error: null\n    }\n  }\n\n  const { data, error } = await supabase!.rpc('ai_search_messages', { q })\n\n  if (error) {\n    return { data: [], error }\n  }\n\n  const convIds = [...new Set(data?.map((d: any) => d.conversation_id) ?? [])]\n  const { data: convs } = await supabase!\n    .from('ai_conversations')\n    .select('id, title')\n    .in('id', convIds)\n\n  const results = data?.map((d: any) => ({\n    ...d,\n    title: convs?.find((c: any) => c.id === d.conversation_id)?.title ?? 'ï¼ˆç„¡é¡Œï¼‰'\n  }))\n\n  return { data: results, error: null }\n}\n\nexport async function deleteConversation(id: string) {\n  if (useMock()) {\n    const all = readLS<Conversation[]>(LS_CONV, [])\n    const filtered = all.filter(c => c.id !== id)\n    writeLS(LS_CONV, filtered)\n\n    const msgs = readLS<Message[]>(LS_MSG, [])\n    const filteredMsgs = msgs.filter(m => m.conversation_id !== id)\n    writeLS(LS_MSG, filteredMsgs)\n\n    return { error: null }\n  }\n\n  const { error } = await supabase!\n    .from('ai_conversations')\n    .delete()\n    .eq('id', id)\n\n  return { error }\n}\n",
  "src/services/googleSheets.ts": "import { supabase } from '../lib/supabase';\n\ninterface GoogleSheetsResponse {\n  success: boolean;\n  message?: string;\n  error?: string;\n  updatedRange?: string;\n}\n\nexport const createGoogleSheetsTemplate = async (): Promise<{ success: boolean; message?: string; error?: string }> => {\n  try {\n    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ä½œæˆã™ã‚‹ãŸã‚ã®é–¢æ•°\n    const headerRow = [\n      'æ—¥ä»˜', 'åº—èˆ—å', 'ã‚¹ã‚¿ãƒƒãƒ•å', 'å£²ä¸Š', 'ä»•å…¥', 'äººä»¶è²»', \n      'å…‰ç†±è²»', 'è²©ä¿ƒè²»', 'æ¸…æƒè²»', 'é›‘è²»', 'é€šä¿¡è²»', 'ãã®ä»–', \n      'å ±å‘Šå†…å®¹', 'ä½œæˆæ—¥æ™‚', 'çµŒè²»åˆè¨ˆ', 'ç²—åˆ©ç›Š', 'å–¶æ¥­åˆ©ç›Š'\n    ];\n\n    const { data, error } = await supabase.functions.invoke('sync-to-sheets', {\n      body: { \n        reportData: {\n          date: headerRow[0],\n          store_name: headerRow[1],\n          staff_name: headerRow[2],\n          sales: headerRow[3],\n          purchase: headerRow[4],\n          labor_cost: headerRow[5],\n          utilities: headerRow[6],\n          promotion: headerRow[7],\n          cleaning: headerRow[8],\n          misc: headerRow[9],\n          communication: headerRow[10],\n          others: headerRow[11],\n          report_text: headerRow[12],\n          created_at: headerRow[13]\n        },\n        isTemplate: true \n      }\n    });\n\n    if (error) {\n      return {\n        success: false,\n        error: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'\n      };\n    }\n\n    return {\n      success: true,\n      message: 'Google Sheetsãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ'\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆã‚µãƒ¼ãƒ“ã‚¹ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'\n    };\n  }\n};\n\nexport const getGoogleSheetsUrl = (sheetId: string): string => {\n  return `https://docs.google.com/spreadsheets/d/${sheetId}/edit`;\n};\n\nexport const readFromSheets = async (): Promise<{ success: boolean; data?: any[]; error?: string }> => {\n  try {\n    const SHEET_ID = '1GWp6bW4WnSc9EFobaYNqhUz6wtMuL6gG74Tg2Osvtco';\n    const API_KEY = import.meta.env.VITE_GOOGLE_SHEETS_API_KEY;\n    \n    if (!API_KEY) {\n      return { success: false, error: 'APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“' };\n    }\n\n    // API key format validation\n    if (!API_KEY.startsWith('AIza') || API_KEY.length < 35) {\n      return { \n        success: false, \n        error: 'APIã‚­ãƒ¼ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚Google Cloud Consoleã§APIã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚' \n      };\n    }\n\n    const range = 'daily_reports!A:O'; // Aåˆ—ã‹ã‚‰Oåˆ—ã¾ã§\n    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${range}?key=${API_KEY}`;\n    \n    const response = await fetch(url);\n    \n    if (!response.ok) {\n      let errorMessage = `HTTP ${response.status}: ${response.statusText}`;\n      \n      try {\n        const errorData = await response.json();\n        if (errorData.error) {\n          switch (response.status) {\n            case 400:\n              if (errorData.error.message.includes('API key')) {\n                errorMessage = 'APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚Google Cloud Consoleã§APIã‚­ãƒ¼ã‚’ç¢ºèªã—ã€Google Sheets APIãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';\n              } else if (errorData.error.message.includes('Unable to parse range')) {\n                errorMessage = 'ã‚·ãƒ¼ãƒˆã®ç¯„å›²æŒ‡å®šãŒç„¡åŠ¹ã§ã™ã€‚ã‚·ãƒ¼ãƒˆåã€Œdaily_reportsã€ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';\n              } else {\n                errorMessage = `APIè¨­å®šã‚¨ãƒ©ãƒ¼: ${errorData.error.message}`;\n              }\n              break;\n            case 403:\n              errorMessage = 'APIã‚­ãƒ¼ã«Google Sheets APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚Google Cloud Consoleã§APIã‚­ãƒ¼ã®åˆ¶é™è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';\n              break;\n            case 404:\n              errorMessage = 'æŒ‡å®šã•ã‚ŒãŸGoogle SheetsãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚·ãƒ¼ãƒˆIDãŒæ­£ã—ã„ã‹ã€ã‚·ãƒ¼ãƒˆãŒå‰Šé™¤ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚';\n              break;\n            default:\n              errorMessage = errorData.error.message || errorMessage;\n          }\n        }\n      } catch (parseError) {\n        console.error('Error parsing API response:', parseError);\n      }\n      \n      return { success: false, error: errorMessage };\n    }\n    \n    const result = await response.json();\n    const rows = result.values || [];\n    \n    if (rows.length <= 1) {\n      return { success: true, data: [] };\n    }\n    \n    // Skip header row and convert to objects\n    const data = rows.slice(1).map((row: string[]) => ({\n      date: row[0],\n      storeName: row[1],\n      staffName: row[2],\n      sales: parseFloat(row[3]) || 0,\n      purchase: parseFloat(row[4]) || 0,\n      laborCost: parseFloat(row[5]) || 0,\n      utilities: parseFloat(row[6]) || 0,\n      promotion: parseFloat(row[7]) || 0,\n      cleaning: parseFloat(row[8]) || 0,\n      misc: parseFloat(row[9]) || 0,\n      communication: parseFloat(row[10]) || 0,\n      others: parseFloat(row[11]) || 0,\n      reportText: row[12] || '',\n      createdAt: row[13] || ''\n    }));\n    \n    return { success: true, data };\n  } catch (error) {\n    console.error('Read from sheets error:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'\n    };\n  }\n};\n",
  "src/services/organizationService.ts": "import { supabase } from '@/lib/supabase'\r\nimport { createAuditLog } from './auditLog'\r\n\r\n/**\r\n * çµ„ç¹”ã‚µãƒ¼ãƒ“ã‚¹\r\n * ãƒ‡ãƒ¼ã‚¿ä½œæˆæ™‚ã« organization_id ã‚’è‡ªå‹•çš„ã«è¨­å®šã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°\r\n */\r\n\r\n/**\r\n * ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® organization_id ã‚’å–å¾—\r\n */\r\nexport async function getCurrentUserOrganizationId(userId: string): Promise<string | null> {\r\n  if (!userId) return null\r\n\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('organization_members')\r\n      .select('organization_id')\r\n      .eq('user_id', userId)\r\n      .maybeSingle()\r\n\r\n    if (error) {\r\n      console.error('Failed to get organization ID:', error)\r\n      return null\r\n    }\r\n\r\n    return data?.organization_id || null\r\n  } catch (error) {\r\n    console.error('Error getting organization ID:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ organization_id ã‚’å–å¾—\r\n */\r\nexport async function getOrganizationIdFromProfile(userId: string): Promise<string | null> {\r\n  if (!userId) return null\r\n\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('profiles')\r\n      .select('organization_id')\r\n      .eq('id', userId)\r\n      .maybeSingle()\r\n\r\n    if (error) {\r\n      console.error('Failed to get organization ID from profile:', error)\r\n      return null\r\n    }\r\n\r\n    return data?.organization_id || null\r\n  } catch (error) {\r\n    console.error('Error getting organization ID from profile:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * ãƒ‡ãƒ¼ã‚¿ä½œæˆæ™‚ã« organization_id ã‚’è‡ªå‹•è¨­å®š\r\n * RLSãƒãƒªã‚·ãƒ¼ã§è‡ªå‹•çš„ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ãŸã‚ã€SELECTã«ã¯ä¸è¦\r\n */\r\nexport async function withOrganizationId<T extends Record<string, any>>(\r\n  userId: string,\r\n  data: T\r\n): Promise<T & { organization_id: string }> {\r\n  const organizationId = await getCurrentUserOrganizationId(userId)\r\n\r\n  if (!organizationId) {\r\n    throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçµ„ç¹”ã«æ‰€å±ã—ã¦ã„ã¾ã›ã‚“')\r\n  }\r\n\r\n  return {\r\n    ...data,\r\n    organization_id: organizationId\r\n  }\r\n}\r\n\r\n/**\r\n * è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã« organization_id ã‚’ä¸€æ‹¬è¨­å®š\r\n */\r\nexport async function withOrganizationIdBatch<T extends Record<string, any>>(\r\n  userId: string,\r\n  dataArray: T[]\r\n): Promise<Array<T & { organization_id: string }>> {\r\n  const organizationId = await getCurrentUserOrganizationId(userId)\r\n\r\n  if (!organizationId) {\r\n    throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçµ„ç¹”ã«æ‰€å±ã—ã¦ã„ã¾ã›ã‚“')\r\n  }\r\n\r\n  return dataArray.map(data => ({\r\n    ...data,\r\n    organization_id: organizationId\r\n  }))\r\n}\r\n\r\n/**\r\n * çµ„ç¹”æƒ…å ±ã‚’å–å¾—\r\n */\r\nexport async function getOrganization(organizationId: string) {\r\n  const { data, error } = await supabase\r\n    .from('organizations')\r\n    .select('*')\r\n    .eq('id', organizationId)\r\n    .single()\r\n\r\n  return { data, error }\r\n}\r\n\r\n/**\r\n * çµ„ç¹”ã‚’æ›´æ–°\r\n */\r\nexport async function updateOrganization(organizationId: string, updates: any, userId?: string) {\r\n  const { data, error } = await supabase\r\n    .from('organizations')\r\n    .update({\r\n      ...updates,\r\n      updated_at: new Date().toISOString()\r\n    })\r\n    .eq('id', organizationId)\r\n    .select()\r\n    .single()\r\n\r\n  if (!error && userId) {\r\n    await createAuditLog(userId, 'organization.updated', 'organization', {\r\n      resourceId: organizationId,\r\n      details: { updates }\r\n    })\r\n  }\r\n\r\n  return { data, error }\r\n}\r\n\r\n/**\r\n * çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ã‚’å–å¾—\r\n */\r\nexport async function getOrganizationMembers(organizationId: string) {\r\n  const { data, error } = await supabase\r\n    .from('organization_members')\r\n    .select(`\r\n      *,\r\n      profiles!inner(id, name, email, role)\r\n    `)\r\n    .eq('organization_id', organizationId)\r\n    .order('joined_at', { ascending: false })\r\n\r\n  return { data, error }\r\n}\r\n\r\n/**\r\n * çµ„ç¹”ã«ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ \r\n */\r\nexport async function addOrganizationMember(\r\n  organizationId: string,\r\n  userId: string,\r\n  role: 'owner' | 'admin' | 'member' = 'member'\r\n) {\r\n  const { data, error } = await supabase\r\n    .from('organization_members')\r\n    .insert({\r\n      organization_id: organizationId,\r\n      user_id: userId,\r\n      role,\r\n      joined_at: new Date().toISOString()\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  return { data, error }\r\n}\r\n\r\n/**\r\n * çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤\r\n */\r\nexport async function removeOrganizationMember(organizationId: string, userId: string, actorUserId?: string) {\r\n  const { error } = await supabase\r\n    .from('organization_members')\r\n    .delete()\r\n    .eq('organization_id', organizationId)\r\n    .eq('user_id', userId)\r\n\r\n  if (!error && actorUserId) {\r\n    await createAuditLog(actorUserId, 'user.deleted', 'user', {\r\n      resourceId: userId,\r\n      details: { organizationId, removedUserId: userId }\r\n    })\r\n  }\r\n\r\n  return { error }\r\n}\r\n\r\n/**\r\n * çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ã®å½¹å‰²ã‚’æ›´æ–°\r\n */\r\nexport async function updateOrganizationMemberRole(\r\n  organizationId: string,\r\n  userId: string,\r\n  role: 'owner' | 'admin' | 'member',\r\n  actorUserId?: string\r\n) {\r\n  const { data: oldRole } = await supabase\r\n    .from('organization_members')\r\n    .select('role')\r\n    .eq('organization_id', organizationId)\r\n    .eq('user_id', userId)\r\n    .single()\r\n\r\n  const { data, error } = await supabase\r\n    .from('organization_members')\r\n    .update({ role })\r\n    .eq('organization_id', organizationId)\r\n    .eq('user_id', userId)\r\n    .select()\r\n    .single()\r\n\r\n  if (!error && actorUserId) {\r\n    await createAuditLog(actorUserId, 'user.role_changed', 'user', {\r\n      resourceId: userId,\r\n      details: {\r\n        organizationId,\r\n        targetUserId: userId,\r\n        oldRole: oldRole?.role,\r\n        newRole: role\r\n      }\r\n    })\r\n  }\r\n\r\n  return { data, error }\r\n}\r\n\r\n/**\r\n * æ‹›å¾…ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ\r\n */\r\nfunction generateInvitationToken(): string {\r\n  const array = new Uint8Array(32)\r\n  crypto.getRandomValues(array)\r\n  return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('')\r\n}\r\n\r\n/**\r\n * çµ„ç¹”ã¸ã®æ‹›å¾…ã‚’ä½œæˆ\r\n */\r\nexport async function createInvitation(\r\n  organizationId: string,\r\n  email: string,\r\n  role: 'member' | 'admin',\r\n  invitedBy: string\r\n) {\r\n  const token = generateInvitationToken()\r\n\r\n  const { data, error } = await supabase\r\n    .from('organization_invitations')\r\n    .insert({\r\n      organization_id: organizationId,\r\n      email: email.toLowerCase(),\r\n      role,\r\n      token,\r\n      invited_by: invitedBy,\r\n      status: 'pending',\r\n      expires_at: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (!error && data) {\r\n    await createAuditLog(invitedBy, 'user.invited', 'user', {\r\n      resourceId: data.id,\r\n      details: { email, role, organizationId }\r\n    })\r\n  }\r\n\r\n  return { data, error }\r\n}\r\n\r\n/**\r\n * çµ„ç¹”ã®æ‹›å¾…ä¸€è¦§ã‚’å–å¾—\r\n */\r\nexport async function getOrganizationInvitations(organizationId: string) {\r\n  const { data, error } = await supabase\r\n    .from('organization_invitations')\r\n    .select('*')\r\n    .eq('organization_id', organizationId)\r\n    .order('created_at', { ascending: false })\r\n\r\n  return { data, error }\r\n}\r\n\r\n/**\r\n * ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰æ‹›å¾…æƒ…å ±ã‚’å–å¾—\r\n */\r\nexport async function getInvitationByToken(token: string) {\r\n  const { data, error } = await supabase\r\n    .from('organization_invitations')\r\n    .select(`\r\n      *,\r\n      organization:organizations(id, name, slug)\r\n    `)\r\n    .eq('token', token)\r\n    .eq('status', 'pending')\r\n    .maybeSingle()\r\n\r\n  return { data, error }\r\n}\r\n\r\n/**\r\n * æ‹›å¾…ã‚’æ‰¿èªã—ã¦ãƒ¡ãƒ³ãƒãƒ¼ã«è¿½åŠ \r\n */\r\nexport async function acceptInvitation(token: string, userId: string) {\r\n  const { data: invitation, error: inviteError } = await getInvitationByToken(token)\r\n\r\n  if (inviteError || !invitation) {\r\n    return { data: null, error: inviteError || { message: 'æ‹›å¾…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' } }\r\n  }\r\n\r\n  if (new Date(invitation.expires_at) < new Date()) {\r\n    return { data: null, error: { message: 'æ‹›å¾…ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™' } }\r\n  }\r\n\r\n  const { data: existingMember } = await supabase\r\n    .from('organization_members')\r\n    .select('id')\r\n    .eq('organization_id', invitation.organization_id)\r\n    .eq('user_id', userId)\r\n    .maybeSingle()\r\n\r\n  if (existingMember) {\r\n    return { data: null, error: { message: 'æ—¢ã«ã“ã®çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ã§ã™' } }\r\n  }\r\n\r\n  const { data: member, error: memberError } = await supabase\r\n    .from('organization_members')\r\n    .insert({\r\n      organization_id: invitation.organization_id,\r\n      user_id: userId,\r\n      role: invitation.role,\r\n      joined_at: new Date().toISOString()\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (memberError) {\r\n    return { data: null, error: memberError }\r\n  }\r\n\r\n  const { error: updateError } = await supabase\r\n    .from('organization_invitations')\r\n    .update({\r\n      status: 'accepted',\r\n      accepted_at: new Date().toISOString()\r\n    })\r\n    .eq('id', invitation.id)\r\n\r\n  if (updateError) {\r\n    console.error('Failed to update invitation status:', updateError)\r\n  }\r\n\r\n  await supabase\r\n    .from('profiles')\r\n    .update({ organization_id: invitation.organization_id })\r\n    .eq('id', userId)\r\n\r\n  return { data: member, error: null }\r\n}\r\n\r\n/**\r\n * æ‹›å¾…ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«\r\n */\r\nexport async function cancelInvitation(invitationId: string) {\r\n  const { error } = await supabase\r\n    .from('organization_invitations')\r\n    .update({ status: 'cancelled' })\r\n    .eq('id', invitationId)\r\n\r\n  return { error }\r\n}\r\n\r\n/**\r\n * æ‹›å¾…ã‚’å‰Šé™¤\r\n */\r\nexport async function deleteInvitation(invitationId: string) {\r\n  const { error } = await supabase\r\n    .from('organization_invitations')\r\n    .delete()\r\n    .eq('id', invitationId)\r\n\r\n  return { error }\r\n}\r\n\r\n/**\r\n * æ‹›å¾…ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆ\r\n */\r\nexport function generateInvitationLink(token: string): string {\r\n  const baseUrl = window.location.origin\r\n  return `${baseUrl}/invite/${token}`\r\n}\r\n",
  "src/services/sampleData.ts": "import {\n  createStore,\n  createVendor,\n  assignVendorToStore,\n  upsertTarget\n} from './supabase'\n\nexport interface SampleDataResult {\n  success: boolean\n  message: string\n  stores?: { id: string; name: string }[]\n  vendors?: { id: string; name: string }[]\n}\n\n/**\n * ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã™ã‚‹ï¼ˆåˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”¨ï¼‰\n */\nexport const insertSampleData = async (): Promise<SampleDataResult> => {\n  try {\n    const stores: { id: string; name: string }[] = []\n    const vendors: { id: string; name: string }[] = []\n\n    // 1. åº—èˆ—ã‚’ä½œæˆ\n    const storeData = [\n      { name: 'è±Šæ´²åº—', address: 'æ±äº¬éƒ½æ±Ÿæ±åŒºè±Šæ´²4-1-1' },\n      { name: 'æœ‰æ˜åº—', address: 'æ±äº¬éƒ½æ±Ÿæ±åŒºæœ‰æ˜4-3-2' },\n      { name: 'æœ¬åº—', address: 'æ±äº¬éƒ½æ±Ÿæ±åŒºå¤çŸ³å ´2-14-1' }\n    ]\n\n    for (const store of storeData) {\n      const { data, error } = await createStore(store)\n      if (error) {\n        console.error('åº—èˆ—ä½œæˆã‚¨ãƒ©ãƒ¼:', error)\n        continue\n      }\n      if (data) {\n        stores.push({ id: data.id, name: data.name })\n      }\n    }\n\n    if (stores.length === 0) {\n      return {\n        success: false,\n        message: 'åº—èˆ—ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ç®¡ç†è€…æ¨©é™ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'\n      }\n    }\n\n    // 2. æ¥­è€…ã‚’ä½œæˆ\n    const vendorData = [\n      { name: 'è±Šæ´²å¸‚å ´é’æœå¸', category: 'vegetable_meat' as const, contact_info: '03-1234-5678', is_active: true },\n      { name: 'ç¯‰åœ°æµ·ç”£ç‰©', category: 'seafood' as const, contact_info: '03-2345-6789', is_active: true },\n      { name: 'é…’é¡è²©å£²ãƒ•ã‚¸ãƒ¯ãƒ©', category: 'alcohol' as const, contact_info: '03-3456-7890', is_active: true },\n      { name: 'ç±³å•å±‹ç”°ä¸­', category: 'rice' as const, contact_info: '03-4567-8901', is_active: true },\n      { name: 'èª¿å‘³æ–™å°‚é–€åº—', category: 'seasoning' as const, contact_info: '03-5678-9012', is_active: true },\n      { name: 'å†·å‡é£Ÿå“ãƒãƒ«ãƒ¨ã‚·', category: 'frozen' as const, contact_info: '03-6789-0123', is_active: true }\n    ]\n\n    for (const vendor of vendorData) {\n      const { data, error } = await createVendor(vendor)\n      if (error) {\n        console.error('æ¥­è€…ä½œæˆã‚¨ãƒ©ãƒ¼:', error)\n        continue\n      }\n      if (data) {\n        vendors.push({ id: data.id, name: data.name })\n      }\n    }\n\n    // 3. å„åº—èˆ—ã«å…¨æ¥­è€…ã‚’å‰²ã‚Šå½“ã¦\n    for (const store of stores) {\n      for (let i = 0; i < vendors.length; i++) {\n        const vendor = vendors[i]\n        await assignVendorToStore(store.id, vendor.id, i)\n      }\n    }\n\n    // 4. å„åº—èˆ—ã«ç›®æ¨™å€¤ã‚’è¨­å®šï¼ˆå½“æœˆï¼‰\n    const currentMonth = new Date().toISOString().slice(0, 7) // YYYY-MM\n    const targetData = [\n      { store_id: stores[0].id, period: currentMonth, target_sales: 5000000, target_profit: 1000000, target_profit_margin: 20.0 },\n      { store_id: stores[1].id, period: currentMonth, target_sales: 4500000, target_profit: 900000, target_profit_margin: 20.0 },\n      { store_id: stores[2].id, period: currentMonth, target_sales: 6000000, target_profit: 1200000, target_profit_margin: 20.0 }\n    ]\n\n    for (const target of targetData) {\n      if (target.store_id) {\n        await upsertTarget(target)\n      }\n    }\n\n    return {\n      success: true,\n      message: `ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\\nåº—èˆ—: ${stores.length}ä»¶ã€æ¥­è€…: ${vendors.length}ä»¶`,\n      stores,\n      vendors\n    }\n  } catch (error) {\n    console.error('ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ã‚¨ãƒ©ãƒ¼:', error)\n    return {\n      success: false,\n      message: 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'\n    }\n  }\n}\n",
  "src/services/supabase.ts": "import { supabase, isSupabaseReady as isSupabaseConfigured } from '../lib/supabase'\n\n// Re-export for convenience\nexport { isSupabaseConfigured as isSupabaseReady }\nimport { DailyReportData } from '@/types'\nimport { isUUID } from '../lib/utils'\nimport { getCurrentUserOrganizationId, withOrganizationId } from './organizationService'\n\n// Types based on database schema\nexport interface ProfileDb {\n  id: string\n  name: string\n  email: string\n  role: 'staff' | 'manager' | 'admin'\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface StoreDb {\n  id: string\n  name: string\n  address: string\n  manager_id?: string\n  is_active?: boolean\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface DailyReportDb {\n  id: string\n  date: string\n  store_id: string\n  user_id: string\n  sales: number\n  purchase: number\n  labor_cost: number\n  utilities: number\n  rent: number\n  consumables: number\n  promotion: number\n  cleaning: number\n  misc: number\n  communication: number\n  others: number\n  customers?: number\n  report_text?: string\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface VendorDb {\n  id: string\n  name: string\n  category: 'vegetable_meat' | 'seafood' | 'alcohol' | 'rice' | 'seasoning' | 'frozen' | 'dessert' | 'others'\n  contact_info?: string\n  is_active: boolean\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface StoreVendorAssignmentDb {\n  id: string\n  store_id: string\n  vendor_id: string\n  display_order: number\n  created_at?: string\n}\n\nexport interface MonthlyExpenseDb {\n  id: string\n  store_id: string\n  user_id: string\n  month: string // YYYY-MM\n  labor_cost_employee: number\n  labor_cost_part_time: number\n  utilities: number\n  rent: number\n  consumables: number\n  promotion: number\n  cleaning: number\n  misc: number\n  communication: number\n  others: number\n  memo?: string\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface TargetDb {\n  id: string\n  store_id: string\n  period: string // YYYY-MM\n  target_sales: number\n  target_profit: number\n  target_profit_margin: number\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface ExpenseBaselineDb {\n  id: string\n  store_id: string\n  month: string // YYYY-MM\n  labor_cost_employee: number\n  labor_cost_part_time: number\n  utilities: number\n  rent: number\n  consumables: number\n  promotion: number\n  cleaning: number\n  misc: number\n  communication: number\n  others: number\n  open_days: number\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface DailyTargetDb {\n  id: string\n  store_id: string\n  date: string // YYYY-MM-DD\n  target_sales: number\n  created_at?: string\n  updated_at?: string\n}\n\n// Authentication\nexport const signInWithEmailPassword = async (email: string, password: string) => {\n  if (!isSupabaseConfigured()) {\n    return { data: null, error: { message: 'SupabaseãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚' } }\n  }\n  const { data, error } = await supabase!.auth.signInWithPassword({\n    email,\n    password\n  })\n  return { data, error }\n}\n\nexport const signUpWithEmailPassword = async (email: string, password: string, name: string, role: 'staff' | 'manager' | 'admin' = 'staff') => {\n  if (!isSupabaseConfigured()) {\n    return { data: null, error: { message: 'SupabaseãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚' } }\n  }\n  const { data, error } = await supabase!.auth.signUp({\n    email,\n    password,\n    options: {\n      data: {\n        name,\n        role\n      }\n    }\n  })\n\n  if (error) {\n    if (error.message.includes('User already registered') || error.message.includes('user_already_exists')) {\n      return { data: null, error: { message: 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚' } }\n    }\n    return { data: null, error }\n  }\n\n  if (data.user && !error) {\n    const { error: profileError } = await supabase!\n      .from('profiles')\n      .insert({\n        id: data.user.id,\n        name,\n        email,\n        role\n      })\n\n    if (profileError) {\n      if (profileError.message.includes('row-level security policy') || profileError.code === '42501') {\n        return { data: null, error: { message: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆæ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚' } }\n      }\n      return { data, error: profileError }\n    }\n\n    return { data, error: null }\n  }\n\n  return { data, error }\n}\n\nexport const signOut = async () => {\n  if (!isSupabaseConfigured()) {\n    return { error: null }\n  }\n  const { error } = await supabase!.auth.signOut()\n  return { error }\n}\n\nexport const getCurrentUser = async () => {\n  if (!isSupabaseConfigured()) {\n    return { user: null, error: null }\n  }\n  const { data: { user }, error } = await supabase!.auth.getUser()\n  return { user, error }\n}\n\n// Profiles\nexport const getUserProfile = async (userId: string) => {\n  if (!isSupabaseConfigured()) {\n    return { data: null, error: null }\n  }\n  const { data, error } = await supabase!\n    .from('profiles')\n    .select('*')\n    .eq('id', userId)\n\n  if (error) {\n    return { data: null, error }\n  }\n\n  const profile = Array.isArray(data) && data.length > 0 ? data[0] : null\n  return { data: profile, error: null }\n}\n\nexport const updateUserProfile = async (userId: string, updates: Partial<ProfileDb>) => {\n  const { data, error } = await supabase!\n    .from('profiles')\n    .update({ ...updates, updated_at: new Date().toISOString() })\n    .eq('id', userId)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\n// Mock data storage keys\nconst MOCK_STORES_KEY = 'mock_stores'\nconst MOCK_VENDORS_KEY = 'mock_vendors'\nconst MOCK_STORE_VENDOR_ASSIGNMENTS_KEY = 'mock_store_vendor_assignments'\nconst MOCK_TARGETS_KEY = 'mock_targets'\nconst MOCK_DAILY_TARGETS_KEY = 'mock_daily_targets'\n\nconst readMockStores = () => {\n  try {\n    return JSON.parse(localStorage.getItem(MOCK_STORES_KEY) || '[]')\n  } catch {\n    return []\n  }\n}\n\nconst writeMockStores = (stores: any[]) => {\n  localStorage.setItem(MOCK_STORES_KEY, JSON.stringify(stores))\n}\n\nconst readMockVendors = () => {\n  try {\n    return JSON.parse(localStorage.getItem(MOCK_VENDORS_KEY) || '[]')\n  } catch {\n    return []\n  }\n}\n\nconst writeMockVendors = (vendors: any[]) => {\n  localStorage.setItem(MOCK_VENDORS_KEY, JSON.stringify(vendors))\n}\n\nconst readMockStoreVendorAssignments = () => {\n  try {\n    return JSON.parse(localStorage.getItem(MOCK_STORE_VENDOR_ASSIGNMENTS_KEY) || '[]')\n  } catch {\n    return []\n  }\n}\n\nconst writeMockStoreVendorAssignments = (assignments: any[]) => {\n  localStorage.setItem(MOCK_STORE_VENDOR_ASSIGNMENTS_KEY, JSON.stringify(assignments))\n}\n\nconst readMockTargets = (): TargetDb[] => {\n  try {\n    return JSON.parse(localStorage.getItem(MOCK_TARGETS_KEY) || '[]')\n  } catch {\n    return []\n  }\n}\n\nconst writeMockTargets = (targets: TargetDb[]) => {\n  localStorage.setItem(MOCK_TARGETS_KEY, JSON.stringify(targets))\n}\n\nconst MOCK_EXPENSE_BASELINES_KEY = 'mock_expense_baselines'\n\nconst readMockExpenseBaselines = (): ExpenseBaselineDb[] => {\n  try {\n    return JSON.parse(localStorage.getItem(MOCK_EXPENSE_BASELINES_KEY) || '[]')\n  } catch {\n    return []\n  }\n}\n\nconst writeMockExpenseBaselines = (baselines: ExpenseBaselineDb[]) => {\n  localStorage.setItem(MOCK_EXPENSE_BASELINES_KEY, JSON.stringify(baselines))\n}\n\nconst readMockDailyTargets = (): DailyTargetDb[] => {\n  try {\n    return JSON.parse(localStorage.getItem(MOCK_DAILY_TARGETS_KEY) || '[]')\n  } catch {\n    return []\n  }\n}\n\nconst writeMockDailyTargets = (targets: DailyTargetDb[]) => {\n  localStorage.setItem(MOCK_DAILY_TARGETS_KEY, JSON.stringify(targets))\n}\n\nconst genId = () => {\n  if (typeof crypto !== 'undefined' && crypto.randomUUID) {\n    return crypto.randomUUID()\n  }\n  return `mock-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n}\n\n// Stores\nexport const getStores = async () => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ getStores: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰èª­ã¿è¾¼ã¿')\n    const stores = readMockStores()\n    return { data: stores.filter((s: any) => s.is_active !== false), error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('stores')\n    .select('*')\n    .eq('is_active', true)\n    .order('name')\n\n  return { data, error }\n}\n\nexport const getUserStores = async (userId: string) => {\n  if (!isSupabaseConfigured()) {\n    return { data: [], error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('store_assignments')\n    .select(`\n      store_id,\n      stores!inner(*)\n    `)\n    .eq('user_id', userId)\n    .eq('stores.is_active', true)\n\n  const stores = data?.map(assignment => assignment.stores).filter(Boolean) || []\n  return { data: stores, error }\n}\n\nexport const createStore = async (storeData: {\n  name: string\n  address: string\n  manager_id?: string\n  is_active?: boolean\n  user_id?: string\n}) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ createStore: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜')\n    const stores = readMockStores()\n    const newStore = {\n      id: genId(),\n      name: storeData.name,\n      address: storeData.address,\n      manager_id: storeData.manager_id ?? null,\n      is_active: storeData.is_active ?? true,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    }\n    writeMockStores([...stores, newStore])\n    return { data: newStore, error: null }\n  }\n\n  try {\n    let insertData: any = {\n      ...storeData,\n      is_active: storeData.is_active ?? true\n    }\n\n    if (storeData.user_id) {\n      const organizationId = await getCurrentUserOrganizationId(storeData.user_id)\n      if (organizationId) {\n        insertData.organization_id = organizationId\n      }\n    }\n\n    const { data, error } = await supabase!\n      .from('stores')\n      .insert(insertData)\n      .select()\n      .single()\n\n    if (error) {\n      if (error.message?.includes('row-level security') || error.code === '42501') {\n        return {\n          data: null,\n          error: {\n            message: 'ã“ã®æ“ä½œã«ã¯ã€Œç®¡ç†è€…ï¼ˆadminï¼‰ã€æ¨©é™ãŒå¿…è¦ã§ã™ã€‚'\n          }\n        }\n      }\n      return { data: null, error }\n    }\n\n    return { data, error: null }\n  } catch (error: any) {\n    return { data: null, error: { message: error.message || 'åº—èˆ—ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ' } }\n  }\n}\n\nexport const updateStore = async (storeId: string, updates: Partial<StoreDb>) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ updateStore: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°')\n    const stores = readMockStores()\n    const updatedStores = stores.map((s: any) =>\n      s.id === storeId\n        ? { ...s, ...updates, updated_at: new Date().toISOString() }\n        : s\n    )\n    writeMockStores(updatedStores)\n    const updatedStore = updatedStores.find((s: any) => s.id === storeId)\n    return { data: updatedStore, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('stores')\n    .update({ ...updates, updated_at: new Date().toISOString() })\n    .eq('id', storeId)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport const deleteStore = async (storeId: string) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ deleteStore: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤')\n    const stores = readMockStores()\n    const updatedStores = stores.map((s: any) =>\n      s.id === storeId\n        ? { ...s, is_active: false, updated_at: new Date().toISOString() }\n        : s\n    )\n    writeMockStores(updatedStores)\n    const deletedStore = updatedStores.find((s: any) => s.id === storeId)\n    return { data: deletedStore, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('stores')\n    .update({ is_active: false, updated_at: new Date().toISOString() })\n    .eq('id', storeId)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\n// Store assignments\nexport const assignUserToStore = async (userId: string, storeId: string) => {\n  const { data, error } = await supabase!\n    .from('store_assignments')\n    .insert({\n      user_id: userId,\n      store_id: storeId\n    })\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport const removeUserFromStore = async (userId: string, storeId: string) => {\n  const { error } = await supabase!\n    .from('store_assignments')\n    .delete()\n    .eq('user_id', userId)\n    .eq('store_id', storeId)\n\n  return { error }\n}\n\n// Daily Reports\nexport const getDailyReports = async (filters: {\n  storeId?: string\n  dateFrom?: string\n  dateTo?: string\n  userId?: string\n} = {}) => {\n  // âœ¨ æœªè¨­å®šãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å–å¾—\n  if (!isSupabaseConfigured()) {\n    const local: any[] = JSON.parse(localStorage.getItem('userReports') || '[]')\n    // ç°¡æ˜“ãƒ•ã‚£ãƒ«ã‚¿\n    const filtered = local.filter(r => {\n      if (filters.storeId && filters.storeId !== 'all' && r.storeId !== filters.storeId) return false\n      if (filters.dateFrom && r.date < filters.dateFrom) return false\n      if (filters.dateTo && r.date > filters.dateTo) return false\n      return true\n    })\n    return { data: filtered, error: null }\n  }\n\n  if (filters.storeId && filters.storeId !== 'all' && !isUUID(filters.storeId)) {\n    console.warn('Invalid store UUID provided:', filters.storeId)\n    return { data: [], error: null }\n  }\n\n  let query = supabase!\n    .from('daily_reports')\n    .select(`\n      *,\n      stores!inner(name),\n      profiles!inner(name)\n    `)\n    .order('date', { ascending: false })\n\n  if (filters.storeId && filters.storeId !== 'all') {\n    query = query.eq('store_id', filters.storeId)\n  }\n\n  if (filters.dateFrom) {\n    query = query.gte('date', filters.dateFrom)\n  }\n\n  if (filters.dateTo) {\n    query = query.lte('date', filters.dateTo)\n  }\n\n  if (filters.userId && isUUID(filters.userId)) {\n    query = query.eq('user_id', filters.userId)\n  }\n\n  const { data, error } = await query\n\n  const transformedData = data?.map(report => ({\n    id: report.id,\n    date: report.date,\n    storeId: report.store_id,\n    storeName: report.stores.name,\n    staffName: report.profiles.name,\n    sales: report.sales,\n    purchase: report.purchase,\n    laborCost: report.labor_cost,\n    utilities: report.utilities,\n    rent: report.rent || 0,\n    consumables: report.consumables || 0,\n    promotion: report.promotion,\n    cleaning: report.cleaning,\n    misc: report.misc,\n    communication: report.communication,\n    others: report.others,\n    reportText: report.report_text || '',\n    customers: report.customers || 0,\n    vendorPurchases: {},  // åˆ¥é€”daily_report_vendor_purchasesãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—\n    createdAt: report.created_at || ''\n  }))\n\n  return { data: transformedData, error }\n}\n\nexport const createDailyReport = async (reportData: Omit<DailyReportData, 'id' | 'createdAt'> & { userId: string; vendorPurchases?: Record<string, number> }) => {\n  // âœ¨ æœªè¨­å®šãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜\n  if (!isSupabaseConfigured()) {\n    const key = 'userReports'\n    const list = JSON.parse(localStorage.getItem(key) || '[]')\n    const rec = {\n      ...reportData,\n      id: crypto.randomUUID(),\n      createdAt: new Date().toISOString(),\n    }\n    localStorage.setItem(key, JSON.stringify([rec, ...list]))\n    console.log('ğŸ“¦ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜:', rec)\n    return { data: rec, error: null }\n  }\n\n  try {\n    const organizationId = await getCurrentUserOrganizationId(reportData.userId)\n\n    // æ—¥å ±æœ¬ä½“ã‚’ä¿å­˜\n    const insertData: any = {\n      date: reportData.date,\n      store_id: reportData.storeId,\n      user_id: reportData.userId,\n      sales: reportData.sales,\n      purchase: reportData.purchase,\n      labor_cost: reportData.laborCost,\n      utilities: reportData.utilities,\n      promotion: reportData.promotion,\n      cleaning: reportData.cleaning,\n      misc: reportData.misc,\n      communication: reportData.communication,\n      others: reportData.others,\n      customers: reportData.customers,\n      report_text: reportData.reportText\n    }\n\n    if (organizationId) {\n      insertData.organization_id = organizationId\n    }\n\n    const { data, error } = await supabase!\n      .from('daily_reports')\n      .insert(insertData)\n      .select()\n      .single()\n\n    if (error || !data) {\n      return { data, error }\n    }\n\n    // æ¥­è€…åˆ¥ä»•å…¥ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜\n    if (reportData.vendorPurchases && Object.keys(reportData.vendorPurchases).length > 0) {\n      const vendorPurchaseRecords = Object.entries(reportData.vendorPurchases)\n        .filter(([_, amount]) => amount > 0)\n        .map(([vendorId, amount]) => ({\n          daily_report_id: data.id,\n          vendor_id: vendorId,\n          amount: amount,\n          organization_id: organizationId\n        }))\n\n      if (vendorPurchaseRecords.length > 0) {\n        const { error: vendorError } = await supabase!\n          .from('daily_report_vendor_purchases')\n          .insert(vendorPurchaseRecords)\n\n        if (vendorError) {\n          console.error('æ¥­è€…åˆ¥ä»•å…¥ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—:', vendorError)\n        }\n      }\n    }\n\n    return { data, error: null }\n  } catch (error: any) {\n    return { data: null, error: { message: error.message || 'æ—¥å ±ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ' } }\n  }\n}\n\nexport const updateDailyReport = async (reportId: string, updates: Partial<DailyReportDb>) => {\n  // âœ¨ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸IDã®å ´åˆ\n  if (reportId.startsWith('local-') || !isSupabaseConfigured()) {\n    const key = 'userReports'\n    const list: any[] = JSON.parse(localStorage.getItem(key) || '[]')\n    const index = list.findIndex(r => r.id === reportId)\n\n    if (index === -1) {\n      return { data: null, error: { message: 'æ—¥å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' } }\n    }\n\n    // æ›´æ–°\n    const updated = {\n      ...list[index],\n      ...updates,\n      updated_at: new Date().toISOString()\n    }\n    list[index] = updated\n    localStorage.setItem(key, JSON.stringify(list))\n    console.log('ğŸ“¦ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§æ›´æ–°:', updated)\n    return { data: updated, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('daily_reports')\n    .update({ ...updates, updated_at: new Date().toISOString() })\n    .eq('id', reportId)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport const deleteDailyReport = async (reportId: string) => {\n  // âœ¨ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸IDã®å ´åˆ\n  if (reportId.startsWith('local-') || !isSupabaseConfigured()) {\n    const key = 'userReports'\n    const list: any[] = JSON.parse(localStorage.getItem(key) || '[]')\n    const filtered = list.filter(r => r.id !== reportId)\n    localStorage.setItem(key, JSON.stringify(filtered))\n    console.log('ğŸ“¦ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å‰Šé™¤:', reportId)\n    return { error: null }\n  }\n\n  const { error } = await supabase!\n    .from('daily_reports')\n    .delete()\n    .eq('id', reportId)\n\n  return { error }\n}\n\n// Vendors\nexport const getVendors = async () => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ getVendors: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰èª­ã¿è¾¼ã¿')\n    const vendors = readMockVendors()\n    return { data: vendors.filter((v: any) => v.is_active !== false), error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('vendors')\n    .select('*')\n    .eq('is_active', true)\n    .order('name')\n\n  return { data, error }\n}\n\nexport const createVendor = async (vendorData: Omit<VendorDb, 'id' | 'created_at' | 'updated_at'> & { user_id?: string }) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ createVendor: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜')\n    const vendors = readMockVendors()\n    const newVendor = {\n      id: genId(),\n      ...vendorData,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    }\n    writeMockVendors([...vendors, newVendor])\n    return { data: newVendor, error: null }\n  }\n\n  try {\n    let insertData: any = { ...vendorData }\n\n    if (vendorData.user_id) {\n      console.log('ğŸ” createVendor: user_idã‚’ä½¿ç”¨ã—ã¦çµ„ç¹”IDã‚’å–å¾—:', vendorData.user_id)\n      const organizationId = await getCurrentUserOrganizationId(vendorData.user_id)\n      console.log('ğŸ” createVendor: å–å¾—ã—ãŸçµ„ç¹”ID:', organizationId)\n\n      if (!organizationId) {\n        console.error('âŒ createVendor: çµ„ç¹”IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ')\n        return {\n          data: null,\n          error: {\n            message: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµ„ç¹”ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚çµ„ç¹”ã«æ‰€å±ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'\n          }\n        }\n      }\n\n      insertData.organization_id = organizationId\n      delete insertData.user_id\n    } else {\n      console.warn('âš ï¸ createVendor: user_idãŒæ¸¡ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚organization_idãŒè¨­å®šã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™')\n    }\n\n    console.log('ğŸ” createVendor: æŒ¿å…¥ã™ã‚‹ãƒ‡ãƒ¼ã‚¿:', insertData)\n\n    const { data, error } = await supabase!\n      .from('vendors')\n      .insert(insertData)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('âŒ createVendor: Supabaseã‚¨ãƒ©ãƒ¼:', error)\n      if (error.message?.includes('row-level security') || error.code === '42501') {\n        return {\n          data: null,\n          error: {\n            message: 'ã“ã®æ“ä½œã«ã¯ã€Œç®¡ç†è€…ï¼ˆadminï¼‰ã€æ¨©é™ãŒå¿…è¦ã§ã™ã€‚RLSãƒãƒªã‚·ãƒ¼ã§æ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚'\n          }\n        }\n      }\n      return { data: null, error }\n    }\n\n    console.log('âœ… createVendor: æ¥­è€…ä½œæˆæˆåŠŸ:', data)\n    return { data, error: null }\n  } catch (error: any) {\n    console.error('âŒ createVendor: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼:', error)\n    return { data: null, error: { message: error.message || 'ä»•å…¥å…ˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ' } }\n  }\n}\n\nexport const updateVendor = async (vendorId: string, updates: Partial<VendorDb>) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ updateVendor: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°')\n    const vendors = readMockVendors()\n    const updatedVendors = vendors.map((v: any) =>\n      v.id === vendorId\n        ? { ...v, ...updates, updated_at: new Date().toISOString() }\n        : v\n    )\n    writeMockVendors(updatedVendors)\n    const updatedVendor = updatedVendors.find((v: any) => v.id === vendorId)\n    return { data: updatedVendor, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('vendors')\n    .update({ ...updates, updated_at: new Date().toISOString() })\n    .eq('id', vendorId)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport const deleteVendor = async (vendorId: string) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ deleteVendor: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤')\n    const vendors = readMockVendors()\n    const updatedVendors = vendors.map((v: any) =>\n      v.id === vendorId\n        ? { ...v, is_active: false, updated_at: new Date().toISOString() }\n        : v\n    )\n    writeMockVendors(updatedVendors)\n    const deletedVendor = updatedVendors.find((v: any) => v.id === vendorId)\n    return { data: deletedVendor, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('vendors')\n    .update({ is_active: false, updated_at: new Date().toISOString() })\n    .eq('id', vendorId)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\n// Store Vendor Assignments\nexport const getAllStoreVendorAssignments = async () => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ getAllStoreVendorAssignments: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰èª­ã¿è¾¼ã¿')\n    const assignments = readMockStoreVendorAssignments()\n    return { data: assignments, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('store_vendor_assignments')\n    .select('*')\n    .order('display_order')\n\n  return { data, error }\n}\n\nexport const getStoreVendors = async (storeId: string) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ getStoreVendors: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰èª­ã¿è¾¼ã¿')\n    const assignments = readMockStoreVendorAssignments()\n    const vendors = readMockVendors()\n\n    const storeAssignments = assignments\n      .filter((a: any) => a.store_id === storeId)\n      .sort((a: any, b: any) => (a.display_order || 0) - (b.display_order || 0))\n\n    const storeVendors = storeAssignments\n      .map((a: any) => vendors.find((v: any) => v.id === a.vendor_id && v.is_active !== false))\n      .filter(Boolean)\n\n    return { data: storeVendors, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('store_vendor_assignments')\n    .select(`\n      display_order,\n      vendors!inner(*)\n    `)\n    .eq('store_id', storeId)\n    .eq('vendors.is_active', true)\n    .order('display_order')\n\n  const vendors = data?.map(assignment => assignment.vendors).filter(Boolean) || []\n  return { data: vendors, error }\n}\n\nexport const assignVendorToStore = async (storeId: string, vendorId: string, displayOrder?: number) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ assignVendorToStore: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜')\n    const assignments = readMockStoreVendorAssignments()\n\n    // æ—¢ã«å‰²ã‚Šå½“ã¦æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯\n    const exists = assignments.find((a: any) =>\n      a.store_id === storeId && a.vendor_id === vendorId\n    )\n\n    if (exists) {\n      console.log('âš ï¸ assignVendorToStore: æ—¢ã«å‰²ã‚Šå½“ã¦æ¸ˆã¿')\n      return { data: exists, error: null }\n    }\n\n    const newAssignment = {\n      store_id: storeId,\n      vendor_id: vendorId,\n      display_order: displayOrder || 0,\n      created_at: new Date().toISOString()\n    }\n\n    writeMockStoreVendorAssignments([...assignments, newAssignment])\n    return { data: newAssignment, error: null }\n  }\n\n  try {\n    // Get the current user's session\n    const { data: { user } } = await supabase!.auth.getUser()\n\n    if (!user) {\n      return {\n        data: null,\n        error: { message: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“' }\n      }\n    }\n\n    // Get organization_id from the user\n    const organizationId = await getCurrentUserOrganizationId(user.id)\n\n    if (!organizationId) {\n      return {\n        data: null,\n        error: { message: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµ„ç¹”ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' }\n      }\n    }\n\n    const { data, error } = await supabase!\n      .from('store_vendor_assignments')\n      .insert({\n        store_id: storeId,\n        vendor_id: vendorId,\n        display_order: displayOrder || 0,\n        organization_id: organizationId\n      })\n      .select()\n      .single()\n\n    return { data, error }\n  } catch (err: any) {\n    return { data: null, error: { message: err.message || 'æ¥­è€…ã®å‰²ã‚Šå½“ã¦ã«å¤±æ•—ã—ã¾ã—ãŸ' } }\n  }\n}\n\nexport const removeVendorFromStore = async (storeId: string, vendorId: string) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ removeVendorFromStore: Supabaseæœªè¨­å®šã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‰Šé™¤')\n    const assignments = readMockStoreVendorAssignments()\n    const filteredAssignments = assignments.filter((a: any) =>\n      !(a.store_id === storeId && a.vendor_id === vendorId)\n    )\n    writeMockStoreVendorAssignments(filteredAssignments)\n    return { error: null }\n  }\n\n  const { error } = await supabase!\n    .from('store_vendor_assignments')\n    .delete()\n    .eq('store_id', storeId)\n    .eq('vendor_id', vendorId)\n\n  return { error }\n}\n\n// Monthly Expenses\nexport const getMonthlyExpenses = async (filters: {\n  storeId?: string\n  month?: string\n  userId?: string\n} = {}) => {\n  if (!isSupabaseConfigured()) {\n    return { data: [], error: null }\n  }\n\n  if (filters.storeId && filters.storeId !== 'all' && !isUUID(filters.storeId)) {\n    console.warn('Invalid store UUID provided:', filters.storeId)\n    return { data: [], error: null }\n  }\n\n  let query = supabase!\n    .from('monthly_expenses')\n    .select(`\n      *,\n      stores!inner(name)\n    `)\n    .order('month', { ascending: false })\n\n  if (filters.storeId && filters.storeId !== 'all') {\n    query = query.eq('store_id', filters.storeId)\n  }\n\n  if (filters.month) {\n    query = query.eq('month', filters.month)\n  }\n\n  if (filters.userId && isUUID(filters.userId)) {\n    query = query.eq('user_id', filters.userId)\n  }\n\n  const { data, error } = await query\n  return { data, error }\n}\n\nexport const createMonthlyExpense = async (expenseData: Omit<MonthlyExpenseDb, 'id' | 'created_at' | 'updated_at'>) => {\n  const { data, error } = await supabase!\n    .from('monthly_expenses')\n    .insert(expenseData)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport const updateMonthlyExpense = async (expenseId: string, updates: Partial<MonthlyExpenseDb>) => {\n  const { data, error } = await supabase!\n    .from('monthly_expenses')\n    .update({ ...updates, updated_at: new Date().toISOString() })\n    .eq('id', expenseId)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport const upsertMonthlyExpense = async (expenseData: Omit<MonthlyExpenseDb, 'id' | 'created_at' | 'updated_at'>) => {\n  const { data, error } = await supabase!\n    .from('monthly_expenses')\n    .upsert(\n      { ...expenseData, updated_at: new Date().toISOString() },\n      { onConflict: 'store_id,month' }\n    )\n    .select()\n    .single()\n\n  return { data, error }\n}\n\n// Targets\nexport const getTargets = async (filters: {\n  storeId?: string\n  period?: string\n} = {}) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ getTargets: Supabaseæœªè¨­å®šã€LocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿')\n    let targets = readMockTargets()\n\n    if (filters.storeId && filters.storeId !== 'all') {\n      targets = targets.filter(t => t.store_id === filters.storeId)\n    }\n\n    if (filters.period) {\n      targets = targets.filter(t => t.period === filters.period)\n    }\n\n    targets.sort((a, b) => b.period.localeCompare(a.period))\n    return { data: targets, error: null }\n  }\n\n  let query = supabase!\n    .from('targets')\n    .select('*')\n    .order('period', { ascending: false })\n\n  if (filters.storeId && filters.storeId !== 'all') {\n    query = query.eq('store_id', filters.storeId)\n  }\n\n  if (filters.period) {\n    query = query.eq('period', filters.period)\n  }\n\n  const { data, error } = await query\n  return { data, error }\n}\n\nexport const createTarget = async (targetData: Omit<TargetDb, 'id' | 'created_at' | 'updated_at'>) => {\n  const { data, error } = await supabase!\n    .from('targets')\n    .insert(targetData)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport const updateTarget = async (targetId: string, updates: Partial<TargetDb>) => {\n  const { data, error } = await supabase!\n    .from('targets')\n    .update({ ...updates, updated_at: new Date().toISOString() })\n    .eq('id', targetId)\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport const upsertTarget = async (targetData: Omit<TargetDb, 'id' | 'created_at' | 'updated_at'>) => {\n  console.log('ğŸ”µ supabase.ts: upsertTargetå‘¼ã³å‡ºã—', targetData)\n\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ upsertTarget: Supabaseæœªè¨­å®šã€LocalStorageã«ä¿å­˜')\n    const targets = readMockTargets()\n    const now = new Date().toISOString()\n    const existingIndex = targets.findIndex(\n      t => t.store_id === targetData.store_id && t.period === targetData.period\n    )\n\n    let savedTarget: TargetDb\n    if (existingIndex >= 0) {\n      savedTarget = {\n        ...targets[existingIndex],\n        ...targetData,\n        updated_at: now\n      }\n      targets[existingIndex] = savedTarget\n    } else {\n      savedTarget = {\n        id: genId(),\n        ...targetData,\n        created_at: now,\n        updated_at: now\n      }\n      targets.push(savedTarget)\n    }\n\n    writeMockTargets(targets)\n    console.log('ğŸ”§ upsertTarget: LocalStorageã«ä¿å­˜å®Œäº†', savedTarget)\n    return { data: savedTarget, error: null }\n  }\n\n  const dataToUpsert = { ...targetData, updated_at: new Date().toISOString() }\n  console.log('ğŸ”µ supabase.ts: upsertã™ã‚‹ãƒ‡ãƒ¼ã‚¿', dataToUpsert)\n\n  const { data, error } = await supabase!\n    .from('targets')\n    .upsert(\n      dataToUpsert,\n      { onConflict: 'store_id,period' }\n    )\n    .select()\n    .single()\n\n  console.log('ğŸ”µ supabase.ts: upsertçµæœ', { data, error })\n\n  return { data, error }\n}\n\nexport const deleteTarget = async (storeId: string, period: string) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ deleteTarget: Supabaseæœªè¨­å®šã€LocalStorageã‹ã‚‰å‰Šé™¤')\n    const targets = readMockTargets()\n    const filtered = targets.filter(t => !(t.store_id === storeId && t.period === period))\n    writeMockTargets(filtered)\n    return { error: null }\n  }\n\n  const { error } = await supabase!\n    .from('targets')\n    .delete()\n    .eq('store_id', storeId)\n    .eq('period', period)\n\n  return { error }\n}\n\n// Expense Baselines (å‚è€ƒçµŒè²»)\nexport const getExpenseBaseline = async (storeId: string, month: string) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ getExpenseBaseline: Supabaseæœªè¨­å®šã€LocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿')\n    const baselines = readMockExpenseBaselines()\n    const baseline = baselines.find(b => b.store_id === storeId && b.month === month) || null\n    return { data: baseline, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('expense_baselines')\n    .select('*')\n    .eq('store_id', storeId)\n    .eq('month', month)\n    .maybeSingle()\n\n  return { data, error }\n}\n\nexport const upsertExpenseBaseline = async (\n  storeId: string,\n  month: string,\n  payload: Partial<ExpenseBaselineDb>\n) => {\n  const baselineData = {\n    store_id: storeId,\n    month,\n    open_days: payload.open_days ?? 30,\n    labor_cost_employee: payload.labor_cost_employee ?? 0,\n    labor_cost_part_time: payload.labor_cost_part_time ?? 0,\n    utilities: payload.utilities ?? 0,\n    promotion: payload.promotion ?? 0,\n    cleaning: payload.cleaning ?? 0,\n    misc: payload.misc ?? 0,\n    communication: payload.communication ?? 0,\n    others: payload.others ?? 0,\n    updated_at: new Date().toISOString()\n  }\n\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ upsertExpenseBaseline: Supabaseæœªè¨­å®šã€LocalStorageã«ä¿å­˜')\n    const baselines = readMockExpenseBaselines()\n    const index = baselines.findIndex(b => b.store_id === storeId && b.month === month)\n\n    if (index >= 0) {\n      baselines[index] = { ...baselines[index], ...baselineData }\n    } else {\n      baselines.push({\n        id: genId(),\n        ...baselineData,\n        created_at: new Date().toISOString()\n      } as ExpenseBaselineDb)\n    }\n\n    writeMockExpenseBaselines(baselines)\n    return { data: baselineData, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('expense_baselines')\n    .upsert(baselineData, { onConflict: 'store_id,month' })\n    .select()\n    .single()\n\n  return { data, error }\n}\n\nexport const deleteExpenseBaseline = async (storeId: string, month: string) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ deleteExpenseBaseline: Supabaseæœªè¨­å®šã€LocalStorageã‹ã‚‰å‰Šé™¤')\n    const baselines = readMockExpenseBaselines()\n    const filtered = baselines.filter(b => !(b.store_id === storeId && b.month === month))\n    writeMockExpenseBaselines(filtered)\n    return { error: null }\n  }\n\n  const { error } = await supabase!\n    .from('expense_baselines')\n    .delete()\n    .eq('store_id', storeId)\n    .eq('month', month)\n\n  return { error }\n}\n\n// Summary data\nexport const getSummaryData = async (filters: {\n  periodType?: 'daily' | 'weekly' | 'monthly'\n  periodStart?: string\n  periodEnd?: string\n  storeId?: string\n} = {}) => {\n  if (!isSupabaseConfigured()) {\n    return { data: [], error: null }\n  }\n\n  let query = supabase!\n    .from('summary_data')\n    .select('*')\n    .order('period_start', { ascending: false })\n\n  if (filters.periodType) {\n    query = query.eq('period_type', filters.periodType)\n  }\n\n  if (filters.periodStart) {\n    query = query.gte('period_start', filters.periodStart)\n  }\n\n  if (filters.periodEnd) {\n    query = query.lte('period_end', filters.periodEnd)\n  }\n\n  if (filters.storeId && filters.storeId !== 'all') {\n    query = query.eq('store_id', filters.storeId)\n  }\n\n  const { data, error } = await query\n  return { data, error }\n}\n\n// Daily Targets\nexport const getDailyTarget = async (storeId: string, date: string) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ getDailyTarget: Supabaseæœªè¨­å®šã€LocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿')\n    const targets = readMockDailyTargets()\n    const target = targets.find(t => t.store_id === storeId && t.date === date) || null\n    return { data: target, error: null }\n  }\n\n  const { data, error } = await supabase!\n    .from('daily_targets')\n    .select('*')\n    .eq('store_id', storeId)\n    .eq('date', date)\n    .maybeSingle()\n\n  return { data, error }\n}\n\nexport const getDailyTargets = async (filters: {\n  storeId?: string\n  dateFrom?: string\n  dateTo?: string\n} = {}) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ getDailyTargets: Supabaseæœªè¨­å®šã€LocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿')\n    let targets = readMockDailyTargets()\n\n    if (filters.storeId && filters.storeId !== 'all') {\n      targets = targets.filter(t => t.store_id === filters.storeId)\n    }\n\n    if (filters.dateFrom) {\n      targets = targets.filter(t => t.date >= filters.dateFrom!)\n    }\n\n    if (filters.dateTo) {\n      targets = targets.filter(t => t.date <= filters.dateTo!)\n    }\n\n    targets.sort((a, b) => b.date.localeCompare(a.date))\n    return { data: targets, error: null }\n  }\n\n  let query = supabase!\n    .from('daily_targets')\n    .select('*')\n    .order('date', { ascending: false })\n\n  if (filters.storeId && filters.storeId !== 'all') {\n    query = query.eq('store_id', filters.storeId)\n  }\n\n  if (filters.dateFrom) {\n    query = query.gte('date', filters.dateFrom)\n  }\n\n  if (filters.dateTo) {\n    query = query.lte('date', filters.dateTo)\n  }\n\n  const { data, error } = await query\n  return { data, error }\n}\n\nexport const upsertDailyTarget = async (targetData: {\n  storeId: string\n  date: string\n  targetSales: number\n}) => {\n  console.log('ğŸ”µ supabase.ts: upsertDailyTargetå‘¼ã³å‡ºã—', targetData)\n\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ upsertDailyTarget: Supabaseæœªè¨­å®šã€LocalStorageã«ä¿å­˜')\n    const targets = readMockDailyTargets()\n    const now = new Date().toISOString()\n    const existingIndex = targets.findIndex(\n      t => t.store_id === targetData.storeId && t.date === targetData.date\n    )\n\n    let savedTarget: DailyTargetDb\n    if (existingIndex >= 0) {\n      savedTarget = {\n        ...targets[existingIndex],\n        target_sales: targetData.targetSales,\n        updated_at: now\n      }\n      targets[existingIndex] = savedTarget\n    } else {\n      savedTarget = {\n        id: genId(),\n        store_id: targetData.storeId,\n        date: targetData.date,\n        target_sales: targetData.targetSales,\n        created_at: now,\n        updated_at: now\n      }\n      targets.push(savedTarget)\n    }\n\n    writeMockDailyTargets(targets)\n    console.log('ğŸ”§ upsertDailyTarget: LocalStorageã«ä¿å­˜å®Œäº†', savedTarget)\n    return { data: savedTarget, error: null }\n  }\n\n  const dataToUpsert = {\n    store_id: targetData.storeId,\n    date: targetData.date,\n    target_sales: targetData.targetSales,\n    updated_at: new Date().toISOString()\n  }\n  console.log('ğŸ”µ supabase.ts: upsertã™ã‚‹ãƒ‡ãƒ¼ã‚¿', dataToUpsert)\n\n  const { data, error } = await supabase!\n    .from('daily_targets')\n    .upsert(\n      dataToUpsert,\n      { onConflict: 'store_id,date' }\n    )\n    .select()\n    .single()\n\n  console.log('ğŸ”µ supabase.ts: upsertçµæœ', { data, error })\n\n  return { data, error }\n}\n\nexport const deleteDailyTarget = async (storeId: string, date: string) => {\n  if (!isSupabaseConfigured()) {\n    console.log('ğŸ”§ deleteDailyTarget: Supabaseæœªè¨­å®šã€LocalStorageã‹ã‚‰å‰Šé™¤')\n    const targets = readMockDailyTargets()\n    const filtered = targets.filter(t => !(t.store_id === storeId && t.date === date))\n    writeMockDailyTargets(filtered)\n    return { error: null }\n  }\n\n  const { error } = await supabase!\n    .from('daily_targets')\n    .delete()\n    .eq('store_id', storeId)\n    .eq('date', date)\n\n  return { error }\n}\n\n// Health check\nexport const checkSupabaseConnection = async () => {\n  try {\n    const { data, error } = await supabase!\n      .from('profiles')\n      .select('count')\n      .limit(1)\n\n    return { connected: !error, error }\n  } catch (error) {\n    return { connected: false, error }\n  }\n}\n",
  "src/services/usageLimits.ts": "import { supabase } from '@/lib/supabase'\nimport { getCurrentUserOrganizationId } from './organizationService'\n\nexport interface UsageLimits {\n  maxStores: number\n  maxUsers: number\n  maxAIRequestsPerMonth: number\n}\n\nexport interface CurrentUsage {\n  storeCount: number\n  userCount: number\n  aiRequestCount: number\n}\n\nexport interface UsageStatus {\n  limits: UsageLimits\n  current: CurrentUsage\n  canAddStore: boolean\n  canAddUser: boolean\n  canUseAI: boolean\n  storesRemaining: number\n  usersRemaining: number\n  aiRequestsRemaining: number\n}\n\n/**\n * çµ„ç¹”ã®ä½¿ç”¨åˆ¶é™ã‚’å–å¾—\n */\nexport async function getOrganizationLimits(organizationId: string): Promise<UsageLimits> {\n  const { data, error } = await supabase\n    .from('organizations')\n    .select('max_stores, max_users, max_ai_requests_per_month')\n    .eq('id', organizationId)\n    .single()\n\n  if (error) {\n    console.error('Failed to get organization limits:', error)\n    return {\n      maxStores: 1,\n      maxUsers: 3,\n      maxAIRequestsPerMonth: 50\n    }\n  }\n\n  return {\n    maxStores: data.max_stores,\n    maxUsers: data.max_users,\n    maxAIRequestsPerMonth: data.max_ai_requests_per_month\n  }\n}\n\n/**\n * ç¾åœ¨ã®åº—èˆ—æ•°ã‚’å–å¾—\n */\nexport async function getCurrentStoreCount(organizationId: string): Promise<number> {\n  const { count, error } = await supabase\n    .from('stores')\n    .select('id', { count: 'exact', head: true })\n    .eq('organization_id', organizationId)\n\n  if (error) {\n    console.error('Failed to get store count:', error)\n    return 0\n  }\n\n  return count || 0\n}\n\n/**\n * ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’å–å¾—\n */\nexport async function getCurrentUserCount(organizationId: string): Promise<number> {\n  const { count, error } = await supabase\n    .from('organization_members')\n    .select('user_id', { count: 'exact', head: true })\n    .eq('organization_id', organizationId)\n\n  if (error) {\n    console.error('Failed to get user count:', error)\n    return 0\n  }\n\n  return count || 0\n}\n\n/**\n * ä»Šæœˆã®AIä½¿ç”¨å›æ•°ã‚’å–å¾—\n */\nexport async function getCurrentAIUsageCount(organizationId: string): Promise<number> {\n  const startOfMonth = new Date()\n  startOfMonth.setDate(1)\n  startOfMonth.setHours(0, 0, 0, 0)\n\n  const { count, error } = await supabase\n    .from('ai_chat_archive')\n    .select('id', { count: 'exact', head: true })\n    .eq('organization_id', organizationId)\n    .gte('created_at', startOfMonth.toISOString())\n\n  if (error) {\n    console.error('Failed to get AI usage count:', error)\n    return 0\n  }\n\n  return count || 0\n}\n\n/**\n * ä½¿ç”¨çŠ¶æ³ã‚’å–å¾—\n */\nexport async function getUsageStatus(userId: string): Promise<UsageStatus | null> {\n  const organizationId = await getCurrentUserOrganizationId(userId)\n\n  if (!organizationId) {\n    return null\n  }\n\n  const [limits, storeCount, userCount, aiRequestCount] = await Promise.all([\n    getOrganizationLimits(organizationId),\n    getCurrentStoreCount(organizationId),\n    getCurrentUserCount(organizationId),\n    getCurrentAIUsageCount(organizationId)\n  ])\n\n  const canAddStore = limits.maxStores === 0 || storeCount < limits.maxStores\n  const canAddUser = limits.maxUsers === 0 || userCount < limits.maxUsers\n  const canUseAI = limits.maxAIRequestsPerMonth === 0 || aiRequestCount < limits.maxAIRequestsPerMonth\n\n  return {\n    limits,\n    current: {\n      storeCount,\n      userCount,\n      aiRequestCount\n    },\n    canAddStore,\n    canAddUser,\n    canUseAI,\n    storesRemaining: limits.maxStores === 0 ? Infinity : Math.max(0, limits.maxStores - storeCount),\n    usersRemaining: limits.maxUsers === 0 ? Infinity : Math.max(0, limits.maxUsers - userCount),\n    aiRequestsRemaining: limits.maxAIRequestsPerMonth === 0 ? Infinity : Math.max(0, limits.maxAIRequestsPerMonth - aiRequestCount)\n  }\n}\n\n/**\n * åº—èˆ—è¿½åŠ ãŒå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯\n */\nexport async function canAddStore(userId: string): Promise<{ allowed: boolean; message?: string }> {\n  const status = await getUsageStatus(userId)\n\n  if (!status) {\n    return { allowed: false, message: 'çµ„ç¹”æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' }\n  }\n\n  if (!status.canAddStore) {\n    return {\n      allowed: false,\n      message: `åº—èˆ—æ•°ã®ä¸Šé™ï¼ˆ${status.limits.maxStores}åº—èˆ—ï¼‰ã«é”ã—ã¦ã„ã¾ã™ã€‚ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚`\n    }\n  }\n\n  return { allowed: true }\n}\n\n/**\n * ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ãŒå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯\n */\nexport async function canInviteUser(userId: string): Promise<{ allowed: boolean; message?: string }> {\n  const status = await getUsageStatus(userId)\n\n  if (!status) {\n    return { allowed: false, message: 'çµ„ç¹”æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' }\n  }\n\n  if (!status.canAddUser) {\n    return {\n      allowed: false,\n      message: `ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã®ä¸Šé™ï¼ˆ${status.limits.maxUsers}åï¼‰ã«é”ã—ã¦ã„ã¾ã™ã€‚ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚`\n    }\n  }\n\n  return { allowed: true }\n}\n\n/**\n * AIä½¿ç”¨ãŒå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯\n */\nexport async function canUseAI(userId: string): Promise<{ allowed: boolean; message?: string }> {\n  const status = await getUsageStatus(userId)\n\n  if (!status) {\n    return { allowed: false, message: 'çµ„ç¹”æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' }\n  }\n\n  if (!status.canUseAI) {\n    return {\n      allowed: false,\n      message: `ä»Šæœˆã®AIä½¿ç”¨å›æ•°ã®ä¸Šé™ï¼ˆ${status.limits.maxAIRequestsPerMonth}å›ï¼‰ã«é”ã—ã¦ã„ã¾ã™ã€‚æ¥æœˆã¾ã§å¾…ã¤ã‹ã€ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚`\n    }\n  }\n\n  return { allowed: true }\n}\n\n/**\n * ä½¿ç”¨é‡ã®å‰²åˆã‚’è¨ˆç®—\n */\nexport function getUsagePercentage(current: number, max: number): number {\n  if (max === 0) return 0\n  return Math.min(Math.round((current / max) * 100), 100)\n}\n\n/**\n * ä½¿ç”¨é‡ã®çŠ¶æ…‹ã‚’å–å¾—\n */\nexport function getUsageState(current: number, max: number): 'safe' | 'warning' | 'critical' | 'exceeded' {\n  if (max === 0) return 'safe'\n\n  const percentage = (current / max) * 100\n\n  if (current >= max) return 'exceeded'\n  if (percentage >= 90) return 'critical'\n  if (percentage >= 75) return 'warning'\n  return 'safe'\n}\n",
  "src/types/index.ts": "// æ¥­å‹™å ±å‘Šã‚·ã‚¹ãƒ†ãƒ  - å‹å®šç¾©\n\nexport interface DailyReport {\n  id: string;\n  date: string;\n  storeId: string;\n  storeName: string;\n  staffName: string;\n  // å£²ä¸Šè©³ç´°ï¼ˆç¨ç‡ãƒ»æ±ºæ¸ˆæ–¹æ³•åˆ¥ï¼‰\n  salesCash10: number;     // ç¾é‡‘ãƒ»10%é£²é£Ÿ\n  salesCash8: number;      // ç¾é‡‘ãƒ»8%é£²é£Ÿ\n  salesCredit10: number;   // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»10%é£²é£Ÿ\n  salesCredit8: number;    // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»8%é£²é£Ÿ\n  sales: number;           // åˆè¨ˆå£²ä¸Šï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰\n  purchase: number;        // ä»•å…¥ã‚Œ\n  laborCost: number;      // äººä»¶è²»\n  utilities: number;      // æ°´é“å…‰ç†±è²»\n  rent: number;          // è³ƒæ–™\n  consumables: number;   // æ¶ˆè€—å“è²»\n  promotion: number;      // è²©ä¿ƒè²»\n  cleaning: number;       // æ¸…æƒè²»\n  misc: number;          // é›‘è²»\n  communication: number; // é€šä¿¡è²»\n  others: number;        // ãã®ä»–\n  reportText: string;    // å ±å‘Šå†…å®¹\n  createdAt: string;\n  lineUserId?: string;   // LINEé€ä¿¡è€…ID\n}\n\nexport interface SummaryData {\n  period: string;\n  periodType: 'daily' | 'weekly' | 'monthly';\n  totalSales: number;\n  totalExpenses: number;\n  grossProfit: number;    // ç²—åˆ©ç›Šï¼ˆå£²ä¸Š - ä»•å…¥ã‚Œï¼‰\n  operatingProfit: number; // å–¶æ¥­åˆ©ç›Šï¼ˆå£²ä¸Š - å…¨çµŒè²»ï¼‰\n  profitMargin: number;   // åˆ©ç›Šç‡\n  storeCount?: number;\n}\n\nexport interface ChartData {\n  labels: string[];\n  datasets: Array<{\n    label: string;\n    data: number[];\n    backgroundColor: string | string[];\n    borderColor?: string;\n    borderWidth?: number;\n  }>;\n}\n\nexport interface Store {\n  id: string;\n  name: string;\n  address: string;\n  manager_id?: string;\n  is_active?: boolean;\n  created_at?: string;\n  updated_at?: string;\n}\n\nexport interface User {\n  id: string;\n  name: string;\n  email: string;\n  role: 'staff' | 'manager' | 'admin';\n  storeIds?: string[];\n  lineUserId?: string;\n  organizationId?: string;\n}\n\nexport interface Organization {\n  id: string;\n  name: string;\n  slug: string;\n  email: string;\n  phone?: string;\n  subscriptionStatus: 'trial' | 'active' | 'suspended' | 'cancelled';\n  subscriptionPlan: 'free' | 'starter' | 'business' | 'enterprise';\n  trialEndsAt?: string;\n  maxStores: number;\n  maxUsers: number;\n  maxAiRequestsPerMonth: number;\n  settings?: Record<string, any>;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface OrganizationMember {\n  organizationId: string;\n  userId: string;\n  role: 'owner' | 'admin' | 'member';\n  joinedAt: string;\n}\n\nexport interface Vendor {\n  id: string;\n  name: string;\n  category: 'vegetable_meat' | 'seafood' | 'alcohol' | 'rice' | 'seasoning' | 'frozen' | 'dessert' | 'others';\n  contactInfo?: string;\n  isActive: boolean;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\nexport interface StoreVendorAssignment {\n  storeId: string;\n  vendorId: string;\n  displayOrder: number;\n}\n\nexport type PeriodType = 'daily' | 'weekly' | 'monthly';\n\n// Google Sheets APIç”¨ã®å‹\nexport interface SheetsData {\n  range: string;\n  majorDimension: 'ROWS' | 'COLUMNS';\n  values: string[][];\n}\n\n// LINE Webhookç”¨ã®å‹\nexport interface LineMessage {\n  type: 'text';\n  text: string;\n}\n\nexport interface LineWebhookEvent {\n  type: 'message';\n  message: LineMessage;\n  source: {\n    userId: string;\n    type: 'user';\n  };\n  timestamp: number;\n  replyToken: string;\n}\n\n// æ—¥å ±ãƒ‡ãƒ¼ã‚¿å‹ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ï¼‰\nexport interface DailyReportData {\n  id: string\n  date: string\n  storeId: string\n  storeName: string\n  staffName: string\n  sales: number\n  purchase: number\n  laborCost: number\n  utilities: number\n  rent: number\n  consumables: number\n  promotion: number\n  cleaning: number\n  misc: number\n  communication: number\n  others: number\n  customers?: number\n  reportText: string\n  vendorPurchases?: Record<string, number>\n  createdAt: string\n}\n\n// ç›®æ¨™ãƒ‡ãƒ¼ã‚¿å‹\nexport interface TargetData {\n  id: string\n  storeId: string\n  storeName?: string\n  period: string\n  periodType: 'daily' | 'weekly' | 'monthly'\n  targetSales: number\n  targetProfit: number\n  targetProfitMargin: number\n  targetCostRate: number      // ç›®æ¨™åŸä¾¡ç‡ (%)\n  targetLaborRate: number     // ç›®æ¨™äººä»¶è²»ç‡ (%)\n  createdAt?: string\n  updatedAt?: string\n}\n\n// æ—¥åˆ¥å£²ä¸Šç›®æ¨™ãƒ‡ãƒ¼ã‚¿å‹\nexport interface DailyTargetData {\n  id: string\n  storeId: string\n  date: string // YYYY-MM-DD\n  targetSales: number\n  createdAt?: string\n  updatedAt?: string\n}\n\n// ç›®æ¨™é”æˆçŠ¶æ³å‹\nexport interface TargetAchievement {\n  targetSales: number\n  actualSales: number\n  achievementRate: number // é”æˆç‡ (%)\n  isAchieved: boolean\n  difference: number // ç›®æ¨™ã¨ã®å·®é¡\n}",
  "src/utils/calculations.ts": "import { DailyReport, SummaryData } from '../types';\n\n// çµŒè²»ã®åˆè¨ˆã‚’è¨ˆç®—\nexport const calculateTotalExpenses = (report: DailyReport): number => {\n  return report.purchase + report.laborCost + report.utilities +\n         report.rent + report.consumables + report.promotion +\n         report.cleaning + report.misc + report.communication + report.others;\n};\n\n// ç²—åˆ©ç›Šã‚’è¨ˆç®—\nexport const calculateGrossProfit = (sales: number, purchase: number): number => {\n  return Math.round(sales - purchase);\n};\n\n// å–¶æ¥­åˆ©ç›Šã‚’è¨ˆç®—\nexport const calculateOperatingProfit = (sales: number, totalExpenses: number): number => {\n  return Math.round(sales - totalExpenses);\n};\n\n// åˆ©ç›Šç‡ã‚’è¨ˆç®—\nexport const calculateProfitMargin = (operatingProfit: number, sales: number): number => {\n  return sales > 0 ? (operatingProfit / sales) * 100 : 0;\n};\n\n// æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰é›†è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\nexport const generateSummaryFromReports = (reports: DailyReport[]): SummaryData[] => {\n  const summaryMap = new Map<string, {\n    totalSales: number;\n    totalExpenses: number;\n    purchase: number;\n  }>();\n\n  reports.forEach(report => {\n    const key = report.date;\n    const existing = summaryMap.get(key) || { totalSales: 0, totalExpenses: 0, purchase: 0 };\n    \n    const expenses = calculateTotalExpenses(report);\n    summaryMap.set(key, {\n      totalSales: existing.totalSales + report.sales,\n      totalExpenses: existing.totalExpenses + expenses,\n      purchase: existing.purchase + report.purchase\n    });\n  });\n\n  return Array.from(summaryMap.entries()).map(([period, data]) => ({\n    period,\n    totalSales: data.totalSales,\n    totalExpenses: data.totalExpenses,\n    grossProfit: calculateGrossProfit(data.totalSales, data.purchase),\n    operatingProfit: calculateOperatingProfit(data.totalSales, data.totalExpenses),\n    profitMargin: calculateProfitMargin(\n      calculateOperatingProfit(data.totalSales, data.totalExpenses), \n      data.totalSales\n    )\n  }));\n};\n\n// æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\nexport const formatDate = (dateString: string): string => {\n  return new Date(dateString).toLocaleDateString('ja-JP', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  });\n};\n\n// é€šè²¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\nexport const formatCurrency = (amount: number): string => {\n  return new Intl.NumberFormat('ja-JP', {\n    style: 'currency',\n    currency: 'JPY'\n  }).format(amount);\n};\n\n// ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\nexport const formatPercent = (value: number): string => {\n  return `${value.toFixed(1)}%`;\n};",
  "src/vite-env.d.ts": "/// <reference types=\"vite/client\" />\n",
  "supabase/functions/chat-gpt/index.ts": "import { createClient } from 'npm:@supabase/supabase-js@2.39.3';\n\ninterface ChatMessage {\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n}\n\ninterface OpenAIRequest {\n  model: string;\n  messages: ChatMessage[];\n  max_tokens?: number;\n  temperature?: number;\n  stream?: boolean;\n}\n\nconst corsHeaders = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n  \"Access-Control-Allow-Headers\": \"authorization, x-client-info, apikey, content-type\",\n};\n\nDeno.serve(async (req: Request) => {\n  if (req.method === \"OPTIONS\") {\n    return new Response(null, {\n      status: 200,\n      headers: corsHeaders,\n    });\n  }\n\n  try {\n    // JWTèªè¨¼ãƒã‚§ãƒƒã‚¯\n    const supabaseUrl = Deno.env.get('SUPABASE_URL')!;\n    const supabaseServiceKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!;\n    const supabase = createClient(supabaseUrl, supabaseServiceKey);\n\n    const authHeader = req.headers.get('Authorization');\n    if (!authHeader) {\n      return new Response(\n        JSON.stringify({\n          success: false,\n          error: 'èªè¨¼ãŒå¿…è¦ã§ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚'\n        }),\n        {\n          status: 401,\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        }\n      );\n    }\n\n    const token = authHeader.replace('Bearer ', '');\n    const { data: { user }, error: userError } = await supabase.auth.getUser(token);\n\n    if (userError || !user) {\n      return new Response(\n        JSON.stringify({\n          success: false,\n          error: 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚'\n        }),\n        {\n          status: 401,\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        }\n      );\n    }\n\n    // AIä½¿ç”¨å›æ•°ãƒã‚§ãƒƒã‚¯\n    const { data: usageCheck, error: usageError } = await supabase.rpc('check_and_increment_usage', {\n      p_user_id: user.id\n    });\n\n    console.log('Usage check result:', usageCheck);\n\n    if (usageError) {\n      console.error('Usage check error:', usageError);\n    }\n\n    if (usageCheck && !usageCheck.allowed) {\n      return new Response(\n        JSON.stringify({\n          success: false,\n          error: `æœ¬æ—¥ã®åˆ©ç”¨ä¸Šé™ï¼ˆ${usageCheck.daily_limit}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚`,\n          message: `${usageCheck.message}\\n\\næ˜æ—¥åˆå‰0æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚\\nãã‚Œã¾ã§ã¯åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿åˆ†ææ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚`,\n          usageInfo: {\n            currentCount: usageCheck.current_count,\n            dailyLimit: usageCheck.daily_limit,\n            remaining: usageCheck.remaining\n          }\n        }),\n        {\n          status: 429,\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        }\n      );\n    }\n\n    const { messages, businessData } = await req.json() as {\n      messages: ChatMessage[];\n      businessData?: {\n        totalSales: number;\n        totalExpenses: number;\n        profitMargin: number;\n        reportCount: number;\n        stores: string[];\n        recentEvents?: string[];\n      };\n    };\n\n    const OPENAI_API_KEY = Deno.env.get('OPENAI_API_KEY');\n    \n    if (!OPENAI_API_KEY) {\n      return new Response(\n        JSON.stringify({ \n          success: false, \n          error: 'OpenAI API ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚' \n        }),\n        {\n          status: 400,\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        }\n      );\n    }\n\n    const systemPrompt = `ã‚ãªãŸã¯å±…é…’å±‹ã„ã£ããƒã‚§ãƒ¼ãƒ³ã®å°‚é–€AIã‚¢ãƒŠãƒªã‚¹ãƒˆã§ã™ã€‚ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«ã€çµŒå–¶ã«å½¹ç«‹ã¤å…·ä½“çš„ã§å®Ÿç”¨çš„ãªå›ç­”ã‚’æ—¥æœ¬èªã§æä¾›ã—ã¦ãã ã•ã„ã€‚\n\nç¾åœ¨ã®æ¥­ç¸¾ãƒ‡ãƒ¼ã‚¿:\n${businessData ? `\n- ç·å£²ä¸Š: ${(businessData.totalSales || 0).toLocaleString('ja-JP')}å††\n- ç·çµŒè²»: ${(businessData.totalExpenses || 0).toLocaleString('ja-JP')}å††\n- åˆ©ç›Šç‡: ${(businessData.profitMargin || 0).toFixed(1)}%\n- å ±å‘Šä»¶æ•°: ${businessData.reportCount || 0}ä»¶\n- åº—èˆ—æ•°: ${businessData.stores?.length || 0}åº—èˆ—\n- åº—èˆ—å: ${businessData.stores?.join('ã€') || 'æœªè¨­å®š'}\n${businessData.recentEvents?.length ? '- ç‰¹åˆ¥å®Ÿç¸¾: ' + businessData.recentEvents.join('ã€') : ''}\n` : 'æ¥­ç¸¾ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...'}\n\nå›ç­”ã®æŒ‡é‡:\n1. å…·ä½“çš„ãªæ•°å€¤ã‚’ä½¿ã£ãŸåˆ†æ\n2. å®Ÿè¡Œå¯èƒ½ãªæ”¹å–„ææ¡ˆ\n3. é£²é£Ÿæ¥­ç•Œã®ä¸€èˆ¬çš„ãªæŒ‡æ¨™ã¨ã®æ¯”è¼ƒ\n4. å­£ç¯€è¦å› ã‚„å¸‚å ´ç’°å¢ƒã®è€ƒæ…®\n5. å„åº—èˆ—ã®ç‰¹å¾´ã‚’æ´»ã‹ã—ãŸæˆ¦ç•¥ææ¡ˆ\n\nç‰¹ã«ä»¥ä¸‹ã®ç‚¹ã‚’é‡è¦–ã—ã¦ãã ã•ã„:\n- åŸä¾¡ç‡: 30-35%ãŒç›®å®‰\n- äººä»¶è²»ç‡: 25-30%ãŒç›®å®‰  \n- å–¶æ¥­åˆ©ç›Šç‡: 15-25%ãŒç›®å®‰\n- è±Šæ´²åº—ã®ç«‹åœ°ç‰¹æ€§ï¼ˆè±Šæ´²å¸‚å ´ã€è¦³å…‰ã‚¨ãƒªã‚¢ï¼‰\n- æœ‰æ˜åº—ã®ã‚ªãƒ•ã‚£ã‚¹è¡—ç«‹åœ°\n- æœ¬åº—ã®åœ°åŸŸå¯†ç€å‹å–¶æ¥­\n\nå›ç­”ã¯ç°¡æ½”ã§åˆ†ã‹ã‚Šã‚„ã™ãã€å¿…è¦ã«å¿œã˜ã¦çµµæ–‡å­—ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚`;\n\n    const openAIMessages: ChatMessage[] = [\n      { role: 'system', content: systemPrompt },\n      ...messages.slice(-10)\n    ];\n\n    const openAIRequest: OpenAIRequest = {\n      model: 'gpt-4o-mini',\n      messages: openAIMessages,\n      max_tokens: 1000,\n      temperature: 0.7\n    };\n\n    console.log('OpenAI API Request:', {\n      messageCount: openAIMessages.length,\n      hasBusinessData: !!businessData,\n      lastUserMessage: messages[messages.length - 1]?.content?.substring(0, 100)\n    });\n\n    const response = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${OPENAI_API_KEY}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(openAIRequest)\n    });\n\n    if (!response.ok) {\n      const errorData = await response.text();\n      console.error('OpenAI API Error:', {\n        status: response.status,\n        statusText: response.statusText,\n        error: errorData\n      });\n      \n      let errorMessage = 'ChatGPT APIã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';\n      \n      if (response.status === 401) {\n        errorMessage = 'OpenAI APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';\n      } else if (response.status === 429) {\n        errorMessage = 'APIåˆ©ç”¨åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';\n      } else if (response.status === 500) {\n        errorMessage = 'OpenAI APIã‚µãƒ¼ãƒãƒ¼ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';\n      }\n      \n      return new Response(\n        JSON.stringify({ \n          success: false, \n          error: errorMessage,\n          fallbackResponse: 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ä¸€æ™‚çš„ã«AIæ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚åŸºæœ¬çš„ãªåˆ†æã¯å¼•ãç¶šãã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚'\n        }),\n        {\n          status: response.status,\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        }\n      );\n    }\n\n    const result = await response.json();\n    const aiResponse = result.choices?.[0]?.message?.content;\n\n    if (!aiResponse) {\n      return new Response(\n        JSON.stringify({ \n          success: false, \n          error: 'ChatGPTã‹ã‚‰ã®å¿œç­”ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚',\n          fallbackResponse: 'AIæ©Ÿèƒ½ãŒä¸€æ™‚çš„ã«åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚æ‰‹å‹•åˆ†ææ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚'\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        }\n      );\n    }\n\n    return new Response(\n      JSON.stringify({\n        success: true,\n        response: aiResponse,\n        usage: result.usage,\n        usageInfo: usageCheck ? {\n          currentCount: usageCheck.current_count,\n          dailyLimit: usageCheck.daily_limit,\n          remaining: usageCheck.remaining\n        } : null\n      }),\n      {\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n      }\n    );\n\n  } catch (error) {\n    console.error('Edge Function Error:', error);\n    return new Response(\n      JSON.stringify({ \n        success: false, \n        error: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚',\n        fallbackResponse: 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã®ãŸã‚ã€åŸºæœ¬çš„ãªåˆ†ææ©Ÿèƒ½ã®ã¿ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚'\n      }),\n      {\n        status: 500,\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n      }\n    );\n  }\n});",
  "supabase/functions/generate-ai-report/index.ts": "import { createClient } from 'npm:@supabase/supabase-js@2.39.3';\n\ninterface ReportRequest {\n  reportType: 'weekly' | 'monthly';\n  storeId?: string;\n  periodStart?: string;\n  periodEnd?: string;\n}\n\ninterface DailyReportData {\n  id: string;\n  date: string;\n  store_id: string;\n  sales: number;\n  purchase: number;\n  labor_cost: number;\n  utilities: number;\n  rent: number;\n  consumables: number;\n  promotion: number;\n  cleaning: number;\n  misc: number;\n  communication: number;\n  others: number;\n}\n\ninterface StoreData {\n  id: string;\n  name: string;\n}\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'POST, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Client-Info, Apikey',\n};\n\nDeno.serve(async (req: Request) => {\n  if (req.method === 'OPTIONS') {\n    return new Response(null, {\n      status: 200,\n      headers: corsHeaders,\n    });\n  }\n\n  try {\n    const supabaseUrl = Deno.env.get('SUPABASE_URL')!;\n    const supabaseServiceKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!;\n    const openaiApiKey = Deno.env.get('OPENAI_API_KEY');\n\n    if (!openaiApiKey) {\n      return new Response(\n        JSON.stringify({ success: false, error: 'OpenAI API key not configured' }),\n        { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const supabase = createClient(supabaseUrl, supabaseServiceKey);\n\n    const { reportType, storeId, periodStart, periodEnd }: ReportRequest = await req.json();\n\n    const logId = crypto.randomUUID();\n    await supabase.from('report_generation_logs').insert({\n      id: logId,\n      report_type: reportType,\n      store_id: storeId || null,\n      status: 'in_progress',\n      started_at: new Date().toISOString(),\n    });\n\n    let startDate: string;\n    let endDate: string;\n\n    if (periodStart && periodEnd) {\n      startDate = periodStart;\n      endDate = periodEnd;\n    } else {\n      const now = new Date();\n      if (reportType === 'weekly') {\n        const weekAgo = new Date(now);\n        weekAgo.setDate(weekAgo.getDate() - 7);\n        startDate = weekAgo.toISOString().split('T')[0];\n        endDate = now.toISOString().split('T')[0];\n      } else {\n        const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n        const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0);\n        startDate = lastMonth.toISOString().split('T')[0];\n        endDate = lastMonthEnd.toISOString().split('T')[0];\n      }\n    }\n\n    let query = supabase\n      .from('daily_reports')\n      .select('*')\n      .gte('date', startDate)\n      .lte('date', endDate)\n      .order('date', { ascending: true });\n\n    if (storeId) {\n      query = query.eq('store_id', storeId);\n    }\n\n    const { data: reports, error: reportsError } = await query;\n\n    if (reportsError) {\n      throw new Error(`Failed to fetch reports: ${reportsError.message}`);\n    }\n\n    if (!reports || reports.length === 0) {\n      await supabase\n        .from('report_generation_logs')\n        .update({\n          status: 'failed',\n          completed_at: new Date().toISOString(),\n          error_message: 'No data available for the specified period',\n        })\n        .eq('id', logId);\n\n      return new Response(\n        JSON.stringify({ success: false, error: 'No data available for the specified period' }),\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const storeIds = [...new Set(reports.map((r: DailyReportData) => r.store_id))];\n    const { data: stores } = await supabase\n      .from('stores')\n      .select('id, name')\n      .in('id', storeIds);\n\n    const storeMap = new Map((stores || []).map((s: StoreData) => [s.id, s.name]));\n\n    const reportPeriodStart = new Date(startDate);\n    const reportPeriodEnd = new Date(endDate);\n    const daysInPeriod = Math.ceil((reportPeriodEnd.getTime() - reportPeriodStart.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n\n    const monthsInPeriod = new Set<string>();\n    for (let d = new Date(reportPeriodStart); d <= reportPeriodEnd; d.setDate(d.getDate() + 1)) {\n      const monthKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n      monthsInPeriod.add(monthKey);\n    }\n\n    const { data: expenseBaselines } = await supabase\n      .from('expense_baselines')\n      .select('*')\n      .in('store_id', storeIds)\n      .in('month', Array.from(monthsInPeriod));\n\n    const expenseBaselineMap = new Map();\n    (expenseBaselines || []).forEach((baseline: any) => {\n      const key = `${baseline.store_id}-${baseline.month}`;\n      expenseBaselineMap.set(key, baseline);\n    });\n\n    const calculateProrationForStore = (storeId: string) => {\n      const storeReports = reports.filter((r: DailyReportData) => r.store_id === storeId);\n      const actualDaysWithReports = storeReports.length;\n\n      if (actualDaysWithReports === 0) return 0;\n\n      let totalProrated = 0;\n      for (const monthKey of Array.from(monthsInPeriod)) {\n        const baselineKey = `${storeId}-${monthKey}`;\n        const baseline = expenseBaselineMap.get(baselineKey);\n        if (!baseline) continue;\n\n        const openDays = baseline.open_days || 30;\n\n        const monthlyTotal =\n          Number(baseline.labor_cost_employee || 0) +\n          Number(baseline.labor_cost_part_time || 0) +\n          Number(baseline.utilities || 0) +\n          Number(baseline.rent || 0) +\n          Number(baseline.consumables || 0) +\n          Number(baseline.promotion || 0) +\n          Number(baseline.cleaning || 0) +\n          Number(baseline.misc || 0) +\n          Number(baseline.communication || 0) +\n          Number(baseline.others || 0);\n\n        totalProrated += (monthlyTotal / openDays) * actualDaysWithReports;\n      }\n      return totalProrated;\n    };\n\n    const totalSales = reports.reduce((sum: number, r: DailyReportData) => sum + (r.sales || 0), 0);\n    const totalPurchase = reports.reduce((sum: number, r: DailyReportData) => sum + (r.purchase || 0), 0);\n    const totalLaborCost = reports.reduce((sum: number, r: DailyReportData) => sum + (r.labor_cost || 0), 0);\n    const totalUtilities = reports.reduce((sum: number, r: DailyReportData) => sum + (r.utilities || 0), 0);\n    const totalRent = reports.reduce((sum: number, r: DailyReportData) => sum + (r.rent || 0), 0);\n    const totalConsumables = reports.reduce((sum: number, r: DailyReportData) => sum + (r.consumables || 0), 0);\n    const totalPromotion = reports.reduce((sum: number, r: DailyReportData) => sum + (r.promotion || 0), 0);\n    const totalCleaning = reports.reduce((sum: number, r: DailyReportData) => sum + (r.cleaning || 0), 0);\n    const totalMisc = reports.reduce((sum: number, r: DailyReportData) => sum + (r.misc || 0), 0);\n    const totalCommunication = reports.reduce((sum: number, r: DailyReportData) => sum + (r.communication || 0), 0);\n    const totalOthers = reports.reduce((sum: number, r: DailyReportData) => sum + (r.others || 0), 0);\n\n    let totalMonthlyExpenses = 0;\n    for (const storeId of storeIds) {\n      totalMonthlyExpenses += calculateProrationForStore(storeId);\n    }\n\n    const totalExpenses =\n      totalPurchase +\n      totalLaborCost +\n      totalUtilities +\n      totalRent +\n      totalConsumables +\n      totalPromotion +\n      totalCleaning +\n      totalMisc +\n      totalCommunication +\n      totalOthers +\n      totalMonthlyExpenses;\n\n    const grossProfit = totalSales - totalPurchase;\n    const operatingProfit = totalSales - totalExpenses;\n    const profitMargin = totalSales > 0 ? (operatingProfit / totalSales) * 100 : 0;\n    const costRate = totalSales > 0 ? (totalPurchase / totalSales) * 100 : 0;\n    const laborRate = totalSales > 0 ? ((totalLaborCost + totalMonthlyExpenses) / totalSales) * 100 : 0;\n\n    const storeBreakdown = storeIds.map((storeId) => {\n      const storeReports = reports.filter((r: DailyReportData) => r.store_id === storeId);\n      const storeSales = storeReports.reduce((sum: number, r: DailyReportData) => sum + (r.sales || 0), 0);\n      const storePurchase = storeReports.reduce((sum: number, r: DailyReportData) => sum + (r.purchase || 0), 0);\n      const storeLaborCost = storeReports.reduce((sum: number, r: DailyReportData) => sum + (r.labor_cost || 0), 0);\n\n      const storeDailyExpenses = storeReports.reduce(\n        (sum: number, r: DailyReportData) =>\n          sum +\n          (r.purchase || 0) +\n          (r.labor_cost || 0) +\n          (r.utilities || 0) +\n          (r.rent || 0) +\n          (r.consumables || 0) +\n          (r.promotion || 0) +\n          (r.cleaning || 0) +\n          (r.misc || 0) +\n          (r.communication || 0) +\n          (r.others || 0),\n        0\n      );\n\n      const storeMonthlyExpenses = calculateProrationForStore(storeId);\n      const storeExpenses = storeDailyExpenses + storeMonthlyExpenses;\n\n      return {\n        storeId,\n        storeName: storeMap.get(storeId) || 'Unknown',\n        sales: storeSales,\n        purchase: storePurchase,\n        laborCost: storeLaborCost,\n        expenses: storeExpenses,\n        profit: storeSales - storeExpenses,\n        profitMargin: storeSales > 0 ? ((storeSales - storeExpenses) / storeSales) * 100 : 0,\n        costRate: storeSales > 0 ? (storePurchase / storeSales) * 100 : 0,\n        laborRate: storeSales > 0 ? ((storeLaborCost + storeMonthlyExpenses) / storeSales) * 100 : 0,\n      };\n    });\n\n    const prompt = `ã‚ãªãŸã¯é£²é£Ÿãƒã‚§ãƒ¼ãƒ³ã®çµŒå–¶ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€${reportType === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡'}ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\næœŸé–“: ${startDate} ã‹ã‚‰ ${endDate}\nå¯¾è±¡åº—èˆ—: ${storeId ? storeMap.get(storeId) : 'å…¨åº—èˆ—'}\n\nã€ç·åˆæŒ‡æ¨™ã€‘\n- ç·å£²ä¸Š: ${totalSales.toLocaleString('ja-JP')}å††\n- ç·çµŒè²»: ${totalExpenses.toLocaleString('ja-JP')}å††\n- ç²—åˆ©ç›Š: ${grossProfit.toLocaleString('ja-JP')}å††\n- å–¶æ¥­åˆ©ç›Š: ${operatingProfit.toLocaleString('ja-JP')}å††\n- åˆ©ç›Šç‡: ${profitMargin.toFixed(1)}%\n- åŸä¾¡ç‡: ${costRate.toFixed(1)}%\n- äººä»¶è²»ç‡: ${laborRate.toFixed(1)}%\n\nã€åº—èˆ—åˆ¥å†…è¨³ã€‘\n${storeBreakdown.map(s => `\n${s.storeName}:\n  å£²ä¸Š: ${s.sales.toLocaleString('ja-JP')}å††\n  çµŒè²»: ${s.expenses.toLocaleString('ja-JP')}å††\n  åˆ©ç›Š: ${s.profit.toLocaleString('ja-JP')}å††\n  åˆ©ç›Šç‡: ${s.profitMargin.toFixed(1)}%\n  åŸä¾¡ç‡: ${s.costRate.toFixed(1)}%\n  äººä»¶è²»ç‡: ${s.laborRate.toFixed(1)}%`).join('')}\n\nä»¥ä¸‹ã®å½¢å¼ã§JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¦ãã ã•ã„:\n{\n  \"title\": \"ãƒ¬ãƒãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«\",\n  \"summary\": \"çµŒå–¶è€…å‘ã‘ã®ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ï¼ˆ200-300æ–‡å­—ï¼‰\",\n  \"keyInsights\": [\"é‡è¦ãªç™ºè¦‹1\", \"é‡è¦ãªç™ºè¦‹2\", \"é‡è¦ãªç™ºè¦‹3\"],\n  \"recommendations\": [\"å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ1\", \"å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ2\", \"å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ3\"],\n  \"analysis\": {\n    \"salesTrend\": \"å£²ä¸Šãƒˆãƒ¬ãƒ³ãƒ‰ã®åˆ†æ\",\n    \"profitability\": \"åç›Šæ€§ã®åˆ†æ\",\n    \"costStructure\": \"ã‚³ã‚¹ãƒˆæ§‹é€ ã®åˆ†æ\",\n    \"storeComparison\": \"åº—èˆ—é–“æ¯”è¼ƒã®åˆ†æ\"\n  }\n}\n\næ¥­ç•Œæ¨™æº–: åŸä¾¡ç‡30-35%, äººä»¶è²»ç‡25-30%, å–¶æ¥­åˆ©ç›Šç‡15-25%ã‚’å‚è€ƒã«ã€å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªææ¡ˆã‚’ã—ã¦ãã ã•ã„ã€‚`;\n\n    const openaiResponse = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${openaiApiKey}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        model: 'gpt-4o-mini',\n        messages: [\n          { role: 'system', content: 'ã‚ãªãŸã¯é£²é£Ÿãƒã‚§ãƒ¼ãƒ³çµŒå–¶ã®å°‚é–€å®¶ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿åˆ†æã¨æ”¹å–„ææ¡ˆã‚’è¡Œã„ã¾ã™ã€‚' },\n          { role: 'user', content: prompt },\n        ],\n        response_format: { type: 'json_object' },\n        temperature: 0.7,\n      }),\n    });\n\n    if (!openaiResponse.ok) {\n      throw new Error(`OpenAI API error: ${openaiResponse.statusText}`);\n    }\n\n    const aiResult = await openaiResponse.json();\n    const aiContent = JSON.parse(aiResult.choices[0].message.content);\n\n    const reportData = {\n      store_id: storeId || null,\n      report_type: reportType,\n      period_start: startDate,\n      period_end: endDate,\n      title: aiContent.title || `${reportType === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡'}æ¥­ç¸¾ãƒ¬ãƒãƒ¼ãƒˆ`,\n      summary: aiContent.summary || '',\n      analysis_content: aiContent.analysis || {},\n      key_insights: aiContent.keyInsights || [],\n      recommendations: aiContent.recommendations || [],\n      metrics: {\n        totalSales,\n        totalExpenses,\n        grossProfit,\n        operatingProfit,\n        profitMargin,\n        costRate,\n        laborRate,\n        storeBreakdown,\n      },\n      generated_by: 'gpt-4o-mini',\n      generated_at: new Date().toISOString(),\n    };\n\n    const { data: report, error: insertError } = await supabase\n      .from('ai_generated_reports')\n      .insert(reportData)\n      .select()\n      .single();\n\n    if (insertError) {\n      throw new Error(`Failed to insert report: ${insertError.message}`);\n    }\n\n    await supabase\n      .from('report_generation_logs')\n      .update({\n        status: 'success',\n        report_id: report.id,\n        completed_at: new Date().toISOString(),\n        data_summary: { reportCount: reports.length, storeCount: storeIds.length },\n      })\n      .eq('id', logId);\n\n    return new Response(\n      JSON.stringify({ success: true, report }),\n      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  } catch (error) {\n    console.error('Report generation error:', error);\n    return new Response(\n      JSON.stringify({ success: false, error: error.message }),\n      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  }\n});\n",
  "supabase/functions/scheduled-report-generator/index.ts": "import { createClient } from 'npm:@supabase/supabase-js@2.39.3';\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'POST, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Client-Info, Apikey',\n};\n\nDeno.serve(async (req: Request) => {\n  if (req.method === 'OPTIONS') {\n    return new Response(null, {\n      status: 200,\n      headers: corsHeaders,\n    });\n  }\n\n  try {\n    const supabaseUrl = Deno.env.get('SUPABASE_URL')!;\n    const supabaseServiceKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!;\n\n    const supabase = createClient(supabaseUrl, supabaseServiceKey);\n\n    const now = new Date();\n\n    const { data: schedules, error: schedulesError } = await supabase\n      .from('report_schedules')\n      .select('*')\n      .eq('is_enabled', true)\n      .or(`next_run_at.is.null,next_run_at.lte.${now.toISOString()}`);\n\n    if (schedulesError) {\n      throw new Error(`Failed to fetch schedules: ${schedulesError.message}`);\n    }\n\n    if (!schedules || schedules.length === 0) {\n      return new Response(\n        JSON.stringify({ success: true, message: 'No schedules to process', processedCount: 0 }),\n        { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const results = [];\n\n    for (const schedule of schedules) {\n      try {\n        let periodStart: string;\n        let periodEnd: string;\n\n        if (schedule.report_type === 'weekly') {\n          const weekStart = new Date(now);\n          weekStart.setDate(weekStart.getDate() - 7);\n          periodStart = weekStart.toISOString().split('T')[0];\n          periodEnd = now.toISOString().split('T')[0];\n        } else {\n          const monthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n          const monthEnd = new Date(now.getFullYear(), now.getMonth(), 0);\n          periodStart = monthStart.toISOString().split('T')[0];\n          periodEnd = monthEnd.toISOString().split('T')[0];\n        }\n\n        const generateReportUrl = `${supabaseUrl}/functions/v1/generate-ai-report`;\n        const generateResponse = await fetch(generateReportUrl, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${supabaseServiceKey}`,\n          },\n          body: JSON.stringify({\n            reportType: schedule.report_type,\n            storeId: schedule.store_id,\n            periodStart,\n            periodEnd,\n          }),\n        });\n\n        if (!generateResponse.ok) {\n          const errorText = await generateResponse.text();\n          throw new Error(`Report generation failed: ${errorText}`);\n        }\n\n        const reportResult = await generateResponse.json();\n\n        let nextRunAt: Date;\n        if (schedule.report_type === 'weekly') {\n          nextRunAt = new Date(now);\n          nextRunAt.setDate(nextRunAt.getDate() + 7);\n          nextRunAt.setHours(6, 0, 0, 0);\n        } else {\n          nextRunAt = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n          nextRunAt.setHours(6, 0, 0, 0);\n        }\n\n        await supabase\n          .from('report_schedules')\n          .update({\n            last_run_at: now.toISOString(),\n            next_run_at: nextRunAt.toISOString(),\n            updated_at: now.toISOString(),\n          })\n          .eq('id', schedule.id);\n\n        results.push({\n          scheduleId: schedule.id,\n          reportType: schedule.report_type,\n          storeId: schedule.store_id,\n          success: true,\n          reportId: reportResult.report?.id,\n        });\n      } catch (error) {\n        console.error(`Failed to process schedule ${schedule.id}:`, error);\n        results.push({\n          scheduleId: schedule.id,\n          reportType: schedule.report_type,\n          storeId: schedule.store_id,\n          success: false,\n          error: error.message,\n        });\n      }\n    }\n\n    return new Response(\n      JSON.stringify({\n        success: true,\n        processedCount: schedules.length,\n        results,\n      }),\n      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  } catch (error) {\n    console.error('Scheduled report generation error:', error);\n    return new Response(\n      JSON.stringify({ success: false, error: error.message }),\n      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  }\n});\n",
  "supabase/functions/send-report-email/index.ts": "import { createClient } from 'npm:@supabase/supabase-js@2.39.3';\n\ninterface EmailRequest {\n  reportId: string;\n  recipientEmail: string;\n}\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'POST, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Client-Info, Apikey',\n};\n\nDeno.serve(async (req: Request) => {\n  if (req.method === 'OPTIONS') {\n    return new Response(null, {\n      status: 200,\n      headers: corsHeaders,\n    });\n  }\n\n  try {\n    const supabaseUrl = Deno.env.get('SUPABASE_URL')!;\n    const supabaseServiceKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!;\n    const resendApiKey = Deno.env.get('RESEND_API_KEY');\n    const isDemoMode = !resendApiKey;\n\n    const supabase = createClient(supabaseUrl, supabaseServiceKey);\n\n    const authHeader = req.headers.get('Authorization');\n    if (!authHeader) {\n      return new Response(\n        JSON.stringify({ success: false, error: 'èªè¨¼ãŒå¿…è¦ã§ã™' }),\n        { status: 401, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const token = authHeader.replace('Bearer ', '');\n    const { data: { user }, error: userError } = await supabase.auth.getUser(token);\n\n    if (userError || !user) {\n      return new Response(\n        JSON.stringify({ success: false, error: 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ' }),\n        { status: 401, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('role')\n      .eq('id', user.id)\n      .single();\n\n    if (!profile || (profile.role !== 'manager' && profile.role !== 'admin')) {\n      return new Response(\n        JSON.stringify({ success: false, error: 'æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä»¥ä¸Šã®ã¿ãƒ¬ãƒãƒ¼ãƒˆã‚’é€ä¿¡ã§ãã¾ã™' }),\n        { status: 403, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const { reportId, recipientEmail }: EmailRequest = await req.json();\n\n    const { data: report, error: reportError } = await supabase\n      .from('ai_generated_reports')\n      .select('*')\n      .eq('id', reportId)\n      .single();\n\n    if (reportError || !report) {\n      return new Response(\n        JSON.stringify({ success: false, error: 'ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' }),\n        { status: 404, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const { data: store } = report.store_id\n      ? await supabase.from('stores').select('name').eq('id', report.store_id).single()\n      : null;\n\n    const storeName = store?.name || 'å…¨åº—èˆ—';\n    const metrics = report.metrics || {};\n\n    const emailHtml = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <style>\n    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; }\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 8px 8px 0 0; }\n    .header h1 { margin: 0; font-size: 24px; }\n    .content { background: #f9fafb; padding: 30px; border-radius: 0 0 8px 8px; }\n    .section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n    .metric { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e5e7eb; }\n    .metric:last-child { border-bottom: none; }\n    .metric-label { color: #6b7280; font-weight: 500; }\n    .metric-value { font-weight: 600; color: #111827; }\n    .positive { color: #059669; }\n    .negative { color: #dc2626; }\n    .insight { background: #eff6ff; border-left: 4px solid #3b82f6; padding: 12px 16px; margin: 8px 0; border-radius: 4px; }\n    .recommendation { background: #f0fdf4; border-left: 4px solid #10b981; padding: 12px 16px; margin: 8px 0; border-radius: 4px; }\n    .footer { text-align: center; padding: 20px; color: #6b7280; font-size: 14px; }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>ğŸ“Š ${report.title}</h1>\n      <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">\n        æœŸé–“: ${report.period_start} ã€œ ${report.period_end}<br>\n        å¯¾è±¡: ${storeName}\n      </p>\n    </div>\n\n    <div class=\"content\">\n      <div class=\"section\">\n        <h2 style=\"margin-top: 0; color: #111827; font-size: 18px;\">ğŸ“ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼</h2>\n        <p style=\"color: #4b5563;\">${report.summary || 'ã‚µãƒãƒªãƒ¼ãªã—'}</p>\n      </div>\n\n      <div class=\"section\">\n        <h2 style=\"margin-top: 0; color: #111827; font-size: 18px;\">ğŸ“ˆ ä¸»è¦æŒ‡æ¨™</h2>\n        <div class=\"metric\">\n          <span class=\"metric-label\">ç·å£²ä¸Š</span>\n          <span class=\"metric-value\">Â¥${(metrics.totalSales || 0).toLocaleString('ja-JP')}</span>\n        </div>\n        <div class=\"metric\">\n          <span class=\"metric-label\">ç·çµŒè²»</span>\n          <span class=\"metric-value\">Â¥${(metrics.totalExpenses || 0).toLocaleString('ja-JP')}</span>\n        </div>\n        <div class=\"metric\">\n          <span class=\"metric-label\">ç²—åˆ©ç›Š</span>\n          <span class=\"metric-value\">Â¥${(metrics.grossProfit || 0).toLocaleString('ja-JP')}</span>\n        </div>\n        <div class=\"metric\">\n          <span class=\"metric-label\">å–¶æ¥­åˆ©ç›Š</span>\n          <span class=\"metric-value ${(metrics.operatingProfit || 0) >= 0 ? 'positive' : 'negative'}\">\n            Â¥${(metrics.operatingProfit || 0).toLocaleString('ja-JP')}\n          </span>\n        </div>\n        <div class=\"metric\">\n          <span class=\"metric-label\">åˆ©ç›Šç‡</span>\n          <span class=\"metric-value ${(metrics.profitMargin || 0) >= 0 ? 'positive' : 'negative'}\">\n            ${(metrics.profitMargin || 0).toFixed(1)}%\n          </span>\n        </div>\n        <div class=\"metric\">\n          <span class=\"metric-label\">åŸä¾¡ç‡</span>\n          <span class=\"metric-value\">${(metrics.costRate || 0).toFixed(1)}%</span>\n        </div>\n        <div class=\"metric\">\n          <span class=\"metric-label\">äººä»¶è²»ç‡</span>\n          <span class=\"metric-value\">${(metrics.laborRate || 0).toFixed(1)}%</span>\n        </div>\n      </div>\n\n      ${report.key_insights && report.key_insights.length > 0 ? `\n      <div class=\"section\">\n        <h2 style=\"margin-top: 0; color: #111827; font-size: 18px;\">ğŸ’¡ é‡è¦ãªç™ºè¦‹</h2>\n        ${report.key_insights.map((insight: string) => `<div class=\"insight\">${insight}</div>`).join('')}\n      </div>\n      ` : ''}\n\n      ${report.recommendations && report.recommendations.length > 0 ? `\n      <div class=\"section\">\n        <h2 style=\"margin-top: 0; color: #111827; font-size: 18px;\">âœ… æ”¹å–„ææ¡ˆ</h2>\n        ${report.recommendations.map((rec: string) => `<div class=\"recommendation\">${rec}</div>`).join('')}\n      </div>\n      ` : ''}\n\n      <div class=\"footer\">\n        <p>ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ AI ã«ã‚ˆã£ã¦è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚<br>\n        è©³ç´°ã¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã”ç¢ºèªãã ã•ã„ã€‚</p>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n    `;\n\n    if (isDemoMode) {\n      console.log(`[DEMO MODE] ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ`);\n      console.log(`To: ${recipientEmail}`);\n      console.log(`Subject: ${report.title} - ${storeName}`);\n      console.log(`Report ID: ${reportId}`);\n\n      return new Response(\n        JSON.stringify({\n          success: true,\n          messageId: `demo-${Date.now()}`,\n          isDemoMode: true,\n          message: 'ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰: ãƒ¡ãƒ¼ãƒ«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸãŒã€ãƒ¬ãƒãƒ¼ãƒˆã®æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸ'\n        }),\n        { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const resendResponse = await fetch('https://api.resend.com/emails', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${resendApiKey}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        from: 'ãƒ¬ãƒãƒ¼ãƒˆé…ä¿¡ <reports@updates.yourdomain.com>',\n        to: [recipientEmail],\n        subject: `${report.title} - ${storeName}`,\n        html: emailHtml,\n      }),\n    });\n\n    if (!resendResponse.ok) {\n      const errorData = await resendResponse.json();\n      console.error('Resend API error:', errorData);\n      throw new Error('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    }\n\n    const result = await resendResponse.json();\n\n    return new Response(\n      JSON.stringify({ success: true, messageId: result.id, isDemoMode: false }),\n      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  } catch (error) {\n    console.error('Email sending error:', error);\n    return new Response(\n      JSON.stringify({\n        success: false,\n        error: error instanceof Error ? error.message : 'ãƒ¡ãƒ¼ãƒ«é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'\n      }),\n      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  }\n});",
  "supabase/functions/sync-to-sheets/index.ts": "interface DailyReportData {\n  date: string;\n  store_name: string;\n  staff_name: string;\n  sales: number;\n  purchase: number;\n  labor_cost: number;\n  utilities: number;\n  promotion: number;\n  cleaning: number;\n  misc: number;\n  communication: number;\n  others: number;\n  report_text: string;\n  created_at: string;\n}\n\n// CORSè¨­å®š: æœ¬ç•ªã§ã¯ç’°å¢ƒå¤‰æ•°ã§è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒ‡å®š\nconst ALLOWED_ORIGIN = Deno.env.get('ALLOWED_ORIGIN') ?? 'http://localhost:5173';\n\nconst corsHeaders = {\n  \"Access-Control-Allow-Origin\": ALLOWED_ORIGIN,\n  \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n  \"Access-Control-Allow-Headers\": \"authorization, x-client-info, apikey, content-type\",\n};\n\nDeno.serve(async (req: Request) => {\n  // Handle CORS preflight requests\n  if (req.method === \"OPTIONS\") {\n    return new Response(null, {\n      status: 200,\n      headers: corsHeaders,\n    });\n  }\n\n  try {\n    const { reportData } = await req.json() as { reportData: DailyReportData };\n    \n    // Google Sheets API configuration\n    const GOOGLE_SHEETS_API_KEY = Deno.env.get('GOOGLE_SHEETS_API_KEY');\n    const GOOGLE_SHEET_ID = Deno.env.get('GOOGLE_SHEET_ID');\n    \n    // Explicitly check for non-empty strings\n    if (!GOOGLE_SHEETS_API_KEY || !GOOGLE_SHEET_ID || \n        GOOGLE_SHEETS_API_KEY.trim() === '' || GOOGLE_SHEET_ID.trim() === '') {\n      console.error('Environment variables check failed:', {\n        hasApiKey: !!GOOGLE_SHEETS_API_KEY,\n        hasSheetId: !!GOOGLE_SHEET_ID,\n        apiKeyLength: GOOGLE_SHEETS_API_KEY?.length || 0,\n        sheetIdLength: GOOGLE_SHEET_ID?.length || 0\n      });\n      return new Response(\n        JSON.stringify({ \n          success: false, \n          error: 'Google Sheets APIè¨­å®šãŒä¸å®Œå…¨ã§ã™ã€‚ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ã‹ç©ºã§ã™ã€‚',\n          details: {\n            hasApiKey: !!GOOGLE_SHEETS_API_KEY && GOOGLE_SHEETS_API_KEY.trim() !== '',\n            hasSheetId: !!GOOGLE_SHEET_ID && GOOGLE_SHEET_ID.trim() !== ''\n          }\n        }),\n        {\n          status: 400,\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        }\n      );\n    }\n\n    // Prepare data for Google Sheets (in the order of columns)\n    const rowData = [\n      reportData.date,\n      reportData.store_name,\n      reportData.staff_name,\n      reportData.sales.toString(),\n      reportData.purchase.toString(),\n      reportData.labor_cost.toString(),\n      reportData.utilities.toString(),\n      reportData.promotion.toString(),\n      reportData.cleaning.toString(),\n      reportData.misc.toString(),\n      reportData.communication.toString(),\n      reportData.others.toString(),\n      reportData.report_text || '',\n      reportData.created_at,\n      // Calculate totals\n      (reportData.purchase + reportData.labor_cost + reportData.utilities + \n       reportData.promotion + reportData.cleaning + reportData.misc + \n       reportData.communication + reportData.others).toString(), // çµŒè²»åˆè¨ˆ\n      (reportData.sales - reportData.purchase).toString(), // ç²—åˆ©ç›Š\n      (reportData.sales - (reportData.purchase + reportData.labor_cost + reportData.utilities + \n       reportData.promotion + reportData.cleaning + reportData.misc + \n       reportData.communication + reportData.others)).toString() // å–¶æ¥­åˆ©ç›Š\n    ];\n\n    // Google Sheets API URL for appending data\n    const sheetsUrl = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEET_ID}/values/daily_reports:append`;\n    \n    // Log the request details for debugging\n    console.log('Google Sheets API Request:', {\n      url: sheetsUrl,\n      method: 'POST',\n      sheetId: GOOGLE_SHEET_ID,\n      hasApiKey: !!GOOGLE_SHEETS_API_KEY\n    });\n    \n    const response = await fetch(`${sheetsUrl}?key=${GOOGLE_SHEETS_API_KEY}&valueInputOption=USER_ENTERED`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        values: [rowData]\n      })\n    });\n\n    if (!response || !response.ok) {\n      const errorText = await response.text();\n      console.error('Google Sheets API Error:', {\n        status: response?.status,\n        statusText: response?.statusText,\n        errorText,\n        url: sheetsUrl\n      });\n      return new Response(\n        JSON.stringify({ \n          success: false, \n          error: 'Google Sheetsã¸ã®æ›¸ãè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ',\n          details: {\n            status: response?.status,\n            statusText: response?.statusText,\n            message: errorText\n          }\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n        }\n      );\n    }\n\n    const result = await response.json();\n    \n    return new Response(\n      JSON.stringify({ \n        success: true, \n        message: 'Google Sheetsã«æ­£å¸¸ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸ',\n        updatedRange: result.updates?.updatedRange \n      }),\n      {\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n      }\n    );\n\n  } catch (error) {\n    console.error('Edge Function Error:', {\n      name: error.name,\n      message: error.message,\n      stack: error.stack,\n      cause: error.cause\n    });\n    return new Response(\n      JSON.stringify({ \n        success: false, \n        error: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',\n        details: {\n          name: error.name,\n          message: error.message,\n          type: typeof error\n        }\n      }),\n      {\n        status: 500,\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n      }\n    );\n  }\n});",
  "supabase/migrations/20250929190518_proud_sunset.sql": "/*\n  # Create vendors table\n\n  1. New Tables\n    - `vendors`\n      - `id` (uuid, primary key)\n      - `name` (text, vendor name)\n      - `category` (text, vendor category)\n      - `contact_info` (text, optional contact information)\n      - `is_active` (boolean, default true)\n      - `created_at` (timestamp)\n      - `updated_at` (timestamp)\n  \n  2. Security\n    - Enable RLS on `vendors` table\n    - Add policy for authenticated users to read vendor data\n    - Add policy for managers/admin to manage vendors\n*/\n\nCREATE TABLE IF NOT EXISTS vendors (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  name text NOT NULL,\n  category text NOT NULL CHECK (category = ANY (ARRAY[\n    'vegetable_meat',\n    'seafood', \n    'alcohol',\n    'rice',\n    'seasoning',\n    'frozen',\n    'dessert',\n    'others'\n  ])),\n  contact_info text,\n  is_active boolean DEFAULT true,\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now()\n);\n\nALTER TABLE vendors ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read vendors\"\n  ON vendors\n  FOR SELECT\n  TO authenticated\n  USING (true);\n\nCREATE POLICY \"Managers can manage vendors\"\n  ON vendors\n  FOR ALL\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('manager', 'admin')\n    )\n  );\n\n-- Index for better performance\nCREATE INDEX IF NOT EXISTS vendors_category_idx ON vendors (category);\nCREATE INDEX IF NOT EXISTS vendors_active_idx ON vendors (is_active);",
  "supabase/migrations/20250929190524_nameless_summit.sql": "/*\n  # Create store vendor assignments table\n\n  1. New Tables\n    - `store_vendor_assignments`\n      - `id` (uuid, primary key)\n      - `store_id` (uuid, foreign key to stores)\n      - `vendor_id` (uuid, foreign key to vendors)\n      - `display_order` (integer, for sorting)\n      - `created_at` (timestamp)\n  \n  2. Security\n    - Enable RLS on `store_vendor_assignments` table\n    - Add policy for authenticated users to read assignments for their stores\n    - Add policy for managers/admin to manage assignments\n*/\n\nCREATE TABLE IF NOT EXISTS store_vendor_assignments (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  store_id uuid NOT NULL REFERENCES stores(id) ON DELETE CASCADE,\n  vendor_id uuid NOT NULL REFERENCES vendors(id) ON DELETE CASCADE,\n  display_order integer DEFAULT 0,\n  created_at timestamptz DEFAULT now(),\n  UNIQUE(store_id, vendor_id)\n);\n\nALTER TABLE store_vendor_assignments ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read assignments for accessible stores\"\n  ON store_vendor_assignments\n  FOR SELECT\n  TO authenticated\n  USING (\n    store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Managers can manage vendor assignments\"\n  ON store_vendor_assignments\n  FOR ALL\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('manager', 'admin')\n    )\n    AND store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\n-- Indexes for better performance\nCREATE INDEX IF NOT EXISTS store_vendor_assignments_store_id_idx ON store_vendor_assignments (store_id);\nCREATE INDEX IF NOT EXISTS store_vendor_assignments_vendor_id_idx ON store_vendor_assignments (vendor_id);",
  "supabase/migrations/20250929190531_heavy_manor.sql": "/*\n  # Create monthly expenses table\n\n  1. New Tables\n    - `monthly_expenses`\n      - `id` (uuid, primary key)\n      - `store_id` (uuid, foreign key to stores)\n      - `user_id` (uuid, foreign key to profiles)\n      - `month` (text, format YYYY-MM)\n      - `labor_cost_employee` (integer, employee labor cost)\n      - `labor_cost_part_time` (integer, part-time labor cost)\n      - `utilities` (integer, utility costs)\n      - `promotion` (integer, promotion costs)\n      - `cleaning` (integer, cleaning costs)\n      - `misc` (integer, miscellaneous costs)\n      - `communication` (integer, communication costs)\n      - `others` (integer, other costs)\n      - `memo` (text, optional memo)\n      - `created_at` (timestamp)\n      - `updated_at` (timestamp)\n  \n  2. Security\n    - Enable RLS on `monthly_expenses` table\n    - Add policy for users to manage expenses for assigned stores\n*/\n\nCREATE TABLE IF NOT EXISTS monthly_expenses (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  store_id uuid NOT NULL REFERENCES stores(id) ON DELETE CASCADE,\n  user_id uuid NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,\n  month text NOT NULL, -- Format: YYYY-MM\n  labor_cost_employee integer DEFAULT 0,\n  labor_cost_part_time integer DEFAULT 0,\n  utilities integer DEFAULT 0,\n  promotion integer DEFAULT 0,\n  cleaning integer DEFAULT 0,\n  misc integer DEFAULT 0,\n  communication integer DEFAULT 0,\n  others integer DEFAULT 0,\n  memo text DEFAULT '',\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now(),\n  UNIQUE(store_id, month)\n);\n\nALTER TABLE monthly_expenses ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read monthly expenses for assigned stores\"\n  ON monthly_expenses\n  FOR SELECT\n  TO authenticated\n  USING (\n    store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Users can manage monthly expenses for assigned stores\"\n  ON monthly_expenses\n  FOR ALL\n  TO authenticated\n  USING (\n    user_id = auth.uid()\n    AND store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\n-- Indexes for better performance\nCREATE INDEX IF NOT EXISTS monthly_expenses_store_month_idx ON monthly_expenses (store_id, month);\nCREATE INDEX IF NOT EXISTS monthly_expenses_user_id_idx ON monthly_expenses (user_id);",
  "supabase/migrations/20250929190539_emerald_torch.sql": "/*\n  # Create targets table\n\n  1. New Tables\n    - `targets`\n      - `id` (uuid, primary key)\n      - `store_id` (uuid, foreign key to stores)\n      - `period` (text, format YYYY-MM)\n      - `target_sales` (integer, target sales amount)\n      - `target_profit` (integer, target profit amount)\n      - `target_profit_margin` (numeric, target profit margin percentage)\n      - `created_at` (timestamp)\n      - `updated_at` (timestamp)\n  \n  2. Security\n    - Enable RLS on `targets` table\n    - Add policy for users to read targets for assigned stores\n    - Add policy for managers/admin to manage targets\n*/\n\nCREATE TABLE IF NOT EXISTS targets (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  store_id uuid NOT NULL REFERENCES stores(id) ON DELETE CASCADE,\n  period text NOT NULL, -- Format: YYYY-MM\n  target_sales integer DEFAULT 0,\n  target_profit integer DEFAULT 0,\n  target_profit_margin numeric(5,2) DEFAULT 0,\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now(),\n  UNIQUE(store_id, period)\n);\n\nALTER TABLE targets ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read targets for assigned stores\"\n  ON targets\n  FOR SELECT\n  TO authenticated\n  USING (\n    store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Managers can manage targets\"\n  ON targets\n  FOR ALL\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('manager', 'admin')\n    )\n    AND store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\n-- Indexes for better performance\nCREATE INDEX IF NOT EXISTS targets_store_period_idx ON targets (store_id, period);\nCREATE INDEX IF NOT EXISTS targets_period_idx ON targets (period);",
  "supabase/migrations/20250929211836_amber_wildflower.sql": "/*\n  # Reset Production Database to Clean State\n\n  This migration resets all data in the production database while preserving the schema structure.\n  Current demo data (stores, reports, etc.) will only be shown in demo mode.\n\n  1. Data Reset\n     - Clear all tables while preserving structure\n     - Reset sequences and indexes\n     \n  2. Clean State\n     - Production starts with empty database\n     - Demo mode shows existing mock data\n     \n  3. Security\n     - Maintain all RLS policies\n     - Preserve user management structure\n*/\n\n-- Clear all data while preserving table structure\nTRUNCATE TABLE public.store_vendor_assignments CASCADE;\nTRUNCATE TABLE public.monthly_expenses CASCADE;\nTRUNCATE TABLE public.daily_reports CASCADE;\nTRUNCATE TABLE public.summary_data CASCADE;\nTRUNCATE TABLE public.targets CASCADE;\nTRUNCATE TABLE public.store_assignments CASCADE;\nTRUNCATE TABLE public.stores CASCADE;\nTRUNCATE TABLE public.vendors CASCADE;\nTRUNCATE TABLE public.profiles CASCADE;\n\n-- Reset any sequences if they exist\n-- Note: UUID primary keys don't use sequences, but if there are any serial columns\nDO $$\nBEGIN\n    -- Reset any auto-increment sequences if they exist\n    PERFORM setval(pg_get_serial_sequence('public.stores', 'id'), 1, false)\n    WHERE pg_get_serial_sequence('public.stores', 'id') IS NOT NULL;\nEXCEPTION\n    WHEN OTHERS THEN\n        -- Ignore if no serial sequences exist\n        NULL;\nEND $$;\n\n-- Verify tables are empty\nDO $$\nDECLARE\n    rec RECORD;\n    table_count INTEGER;\nBEGIN\n    FOR rec IN \n        SELECT table_name \n        FROM information_schema.tables \n        WHERE table_schema = 'public' \n        AND table_type = 'BASE TABLE'\n        AND table_name NOT LIKE '%_backup'\n    LOOP\n        EXECUTE format('SELECT COUNT(*) FROM public.%I', rec.table_name) INTO table_count;\n        RAISE NOTICE 'Table % has % rows after reset', rec.table_name, table_count;\n    END LOOP;\nEND $$;",
  "supabase/migrations/20251003040424_add_store_insert_policies.sql": "/*\n  # Add INSERT/UPDATE/DELETE policies for stores table\n\n  1. Changes\n    - Add INSERT policy for managers/admin to create stores\n    - Add UPDATE policy for managers/admin to update stores\n    - Add DELETE policy for managers/admin to delete stores (soft delete)\n\n  2. Security\n    - Only managers and admins can create/update/delete stores\n    - Staff can only read stores they are assigned to\n*/\n\n-- INSERT policy for managers/admin\nCREATE POLICY \"Managers can create stores\"\n  ON stores\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('manager', 'admin')\n    )\n  );\n\n-- UPDATE policy for managers/admin\nCREATE POLICY \"Managers can update stores\"\n  ON stores\n  FOR UPDATE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('manager', 'admin')\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('manager', 'admin')\n    )\n  );\n\n-- DELETE policy for managers/admin (though we use soft delete with is_active)\nCREATE POLICY \"Managers can delete stores\"\n  ON stores\n  FOR DELETE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('manager', 'admin')\n    )\n  );\n",
  "supabase/migrations/20251003040825_fix_profiles_insert_policy.sql": "/*\n  # Fix profiles table INSERT policy\n\n  1. Changes\n    - Add INSERT policy to allow users to create their own profile during signup\n    - This fixes the issue where new users cannot complete registration\n\n  2. Security\n    - Users can only create a profile with their own auth.uid()\n    - Users cannot create profiles for other users\n*/\n\n-- INSERT policy for profiles - allows users to create their own profile\nCREATE POLICY \"Users can create own profile\"\n  ON profiles\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (auth.uid() = id);\n",
  "supabase/migrations/20251003040841_create_missing_profiles.sql": "/*\n  # Create missing profiles for existing users\n\n  1. Changes\n    - Create profile records for all existing auth users who don't have profiles\n    - Set default role as 'admin' for the first user, 'staff' for others\n    - Use email as name if no name is available\n\n  2. Security\n    - Profiles are created with proper user IDs from auth.users\n*/\n\n-- Create profiles for existing auth users who don't have profiles\nINSERT INTO profiles (id, name, email, role)\nSELECT \n  u.id,\n  COALESCE(u.raw_user_meta_data->>'name', split_part(u.email, '@', 1)) as name,\n  u.email,\n  CASE \n    WHEN u.created_at = (SELECT MIN(created_at) FROM auth.users) THEN 'admin'::text\n    ELSE 'staff'::text\n  END as role\nFROM auth.users u\nWHERE NOT EXISTS (\n  SELECT 1 FROM profiles p WHERE p.id = u.id\n)\nON CONFLICT (id) DO NOTHING;\n",
  "supabase/migrations/20251003064153_create_daily_report_vendor_purchases.sql": "/*\n  # Create daily_report_vendor_purchases table\n\n  1. New Tables\n    - `daily_report_vendor_purchases`\n      - `id` (uuid, primary key)\n      - `daily_report_id` (uuid, foreign key to daily_reports)\n      - `vendor_id` (uuid, foreign key to vendors)\n      - `amount` (integer, purchase amount from this vendor)\n      - `created_at` (timestamp)\n  \n  2. Security\n    - Enable RLS on `daily_report_vendor_purchases` table\n    - Add policy for users to read vendor purchases for their accessible stores\n    - Add policy for users to insert/update vendor purchases for their accessible stores\n  \n  3. Notes\n    - This table stores the breakdown of purchases by vendor for each daily report\n    - The total of all vendor purchases should match the `purchase` field in daily_reports\n*/\n\nCREATE TABLE IF NOT EXISTS daily_report_vendor_purchases (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  daily_report_id uuid NOT NULL REFERENCES daily_reports(id) ON DELETE CASCADE,\n  vendor_id uuid NOT NULL REFERENCES vendors(id) ON DELETE CASCADE,\n  amount integer DEFAULT 0,\n  created_at timestamptz DEFAULT now(),\n  UNIQUE(daily_report_id, vendor_id)\n);\n\nALTER TABLE daily_report_vendor_purchases ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read vendor purchases for accessible stores\"\n  ON daily_report_vendor_purchases\n  FOR SELECT\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM daily_reports\n      JOIN store_assignments ON daily_reports.store_id = store_assignments.store_id\n      WHERE daily_reports.id = daily_report_vendor_purchases.daily_report_id\n      AND store_assignments.user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Users can insert vendor purchases for accessible stores\"\n  ON daily_report_vendor_purchases\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM daily_reports\n      JOIN store_assignments ON daily_reports.store_id = store_assignments.store_id\n      WHERE daily_reports.id = daily_report_vendor_purchases.daily_report_id\n      AND store_assignments.user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Users can update vendor purchases for accessible stores\"\n  ON daily_report_vendor_purchases\n  FOR UPDATE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM daily_reports\n      JOIN store_assignments ON daily_reports.store_id = store_assignments.store_id\n      WHERE daily_reports.id = daily_report_vendor_purchases.daily_report_id\n      AND store_assignments.user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Users can delete vendor purchases for accessible stores\"\n  ON daily_report_vendor_purchases\n  FOR DELETE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM daily_reports\n      JOIN store_assignments ON daily_reports.store_id = store_assignments.store_id\n      WHERE daily_reports.id = daily_report_vendor_purchases.daily_report_id\n      AND store_assignments.user_id = auth.uid()\n    )\n  );\n\n-- Indexes for better performance\nCREATE INDEX IF NOT EXISTS daily_report_vendor_purchases_report_id_idx ON daily_report_vendor_purchases (daily_report_id);\nCREATE INDEX IF NOT EXISTS daily_report_vendor_purchases_vendor_id_idx ON daily_report_vendor_purchases (vendor_id);",
  "supabase/migrations/20251003161608_create_base_schema.sql": "/*\n  # Create base schema for restaurant reporting system\n\n  1. New Tables\n    - `profiles`\n      - `id` (uuid, primary key, references auth.users)\n      - `name` (text, user name)\n      - `email` (text, user email)\n      - `role` (text, user role: staff/manager/admin)\n      - `created_at` (timestamp)\n      - `updated_at` (timestamp)\n    \n    - `stores`\n      - `id` (uuid, primary key)\n      - `name` (text, store name)\n      - `address` (text, store address)\n      - `manager_id` (uuid, optional, foreign key to profiles)\n      - `is_active` (boolean, default true)\n      - `created_at` (timestamp)\n      - `updated_at` (timestamp)\n    \n    - `store_assignments`\n      - `id` (uuid, primary key)\n      - `user_id` (uuid, foreign key to profiles)\n      - `store_id` (uuid, foreign key to stores)\n      - `created_at` (timestamp)\n    \n    - `daily_reports`\n      - `id` (uuid, primary key)\n      - `date` (date, report date)\n      - `store_id` (uuid, foreign key to stores)\n      - `user_id` (uuid, foreign key to profiles)\n      - `sales` (integer, daily sales)\n      - `purchase` (integer, purchase costs)\n      - `labor_cost` (integer, labor costs)\n      - `utilities` (integer, utility costs)\n      - `promotion` (integer, promotion costs)\n      - `cleaning` (integer, cleaning costs)\n      - `misc` (integer, miscellaneous costs)\n      - `communication` (integer, communication costs)\n      - `others` (integer, other costs)\n      - `customers` (integer, number of customers)\n      - `report_text` (text, optional report notes)\n      - `created_at` (timestamp)\n      - `updated_at` (timestamp)\n    \n    - `summary_data`\n      - `id` (uuid, primary key)\n      - `period_type` (text, 'daily', 'weekly', 'monthly')\n      - `period_start` (date)\n      - `period_end` (date)\n      - `store_id` (uuid, optional, null for all stores)\n      - `total_sales` (integer)\n      - `total_expenses` (integer)\n      - `gross_profit` (integer)\n      - `operating_profit` (integer)\n      - `profit_margin` (numeric)\n      - `created_at` (timestamp)\n      - `updated_at` (timestamp)\n\n  2. Security\n    - Enable RLS on all tables\n    - Add policies for authenticated users\n    - Staff can view/create reports for assigned stores\n    - Managers can view/manage reports for assigned stores\n    - Admins can view/manage all data\n*/\n\n-- Profiles table\nCREATE TABLE IF NOT EXISTS profiles (\n  id uuid PRIMARY KEY REFERENCES auth.users ON DELETE CASCADE,\n  name text NOT NULL,\n  email text NOT NULL UNIQUE,\n  role text NOT NULL CHECK (role IN ('staff', 'manager', 'admin')),\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now()\n);\n\nALTER TABLE profiles ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read own profile\"\n  ON profiles FOR SELECT\n  TO authenticated\n  USING (auth.uid() = id);\n\nCREATE POLICY \"Users can update own profile\"\n  ON profiles FOR UPDATE\n  TO authenticated\n  USING (auth.uid() = id)\n  WITH CHECK (auth.uid() = id);\n\n-- Stores table\nCREATE TABLE IF NOT EXISTS stores (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  name text NOT NULL,\n  address text NOT NULL,\n  manager_id uuid REFERENCES profiles(id),\n  is_active boolean DEFAULT true,\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now()\n);\n\nALTER TABLE stores ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read active stores\"\n  ON stores FOR SELECT\n  TO authenticated\n  USING (is_active = true);\n\nCREATE POLICY \"Admins can manage stores\"\n  ON stores FOR ALL\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n  );\n\n-- Store assignments table\nCREATE TABLE IF NOT EXISTS store_assignments (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id uuid NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,\n  store_id uuid NOT NULL REFERENCES stores(id) ON DELETE CASCADE,\n  created_at timestamptz DEFAULT now(),\n  UNIQUE(user_id, store_id)\n);\n\nALTER TABLE store_assignments ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read own store assignments\"\n  ON store_assignments FOR SELECT\n  TO authenticated\n  USING (user_id = auth.uid());\n\nCREATE POLICY \"Admins can manage store assignments\"\n  ON store_assignments FOR ALL\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n  );\n\n-- Daily reports table\nCREATE TABLE IF NOT EXISTS daily_reports (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  date date NOT NULL,\n  store_id uuid NOT NULL REFERENCES stores(id) ON DELETE CASCADE,\n  user_id uuid NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,\n  sales integer DEFAULT 0,\n  purchase integer DEFAULT 0,\n  labor_cost integer DEFAULT 0,\n  utilities integer DEFAULT 0,\n  promotion integer DEFAULT 0,\n  cleaning integer DEFAULT 0,\n  misc integer DEFAULT 0,\n  communication integer DEFAULT 0,\n  others integer DEFAULT 0,\n  customers integer DEFAULT 0,\n  report_text text DEFAULT '',\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now(),\n  UNIQUE(date, store_id)\n);\n\nALTER TABLE daily_reports ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read reports for assigned stores\"\n  ON daily_reports FOR SELECT\n  TO authenticated\n  USING (\n    store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Users can insert reports for assigned stores\"\n  ON daily_reports FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    user_id = auth.uid()\n    AND store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Users can update own reports for assigned stores\"\n  ON daily_reports FOR UPDATE\n  TO authenticated\n  USING (\n    user_id = auth.uid()\n    AND store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\n-- Summary data table\nCREATE TABLE IF NOT EXISTS summary_data (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  period_type text NOT NULL CHECK (period_type IN ('daily', 'weekly', 'monthly')),\n  period_start date NOT NULL,\n  period_end date NOT NULL,\n  store_id uuid REFERENCES stores(id) ON DELETE CASCADE,\n  total_sales integer DEFAULT 0,\n  total_expenses integer DEFAULT 0,\n  gross_profit integer DEFAULT 0,\n  operating_profit integer DEFAULT 0,\n  profit_margin numeric(5,2) DEFAULT 0,\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now()\n);\n\nALTER TABLE summary_data ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can read summary data for assigned stores\"\n  ON summary_data FOR SELECT\n  TO authenticated\n  USING (\n    store_id IS NULL\n    OR store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\n-- Indexes for performance\nCREATE INDEX IF NOT EXISTS profiles_email_idx ON profiles (email);\nCREATE INDEX IF NOT EXISTS profiles_role_idx ON profiles (role);\nCREATE INDEX IF NOT EXISTS stores_active_idx ON stores (is_active);\nCREATE INDEX IF NOT EXISTS store_assignments_user_idx ON store_assignments (user_id);\nCREATE INDEX IF NOT EXISTS store_assignments_store_idx ON store_assignments (store_id);\nCREATE INDEX IF NOT EXISTS daily_reports_date_idx ON daily_reports (date);\nCREATE INDEX IF NOT EXISTS daily_reports_store_idx ON daily_reports (store_id);\nCREATE INDEX IF NOT EXISTS daily_reports_user_idx ON daily_reports (user_id);\nCREATE INDEX IF NOT EXISTS summary_data_period_idx ON summary_data (period_type, period_start, period_end);\nCREATE INDEX IF NOT EXISTS summary_data_store_idx ON summary_data (store_id);\n",
  "supabase/migrations/20251004034606_fix_targets_rls_policies.sql": "/*\n  # Fix targets table RLS policies\n\n  1. Changes\n    - Drop existing restrictive policies\n    - Add separate policies for SELECT, INSERT, UPDATE, DELETE\n    - Allow admins to manage all targets\n    - Allow managers to manage targets for assigned stores only\n\n  2. Security\n    - Admins have full access to all targets\n    - Managers can only manage targets for stores they are assigned to\n    - Staff can only view targets for assigned stores\n*/\n\n-- Drop existing policies\nDROP POLICY IF EXISTS \"Users can read targets for assigned stores\" ON targets;\nDROP POLICY IF EXISTS \"Managers can manage targets\" ON targets;\n\n-- SELECT: Users can read targets for stores they have access to\nCREATE POLICY \"Users can view targets for accessible stores\"\n  ON targets\n  FOR SELECT\n  TO authenticated\n  USING (\n    -- Admins can see all targets\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n    OR\n    -- Others can see targets for assigned stores\n    store_id IN (\n      SELECT store_assignments.store_id\n      FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n    )\n  );\n\n-- INSERT: Managers and admins can create targets\nCREATE POLICY \"Managers can create targets\"\n  ON targets\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    -- Admins can create targets for any store\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n    OR\n    -- Managers can create targets for assigned stores\n    (\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role = 'manager'\n      )\n      AND store_id IN (\n        SELECT store_assignments.store_id\n        FROM store_assignments\n        WHERE store_assignments.user_id = auth.uid()\n      )\n    )\n  );\n\n-- UPDATE: Managers and admins can update targets\nCREATE POLICY \"Managers can update targets\"\n  ON targets\n  FOR UPDATE\n  TO authenticated\n  USING (\n    -- Admins can update all targets\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n    OR\n    -- Managers can update targets for assigned stores\n    (\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role = 'manager'\n      )\n      AND store_id IN (\n        SELECT store_assignments.store_id\n        FROM store_assignments\n        WHERE store_assignments.user_id = auth.uid()\n      )\n    )\n  )\n  WITH CHECK (\n    -- Admins can update to any store\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n    OR\n    -- Managers can update to assigned stores\n    (\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role = 'manager'\n      )\n      AND store_id IN (\n        SELECT store_assignments.store_id\n        FROM store_assignments\n        WHERE store_assignments.user_id = auth.uid()\n      )\n    )\n  );\n\n-- DELETE: Managers and admins can delete targets\nCREATE POLICY \"Managers can delete targets\"\n  ON targets\n  FOR DELETE\n  TO authenticated\n  USING (\n    -- Admins can delete all targets\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n    OR\n    -- Managers can delete targets for assigned stores\n    (\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role = 'manager'\n      )\n      AND store_id IN (\n        SELECT store_assignments.store_id\n        FROM store_assignments\n        WHERE store_assignments.user_id = auth.uid()\n      )\n    )\n  );\n",
  "supabase/migrations/20251004171555_create_expense_baselines.sql": "/*\n  # å‚è€ƒçµŒè²»ï¼ˆæœˆæ¬¡å¹³å‡ï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ\n\n  1. æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«\n    - `expense_baselines`\n      - åº—èˆ—Ã—æœˆã”ã¨ã«å‚è€ƒã¨ãªã‚‹æœˆæ¬¡çµŒè²»ã®åŸºæº–å€¤ã‚’ä¿å­˜\n      - äººä»¶è²»ã€å…‰ç†±è²»ã€è²©ä¿ƒè²»ã€æ¸…æƒè²»ã€é›‘è²»ã€é€šä¿¡è²»ã€ãã®ä»–\n      - ç¨¼åƒæ—¥æ•°ï¼ˆæ—¥å‰²ã‚Šè¨ˆç®—ç”¨ï¼‰\n      - æ—¥å ±å…¥åŠ›æ™‚ã«å‚è€ƒKPIã¨ã—ã¦è¡¨ç¤ºã—ã€ç¿Œæœˆã®ç¢ºå®šå€¤å…¥åŠ›ã¾ã§åˆ©ç”¨\n\n  2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n    - RLSã‚’æœ‰åŠ¹åŒ–\n    - é–²è¦§ï¼šæ‹…å½“åº—èˆ—ã®ã‚¹ã‚¿ãƒƒãƒ•ã¾ãŸã¯ç®¡ç†è€…\n    - ç™»éŒ²ãƒ»æ›´æ–°ï¼šç®¡ç†è€…ã¾ãŸã¯ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼\n\n  3. ç”¨é€”\n    - æ—¥å ±å…¥åŠ›æ™‚ï¼šé£Ÿæè²»ä»¥å¤–ã®çµŒè²»ã‚’æ—¥å‰²ã‚Šã§å‚è€ƒè¡¨ç¤º\n    - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼šå®Ÿç¸¾KPIã¨å‚è€ƒKPIã‚’åˆ‡ã‚Šæ›¿ãˆè¡¨ç¤º\n    - ç¿Œæœˆç¢ºå®šï¼šmonthly_expensesã«ç¢ºå®šå€¤ã‚’å…¥åŠ›ã—ã¦æœ€çµ‚PLã‚’ä½œæˆ\n*/\n\n-- å‚è€ƒçµŒè²»ï¼ˆæœˆæ¬¡å¹³å‡ï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«\nCREATE TABLE IF NOT EXISTS expense_baselines (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  store_id uuid NOT NULL REFERENCES stores(id) ON DELETE CASCADE,\n  month text NOT NULL, -- YYYY-MMå½¢å¼\n\n  -- äººä»¶è²»\n  labor_cost_employee numeric DEFAULT 0,\n  labor_cost_part_time numeric DEFAULT 0,\n\n  -- ãã®ä»–çµŒè²»\n  utilities numeric DEFAULT 0,\n  promotion numeric DEFAULT 0,\n  cleaning numeric DEFAULT 0,\n  misc numeric DEFAULT 0,\n  communication numeric DEFAULT 0,\n  others numeric DEFAULT 0,\n\n  -- ç¨¼åƒæ—¥æ•°ï¼ˆæ—¥å‰²ã‚Šè¨ˆç®—ç”¨ï¼‰\n  open_days int DEFAULT 30,\n\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now(),\n\n  -- åº—èˆ—Ã—æœˆã§ä¸€æ„\n  UNIQUE(store_id, month)\n);\n\n-- RLSã‚’æœ‰åŠ¹åŒ–\nALTER TABLE expense_baselines ENABLE ROW LEVEL SECURITY;\n\n-- é–²è¦§ãƒãƒªã‚·ãƒ¼ï¼šæ‹…å½“åº—èˆ—ã¾ãŸã¯ç®¡ç†è€…\nCREATE POLICY \"Users can view expense baselines for their stores\"\n  ON expense_baselines FOR SELECT\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n    OR EXISTS (\n      SELECT 1 FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n      AND store_assignments.store_id = expense_baselines.store_id\n    )\n  );\n\n-- ç™»éŒ²ãƒãƒªã‚·ãƒ¼ï¼šç®¡ç†è€…ã¾ãŸã¯ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼\nCREATE POLICY \"Admins and managers can insert expense baselines\"\n  ON expense_baselines FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'manager')\n    )\n  );\n\n-- æ›´æ–°ãƒãƒªã‚·ãƒ¼ï¼šç®¡ç†è€…ã¾ãŸã¯ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼\nCREATE POLICY \"Admins and managers can update expense baselines\"\n  ON expense_baselines FOR UPDATE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'manager')\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'manager')\n    )\n  );\n\n-- å‰Šé™¤ãƒãƒªã‚·ãƒ¼ï¼šç®¡ç†è€…ã¾ãŸã¯ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼\nCREATE POLICY \"Admins and managers can delete expense baselines\"\n  ON expense_baselines FOR DELETE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'manager')\n    )\n  );\n",
  "supabase/migrations/20251004173303_add_rent_and_consumables_to_expenses.sql": "/*\n  # çµŒè²»é …ç›®ã®è¿½åŠ \n\n  1. å¤‰æ›´å†…å®¹\n    - è³ƒæ–™(rent)ã‚«ãƒ©ãƒ ã‚’è¿½åŠ \n    - æ¶ˆè€—å“è²»(consumables)ã‚«ãƒ©ãƒ ã‚’è¿½åŠ \n    - å…‰ç†±è²»ã¯æ°´é“å…‰ç†±è²»ã¨ã—ã¦æ‰±ã†ï¼ˆã‚«ãƒ©ãƒ åutilitiesã¯ãã®ã¾ã¾ï¼‰\n\n  2. ãƒ†ãƒ¼ãƒ–ãƒ«å¤‰æ›´\n    - `daily_reports`ãƒ†ãƒ¼ãƒ–ãƒ«ã«2ã¤ã®æ–°ã‚«ãƒ©ãƒ ã‚’è¿½åŠ \n    - `monthly_expenses`ãƒ†ãƒ¼ãƒ–ãƒ«ã«2ã¤ã®æ–°ã‚«ãƒ©ãƒ ã‚’è¿½åŠ \n\n  3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n    - æ—¢å­˜ã®RLSãƒãƒªã‚·ãƒ¼ãŒæ–°ã‚«ãƒ©ãƒ ã«ã‚‚é©ç”¨ã•ã‚Œã¾ã™\n*/\n\n-- daily_reportsãƒ†ãƒ¼ãƒ–ãƒ«ã«è³ƒæ–™ã¨æ¶ˆè€—å“è²»ã‚’è¿½åŠ \nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_name = 'daily_reports' AND column_name = 'rent'\n  ) THEN\n    ALTER TABLE daily_reports ADD COLUMN rent integer DEFAULT 0;\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_name = 'daily_reports' AND column_name = 'consumables'\n  ) THEN\n    ALTER TABLE daily_reports ADD COLUMN consumables integer DEFAULT 0;\n  END IF;\nEND $$;\n\n-- monthly_expensesãƒ†ãƒ¼ãƒ–ãƒ«ã«è³ƒæ–™ã¨æ¶ˆè€—å“è²»ã‚’è¿½åŠ \nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_name = 'monthly_expenses' AND column_name = 'rent'\n  ) THEN\n    ALTER TABLE monthly_expenses ADD COLUMN rent integer DEFAULT 0;\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_name = 'monthly_expenses' AND column_name = 'consumables'\n  ) THEN\n    ALTER TABLE monthly_expenses ADD COLUMN consumables integer DEFAULT 0;\n  END IF;\nEND $$;\n",
  "supabase/migrations/20251005051705_add_performance_indexes.sql": "/*\n  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–\n\n  ## æ¦‚è¦\n  é »ç¹ã«ã‚¯ã‚¨ãƒªã•ã‚Œã‚‹ã‚«ãƒ©ãƒ ã«å¯¾ã—ã¦è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ã—ã€\n  ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã¾ã™ã€‚\n\n  ## è¿½åŠ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸€è¦§\n\n  ### daily_reports ãƒ†ãƒ¼ãƒ–ãƒ«\n  1. `idx_daily_reports_store_date` - åº—èˆ—åˆ¥ãƒ»æ—¥ä»˜ç¯„å›²ã‚¯ã‚¨ãƒªç”¨ï¼ˆæœ€é‡è¦ï¼‰\n  2. `idx_daily_reports_user_date` - ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒ¬ãƒãƒ¼ãƒˆæ¤œç´¢ç”¨\n  3. `idx_daily_reports_date_store` - æ—¥ä»˜ã‚½ãƒ¼ãƒˆ + åº—èˆ—ãƒ•ã‚£ãƒ«ã‚¿ç”¨\n\n  ### monthly_expenses ãƒ†ãƒ¼ãƒ–ãƒ«\n  4. `idx_monthly_expenses_store_month` - åº—èˆ—åˆ¥ãƒ»æœˆæ¬¡æ¤œç´¢ç”¨\n  5. `idx_monthly_expenses_user_month` - ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒ»æœˆæ¬¡æ¤œç´¢ç”¨\n\n  ### targets ãƒ†ãƒ¼ãƒ–ãƒ«\n  6. `idx_targets_store_period` - åº—èˆ—åˆ¥ãƒ»æœŸé–“æ¤œç´¢ç”¨ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä»˜ãï¼‰\n\n  ### store_assignments ãƒ†ãƒ¼ãƒ–ãƒ«\n  7. `idx_store_assignments_user` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ãƒã‚§ãƒƒã‚¯é«˜é€ŸåŒ–\n  8. `idx_store_assignments_store` - åº—èˆ—åˆ¥ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ç”¨\n\n  ### daily_report_vendor_purchases ãƒ†ãƒ¼ãƒ–ãƒ«\n  9. `idx_vendor_purchases_report` - æ—¥å ±åˆ¥ä»•å…¥æ˜ç´°å–å¾—ç”¨\n  10. `idx_vendor_purchases_vendor` - ä»•å…¥å…ˆåˆ¥é›†è¨ˆç”¨\n\n  ### store_vendor_assignments ãƒ†ãƒ¼ãƒ–ãƒ«\n  11. `idx_store_vendor_store` - åº—èˆ—åˆ¥ä»•å…¥å…ˆä¸€è¦§ç”¨\n\n  ## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„è¦‹è¾¼ã¿\n  - æ—¥æ¬¡å ±å‘Šæ¤œç´¢: 50-80%é«˜é€ŸåŒ–\n  - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èª­ã¿è¾¼ã¿: 60-90%é«˜é€ŸåŒ–\n  - åº—èˆ—åˆ¥é›†è¨ˆ: 70-95%é«˜é€ŸåŒ–\n  - æ¨©é™ãƒã‚§ãƒƒã‚¯: 80-95%é«˜é€ŸåŒ–\n\n  ## æ³¨æ„äº‹é …\n  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã‚’æ¶ˆè²»ã—ã¾ã™ï¼ˆç´„10-15% of table sizeï¼‰\n  - æ›¸ãè¾¼ã¿æ“ä½œãŒè‹¥å¹²é…ããªã‚Šã¾ã™ï¼ˆ2-5%ç¨‹åº¦ï¼‰\n  - èª­ã¿å–ã‚Šé‡è¦–ã®ã‚·ã‚¹ãƒ†ãƒ ã®ãŸã‚ã€ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¯è¨±å®¹ç¯„å›²å†…\n*/\n\n-- ============================================\n-- daily_reports ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæœ€é‡è¦ï¼‰\n-- ============================================\n\n-- åº—èˆ—åˆ¥ãƒ»æ—¥ä»˜ç¯„å›²ã‚¯ã‚¨ãƒªç”¨ï¼ˆWHERE store_id = ? AND date BETWEEN ? AND ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_daily_reports_store_date \nON daily_reports(store_id, date DESC);\n\n-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒ¬ãƒãƒ¼ãƒˆæ¤œç´¢ç”¨ï¼ˆWHERE user_id = ? ORDER BY date DESCï¼‰\nCREATE INDEX IF NOT EXISTS idx_daily_reports_user_date \nON daily_reports(user_id, date DESC);\n\n-- æ—¥ä»˜ã‚½ãƒ¼ãƒˆ + åº—èˆ—ãƒ•ã‚£ãƒ«ã‚¿ç”¨ï¼ˆORDER BY date DESC WHERE store_id = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_daily_reports_date_store \nON daily_reports(date DESC, store_id);\n\n-- ä½œæˆæ—¥æ™‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆæœ€è¿‘ã®å ±å‘Šã‚’å–å¾—ï¼‰\nCREATE INDEX IF NOT EXISTS idx_daily_reports_created \nON daily_reports(created_at DESC);\n\n-- ============================================\n-- monthly_expenses ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\n-- åº—èˆ—åˆ¥ãƒ»æœˆæ¬¡æ¤œç´¢ç”¨ï¼ˆWHERE store_id = ? AND month = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_monthly_expenses_store_month \nON monthly_expenses(store_id, month);\n\n-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒ»æœˆæ¬¡æ¤œç´¢ç”¨ï¼ˆWHERE user_id = ? AND month = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_monthly_expenses_user_month \nON monthly_expenses(user_id, month);\n\n-- ============================================\n-- targets ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\n-- åº—èˆ—åˆ¥ãƒ»æœŸé–“æ¤œç´¢ç”¨ï¼ˆWHERE store_id = ? AND period = ?ï¼‰\n-- ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚‚ä»˜ä¸ï¼ˆåŒã˜åº—èˆ—ãƒ»æœŸé–“ã®ç›®æ¨™ã¯1ã¤ã®ã¿ï¼‰\nCREATE UNIQUE INDEX IF NOT EXISTS idx_targets_store_period \nON targets(store_id, period);\n\n-- ============================================\n-- store_assignments ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ¨©é™ãƒã‚§ãƒƒã‚¯é«˜é€ŸåŒ–ï¼‰\n-- ============================================\n\n-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ãƒã‚§ãƒƒã‚¯ç”¨ï¼ˆWHERE user_id = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_store_assignments_user \nON store_assignments(user_id);\n\n-- åº—èˆ—åˆ¥ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ç”¨ï¼ˆWHERE store_id = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_store_assignments_store \nON store_assignments(store_id);\n\n-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»åº—èˆ—è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼ˆé‡è¤‡å‰²å½“é˜²æ­¢ï¼‰\nCREATE UNIQUE INDEX IF NOT EXISTS idx_store_assignments_user_store \nON store_assignments(user_id, store_id);\n\n-- ============================================\n-- daily_report_vendor_purchases ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\n-- æ—¥å ±åˆ¥ä»•å…¥æ˜ç´°å–å¾—ç”¨ï¼ˆWHERE daily_report_id = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_vendor_purchases_report \nON daily_report_vendor_purchases(daily_report_id);\n\n-- ä»•å…¥å…ˆåˆ¥é›†è¨ˆç”¨ï¼ˆWHERE vendor_id = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_vendor_purchases_vendor \nON daily_report_vendor_purchases(vendor_id);\n\n-- ============================================\n-- store_vendor_assignments ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\n-- åº—èˆ—åˆ¥ä»•å…¥å…ˆä¸€è¦§ç”¨ï¼ˆWHERE store_id = ? ORDER BY display_orderï¼‰\nCREATE INDEX IF NOT EXISTS idx_store_vendor_store \nON store_vendor_assignments(store_id, display_order);\n\n-- ä»•å…¥å…ˆåˆ¥åº—èˆ—ä¸€è¦§ç”¨ï¼ˆWHERE vendor_id = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_store_vendor_vendor \nON store_vendor_assignments(vendor_id);\n\n-- åº—èˆ—ãƒ»ä»•å…¥å…ˆè¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼ˆé‡è¤‡å‰²å½“é˜²æ­¢ï¼‰\nCREATE UNIQUE INDEX IF NOT EXISTS idx_store_vendor_unique \nON store_vendor_assignments(store_id, vendor_id);\n\n-- ============================================\n-- vendors ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\n-- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªä»•å…¥å…ˆæ¤œç´¢ç”¨ï¼ˆWHERE is_active = trueï¼‰\nCREATE INDEX IF NOT EXISTS idx_vendors_active \nON vendors(is_active, name);\n\n-- ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¤œç´¢ç”¨ï¼ˆWHERE category = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_vendors_category \nON vendors(category, name);\n\n-- ============================================\n-- stores ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\n-- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªåº—èˆ—æ¤œç´¢ç”¨ï¼ˆWHERE is_active = trueï¼‰\nCREATE INDEX IF NOT EXISTS idx_stores_active \nON stores(is_active, name);\n\n-- ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆ¥åº—èˆ—æ¤œç´¢ç”¨ï¼ˆWHERE manager_id = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_stores_manager \nON stores(manager_id);\n\n-- ============================================\n-- profiles ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\n-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œç´¢ç”¨ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼‰\nCREATE INDEX IF NOT EXISTS idx_profiles_email \nON profiles(email);\n\n-- ãƒ­ãƒ¼ãƒ«åˆ¥æ¤œç´¢ç”¨ï¼ˆWHERE role = ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_profiles_role \nON profiles(role);\n\n-- ============================================\n-- summary_data ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\n-- æœŸé–“ã‚¿ã‚¤ãƒ—ãƒ»åº—èˆ—ãƒ»æœŸé–“æ¤œç´¢ç”¨ï¼ˆæœ€ã‚‚é »ç¹ãªã‚¯ã‚¨ãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰\nCREATE INDEX IF NOT EXISTS idx_summary_period_store_dates \nON summary_data(period_type, store_id, period_start, period_end);\n\n-- æœŸé–“ç¯„å›²æ¤œç´¢ç”¨ï¼ˆWHERE period_start >= ? AND period_end <= ?ï¼‰\nCREATE INDEX IF NOT EXISTS idx_summary_date_range \nON summary_data(period_start, period_end);\n",
  "supabase/migrations/20251005052656_create_ai_chat_archive_schema.sql": "/*\n  # AIãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ©Ÿèƒ½\n\n  ## æ¦‚è¦\n  AIãƒãƒ£ãƒƒãƒˆã®ä¼šè©±å±¥æ­´ã‚’ä¿å­˜ãƒ»æ¤œç´¢ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚\n  ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ä¼šè©±ãŒå¾©å…ƒã•ã‚Œã€éå»ã®ã‚„ã‚Šå–ã‚Šã‚’æ¤œç´¢ã§ãã¾ã™ã€‚\n\n  ## æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«\n\n  ### ai_conversationsï¼ˆä¼šè©±ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰\n  - `id` (uuid, primary key) - ä¼šè©±ID\n  - `user_id` (uuid) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID\n  - `store_id` (text) - åº—èˆ—IDï¼ˆ'all' ã¾ãŸã¯ 'store-xxx'ï¼‰\n  - `title` (text) - ä¼šè©±ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆåˆå›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰è‡ªå‹•ç”Ÿæˆï¼‰\n  - `archived` (boolean) - ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ¸ˆã¿ãƒ•ãƒ©ã‚°\n  - `created_at` (timestamptz) - ä½œæˆæ—¥æ™‚\n  - `updated_at` (timestamptz) - æ›´æ–°æ—¥æ™‚\n\n  ### ai_messagesï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰\n  - `id` (uuid, primary key) - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID\n  - `conversation_id` (uuid) - ä¼šè©±IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰\n  - `role` (text) - å½¹å‰²ï¼ˆsystem/user/assistantï¼‰\n  - `content` (text) - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹\n  - `tokens` (int) - ãƒˆãƒ¼ã‚¯ãƒ³æ•°ï¼ˆã‚³ã‚¹ãƒˆç®¡ç†ç”¨ï¼‰\n  - `meta` (jsonb) - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆusageæƒ…å ±ãªã©ï¼‰\n  - `created_at` (timestamptz) - ä½œæˆæ—¥æ™‚\n\n  ## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n  - RLSæœ‰åŠ¹åŒ–\n  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ä¼šè©±ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½\n\n  ## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–\n  - pg_trgmæ‹¡å¼µã«ã‚ˆã‚‹å…¨æ–‡æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n  - ä¼šè©±ä¸€è¦§ç”¨ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—ç”¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n*/\n\n-- ============================================\n-- 1. æ‹¡å¼µæ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–\n-- ============================================\n\n-- æ–‡å­—åˆ—æ¤œç´¢ã®ç²¾åº¦å‘ä¸Šï¼ˆæ—¥æœ¬èªã‚‚trigramã§OKï¼‰\nCREATE EXTENSION IF NOT EXISTS pg_trgm;\n\n-- ============================================\n-- 2. ai_conversations ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nCREATE TABLE IF NOT EXISTS ai_conversations (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id uuid NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  store_id text,\n  title text,\n  archived boolean NOT NULL DEFAULT false,\n  created_at timestamptz NOT NULL DEFAULT now(),\n  updated_at timestamptz NOT NULL DEFAULT now()\n);\n\n-- ============================================\n-- 3. ai_messages ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nCREATE TABLE IF NOT EXISTS ai_messages (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  conversation_id uuid NOT NULL REFERENCES ai_conversations(id) ON DELETE CASCADE,\n  role text NOT NULL CHECK (role IN ('system','user','assistant')),\n  content text NOT NULL,\n  tokens int,\n  meta jsonb,\n  created_at timestamptz NOT NULL DEFAULT now()\n);\n\n-- ============================================\n-- 4. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n-- ============================================\n\n-- ä¼šè©±ä¸€è¦§ç”¨ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–åˆ¥ãƒ»æ›´æ–°æ—¥æ™‚é™é †ï¼‰\nCREATE INDEX IF NOT EXISTS idx_ai_conversations_user \nON ai_conversations(user_id, archived, updated_at DESC);\n\n-- ä¼šè©±åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—ç”¨ï¼ˆä¼šè©±IDãƒ»ä½œæˆæ—¥æ™‚æ˜‡é †ï¼‰\nCREATE INDEX IF NOT EXISTS idx_ai_messages_conv \nON ai_messages(conversation_id, created_at);\n\n-- å…¨æ–‡æ¤œç´¢ç”¨ï¼ˆtrigram GINã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰\nCREATE INDEX IF NOT EXISTS idx_ai_messages_trgm \nON ai_messages USING gin (content gin_trgm_ops);\n\n-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¤œç´¢ç”¨ï¼ˆçµåˆæœ€é©åŒ–ï¼‰\nCREATE INDEX IF NOT EXISTS idx_ai_messages_user \nON ai_messages(conversation_id);\n\n-- ============================================\n-- 5. Row Level Securityï¼ˆRLSï¼‰\n-- ============================================\n\n-- ai_conversations ã®RLSæœ‰åŠ¹åŒ–\nALTER TABLE ai_conversations ENABLE ROW LEVEL SECURITY;\n\n-- ai_messages ã®RLSæœ‰åŠ¹åŒ–\nALTER TABLE ai_messages ENABLE ROW LEVEL SECURITY;\n\n-- ai_conversations: SELECT ãƒãƒªã‚·ãƒ¼\nDROP POLICY IF EXISTS \"Users can view own conversations\" ON ai_conversations;\nCREATE POLICY \"Users can view own conversations\" \nON ai_conversations\nFOR SELECT \nTO authenticated\nUSING (auth.uid() = user_id);\n\n-- ai_conversations: INSERT ãƒãƒªã‚·ãƒ¼\nDROP POLICY IF EXISTS \"Users can create own conversations\" ON ai_conversations;\nCREATE POLICY \"Users can create own conversations\" \nON ai_conversations\nFOR INSERT \nTO authenticated\nWITH CHECK (auth.uid() = user_id);\n\n-- ai_conversations: UPDATE ãƒãƒªã‚·ãƒ¼\nDROP POLICY IF EXISTS \"Users can update own conversations\" ON ai_conversations;\nCREATE POLICY \"Users can update own conversations\" \nON ai_conversations\nFOR UPDATE \nTO authenticated\nUSING (auth.uid() = user_id)\nWITH CHECK (auth.uid() = user_id);\n\n-- ai_conversations: DELETE ãƒãƒªã‚·ãƒ¼\nDROP POLICY IF EXISTS \"Users can delete own conversations\" ON ai_conversations;\nCREATE POLICY \"Users can delete own conversations\" \nON ai_conversations\nFOR DELETE \nTO authenticated\nUSING (auth.uid() = user_id);\n\n-- ai_messages: SELECT ãƒãƒªã‚·ãƒ¼\nDROP POLICY IF EXISTS \"Users can view messages in own conversations\" ON ai_messages;\nCREATE POLICY \"Users can view messages in own conversations\" \nON ai_messages\nFOR SELECT \nTO authenticated\nUSING (\n  conversation_id IN (\n    SELECT id FROM ai_conversations WHERE user_id = auth.uid()\n  )\n);\n\n-- ai_messages: INSERT ãƒãƒªã‚·ãƒ¼\nDROP POLICY IF EXISTS \"Users can create messages in own conversations\" ON ai_messages;\nCREATE POLICY \"Users can create messages in own conversations\" \nON ai_messages\nFOR INSERT \nTO authenticated\nWITH CHECK (\n  conversation_id IN (\n    SELECT id FROM ai_conversations WHERE user_id = auth.uid()\n  )\n);\n\n-- ============================================\n-- 6. æ¤œç´¢ç”¨RPCé–¢æ•°\n-- ============================================\n\n-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¨æ–‡æ¤œç´¢é–¢æ•°\nCREATE OR REPLACE FUNCTION ai_search_messages(q text)\nRETURNS TABLE(\n  conversation_id uuid,\n  snippet text,\n  created_at timestamptz\n) \nLANGUAGE sql \nSTABLE \nSECURITY DEFINER\nSET search_path = public\nAS $$\n  SELECT \n    m.conversation_id,\n    LEFT(m.content, 160) AS snippet,\n    m.created_at\n  FROM ai_messages m\n  JOIN ai_conversations c ON c.id = m.conversation_id\n  WHERE c.user_id = auth.uid()\n    AND m.content ILIKE '%' || q || '%'\n  ORDER BY m.created_at DESC\n  LIMIT 200;\n$$;\n\n-- ============================================\n-- 7. ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ï¼ˆupdated_atè‡ªå‹•æ›´æ–°ï¼‰\n-- ============================================\n\n-- updated_atè‡ªå‹•æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- ai_conversationsç”¨ãƒˆãƒªã‚¬ãƒ¼\nDROP TRIGGER IF EXISTS trigger_ai_conversations_updated_at ON ai_conversations;\nCREATE TRIGGER trigger_ai_conversations_updated_at\n  BEFORE UPDATE ON ai_conversations\n  FOR EACH ROW\n  EXECUTE FUNCTION update_updated_at_column();\n\n-- ============================================\n-- 8. ãƒ†ãƒ¼ãƒ–ãƒ«ã‚³ãƒ¡ãƒ³ãƒˆ\n-- ============================================\n\nCOMMENT ON TABLE ai_conversations IS \n'AIãƒãƒ£ãƒƒãƒˆã®ä¼šè©±ã‚¹ãƒ¬ãƒƒãƒ‰ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«è¤‡æ•°ã®ä¼šè©±ã‚’ä¿æŒã§ãã¾ã™ã€‚';\n\nCOMMENT ON TABLE ai_messages IS \n'AIãƒãƒ£ãƒƒãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã€‚ä¼šè©±ã”ã¨ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜ã—ã¾ã™ã€‚';\n\nCOMMENT ON FUNCTION ai_search_messages IS \n'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’å…¨æ–‡æ¤œç´¢ã™ã‚‹é–¢æ•°ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®ä¼šè©±ã®ã¿æ¤œç´¢å¯¾è±¡ã€‚\nä½¿ç”¨ä¾‹: SELECT * FROM ai_search_messages(''å£²ä¸Šåˆ†æ'');';\n\n-- ============================================\n-- 9. ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆé–‹ç™ºç”¨ãƒ»ä»»æ„ï¼‰\n-- ============================================\n\n-- é–‹ç™ºç’°å¢ƒç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ã¯ä»»æ„\n-- æœ¬ç•ªç’°å¢ƒã§ã¯ä¸è¦ãªã®ã§ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ãŠãã¾ã™\n\n/*\n-- ã‚µãƒ³ãƒ—ãƒ«ä¼šè©±ã‚’ä½œæˆï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰\nINSERT INTO ai_conversations (user_id, store_id, title, archived)\nSELECT \n  id, \n  'all', \n  'ã‚µãƒ³ãƒ—ãƒ«ä¼šè©±ï¼šã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦',\n  false\nFROM auth.users \nLIMIT 1\nON CONFLICT DO NOTHING;\n*/\n",
  "supabase/migrations/20251006042332_enforce_complete_rls_policies_v2.sql": "/*\n  # æœ¬ç•ªç’°å¢ƒç”¨ RLS ãƒãƒªã‚·ãƒ¼å®Œå…¨å¼·åŒ– v2\n\n  ## æ¦‚è¦\n  å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§Row Level Securityï¼ˆRLSï¼‰ã‚’å¼·åˆ¶ã—ã€\n  æœ¬ç•ªé‹ç”¨ã«å¿…è¦ãªå³æ ¼ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å®Ÿè£…ã—ã¾ã™ã€‚\n\n  ## ä¿®æ­£å†…å®¹\n  - summary_dataã®store_idå‹ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£\n  - å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSå¼·åŒ–\n*/\n\n-- ============================================\n-- 1. targets ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSå¼·åŒ–\n-- ============================================\n\nDROP POLICY IF EXISTS \"Users can view targets for assigned stores\" ON targets;\nDROP POLICY IF EXISTS \"Managers and admins can create targets\" ON targets;\nDROP POLICY IF EXISTS \"Managers and admins can update targets\" ON targets;\nDROP POLICY IF EXISTS \"Admins can delete targets\" ON targets;\n\nCREATE POLICY \"Users can view targets for assigned stores\"\nON targets FOR SELECT\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM store_assignments sa\n    WHERE sa.user_id = auth.uid()\n      AND sa.store_id = targets.store_id\n  )\n  OR EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid() AND p.role = 'admin'\n  )\n);\n\nCREATE POLICY \"Managers and admins can create targets\"\nON targets FOR INSERT\nTO authenticated\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = targets.store_id\n    )\n    OR EXISTS (\n      SELECT 1 FROM profiles p\n      WHERE p.id = auth.uid() AND p.role = 'admin'\n    )\n  )\n);\n\nCREATE POLICY \"Managers and admins can update targets\"\nON targets FOR UPDATE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = targets.store_id\n    )\n    OR EXISTS (\n      SELECT 1 FROM profiles p\n      WHERE p.id = auth.uid() AND p.role = 'admin'\n    )\n  )\n)\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n);\n\nCREATE POLICY \"Admins can delete targets\"\nON targets FOR DELETE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid() AND p.role = 'admin'\n  )\n);\n\n-- ============================================\n-- 2. summary_data ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSå¼·åŒ–\n-- ============================================\n\nALTER TABLE summary_data ENABLE ROW LEVEL SECURITY;\n\nDROP POLICY IF EXISTS \"Users can view summary for assigned stores\" ON summary_data;\n\nCREATE POLICY \"Users can view summary for assigned stores\"\nON summary_data FOR SELECT\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM store_assignments sa\n    WHERE sa.user_id = auth.uid()\n      AND (sa.store_id = summary_data.store_id OR summary_data.store_id IS NULL)\n  )\n  OR EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid() AND p.role = 'admin'\n  )\n);\n\n-- ============================================\n-- 3. daily_report_vendor_purchases ã®å¼·åŒ–\n-- ============================================\n\nALTER TABLE daily_report_vendor_purchases ENABLE ROW LEVEL SECURITY;\n\nDROP POLICY IF EXISTS \"Users can view vendor purchases for accessible reports\" ON daily_report_vendor_purchases;\nDROP POLICY IF EXISTS \"Users can insert vendor purchases for own reports\" ON daily_report_vendor_purchases;\nDROP POLICY IF EXISTS \"Users can update own vendor purchases\" ON daily_report_vendor_purchases;\nDROP POLICY IF EXISTS \"Users can delete own vendor purchases\" ON daily_report_vendor_purchases;\n\nCREATE POLICY \"Users can view vendor purchases for accessible reports\"\nON daily_report_vendor_purchases FOR SELECT\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM daily_reports dr\n    JOIN store_assignments sa ON sa.store_id = dr.store_id\n    WHERE dr.id = daily_report_vendor_purchases.daily_report_id\n      AND sa.user_id = auth.uid()\n  )\n  OR EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid() AND p.role = 'admin'\n  )\n);\n\nCREATE POLICY \"Users can insert vendor purchases for own reports\"\nON daily_report_vendor_purchases FOR INSERT\nTO authenticated\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM daily_reports dr\n    WHERE dr.id = daily_report_vendor_purchases.daily_report_id\n      AND dr.user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"Users can update own vendor purchases\"\nON daily_report_vendor_purchases FOR UPDATE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM daily_reports dr\n    WHERE dr.id = daily_report_vendor_purchases.daily_report_id\n      AND dr.user_id = auth.uid()\n  )\n)\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM daily_reports dr\n    WHERE dr.id = daily_report_vendor_purchases.daily_report_id\n      AND dr.user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"Users can delete own vendor purchases\"\nON daily_report_vendor_purchases FOR DELETE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM daily_reports dr\n    WHERE dr.id = daily_report_vendor_purchases.daily_report_id\n      AND dr.user_id = auth.uid()\n  )\n  OR EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid() AND p.role = 'admin'\n  )\n);\n\n-- ============================================\n-- 4. RLS çŠ¶æ…‹ç¢ºèªãƒ“ãƒ¥ãƒ¼\n-- ============================================\n\nCREATE OR REPLACE VIEW rls_status AS\nSELECT\n  schemaname,\n  tablename,\n  rowsecurity AS rls_enabled,\n  CASE WHEN rowsecurity THEN 'âœ… Enabled' ELSE 'âš ï¸ DISABLED' END AS status\nFROM pg_tables\nWHERE schemaname = 'public'\nORDER BY tablename;\n\nCREATE OR REPLACE VIEW rls_policies AS\nSELECT\n  schemaname,\n  tablename,\n  policyname,\n  permissive,\n  roles,\n  cmd\nFROM pg_policies\nWHERE schemaname = 'public'\nORDER BY tablename, policyname;\n\nCOMMENT ON VIEW rls_status IS\n'å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSæœ‰åŠ¹åŒ–çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ãƒ“ãƒ¥ãƒ¼ã€‚\nä½¿ç”¨ä¾‹: SELECT * FROM rls_status WHERE rls_enabled = false;';\n\nCOMMENT ON VIEW rls_policies IS\n'å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSãƒãƒªã‚·ãƒ¼ä¸€è¦§ã€‚\nä½¿ç”¨ä¾‹: SELECT * FROM rls_policies WHERE tablename = ''daily_reports'';';\n\n-- ============================================\n-- 5. æœ¬ç•ªç’°å¢ƒãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ\n-- ============================================\n\nDO $$\nDECLARE\n  disabled_tables TEXT;\nBEGIN\n  SELECT string_agg(tablename, ', ')\n  INTO disabled_tables\n  FROM pg_tables\n  WHERE schemaname = 'public'\n    AND rowsecurity = false;\n\n  IF disabled_tables IS NOT NULL THEN\n    RAISE WARNING 'âš ï¸ ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§RLSãŒç„¡åŠ¹ã§ã™: %', disabled_tables;\n  ELSE\n    RAISE NOTICE 'âœ… å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§RLSãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™';\n  END IF;\nEND $$;\n",
  "supabase/migrations/20251006054119_create_is_admin_and_complete_rls.sql": "/*\n  # is_admin()é–¢æ•° + å®Œå…¨ãªRLSãƒãƒªã‚·ãƒ¼ + ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n\n  ## æ¦‚è¦\n  1. is_admin()ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’ä½œæˆ\n  2. UPDATE/INSERTã®WITH CHECKã‚’è¿½åŠ \n  3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ\n\n  ## é‡è¦\n  ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’åŒæ™‚ã«æ”¹å–„ã—ã¾ã™\n*/\n\n-- ============================================\n-- 1. is_admin() ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°\n-- ============================================\n\nCREATE OR REPLACE FUNCTION public.is_admin()\nRETURNS boolean\nLANGUAGE sql\nSTABLE\nSECURITY DEFINER\nAS $$\n  SELECT EXISTS (\n    SELECT 1 FROM public.profiles\n    WHERE id = auth.uid() AND role = 'admin'\n  );\n$$;\n\nCOMMENT ON FUNCTION public.is_admin() IS\n'ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç®¡ç†è€…ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ã€‚\nRLSãƒãƒªã‚·ãƒ¼å†…ã§ä½¿ç”¨ã—ã¾ã™ã€‚';\n\n-- ============================================\n-- 2. daily_reports ã®ãƒãƒªã‚·ãƒ¼ä¿®æ­£\n-- ============================================\n\nDROP POLICY IF EXISTS \"dr_update\" ON daily_reports;\nCREATE POLICY \"dr_update\" ON daily_reports\nFOR UPDATE\nTO authenticated\nUSING (\n  is_admin() OR daily_reports.user_id = auth.uid()\n)\nWITH CHECK (\n  is_admin() OR EXISTS (\n    SELECT 1 FROM store_assignments sa\n    WHERE sa.store_id = daily_reports.store_id\n      AND sa.user_id = auth.uid()\n  )\n);\n\nDROP POLICY IF EXISTS \"dr_insert\" ON daily_reports;\nCREATE POLICY \"dr_insert\" ON daily_reports\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  is_admin() OR EXISTS (\n    SELECT 1 FROM store_assignments sa\n    WHERE sa.store_id = daily_reports.store_id\n      AND sa.user_id = auth.uid()\n  )\n);\n\n-- ============================================\n-- 3. targets ã®ãƒãƒªã‚·ãƒ¼ä¿®æ­£\n-- ============================================\n\nDROP POLICY IF EXISTS \"Managers and admins can create targets\" ON targets;\nCREATE POLICY \"Managers and admins can create targets\"\nON targets FOR INSERT\nTO authenticated\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = targets.store_id\n    )\n    OR is_admin()\n  )\n);\n\nDROP POLICY IF EXISTS \"Managers and admins can update targets\" ON targets;\nCREATE POLICY \"Managers and admins can update targets\"\nON targets FOR UPDATE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = targets.store_id\n    )\n    OR is_admin()\n  )\n)\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = targets.store_id\n    )\n    OR is_admin()\n  )\n);\n\n-- ============================================\n-- 4. monthly_expenses ã®ãƒãƒªã‚·ãƒ¼ä¿®æ­£\n-- ============================================\n\nDROP POLICY IF EXISTS \"me_select\" ON monthly_expenses;\nDROP POLICY IF EXISTS \"me_modify\" ON monthly_expenses;\n\nCREATE POLICY \"me_select\" ON monthly_expenses\nFOR SELECT\nTO authenticated\nUSING (\n  is_admin() OR EXISTS (\n    SELECT 1 FROM store_assignments sa\n    WHERE sa.store_id = monthly_expenses.store_id\n      AND sa.user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"me_insert\" ON monthly_expenses\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = monthly_expenses.store_id\n    )\n    OR is_admin()\n  )\n);\n\nCREATE POLICY \"me_update\" ON monthly_expenses\nFOR UPDATE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = monthly_expenses.store_id\n    )\n    OR is_admin()\n  )\n)\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = monthly_expenses.store_id\n    )\n    OR is_admin()\n  )\n);\n\nCREATE POLICY \"me_delete\" ON monthly_expenses\nFOR DELETE\nTO authenticated\nUSING (is_admin());\n\n-- ============================================\n-- 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n-- ============================================\n\nCREATE INDEX IF NOT EXISTS idx_daily_reports_store_date\n  ON daily_reports (store_id, date DESC);\n\nCREATE INDEX IF NOT EXISTS idx_daily_reports_user_date\n  ON daily_reports (user_id, date DESC);\n\nCREATE INDEX IF NOT EXISTS idx_monthly_expenses_store_month\n  ON monthly_expenses (store_id, month);\n\nCREATE INDEX IF NOT EXISTS idx_targets_store_period\n  ON targets (store_id, period);\n\nCREATE INDEX IF NOT EXISTS idx_store_assignments_user\n  ON store_assignments (user_id);\n\nCREATE INDEX IF NOT EXISTS idx_store_assignments_store\n  ON store_assignments (store_id);\n\nCREATE INDEX IF NOT EXISTS idx_drv_purchases_report\n  ON daily_report_vendor_purchases (daily_report_id);\n\n-- ============================================\n-- 6. ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n-- ============================================\n\nCREATE UNIQUE INDEX IF NOT EXISTS uniq_store_assignment\n  ON store_assignments (user_id, store_id);\n\nCREATE UNIQUE INDEX IF NOT EXISTS uniq_store_vendor\n  ON store_vendor_assignments (store_id, vendor_id);\n\nCREATE UNIQUE INDEX IF NOT EXISTS uniq_profiles_email\n  ON profiles (email);\n\n-- ============================================\n-- 7. ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nDECLARE\n  index_count INTEGER;\n  policy_count INTEGER;\nBEGIN\n  SELECT COUNT(*) INTO index_count\n  FROM pg_indexes\n  WHERE schemaname = 'public'\n    AND indexname LIKE 'idx_%';\n\n  SELECT COUNT(*) INTO policy_count\n  FROM pg_policies\n  WHERE schemaname = 'public';\n\n  RAISE NOTICE 'âœ… is_admin()é–¢æ•°ä½œæˆå®Œäº†';\n  RAISE NOTICE 'âœ… RLSãƒãƒªã‚·ãƒ¼ï¼ˆWITH CHECKï¼‰è¿½åŠ å®Œäº†';\n  RAISE NOTICE 'âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆå®Œäº†: % å€‹', index_count;\n  RAISE NOTICE 'âœ… RLSãƒãƒªã‚·ãƒ¼ç·æ•°: % å€‹', policy_count;\nEND $$;\n",
  "supabase/migrations/20251006061737_add_profiles_insert_policy.sql": "/*\n  # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«INSERTãƒãƒªã‚·ãƒ¼è¿½åŠ \n\n  ## æ¦‚è¦\n  æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã«INSERTãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ \n\n  ## å¤‰æ›´å†…å®¹\n  1. èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®IDã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆå¯èƒ½\n  2. æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è£œå®Œ\n*/\n\n-- ============================================\n-- 1. INSERTãƒãƒªã‚·ãƒ¼è¿½åŠ \n-- ============================================\n\nDROP POLICY IF EXISTS \"Users can insert own profile\" ON profiles;\n\nCREATE POLICY \"Users can insert own profile\"\nON profiles FOR INSERT\nTO authenticated\nWITH CHECK (auth.uid() = id);\n\n-- ============================================\n-- 2. æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è£œå®Œ\n-- ============================================\n\nINSERT INTO public.profiles (id, name, email, role)\nSELECT \n  au.id,\n  COALESCE(au.raw_user_meta_data->>'name', split_part(au.email, '@', 1)),\n  au.email,\n  COALESCE((au.raw_user_meta_data->>'role')::text, 'staff')\nFROM auth.users au\nWHERE NOT EXISTS (\n  SELECT 1 FROM public.profiles p WHERE p.id = au.id\n);\n\n-- ============================================\n-- 3. ç¢ºèª\n-- ============================================\n\nDO $$\nDECLARE\n  profile_count INTEGER;\n  auth_count INTEGER;\nBEGIN\n  SELECT COUNT(*) INTO profile_count FROM profiles;\n  SELECT COUNT(*) INTO auth_count FROM auth.users;\n  \n  RAISE NOTICE 'âœ… ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«INSERTãƒãƒªã‚·ãƒ¼ä½œæˆå®Œäº†';\n  RAISE NOTICE 'ğŸ“Š auth.users: % äºº', auth_count;\n  RAISE NOTICE 'ğŸ“Š profiles: % äºº', profile_count;\nEND $$;\n",
  "supabase/migrations/20251006081854_create_expense_baselines_table.sql": "/*\n  # Create expense_baselines table\n\n  1. New Tables\n    - `expense_baselines`\n      - `id` (uuid, primary key)\n      - `store_id` (uuid, foreign key to stores)\n      - `month` (text, format: YYYY-MM)\n      - Monthly expense baseline fields:\n        - `labor_cost_employee` (numeric)\n        - `labor_cost_part_time` (numeric)\n        - `utilities` (numeric)\n        - `promotion` (numeric)\n        - `cleaning` (numeric)\n        - `misc` (numeric)\n        - `communication` (numeric)\n        - `others` (numeric)\n      - `created_at` (timestamptz)\n      - `updated_at` (timestamptz)\n\n  2. Security\n    - Enable RLS on `expense_baselines` table\n    - Add SELECT policy for authenticated users (admin or assigned store)\n    - Add INSERT/UPDATE/DELETE policies for admin only\n\n  3. Indexes\n    - Add index on (store_id, month) for performance\n*/\n\n-- Create expense_baselines table\nCREATE TABLE IF NOT EXISTS public.expense_baselines (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  store_id uuid NOT NULL REFERENCES public.stores(id) ON DELETE CASCADE,\n  month text NOT NULL,\n  labor_cost_employee numeric NOT NULL DEFAULT 0,\n  labor_cost_part_time numeric NOT NULL DEFAULT 0,\n  utilities numeric NOT NULL DEFAULT 0,\n  promotion numeric NOT NULL DEFAULT 0,\n  cleaning numeric NOT NULL DEFAULT 0,\n  misc numeric NOT NULL DEFAULT 0,\n  communication numeric NOT NULL DEFAULT 0,\n  others numeric NOT NULL DEFAULT 0,\n  created_at timestamptz NOT NULL DEFAULT now(),\n  updated_at timestamptz NOT NULL DEFAULT now(),\n  CONSTRAINT uq_expense_baselines_store_month UNIQUE (store_id, month),\n  CONSTRAINT ck_expense_baselines_month_format CHECK (month ~ '^[0-9]{4}-[0-9]{2}$')\n);\n\n-- Create updated_at trigger function if not exists\nCREATE OR REPLACE FUNCTION public.set_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Create trigger for updated_at\nDROP TRIGGER IF EXISTS trg_expense_baselines_updated_at ON public.expense_baselines;\nCREATE TRIGGER trg_expense_baselines_updated_at\n  BEFORE UPDATE ON public.expense_baselines\n  FOR EACH ROW\n  EXECUTE FUNCTION public.set_updated_at();\n\n-- Create index for performance\nCREATE INDEX IF NOT EXISTS idx_expense_baselines_store_month\n  ON public.expense_baselines(store_id, month);\n\n-- Enable RLS\nALTER TABLE public.expense_baselines ENABLE ROW LEVEL SECURITY;\n\n-- SELECT policy: admin or assigned store users\nDROP POLICY IF EXISTS \"expense_baselines_select\" ON public.expense_baselines;\nCREATE POLICY \"expense_baselines_select\"\n  ON public.expense_baselines\n  FOR SELECT\n  TO authenticated\n  USING (\n    public.is_admin() OR\n    EXISTS (\n      SELECT 1\n      FROM public.store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = expense_baselines.store_id\n    )\n  );\n\n-- INSERT policy: admin only\nDROP POLICY IF EXISTS \"expense_baselines_ins\" ON public.expense_baselines;\nCREATE POLICY \"expense_baselines_ins\"\n  ON public.expense_baselines\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (public.is_admin());\n\n-- UPDATE policy: admin only\nDROP POLICY IF EXISTS \"expense_baselines_upd\" ON public.expense_baselines;\nCREATE POLICY \"expense_baselines_upd\"\n  ON public.expense_baselines\n  FOR UPDATE\n  TO authenticated\n  USING (public.is_admin())\n  WITH CHECK (public.is_admin());\n\n-- DELETE policy: admin only\nDROP POLICY IF EXISTS \"expense_baselines_del\" ON public.expense_baselines;\nCREATE POLICY \"expense_baselines_del\"\n  ON public.expense_baselines\n  FOR DELETE\n  TO authenticated\n  USING (public.is_admin());",
  "supabase/migrations/20251006114143_create_auto_profile_trigger.sql": "/*\n  # Auto-create Profile on User Registration\n\n  1. Changes\n    - Creates trigger function to automatically create profile when user signs up\n    - Creates trigger on auth.users table\n    - Backfills any missing profiles for existing users\n\n  2. Security\n    - Function uses SECURITY DEFINER to bypass RLS\n    - Only creates profile if it doesn't exist (ON CONFLICT DO NOTHING)\n    - Sets default role to 'staff'\n*/\n\n-- Create function to handle new user creation\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nBEGIN\n  INSERT INTO public.profiles (id, email, name, role)\n  VALUES (\n    NEW.id,\n    NEW.email,\n    COALESCE(NEW.raw_user_meta_data->>'name', SPLIT_PART(NEW.email, '@', 1)),\n    COALESCE(NEW.raw_user_meta_data->>'role', 'staff')\n  )\n  ON CONFLICT (id) DO NOTHING;\n  RETURN NEW;\nEND;\n$$;\n\n-- Drop existing trigger if it exists\nDROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;\n\n-- Create trigger to run after user insert\nCREATE TRIGGER on_auth_user_created\n  AFTER INSERT ON auth.users\n  FOR EACH ROW\n  EXECUTE FUNCTION public.handle_new_user();\n\n-- Backfill missing profiles for existing users\nINSERT INTO public.profiles (id, email, name, role)\nSELECT \n  u.id,\n  u.email,\n  COALESCE(u.raw_user_meta_data->>'name', SPLIT_PART(u.email, '@', 1)),\n  COALESCE(u.raw_user_meta_data->>'role', 'staff')\nFROM auth.users u\nLEFT JOIN public.profiles p ON p.id = u.id\nWHERE p.id IS NULL\nON CONFLICT (id) DO NOTHING;\n",
  "supabase/migrations/20251007025748_add_missing_columns_to_expense_baselines.sql": "/*\n  # expense_baselines ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¸è¶³ã‚«ãƒ©ãƒ ã‚’è¿½åŠ \n\n  1. å¤‰æ›´å†…å®¹\n    - `open_days` ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ï¼ˆç¨¼åƒæ—¥æ•°ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30æ—¥ï¼‰\n    - `rent` ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ï¼ˆè³ƒæ–™ï¼‰\n    - `consumables` ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ï¼ˆæ¶ˆè€—å“è²»ï¼‰\n\n  2. ç†ç”±\n    - open_days: æ—¥å‰²ã‚Šè¨ˆç®—ã«å¿…è¦\n    - rent, consumables: ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¨æ•´åˆæ€§ã‚’ä¿ã¤ãŸã‚\n\n  3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n    - æ—¢å­˜ã®RLSãƒãƒªã‚·ãƒ¼ãŒæ–°ã‚«ãƒ©ãƒ ã«ã‚‚é©ç”¨ã•ã‚Œã¾ã™\n*/\n\n-- open_days ã‚«ãƒ©ãƒ ã‚’è¿½åŠ \nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_name = 'expense_baselines' AND column_name = 'open_days'\n  ) THEN\n    ALTER TABLE expense_baselines ADD COLUMN open_days integer DEFAULT 30;\n  END IF;\nEND $$;\n\n-- rent ã‚«ãƒ©ãƒ ã‚’è¿½åŠ \nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_name = 'expense_baselines' AND column_name = 'rent'\n  ) THEN\n    ALTER TABLE expense_baselines ADD COLUMN rent numeric DEFAULT 0;\n  END IF;\nEND $$;\n\n-- consumables ã‚«ãƒ©ãƒ ã‚’è¿½åŠ \nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_name = 'expense_baselines' AND column_name = 'consumables'\n  ) THEN\n    ALTER TABLE expense_baselines ADD COLUMN consumables numeric DEFAULT 0;\n  END IF;\nEND $$;\n",
  "supabase/migrations/20251007062248_fix_store_vendor_assignments_rls.sql": "/*\n  # store_vendor_assignments RLSãƒãƒªã‚·ãƒ¼ã®ä¿®æ­£\n\n  1. å•é¡Œç‚¹\n    - ç¾åœ¨ã®ãƒãƒªã‚·ãƒ¼ã§ã¯ã€ç®¡ç†è€…ãŒåº—èˆ—ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ãªã„å ´åˆã€æ¥­è€…å‰²ã‚Šå½“ã¦ãŒã§ããªã„\n    - ç®¡ç†è€…ã¯å…¨åº—èˆ—ã«å¯¾ã—ã¦æ¥­è€…å‰²ã‚Šå½“ã¦ãŒã§ãã‚‹ã¹ã\n\n  2. ä¿®æ­£å†…å®¹\n    - INSERT/UPDATE/DELETE ãƒãƒªã‚·ãƒ¼ã§ is_admin() ã®å ´åˆã¯åº—èˆ—å‰²ã‚Šå½“ã¦ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—\n    - SELECT ãƒãƒªã‚·ãƒ¼ã§ is_admin() ã®å ´åˆã¯å…¨ãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§å¯èƒ½\n\n  3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n    - ç®¡ç†è€…: å…¨åº—èˆ—ã®æ¥­è€…å‰²ã‚Šå½“ã¦ã‚’ç®¡ç†å¯èƒ½\n    - ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼: å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸåº—èˆ—ã®ã¿ç®¡ç†å¯èƒ½\n    - ã‚¹ã‚¿ãƒƒãƒ•: å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸåº—èˆ—ã®ã¿é–²è¦§å¯èƒ½\n*/\n\n-- æ—¢å­˜ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤\nDROP POLICY IF EXISTS \"Users can read assignments for accessible stores\" ON store_vendor_assignments;\nDROP POLICY IF EXISTS \"Managers can manage vendor assignments\" ON store_vendor_assignments;\n\n-- SELECT: ç®¡ç†è€…ã¯å…¨åº—èˆ—ã€ãã®ä»–ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸåº—èˆ—ã®ã¿\nCREATE POLICY \"sva_select\" ON store_vendor_assignments\nFOR SELECT\nTO authenticated\nUSING (\n  is_admin() OR EXISTS (\n    SELECT 1 FROM store_assignments sa\n    WHERE sa.store_id = store_vendor_assignments.store_id\n      AND sa.user_id = auth.uid()\n  )\n);\n\n-- INSERT: ç®¡ç†è€…ã¯å…¨åº—èˆ—ã€ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸåº—èˆ—ã®ã¿\nCREATE POLICY \"sva_insert\" ON store_vendor_assignments\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    is_admin() OR EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = store_vendor_assignments.store_id\n    )\n  )\n);\n\n-- UPDATE: ç®¡ç†è€…ã¯å…¨åº—èˆ—ã€ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸåº—èˆ—ã®ã¿\nCREATE POLICY \"sva_update\" ON store_vendor_assignments\nFOR UPDATE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    is_admin() OR EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = store_vendor_assignments.store_id\n    )\n  )\n)\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    is_admin() OR EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = store_vendor_assignments.store_id\n    )\n  )\n);\n\n-- DELETE: ç®¡ç†è€…ã¯å…¨åº—èˆ—ã€ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸåº—èˆ—ã®ã¿\nCREATE POLICY \"sva_delete\" ON store_vendor_assignments\nFOR DELETE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles p\n    WHERE p.id = auth.uid()\n      AND p.role IN ('manager', 'admin')\n  )\n  AND (\n    is_admin() OR EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.user_id = auth.uid()\n        AND sa.store_id = store_vendor_assignments.store_id\n    )\n  )\n);\n",
  "supabase/migrations/20251008121020_add_cost_rate_targets_to_targets.sql": "/*\n  # Add Cost Rate Targets to Targets Table\n\n  1. Changes\n    - Add `target_cost_rate` column to `targets` table (ç›®æ¨™åŸä¾¡ç‡)\n    - Add `target_labor_rate` column to `targets` table (ç›®æ¨™äººä»¶è²»ç‡)\n    - Both columns are optional decimals with default value of 0\n    - Values are stored as percentages (e.g., 30.5 for 30.5%)\n\n  2. Notes\n    - Existing records will have default values of 0\n    - These targets will be used in KPI analysis and dashboard displays\n    - No RLS policy changes needed as policies are already in place\n*/\n\n-- Add target cost rate column (ç›®æ¨™åŸä¾¡ç‡)\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_name = 'targets' AND column_name = 'target_cost_rate'\n  ) THEN\n    ALTER TABLE targets ADD COLUMN target_cost_rate decimal DEFAULT 0;\n  END IF;\nEND $$;\n\n-- Add target labor rate column (ç›®æ¨™äººä»¶è²»ç‡)\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_name = 'targets' AND column_name = 'target_labor_rate'\n  ) THEN\n    ALTER TABLE targets ADD COLUMN target_labor_rate decimal DEFAULT 0;\n  END IF;\nEND $$;\n\n-- Add comments for clarity\nCOMMENT ON COLUMN targets.target_cost_rate IS 'Target cost of goods sold rate as percentage (e.g., 30.5 for 30.5%)';\nCOMMENT ON COLUMN targets.target_labor_rate IS 'Target labor cost rate as percentage (e.g., 25.0 for 25.0%)';",
  "supabase/migrations/20251009033828_add_daily_targets_table.sql": "/*\n  # æ—¥åˆ¥å£²ä¸Šç›®æ¨™ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ\n\n  1. æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«\n    - `daily_targets`\n      - `id` (uuid, primary key) - ãƒ¬ã‚³ãƒ¼ãƒ‰ID\n      - `store_id` (uuid, foreign key) - åº—èˆ—ID\n      - `date` (date) - å¯¾è±¡æ—¥\n      - `target_sales` (numeric) - å£²ä¸Šç›®æ¨™é‡‘é¡\n      - `created_at` (timestamptz) - ä½œæˆæ—¥æ™‚\n      - `updated_at` (timestamptz) - æ›´æ–°æ—¥æ™‚\n\n  2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n    - RLSã‚’æœ‰åŠ¹åŒ–\n    - ç®¡ç†è€…ï¼ˆadminï¼‰ï¼šå…¨åº—èˆ—ã®æ—¥åˆ¥ç›®æ¨™ã®ä½œæˆãƒ»èª­ã¿å–ã‚Šãƒ»æ›´æ–°ãƒ»å‰Šé™¤ãŒå¯èƒ½\n    - åº—é•·ï¼ˆmanagerï¼‰ï¼šæ‹…å½“åº—èˆ—ã®æ—¥åˆ¥ç›®æ¨™ã®ä½œæˆãƒ»èª­ã¿å–ã‚Šãƒ»æ›´æ–°ãƒ»å‰Šé™¤ãŒå¯èƒ½\n    - ã‚¹ã‚¿ãƒƒãƒ•ï¼ˆstaffï¼‰ï¼šæ‹…å½“åº—èˆ—ã®æ—¥åˆ¥ç›®æ¨™ã®èª­ã¿å–ã‚Šã®ã¿å¯èƒ½\n\n  3. åˆ¶ç´„\n    - store_idã¨dateã®è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼ˆåŒã˜åº—èˆ—ãƒ»åŒã˜æ—¥ä»˜ã§é‡è¤‡ç™»éŒ²ã‚’é˜²æ­¢ï¼‰\n    - å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã§storesãƒ†ãƒ¼ãƒ–ãƒ«ã¨é–¢é€£ä»˜ã‘\n\n  4. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n    - store_idã¨dateã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–\n*/\n\n-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ\nCREATE TABLE IF NOT EXISTS daily_targets (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  store_id uuid NOT NULL REFERENCES stores(id) ON DELETE CASCADE,\n  date date NOT NULL,\n  target_sales numeric NOT NULL DEFAULT 0,\n  created_at timestamptz DEFAULT now(),\n  updated_at timestamptz DEFAULT now(),\n  CONSTRAINT daily_targets_store_date_unique UNIQUE (store_id, date)\n);\n\n-- RLSã‚’æœ‰åŠ¹åŒ–\nALTER TABLE daily_targets ENABLE ROW LEVEL SECURITY;\n\n-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ\nCREATE INDEX IF NOT EXISTS idx_daily_targets_store_date ON daily_targets(store_id, date);\nCREATE INDEX IF NOT EXISTS idx_daily_targets_date ON daily_targets(date);\n\n-- RLSãƒãƒªã‚·ãƒ¼: ç®¡ç†è€…ã¯å…¨ã¦ã®æ—¥åˆ¥ç›®æ¨™ã‚’èª­ã¿å–ã‚Šå¯èƒ½\nCREATE POLICY \"Admins can view all daily targets\"\n  ON daily_targets FOR SELECT\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n  );\n\n-- RLSãƒãƒªã‚·ãƒ¼: åº—é•·ã¨ã‚¹ã‚¿ãƒƒãƒ•ã¯æ‹…å½“åº—èˆ—ã®æ—¥åˆ¥ç›®æ¨™ã‚’èª­ã¿å–ã‚Šå¯èƒ½\nCREATE POLICY \"Managers and staff can view their store daily targets\"\n  ON daily_targets FOR SELECT\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM store_assignments\n      WHERE store_assignments.user_id = auth.uid()\n      AND store_assignments.store_id = daily_targets.store_id\n    )\n  );\n\n-- RLSãƒãƒªã‚·ãƒ¼: ç®¡ç†è€…ã¯å…¨ã¦ã®æ—¥åˆ¥ç›®æ¨™ã‚’ä½œæˆå¯èƒ½\nCREATE POLICY \"Admins can create daily targets\"\n  ON daily_targets FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n  );\n\n-- RLSãƒãƒªã‚·ãƒ¼: åº—é•·ã¯æ‹…å½“åº—èˆ—ã®æ—¥åˆ¥ç›®æ¨™ã‚’ä½œæˆå¯èƒ½\nCREATE POLICY \"Managers can create their store daily targets\"\n  ON daily_targets FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      JOIN profiles p ON p.id = sa.user_id\n      WHERE sa.user_id = auth.uid()\n      AND sa.store_id = daily_targets.store_id\n      AND p.role = 'manager'\n    )\n  );\n\n-- RLSãƒãƒªã‚·ãƒ¼: ç®¡ç†è€…ã¯å…¨ã¦ã®æ—¥åˆ¥ç›®æ¨™ã‚’æ›´æ–°å¯èƒ½\nCREATE POLICY \"Admins can update daily targets\"\n  ON daily_targets FOR UPDATE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n  );\n\n-- RLSãƒãƒªã‚·ãƒ¼: åº—é•·ã¯æ‹…å½“åº—èˆ—ã®æ—¥åˆ¥ç›®æ¨™ã‚’æ›´æ–°å¯èƒ½\nCREATE POLICY \"Managers can update their store daily targets\"\n  ON daily_targets FOR UPDATE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      JOIN profiles p ON p.id = sa.user_id\n      WHERE sa.user_id = auth.uid()\n      AND sa.store_id = daily_targets.store_id\n      AND p.role = 'manager'\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      JOIN profiles p ON p.id = sa.user_id\n      WHERE sa.user_id = auth.uid()\n      AND sa.store_id = daily_targets.store_id\n      AND p.role = 'manager'\n    )\n  );\n\n-- RLSãƒãƒªã‚·ãƒ¼: ç®¡ç†è€…ã¯å…¨ã¦ã®æ—¥åˆ¥ç›®æ¨™ã‚’å‰Šé™¤å¯èƒ½\nCREATE POLICY \"Admins can delete daily targets\"\n  ON daily_targets FOR DELETE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'admin'\n    )\n  );\n\n-- RLSãƒãƒªã‚·ãƒ¼: åº—é•·ã¯æ‹…å½“åº—èˆ—ã®æ—¥åˆ¥ç›®æ¨™ã‚’å‰Šé™¤å¯èƒ½\nCREATE POLICY \"Managers can delete their store daily targets\"\n  ON daily_targets FOR DELETE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      JOIN profiles p ON p.id = sa.user_id\n      WHERE sa.user_id = auth.uid()\n      AND sa.store_id = daily_targets.store_id\n      AND p.role = 'manager'\n    )\n  );\n",
  "supabase/migrations/20251009044215_create_ai_report_system_tables.sql": "/*\n  # AI Automated Report Generation System\n\n  ## Overview\n  This migration creates the infrastructure for AI-powered automated weekly and monthly report generation.\n  The system will automatically analyze business data and generate comprehensive reports with insights.\n\n  ## New Tables\n  \n  ### 1. `ai_generated_reports`\n  Stores AI-generated analysis reports\n  - `id` (uuid, primary key) - Unique report identifier\n  - `store_id` (uuid, nullable) - Store ID if report is store-specific, null for all-store reports\n  - `report_type` (text) - Type: 'weekly' or 'monthly'\n  - `period_start` (date) - Start date of reporting period\n  - `period_end` (date) - End date of reporting period\n  - `title` (text) - Report title\n  - `summary` (text) - Executive summary section\n  - `analysis_content` (jsonb) - Detailed analysis sections in structured format\n  - `key_insights` (text[]) - Array of key insights/findings\n  - `recommendations` (text[]) - Array of actionable recommendations\n  - `metrics` (jsonb) - Calculated metrics (sales, profit, growth rates, etc.)\n  - `generated_by` (text) - AI model used for generation\n  - `generated_at` (timestamptz) - When the report was generated\n  - `created_at` (timestamptz) - Record creation timestamp\n\n  ### 2. `report_schedules`\n  Manages automatic report generation schedules\n  - `id` (uuid, primary key) - Schedule identifier\n  - `report_type` (text) - 'weekly' or 'monthly'\n  - `store_id` (uuid, nullable) - Store ID for store-specific reports, null for all stores\n  - `is_enabled` (boolean) - Whether the schedule is active\n  - `cron_expression` (text) - Cron expression for scheduling\n  - `last_run_at` (timestamptz, nullable) - Last successful generation time\n  - `next_run_at` (timestamptz, nullable) - Scheduled next run time\n  - `notification_emails` (text[]) - Email addresses to notify on completion\n  - `created_at` (timestamptz) - Record creation timestamp\n  - `updated_at` (timestamptz) - Last update timestamp\n\n  ### 3. `report_generation_logs`\n  Tracks report generation history and status\n  - `id` (uuid, primary key) - Log entry identifier\n  - `schedule_id` (uuid, nullable) - Related schedule if auto-generated\n  - `report_id` (uuid, nullable) - Generated report ID if successful\n  - `report_type` (text) - Type of report attempted\n  - `store_id` (uuid, nullable) - Store ID if applicable\n  - `status` (text) - 'success', 'failed', or 'in_progress'\n  - `started_at` (timestamptz) - Generation start time\n  - `completed_at` (timestamptz, nullable) - Generation completion time\n  - `error_message` (text, nullable) - Error details if failed\n  - `data_summary` (jsonb) - Summary of data analyzed\n  - `created_at` (timestamptz) - Record creation timestamp\n\n  ## Security\n  - Enable RLS on all tables\n  - Admin users can view all reports and manage schedules\n  - Store managers can view reports for their assigned stores\n  - Staff can view reports for their store\n\n  ## Indexes\n  - Performance indexes on frequently queried columns\n  - Composite indexes for date range queries\n\n  ## Notes\n  - Reports are generated automatically based on schedules\n  - Manual generation is also supported\n  - All reports are versioned by generation timestamp\n  - Historical reports are preserved for trend analysis\n*/\n\n-- Create ai_generated_reports table\nCREATE TABLE IF NOT EXISTS ai_generated_reports (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  store_id uuid REFERENCES stores(id) ON DELETE CASCADE,\n  report_type text NOT NULL CHECK (report_type IN ('weekly', 'monthly')),\n  period_start date NOT NULL,\n  period_end date NOT NULL,\n  title text NOT NULL,\n  summary text NOT NULL,\n  analysis_content jsonb NOT NULL DEFAULT '{}',\n  key_insights text[] NOT NULL DEFAULT '{}',\n  recommendations text[] NOT NULL DEFAULT '{}',\n  metrics jsonb NOT NULL DEFAULT '{}',\n  generated_by text NOT NULL DEFAULT 'gpt-4o-mini',\n  generated_at timestamptz NOT NULL DEFAULT now(),\n  created_at timestamptz NOT NULL DEFAULT now()\n);\n\n-- Create report_schedules table\nCREATE TABLE IF NOT EXISTS report_schedules (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  report_type text NOT NULL CHECK (report_type IN ('weekly', 'monthly')),\n  store_id uuid REFERENCES stores(id) ON DELETE CASCADE,\n  is_enabled boolean NOT NULL DEFAULT true,\n  cron_expression text NOT NULL,\n  last_run_at timestamptz,\n  next_run_at timestamptz,\n  notification_emails text[] NOT NULL DEFAULT '{}',\n  created_at timestamptz NOT NULL DEFAULT now(),\n  updated_at timestamptz NOT NULL DEFAULT now()\n);\n\n-- Create report_generation_logs table\nCREATE TABLE IF NOT EXISTS report_generation_logs (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  schedule_id uuid REFERENCES report_schedules(id) ON DELETE SET NULL,\n  report_id uuid REFERENCES ai_generated_reports(id) ON DELETE SET NULL,\n  report_type text NOT NULL CHECK (report_type IN ('weekly', 'monthly')),\n  store_id uuid REFERENCES stores(id) ON DELETE CASCADE,\n  status text NOT NULL CHECK (status IN ('success', 'failed', 'in_progress')) DEFAULT 'in_progress',\n  started_at timestamptz NOT NULL DEFAULT now(),\n  completed_at timestamptz,\n  error_message text,\n  data_summary jsonb DEFAULT '{}',\n  created_at timestamptz NOT NULL DEFAULT now()\n);\n\n-- Create indexes for performance\nCREATE INDEX IF NOT EXISTS idx_ai_reports_store_type_period ON ai_generated_reports(store_id, report_type, period_start DESC);\nCREATE INDEX IF NOT EXISTS idx_ai_reports_generated_at ON ai_generated_reports(generated_at DESC);\nCREATE INDEX IF NOT EXISTS idx_report_schedules_enabled ON report_schedules(is_enabled, next_run_at) WHERE is_enabled = true;\nCREATE INDEX IF NOT EXISTS idx_report_logs_status_started ON report_generation_logs(status, started_at DESC);\n\n-- Enable Row Level Security\nALTER TABLE ai_generated_reports ENABLE ROW LEVEL SECURITY;\nALTER TABLE report_schedules ENABLE ROW LEVEL SECURITY;\nALTER TABLE report_generation_logs ENABLE ROW LEVEL SECURITY;\n\n-- RLS Policies for ai_generated_reports\n\n-- Admins can view all reports\nCREATE POLICY \"Admins can view all AI reports\"\n  ON ai_generated_reports FOR SELECT\n  TO authenticated\n  USING (public.is_admin());\n\n-- Managers can view reports for their stores\nCREATE POLICY \"Managers can view reports for their stores\"\n  ON ai_generated_reports FOR SELECT\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'manager'\n      AND (\n        ai_generated_reports.store_id IS NULL\n        OR ai_generated_reports.store_id IN (\n          SELECT id FROM stores WHERE manager_id = auth.uid()\n        )\n      )\n    )\n  );\n\n-- Staff can view reports for their store\nCREATE POLICY \"Staff can view reports for their store\"\n  ON ai_generated_reports FOR SELECT\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM daily_reports\n      WHERE daily_reports.user_id = auth.uid()\n      AND daily_reports.store_id = ai_generated_reports.store_id\n    )\n  );\n\n-- Admins can insert reports\nCREATE POLICY \"Admins can insert AI reports\"\n  ON ai_generated_reports FOR INSERT\n  TO authenticated\n  WITH CHECK (public.is_admin());\n\n-- RLS Policies for report_schedules\n\n-- Admins can manage all schedules\nCREATE POLICY \"Admins can view all schedules\"\n  ON report_schedules FOR SELECT\n  TO authenticated\n  USING (public.is_admin());\n\nCREATE POLICY \"Admins can insert schedules\"\n  ON report_schedules FOR INSERT\n  TO authenticated\n  WITH CHECK (public.is_admin());\n\nCREATE POLICY \"Admins can update schedules\"\n  ON report_schedules FOR UPDATE\n  TO authenticated\n  USING (public.is_admin())\n  WITH CHECK (public.is_admin());\n\nCREATE POLICY \"Admins can delete schedules\"\n  ON report_schedules FOR DELETE\n  TO authenticated\n  USING (public.is_admin());\n\n-- RLS Policies for report_generation_logs\n\n-- Admins can view all logs\nCREATE POLICY \"Admins can view all generation logs\"\n  ON report_generation_logs FOR SELECT\n  TO authenticated\n  USING (public.is_admin());\n\n-- Admins can insert logs\nCREATE POLICY \"Admins can insert generation logs\"\n  ON report_generation_logs FOR INSERT\n  TO authenticated\n  WITH CHECK (public.is_admin());\n\n-- Admins can update logs\nCREATE POLICY \"Admins can update generation logs\"\n  ON report_generation_logs FOR UPDATE\n  TO authenticated\n  USING (public.is_admin())\n  WITH CHECK (public.is_admin());\n",
  "supabase/migrations/20251009050405_add_ai_reports_delete_policy.sql": "/*\n  # Add DELETE policy for AI Generated Reports\n\n  ## Changes\n  This migration adds a DELETE policy to the ai_generated_reports table.\n\n  ## Security\n  - Only admins can delete AI generated reports\n  - This prevents accidental or unauthorized deletion of reports\n\n  ## Policy Details\n  - Policy Name: \"Admins can delete AI reports\"\n  - Operation: DELETE\n  - Role: authenticated\n  - Condition: User must be an admin (verified via is_admin() function)\n*/\n\n-- Add DELETE policy for ai_generated_reports\nCREATE POLICY \"Admins can delete AI reports\"\n  ON ai_generated_reports FOR DELETE\n  TO authenticated\n  USING (public.is_admin());",
  "supabase/migrations/20251009115151_add_shareable_link_to_reports.sql": "/*\n  # Add Shareable Link Support to AI Reports\n\n  ## Changes\n  1. Add `share_token` column to ai_generated_reports table\n    - Unique token for public access\n    - Used to generate shareable links\n  \n  2. Add `is_public` flag\n    - Controls whether report can be accessed via share link\n  \n  3. Create public access policy\n    - Allows unauthenticated access via valid share_token\n\n  ## Security\n  - Share tokens are randomly generated UUIDs\n  - Reports are only accessible with valid token and is_public = true\n  - Tokens can be regenerated to revoke access\n*/\n\n-- Add share_token and is_public columns\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'ai_generated_reports' AND column_name = 'share_token'\n  ) THEN\n    ALTER TABLE ai_generated_reports \n    ADD COLUMN share_token uuid DEFAULT gen_random_uuid() UNIQUE;\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'ai_generated_reports' AND column_name = 'is_public'\n  ) THEN\n    ALTER TABLE ai_generated_reports \n    ADD COLUMN is_public boolean DEFAULT false;\n  END IF;\nEND $$;\n\n-- Create index for share_token lookups\nCREATE INDEX IF NOT EXISTS idx_ai_reports_share_token \n  ON ai_generated_reports(share_token) \n  WHERE is_public = true;\n\n-- Add policy for public access via share token\nCREATE POLICY \"Public can view reports with valid share token\"\n  ON ai_generated_reports FOR SELECT\n  TO anon\n  USING (\n    is_public = true \n    AND share_token IS NOT NULL\n  );\n",
  "supabase/migrations/20251009115807_add_ai_reports_update_policies.sql": "/*\n  # Add UPDATE policies for AI Reports\n\n  ## Changes\n  1. Add UPDATE policy for admins to update all AI reports\n  2. Add UPDATE policy for managers to update reports for their stores\n\n  ## Security\n  - Admins can update all reports\n  - Managers can update reports for stores they manage\n  - Staff cannot update reports (read-only access)\n*/\n\n-- Admins can update all AI reports\nCREATE POLICY \"Admins can update AI reports\"\n  ON ai_generated_reports FOR UPDATE\n  TO authenticated\n  USING (public.is_admin())\n  WITH CHECK (public.is_admin());\n\n-- Managers can update reports for their stores\nCREATE POLICY \"Managers can update reports for their stores\"\n  ON ai_generated_reports FOR UPDATE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'manager'\n      AND (\n        ai_generated_reports.store_id IS NULL\n        OR ai_generated_reports.store_id IN (\n          SELECT id FROM stores WHERE manager_id = auth.uid()\n        )\n      )\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'manager'\n      AND (\n        ai_generated_reports.store_id IS NULL\n        OR ai_generated_reports.store_id IN (\n          SELECT id FROM stores WHERE manager_id = auth.uid()\n        )\n      )\n    )\n  );\n",
  "supabase/migrations/20251009120056_fix_ai_reports_policies_conflict.sql": "/*\n  # Fix AI Reports Policy Conflicts\n\n  ## Changes\n  1. Drop existing UPDATE policies to avoid conflicts\n  2. Recreate simplified UPDATE policies\n  3. Ensure proper policy evaluation order\n\n  ## Security\n  - Maintains same security levels\n  - Admins and managers can update reports\n  - No change to SELECT, INSERT, DELETE policies\n*/\n\n-- Drop existing UPDATE policies if they exist\nDO $$ \nBEGIN\n  DROP POLICY IF EXISTS \"Admins can update AI reports\" ON ai_generated_reports;\n  DROP POLICY IF EXISTS \"Managers can update reports for their stores\" ON ai_generated_reports;\nEXCEPTION\n  WHEN undefined_object THEN NULL;\nEND $$;\n\n-- Create single UPDATE policy for admins and managers\nCREATE POLICY \"Authenticated users can update their accessible reports\"\n  ON ai_generated_reports FOR UPDATE\n  TO authenticated\n  USING (\n    -- Admins can update all reports\n    public.is_admin()\n    OR\n    -- Managers can update reports for their stores\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'manager'\n      AND (\n        ai_generated_reports.store_id IS NULL\n        OR ai_generated_reports.store_id IN (\n          SELECT id FROM stores WHERE manager_id = auth.uid()\n        )\n      )\n    )\n  )\n  WITH CHECK (\n    -- Admins can update all reports\n    public.is_admin()\n    OR\n    -- Managers can update reports for their stores\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role = 'manager'\n      AND (\n        ai_generated_reports.store_id IS NULL\n        OR ai_generated_reports.store_id IN (\n          SELECT id FROM stores WHERE manager_id = auth.uid()\n        )\n      )\n    )\n  );\n",
  "supabase/migrations/20251009130000_create_ai_usage_limits.sql": "/*\n  # AIä½¿ç”¨åˆ¶é™ã‚·ã‚¹ãƒ†ãƒ \n\n  ## æ¦‚è¦\n  AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®1æ—¥ã‚ãŸã‚Šã®ä½¿ç”¨å›æ•°ã‚’åˆ¶é™ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¾ã™ã€‚\n  ãƒ­ãƒ¼ãƒ«åˆ¥ã«ç•°ãªã‚‹ä¸Šé™ã‚’è¨­å®šã—ã€ã‚³ã‚¹ãƒˆç®¡ç†ã¨é©åˆ‡ãªåˆ©ç”¨ã‚’ä¿ƒé€²ã—ã¾ã™ã€‚\n\n  ## æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«\n\n  ### ai_usage_trackingï¼ˆä½¿ç”¨å›æ•°è¿½è·¡ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰\n  - `id` (uuid, primary key) - ãƒ¬ã‚³ãƒ¼ãƒ‰ID\n  - `user_id` (uuid, å¤–éƒ¨ã‚­ãƒ¼) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID\n  - `usage_date` (date) - ä½¿ç”¨æ—¥ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰\n  - `request_count` (integer) - ãƒªã‚¯ã‚¨ã‚¹ãƒˆå›æ•°\n  - `created_at` (timestamptz) - ä½œæˆæ—¥æ™‚\n  - `updated_at` (timestamptz) - æ›´æ–°æ—¥æ™‚\n  - ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„: (user_id, usage_date)\n\n  ### ai_usage_settingsï¼ˆä½¿ç”¨åˆ¶é™è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰\n  - `id` (uuid, primary key) - ãƒ¬ã‚³ãƒ¼ãƒ‰ID\n  - `role` (text) - ãƒ­ãƒ¼ãƒ«ï¼ˆadmin/manager/staffï¼‰\n  - `daily_limit` (integer) - 1æ—¥ã®ä¸Šé™ï¼ˆ-1ã¯ç„¡åˆ¶é™ï¼‰\n  - `enabled` (boolean) - åˆ¶é™ã®æœ‰åŠ¹/ç„¡åŠ¹\n  - `created_at` (timestamptz) - ä½œæˆæ—¥æ™‚\n  - `updated_at` (timestamptz) - æ›´æ–°æ—¥æ™‚\n  - ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„: role\n\n  ## RPCé–¢æ•°\n\n  ### check_and_increment_usage\n  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½¿ç”¨å›æ•°ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€åˆ¶é™å†…ã§ã‚ã‚Œã°ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—åŠ ã•ã›ã¾ã™ã€‚\n\n  ### get_user_usage_status\n  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ã®ä½¿ç”¨çŠ¶æ³ï¼ˆä½¿ç”¨å›æ•°ã€ä¸Šé™ã€æ®‹ã‚Šï¼‰ã‚’å–å¾—ã—ã¾ã™ã€‚\n\n  ### reset_user_daily_usage\n  ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½“æ—¥ã®ä½¿ç”¨å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰ã€‚\n\n  ## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n  - RLSæœ‰åŠ¹åŒ–\n  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ä½¿ç”¨çŠ¶æ³ã®ã¿å‚ç…§å¯èƒ½\n  - è¨­å®šã¯å…¨å“¡ãŒå‚ç…§å¯èƒ½ã€æ›´æ–°ã¯ç®¡ç†è€…ã®ã¿\n  - RPCé–¢æ•°ã¯SECURITY DEFINERã§å®Ÿè£…\n\n  ## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–\n  - è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: (user_id, usage_date)\n  - ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n  - è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ8æ—¥ä»¥ä¸Šå‰ã®ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼‰\n*/\n\n-- ============================================\n-- 1. ai_usage_tracking ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nCREATE TABLE IF NOT EXISTS ai_usage_tracking (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id uuid NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  usage_date date NOT NULL DEFAULT (now() AT TIME ZONE 'Asia/Tokyo')::date,\n  request_count integer NOT NULL DEFAULT 0,\n  created_at timestamptz NOT NULL DEFAULT now(),\n  updated_at timestamptz NOT NULL DEFAULT now(),\n  CONSTRAINT unique_user_date UNIQUE (user_id, usage_date)\n);\n\n-- ============================================\n-- 2. ai_usage_settings ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nCREATE TABLE IF NOT EXISTS ai_usage_settings (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  role text NOT NULL CHECK (role IN ('admin', 'manager', 'staff')),\n  daily_limit integer NOT NULL DEFAULT 20,\n  enabled boolean NOT NULL DEFAULT true,\n  created_at timestamptz NOT NULL DEFAULT now(),\n  updated_at timestamptz NOT NULL DEFAULT now(),\n  CONSTRAINT unique_role UNIQUE (role)\n);\n\n-- ============================================\n-- 3. åˆæœŸè¨­å®šãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥\n-- ============================================\n\nINSERT INTO ai_usage_settings (role, daily_limit, enabled)\nVALUES\n  ('admin', -1, true),      -- ç„¡åˆ¶é™\n  ('manager', 20, true),    -- 20å›/æ—¥\n  ('staff', 5, true)        -- 5å›/æ—¥\nON CONFLICT (role) DO NOTHING;\n\n-- ============================================\n-- 4. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n-- ============================================\n\n-- ä½¿ç”¨å›æ•°å–å¾—ç”¨ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\nCREATE INDEX IF NOT EXISTS idx_usage_tracking_user_date\nON ai_usage_tracking(user_id, usage_date);\n\n-- ãƒ­ãƒ¼ãƒ«åˆ¥è¨­å®šå–å¾—ç”¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\nCREATE INDEX IF NOT EXISTS idx_usage_settings_role\nON ai_usage_settings(role);\n\n-- ============================================\n-- 5. Row Level Securityï¼ˆRLSï¼‰\n-- ============================================\n\n-- ai_usage_tracking ã®RLSæœ‰åŠ¹åŒ–\nALTER TABLE ai_usage_tracking ENABLE ROW LEVEL SECURITY;\n\n-- ai_usage_settings ã®RLSæœ‰åŠ¹åŒ–\nALTER TABLE ai_usage_settings ENABLE ROW LEVEL SECURITY;\n\n-- ai_usage_tracking: SELECT ãƒãƒªã‚·ãƒ¼ï¼ˆè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿å‚ç…§å¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Users can view own usage tracking\" ON ai_usage_tracking;\nCREATE POLICY \"Users can view own usage tracking\"\nON ai_usage_tracking\nFOR SELECT\nTO authenticated\nUSING (auth.uid() = user_id);\n\n-- ai_usage_tracking: INSERT ãƒãƒªã‚·ãƒ¼ï¼ˆè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ä½œæˆå¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Users can create own usage tracking\" ON ai_usage_tracking;\nCREATE POLICY \"Users can create own usage tracking\"\nON ai_usage_tracking\nFOR INSERT\nTO authenticated\nWITH CHECK (auth.uid() = user_id);\n\n-- ai_usage_tracking: UPDATE ãƒãƒªã‚·ãƒ¼ï¼ˆè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿æ›´æ–°å¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Users can update own usage tracking\" ON ai_usage_tracking;\nCREATE POLICY \"Users can update own usage tracking\"\nON ai_usage_tracking\nFOR UPDATE\nTO authenticated\nUSING (auth.uid() = user_id)\nWITH CHECK (auth.uid() = user_id);\n\n-- ai_usage_settings: SELECT ãƒãƒªã‚·ãƒ¼ï¼ˆå…¨å“¡ãŒå‚ç…§å¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Anyone can view usage settings\" ON ai_usage_settings;\nCREATE POLICY \"Anyone can view usage settings\"\nON ai_usage_settings\nFOR SELECT\nTO authenticated\nUSING (true);\n\n-- ai_usage_settings: UPDATE ãƒãƒªã‚·ãƒ¼ï¼ˆç®¡ç†è€…ã®ã¿æ›´æ–°å¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Admins can update usage settings\" ON ai_usage_settings;\nCREATE POLICY \"Admins can update usage settings\"\nON ai_usage_settings\nFOR UPDATE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles\n    WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n  )\n)\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles\n    WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n  )\n);\n\n-- ============================================\n-- 6. RPCé–¢æ•°: check_and_increment_usage\n-- ============================================\n\nCREATE OR REPLACE FUNCTION check_and_increment_usage(p_user_id uuid)\nRETURNS jsonb\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n  v_current_date date;\n  v_current_count integer;\n  v_user_role text;\n  v_daily_limit integer;\n  v_enabled boolean;\n  v_remaining integer;\n  v_is_allowed boolean;\nBEGIN\n  -- æ—¥æœ¬æ™‚é–“ã®ç¾åœ¨æ—¥ä»˜ã‚’å–å¾—\n  v_current_date := (now() AT TIME ZONE 'Asia/Tokyo')::date;\n\n  -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ãƒ¼ãƒ«ã‚’å–å¾—\n  SELECT role INTO v_user_role\n  FROM profiles\n  WHERE id = p_user_id;\n\n  IF v_user_role IS NULL THEN\n    v_user_role := 'staff'; -- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\n  END IF;\n\n  -- ãƒ­ãƒ¼ãƒ«åˆ¥ã®ä¸Šé™è¨­å®šã‚’å–å¾—\n  SELECT daily_limit, enabled INTO v_daily_limit, v_enabled\n  FROM ai_usage_settings\n  WHERE role = v_user_role;\n\n  IF v_daily_limit IS NULL THEN\n    v_daily_limit := 5; -- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\n  END IF;\n\n  IF v_enabled IS NULL THEN\n    v_enabled := true;\n  END IF;\n\n  -- åˆ¶é™ãŒç„¡åŠ¹ã®å ´åˆã¯å¸¸ã«è¨±å¯\n  IF NOT v_enabled THEN\n    RETURN jsonb_build_object(\n      'allowed', true,\n      'current_count', 0,\n      'daily_limit', -1,\n      'remaining', -1,\n      'message', 'åˆ¶é™ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™'\n    );\n  END IF;\n\n  -- ç®¡ç†è€…ï¼ˆç„¡åˆ¶é™ï¼‰ã®å ´åˆ\n  IF v_daily_limit = -1 THEN\n    RETURN jsonb_build_object(\n      'allowed', true,\n      'current_count', 0,\n      'daily_limit', -1,\n      'remaining', -1,\n      'message', 'ç„¡åˆ¶é™'\n    );\n  END IF;\n\n  -- ç¾åœ¨ã®ä½¿ç”¨å›æ•°ã‚’å–å¾—ã¾ãŸã¯åˆæœŸåŒ–\n  SELECT request_count INTO v_current_count\n  FROM ai_usage_tracking\n  WHERE user_id = p_user_id AND usage_date = v_current_date;\n\n  IF v_current_count IS NULL THEN\n    v_current_count := 0;\n  END IF;\n\n  -- åˆ¶é™ãƒã‚§ãƒƒã‚¯\n  v_is_allowed := v_current_count < v_daily_limit;\n\n  -- è¨±å¯ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—åŠ \n  IF v_is_allowed THEN\n    INSERT INTO ai_usage_tracking (user_id, usage_date, request_count)\n    VALUES (p_user_id, v_current_date, 1)\n    ON CONFLICT (user_id, usage_date)\n    DO UPDATE SET\n      request_count = ai_usage_tracking.request_count + 1,\n      updated_at = now();\n\n    v_current_count := v_current_count + 1;\n  END IF;\n\n  v_remaining := GREATEST(0, v_daily_limit - v_current_count);\n\n  RETURN jsonb_build_object(\n    'allowed', v_is_allowed,\n    'current_count', v_current_count,\n    'daily_limit', v_daily_limit,\n    'remaining', v_remaining,\n    'message', CASE\n      WHEN v_is_allowed THEN 'åˆ©ç”¨å¯èƒ½'\n      ELSE 'æœ¬æ—¥ã®åˆ©ç”¨ä¸Šé™ã«é”ã—ã¾ã—ãŸ'\n    END\n  );\nEND;\n$$;\n\n-- ============================================\n-- 7. RPCé–¢æ•°: get_user_usage_status\n-- ============================================\n\nCREATE OR REPLACE FUNCTION get_user_usage_status(p_user_id uuid)\nRETURNS jsonb\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n  v_current_date date;\n  v_current_count integer;\n  v_user_role text;\n  v_daily_limit integer;\n  v_enabled boolean;\n  v_remaining integer;\n  v_reset_at timestamptz;\nBEGIN\n  -- æ—¥æœ¬æ™‚é–“ã®ç¾åœ¨æ—¥ä»˜ã‚’å–å¾—\n  v_current_date := (now() AT TIME ZONE 'Asia/Tokyo')::date;\n\n  -- æ¬¡ã®ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»ï¼ˆç¿Œæ—¥ã®åˆå‰0æ™‚ JSTï¼‰\n  v_reset_at := (v_current_date + interval '1 day') AT TIME ZONE 'Asia/Tokyo';\n\n  -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ãƒ¼ãƒ«ã‚’å–å¾—\n  SELECT role INTO v_user_role\n  FROM profiles\n  WHERE id = p_user_id;\n\n  IF v_user_role IS NULL THEN\n    v_user_role := 'staff';\n  END IF;\n\n  -- ãƒ­ãƒ¼ãƒ«åˆ¥ã®ä¸Šé™è¨­å®šã‚’å–å¾—\n  SELECT daily_limit, enabled INTO v_daily_limit, v_enabled\n  FROM ai_usage_settings\n  WHERE role = v_user_role;\n\n  IF v_daily_limit IS NULL THEN\n    v_daily_limit := 5;\n  END IF;\n\n  IF v_enabled IS NULL THEN\n    v_enabled := true;\n  END IF;\n\n  -- åˆ¶é™ãŒç„¡åŠ¹ã®å ´åˆ\n  IF NOT v_enabled THEN\n    RETURN jsonb_build_object(\n      'current_count', 0,\n      'daily_limit', -1,\n      'remaining', -1,\n      'reset_at', v_reset_at,\n      'is_limited', false\n    );\n  END IF;\n\n  -- ç®¡ç†è€…ï¼ˆç„¡åˆ¶é™ï¼‰ã®å ´åˆ\n  IF v_daily_limit = -1 THEN\n    RETURN jsonb_build_object(\n      'current_count', 0,\n      'daily_limit', -1,\n      'remaining', -1,\n      'reset_at', v_reset_at,\n      'is_limited', false\n    );\n  END IF;\n\n  -- ç¾åœ¨ã®ä½¿ç”¨å›æ•°ã‚’å–å¾—\n  SELECT request_count INTO v_current_count\n  FROM ai_usage_tracking\n  WHERE user_id = p_user_id AND usage_date = v_current_date;\n\n  IF v_current_count IS NULL THEN\n    v_current_count := 0;\n  END IF;\n\n  v_remaining := GREATEST(0, v_daily_limit - v_current_count);\n\n  RETURN jsonb_build_object(\n    'current_count', v_current_count,\n    'daily_limit', v_daily_limit,\n    'remaining', v_remaining,\n    'reset_at', v_reset_at,\n    'is_limited', v_current_count >= v_daily_limit\n  );\nEND;\n$$;\n\n-- ============================================\n-- 8. RPCé–¢æ•°: reset_user_daily_usageï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰\n-- ============================================\n\nCREATE OR REPLACE FUNCTION reset_user_daily_usage(p_user_id uuid)\nRETURNS jsonb\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n  v_current_date date;\n  v_is_admin boolean;\nBEGIN\n  -- å®Ÿè¡Œè€…ãŒç®¡ç†è€…ã‹ãƒã‚§ãƒƒã‚¯\n  SELECT EXISTS (\n    SELECT 1 FROM profiles\n    WHERE id = auth.uid() AND role = 'admin'\n  ) INTO v_is_admin;\n\n  IF NOT v_is_admin THEN\n    RETURN jsonb_build_object(\n      'success', false,\n      'message', 'ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™'\n    );\n  END IF;\n\n  -- æ—¥æœ¬æ™‚é–“ã®ç¾åœ¨æ—¥ä»˜ã‚’å–å¾—\n  v_current_date := (now() AT TIME ZONE 'Asia/Tokyo')::date;\n\n  -- å½“æ—¥ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ\n  UPDATE ai_usage_tracking\n  SET request_count = 0, updated_at = now()\n  WHERE user_id = p_user_id AND usage_date = v_current_date;\n\n  RETURN jsonb_build_object(\n    'success', true,\n    'message', 'ä½¿ç”¨å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ'\n  );\nEND;\n$$;\n\n-- ============================================\n-- 9. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ï¼ˆå¤ã„ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ï¼‰\n-- ============================================\n\nCREATE OR REPLACE FUNCTION cleanup_old_usage_data()\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nBEGIN\n  -- 8æ—¥ä»¥ä¸Šå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤\n  DELETE FROM ai_usage_tracking\n  WHERE usage_date < (now() AT TIME ZONE 'Asia/Tokyo')::date - interval '8 days';\nEND;\n$$;\n\n-- ============================================\n-- 10. ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ï¼ˆupdated_atè‡ªå‹•æ›´æ–°ï¼‰\n-- ============================================\n\n-- updated_atè‡ªå‹•æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ï¼ˆæ—¢å­˜ã®å ´åˆã¯å†åˆ©ç”¨ï¼‰\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- ai_usage_trackingç”¨ãƒˆãƒªã‚¬ãƒ¼\nDROP TRIGGER IF EXISTS trigger_usage_tracking_updated_at ON ai_usage_tracking;\nCREATE TRIGGER trigger_usage_tracking_updated_at\n  BEFORE UPDATE ON ai_usage_tracking\n  FOR EACH ROW\n  EXECUTE FUNCTION update_updated_at_column();\n\n-- ai_usage_settingsç”¨ãƒˆãƒªã‚¬ãƒ¼\nDROP TRIGGER IF EXISTS trigger_usage_settings_updated_at ON ai_usage_settings;\nCREATE TRIGGER trigger_usage_settings_updated_at\n  BEFORE UPDATE ON ai_usage_settings\n  FOR EACH ROW\n  EXECUTE FUNCTION update_updated_at_column();\n\n-- ============================================\n-- 11. ãƒ†ãƒ¼ãƒ–ãƒ«ã‚³ãƒ¡ãƒ³ãƒˆ\n-- ============================================\n\nCOMMENT ON TABLE ai_usage_tracking IS\n'AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®ä½¿ç”¨å›æ•°ã‚’è¿½è·¡ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã€æ—¥ä»˜ã”ã¨ã«ä½¿ç”¨å›æ•°ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚';\n\nCOMMENT ON TABLE ai_usage_settings IS\n'ãƒ­ãƒ¼ãƒ«åˆ¥ã®AIä½¿ç”¨åˆ¶é™è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ«ã€‚adminï¼ˆç„¡åˆ¶é™ï¼‰ã€managerï¼ˆ20å›/æ—¥ï¼‰ã€staffï¼ˆ5å›/æ—¥ï¼‰ã‚’ç®¡ç†ã—ã¾ã™ã€‚';\n\nCOMMENT ON FUNCTION check_and_increment_usage IS\n'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½¿ç”¨å›æ•°ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€åˆ¶é™å†…ã§ã‚ã‚Œã°ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—åŠ ã•ã›ã‚‹é–¢æ•°ã€‚\nä½¿ç”¨ä¾‹: SELECT check_and_increment_usage(auth.uid());';\n\nCOMMENT ON FUNCTION get_user_usage_status IS\n'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ã®ä½¿ç”¨çŠ¶æ³ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã€‚\nä½¿ç”¨ä¾‹: SELECT get_user_usage_status(auth.uid());';\n\nCOMMENT ON FUNCTION reset_user_daily_usage IS\n'ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½“æ—¥ã®ä½¿ç”¨å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°ï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰ã€‚\nä½¿ç”¨ä¾‹: SELECT reset_user_daily_usage(''user-uuid-here'');';\n\nCOMMENT ON FUNCTION cleanup_old_usage_data IS\n'8æ—¥ä»¥ä¸Šå‰ã®ä½¿ç”¨å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã€‚\nä½¿ç”¨ä¾‹: SELECT cleanup_old_usage_data();';\n",
  "supabase/migrations/20251009163131_20251009130000_create_ai_usage_limits.sql": "/*\n  # AIä½¿ç”¨åˆ¶é™ã‚·ã‚¹ãƒ†ãƒ \n\n  ## æ¦‚è¦\n  AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®1æ—¥ã‚ãŸã‚Šã®ä½¿ç”¨å›æ•°ã‚’åˆ¶é™ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¾ã™ã€‚\n  ãƒ­ãƒ¼ãƒ«åˆ¥ã«ç•°ãªã‚‹ä¸Šé™ã‚’è¨­å®šã—ã€ã‚³ã‚¹ãƒˆç®¡ç†ã¨é©åˆ‡ãªåˆ©ç”¨ã‚’ä¿ƒé€²ã—ã¾ã™ã€‚\n\n  ## æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«\n\n  ### ai_usage_trackingï¼ˆä½¿ç”¨å›æ•°è¿½è·¡ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰\n  - `id` (uuid, primary key) - ãƒ¬ã‚³ãƒ¼ãƒ‰ID\n  - `user_id` (uuid, å¤–éƒ¨ã‚­ãƒ¼) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID\n  - `usage_date` (date) - ä½¿ç”¨æ—¥ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰\n  - `request_count` (integer) - ãƒªã‚¯ã‚¨ã‚¹ãƒˆå›æ•°\n  - `created_at` (timestamptz) - ä½œæˆæ—¥æ™‚\n  - `updated_at` (timestamptz) - æ›´æ–°æ—¥æ™‚\n  - ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„: (user_id, usage_date)\n\n  ### ai_usage_settingsï¼ˆä½¿ç”¨åˆ¶é™è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰\n  - `id` (uuid, primary key) - ãƒ¬ã‚³ãƒ¼ãƒ‰ID\n  - `role` (text) - ãƒ­ãƒ¼ãƒ«ï¼ˆadmin/manager/staffï¼‰\n  - `daily_limit` (integer) - 1æ—¥ã®ä¸Šé™ï¼ˆ-1ã¯ç„¡åˆ¶é™ï¼‰\n  - `enabled` (boolean) - åˆ¶é™ã®æœ‰åŠ¹/ç„¡åŠ¹\n  - `created_at` (timestamptz) - ä½œæˆæ—¥æ™‚\n  - `updated_at` (timestamptz) - æ›´æ–°æ—¥æ™‚\n  - ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„: role\n\n  ## RPCé–¢æ•°\n\n  ### check_and_increment_usage\n  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½¿ç”¨å›æ•°ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€åˆ¶é™å†…ã§ã‚ã‚Œã°ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—åŠ ã•ã›ã¾ã™ã€‚\n\n  ### get_user_usage_status\n  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ã®ä½¿ç”¨çŠ¶æ³ï¼ˆä½¿ç”¨å›æ•°ã€ä¸Šé™ã€æ®‹ã‚Šï¼‰ã‚’å–å¾—ã—ã¾ã™ã€‚\n\n  ### reset_user_daily_usage\n  ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½“æ—¥ã®ä½¿ç”¨å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰ã€‚\n\n  ## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n  - RLSæœ‰åŠ¹åŒ–\n  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ä½¿ç”¨çŠ¶æ³ã®ã¿å‚ç…§å¯èƒ½\n  - è¨­å®šã¯å…¨å“¡ãŒå‚ç…§å¯èƒ½ã€æ›´æ–°ã¯ç®¡ç†è€…ã®ã¿\n  - RPCé–¢æ•°ã¯SECURITY DEFINERã§å®Ÿè£…\n\n  ## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–\n  - è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: (user_id, usage_date)\n  - ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n  - è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ8æ—¥ä»¥ä¸Šå‰ã®ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼‰\n*/\n\n-- ============================================\n-- 1. ai_usage_tracking ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nCREATE TABLE IF NOT EXISTS ai_usage_tracking (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id uuid NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  usage_date date NOT NULL DEFAULT (now() AT TIME ZONE 'Asia/Tokyo')::date,\n  request_count integer NOT NULL DEFAULT 0,\n  created_at timestamptz NOT NULL DEFAULT now(),\n  updated_at timestamptz NOT NULL DEFAULT now(),\n  CONSTRAINT unique_user_date UNIQUE (user_id, usage_date)\n);\n\n-- ============================================\n-- 2. ai_usage_settings ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nCREATE TABLE IF NOT EXISTS ai_usage_settings (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  role text NOT NULL CHECK (role IN ('admin', 'manager', 'staff')),\n  daily_limit integer NOT NULL DEFAULT 20,\n  enabled boolean NOT NULL DEFAULT true,\n  created_at timestamptz NOT NULL DEFAULT now(),\n  updated_at timestamptz NOT NULL DEFAULT now(),\n  CONSTRAINT unique_role UNIQUE (role)\n);\n\n-- ============================================\n-- 3. åˆæœŸè¨­å®šãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥\n-- ============================================\n\nINSERT INTO ai_usage_settings (role, daily_limit, enabled)\nVALUES\n  ('admin', -1, true),      -- ç„¡åˆ¶é™\n  ('manager', 20, true),    -- 20å›/æ—¥\n  ('staff', 5, true)        -- 5å›/æ—¥\nON CONFLICT (role) DO NOTHING;\n\n-- ============================================\n-- 4. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n-- ============================================\n\n-- ä½¿ç”¨å›æ•°å–å¾—ç”¨ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\nCREATE INDEX IF NOT EXISTS idx_usage_tracking_user_date\nON ai_usage_tracking(user_id, usage_date);\n\n-- ãƒ­ãƒ¼ãƒ«åˆ¥è¨­å®šå–å¾—ç”¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\nCREATE INDEX IF NOT EXISTS idx_usage_settings_role\nON ai_usage_settings(role);\n\n-- ============================================\n-- 5. Row Level Securityï¼ˆRLSï¼‰\n-- ============================================\n\n-- ai_usage_tracking ã®RLSæœ‰åŠ¹åŒ–\nALTER TABLE ai_usage_tracking ENABLE ROW LEVEL SECURITY;\n\n-- ai_usage_settings ã®RLSæœ‰åŠ¹åŒ–\nALTER TABLE ai_usage_settings ENABLE ROW LEVEL SECURITY;\n\n-- ai_usage_tracking: SELECT ãƒãƒªã‚·ãƒ¼ï¼ˆè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿å‚ç…§å¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Users can view own usage tracking\" ON ai_usage_tracking;\nCREATE POLICY \"Users can view own usage tracking\"\nON ai_usage_tracking\nFOR SELECT\nTO authenticated\nUSING (auth.uid() = user_id);\n\n-- ai_usage_tracking: INSERT ãƒãƒªã‚·ãƒ¼ï¼ˆè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ä½œæˆå¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Users can create own usage tracking\" ON ai_usage_tracking;\nCREATE POLICY \"Users can create own usage tracking\"\nON ai_usage_tracking\nFOR INSERT\nTO authenticated\nWITH CHECK (auth.uid() = user_id);\n\n-- ai_usage_tracking: UPDATE ãƒãƒªã‚·ãƒ¼ï¼ˆè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿æ›´æ–°å¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Users can update own usage tracking\" ON ai_usage_tracking;\nCREATE POLICY \"Users can update own usage tracking\"\nON ai_usage_tracking\nFOR UPDATE\nTO authenticated\nUSING (auth.uid() = user_id)\nWITH CHECK (auth.uid() = user_id);\n\n-- ai_usage_settings: SELECT ãƒãƒªã‚·ãƒ¼ï¼ˆå…¨å“¡ãŒå‚ç…§å¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Anyone can view usage settings\" ON ai_usage_settings;\nCREATE POLICY \"Anyone can view usage settings\"\nON ai_usage_settings\nFOR SELECT\nTO authenticated\nUSING (true);\n\n-- ai_usage_settings: UPDATE ãƒãƒªã‚·ãƒ¼ï¼ˆç®¡ç†è€…ã®ã¿æ›´æ–°å¯èƒ½ï¼‰\nDROP POLICY IF EXISTS \"Admins can update usage settings\" ON ai_usage_settings;\nCREATE POLICY \"Admins can update usage settings\"\nON ai_usage_settings\nFOR UPDATE\nTO authenticated\nUSING (\n  EXISTS (\n    SELECT 1 FROM profiles\n    WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n  )\n)\nWITH CHECK (\n  EXISTS (\n    SELECT 1 FROM profiles\n    WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n  )\n);\n\n-- ============================================\n-- 6. RPCé–¢æ•°: check_and_increment_usage\n-- ============================================\n\nCREATE OR REPLACE FUNCTION check_and_increment_usage(p_user_id uuid)\nRETURNS jsonb\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n  v_current_date date;\n  v_current_count integer;\n  v_user_role text;\n  v_daily_limit integer;\n  v_enabled boolean;\n  v_remaining integer;\n  v_is_allowed boolean;\nBEGIN\n  -- æ—¥æœ¬æ™‚é–“ã®ç¾åœ¨æ—¥ä»˜ã‚’å–å¾—\n  v_current_date := (now() AT TIME ZONE 'Asia/Tokyo')::date;\n\n  -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ãƒ¼ãƒ«ã‚’å–å¾—\n  SELECT role INTO v_user_role\n  FROM profiles\n  WHERE id = p_user_id;\n\n  IF v_user_role IS NULL THEN\n    v_user_role := 'staff'; -- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\n  END IF;\n\n  -- ãƒ­ãƒ¼ãƒ«åˆ¥ã®ä¸Šé™è¨­å®šã‚’å–å¾—\n  SELECT daily_limit, enabled INTO v_daily_limit, v_enabled\n  FROM ai_usage_settings\n  WHERE role = v_user_role;\n\n  IF v_daily_limit IS NULL THEN\n    v_daily_limit := 5; -- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\n  END IF;\n\n  IF v_enabled IS NULL THEN\n    v_enabled := true;\n  END IF;\n\n  -- åˆ¶é™ãŒç„¡åŠ¹ã®å ´åˆã¯å¸¸ã«è¨±å¯\n  IF NOT v_enabled THEN\n    RETURN jsonb_build_object(\n      'allowed', true,\n      'current_count', 0,\n      'daily_limit', -1,\n      'remaining', -1,\n      'message', 'åˆ¶é™ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™'\n    );\n  END IF;\n\n  -- ç®¡ç†è€…ï¼ˆç„¡åˆ¶é™ï¼‰ã®å ´åˆ\n  IF v_daily_limit = -1 THEN\n    RETURN jsonb_build_object(\n      'allowed', true,\n      'current_count', 0,\n      'daily_limit', -1,\n      'remaining', -1,\n      'message', 'ç„¡åˆ¶é™'\n    );\n  END IF;\n\n  -- ç¾åœ¨ã®ä½¿ç”¨å›æ•°ã‚’å–å¾—ã¾ãŸã¯åˆæœŸåŒ–\n  SELECT request_count INTO v_current_count\n  FROM ai_usage_tracking\n  WHERE user_id = p_user_id AND usage_date = v_current_date;\n\n  IF v_current_count IS NULL THEN\n    v_current_count := 0;\n  END IF;\n\n  -- åˆ¶é™ãƒã‚§ãƒƒã‚¯\n  v_is_allowed := v_current_count < v_daily_limit;\n\n  -- è¨±å¯ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—åŠ \n  IF v_is_allowed THEN\n    INSERT INTO ai_usage_tracking (user_id, usage_date, request_count)\n    VALUES (p_user_id, v_current_date, 1)\n    ON CONFLICT (user_id, usage_date)\n    DO UPDATE SET\n      request_count = ai_usage_tracking.request_count + 1,\n      updated_at = now();\n\n    v_current_count := v_current_count + 1;\n  END IF;\n\n  v_remaining := GREATEST(0, v_daily_limit - v_current_count);\n\n  RETURN jsonb_build_object(\n    'allowed', v_is_allowed,\n    'current_count', v_current_count,\n    'daily_limit', v_daily_limit,\n    'remaining', v_remaining,\n    'message', CASE\n      WHEN v_is_allowed THEN 'åˆ©ç”¨å¯èƒ½'\n      ELSE 'æœ¬æ—¥ã®åˆ©ç”¨ä¸Šé™ã«é”ã—ã¾ã—ãŸ'\n    END\n  );\nEND;\n$$;\n\n-- ============================================\n-- 7. RPCé–¢æ•°: get_user_usage_status\n-- ============================================\n\nCREATE OR REPLACE FUNCTION get_user_usage_status(p_user_id uuid)\nRETURNS jsonb\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n  v_current_date date;\n  v_current_count integer;\n  v_user_role text;\n  v_daily_limit integer;\n  v_enabled boolean;\n  v_remaining integer;\n  v_reset_at timestamptz;\nBEGIN\n  -- æ—¥æœ¬æ™‚é–“ã®ç¾åœ¨æ—¥ä»˜ã‚’å–å¾—\n  v_current_date := (now() AT TIME ZONE 'Asia/Tokyo')::date;\n\n  -- æ¬¡ã®ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»ï¼ˆç¿Œæ—¥ã®åˆå‰0æ™‚ JSTï¼‰\n  v_reset_at := (v_current_date + interval '1 day') AT TIME ZONE 'Asia/Tokyo';\n\n  -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ãƒ¼ãƒ«ã‚’å–å¾—\n  SELECT role INTO v_user_role\n  FROM profiles\n  WHERE id = p_user_id;\n\n  IF v_user_role IS NULL THEN\n    v_user_role := 'staff';\n  END IF;\n\n  -- ãƒ­ãƒ¼ãƒ«åˆ¥ã®ä¸Šé™è¨­å®šã‚’å–å¾—\n  SELECT daily_limit, enabled INTO v_daily_limit, v_enabled\n  FROM ai_usage_settings\n  WHERE role = v_user_role;\n\n  IF v_daily_limit IS NULL THEN\n    v_daily_limit := 5;\n  END IF;\n\n  IF v_enabled IS NULL THEN\n    v_enabled := true;\n  END IF;\n\n  -- åˆ¶é™ãŒç„¡åŠ¹ã®å ´åˆ\n  IF NOT v_enabled THEN\n    RETURN jsonb_build_object(\n      'current_count', 0,\n      'daily_limit', -1,\n      'remaining', -1,\n      'reset_at', v_reset_at,\n      'is_limited', false\n    );\n  END IF;\n\n  -- ç®¡ç†è€…ï¼ˆç„¡åˆ¶é™ï¼‰ã®å ´åˆ\n  IF v_daily_limit = -1 THEN\n    RETURN jsonb_build_object(\n      'current_count', 0,\n      'daily_limit', -1,\n      'remaining', -1,\n      'reset_at', v_reset_at,\n      'is_limited', false\n    );\n  END IF;\n\n  -- ç¾åœ¨ã®ä½¿ç”¨å›æ•°ã‚’å–å¾—\n  SELECT request_count INTO v_current_count\n  FROM ai_usage_tracking\n  WHERE user_id = p_user_id AND usage_date = v_current_date;\n\n  IF v_current_count IS NULL THEN\n    v_current_count := 0;\n  END IF;\n\n  v_remaining := GREATEST(0, v_daily_limit - v_current_count);\n\n  RETURN jsonb_build_object(\n    'current_count', v_current_count,\n    'daily_limit', v_daily_limit,\n    'remaining', v_remaining,\n    'reset_at', v_reset_at,\n    'is_limited', v_current_count >= v_daily_limit\n  );\nEND;\n$$;\n\n-- ============================================\n-- 8. RPCé–¢æ•°: reset_user_daily_usageï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰\n-- ============================================\n\nCREATE OR REPLACE FUNCTION reset_user_daily_usage(p_user_id uuid)\nRETURNS jsonb\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n  v_current_date date;\n  v_is_admin boolean;\nBEGIN\n  -- å®Ÿè¡Œè€…ãŒç®¡ç†è€…ã‹ãƒã‚§ãƒƒã‚¯\n  SELECT EXISTS (\n    SELECT 1 FROM profiles\n    WHERE id = auth.uid() AND role = 'admin'\n  ) INTO v_is_admin;\n\n  IF NOT v_is_admin THEN\n    RETURN jsonb_build_object(\n      'success', false,\n      'message', 'ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™'\n    );\n  END IF;\n\n  -- æ—¥æœ¬æ™‚é–“ã®ç¾åœ¨æ—¥ä»˜ã‚’å–å¾—\n  v_current_date := (now() AT TIME ZONE 'Asia/Tokyo')::date;\n\n  -- å½“æ—¥ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ\n  UPDATE ai_usage_tracking\n  SET request_count = 0, updated_at = now()\n  WHERE user_id = p_user_id AND usage_date = v_current_date;\n\n  RETURN jsonb_build_object(\n    'success', true,\n    'message', 'ä½¿ç”¨å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ'\n  );\nEND;\n$$;\n\n-- ============================================\n-- 9. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ï¼ˆå¤ã„ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ï¼‰\n-- ============================================\n\nCREATE OR REPLACE FUNCTION cleanup_old_usage_data()\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nBEGIN\n  -- 8æ—¥ä»¥ä¸Šå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤\n  DELETE FROM ai_usage_tracking\n  WHERE usage_date < (now() AT TIME ZONE 'Asia/Tokyo')::date - interval '8 days';\nEND;\n$$;\n\n-- ============================================\n-- 10. ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ï¼ˆupdated_atè‡ªå‹•æ›´æ–°ï¼‰\n-- ============================================\n\n-- updated_atè‡ªå‹•æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ï¼ˆæ—¢å­˜ã®å ´åˆã¯å†åˆ©ç”¨ï¼‰\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- ai_usage_trackingç”¨ãƒˆãƒªã‚¬ãƒ¼\nDROP TRIGGER IF EXISTS trigger_usage_tracking_updated_at ON ai_usage_tracking;\nCREATE TRIGGER trigger_usage_tracking_updated_at\n  BEFORE UPDATE ON ai_usage_tracking\n  FOR EACH ROW\n  EXECUTE FUNCTION update_updated_at_column();\n\n-- ai_usage_settingsç”¨ãƒˆãƒªã‚¬ãƒ¼\nDROP TRIGGER IF EXISTS trigger_usage_settings_updated_at ON ai_usage_settings;\nCREATE TRIGGER trigger_usage_settings_updated_at\n  BEFORE UPDATE ON ai_usage_settings\n  FOR EACH ROW\n  EXECUTE FUNCTION update_updated_at_column();\n\n-- ============================================\n-- 11. ãƒ†ãƒ¼ãƒ–ãƒ«ã‚³ãƒ¡ãƒ³ãƒˆ\n-- ============================================\n\nCOMMENT ON TABLE ai_usage_tracking IS\n'AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®ä½¿ç”¨å›æ•°ã‚’è¿½è·¡ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã€æ—¥ä»˜ã”ã¨ã«ä½¿ç”¨å›æ•°ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚';\n\nCOMMENT ON TABLE ai_usage_settings IS\n'ãƒ­ãƒ¼ãƒ«åˆ¥ã®AIä½¿ç”¨åˆ¶é™è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ«ã€‚adminï¼ˆç„¡åˆ¶é™ï¼‰ã€managerï¼ˆ20å›/æ—¥ï¼‰ã€staffï¼ˆ5å›/æ—¥ï¼‰ã‚’ç®¡ç†ã—ã¾ã™ã€‚';\n\nCOMMENT ON FUNCTION check_and_increment_usage IS\n'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½¿ç”¨å›æ•°ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€åˆ¶é™å†…ã§ã‚ã‚Œã°ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—åŠ ã•ã›ã‚‹é–¢æ•°ã€‚\nä½¿ç”¨ä¾‹: SELECT check_and_increment_usage(auth.uid());';\n\nCOMMENT ON FUNCTION get_user_usage_status IS\n'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ã®ä½¿ç”¨çŠ¶æ³ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã€‚\nä½¿ç”¨ä¾‹: SELECT get_user_usage_status(auth.uid());';\n\nCOMMENT ON FUNCTION reset_user_daily_usage IS\n'ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½“æ—¥ã®ä½¿ç”¨å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°ï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰ã€‚\nä½¿ç”¨ä¾‹: SELECT reset_user_daily_usage(''user-uuid-here'');';\n\nCOMMENT ON FUNCTION cleanup_old_usage_data IS\n'8æ—¥ä»¥ä¸Šå‰ã®ä½¿ç”¨å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã€‚\nä½¿ç”¨ä¾‹: SELECT cleanup_old_usage_data();';\n",
  "supabase/migrations/20251010052354_create_organizations_multitenant.sql": "/*\n  # ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåŒ– - Organizations ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ\n\n  ## æ¦‚è¦\n  è¤‡æ•°ã®ä¼æ¥­ãƒ»çµ„ç¹”ãŒã‚·ã‚¹ãƒ†ãƒ ã‚’ç‹¬ç«‹ã—ã¦åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã€ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚\n\n  ## 1. æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«\n    - `organizations` - çµ„ç¹”ãƒ»ä¼æ¥­ã®åŸºæœ¬æƒ…å ±\n      - `id` (uuid, primary key) - çµ„ç¹”ID\n      - `name` (text) - çµ„ç¹”å\n      - `slug` (text, unique) - URLç”¨ã‚¹ãƒ©ãƒƒã‚°\n      - `email` (text) - çµ„ç¹”ã®é€£çµ¡å…ˆãƒ¡ãƒ¼ãƒ«\n      - `phone` (text) - é›»è©±ç•ªå·\n      - `subscription_status` (text) - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ (trial, active, suspended, cancelled)\n      - `subscription_plan` (text) - ãƒ—ãƒ©ãƒ³ç¨®åˆ¥ (free, starter, business, enterprise)\n      - `trial_ends_at` (timestamptz) - ãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé™\n      - `max_stores` (int) - æœ€å¤§åº—èˆ—æ•°åˆ¶é™\n      - `max_users` (int) - æœ€å¤§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°åˆ¶é™\n      - `max_ai_requests_per_month` (int) - æœˆé–“AIä½¿ç”¨å›æ•°åˆ¶é™\n      - `settings` (jsonb) - çµ„ç¹”å›ºæœ‰ã®è¨­å®š\n      - `created_at` (timestamptz) - ä½œæˆæ—¥æ™‚\n      - `updated_at` (timestamptz) - æ›´æ–°æ—¥æ™‚\n\n    - `organization_members` - çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†\n      - `organization_id` (uuid, foreign key) - çµ„ç¹”ID\n      - `user_id` (uuid, foreign key) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID\n      - `role` (text) - çµ„ç¹”å†…ã®å½¹å‰² (owner, admin, member)\n      - `joined_at` (timestamptz) - å‚åŠ æ—¥æ™‚\n\n  ## 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n    - å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§RLSæœ‰åŠ¹åŒ–\n    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ‰€å±çµ„ç¹”ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½\n    - çµ„ç¹”ã‚ªãƒ¼ãƒŠãƒ¼/ç®¡ç†è€…ã¯çµ„ç¹”è¨­å®šã‚’å¤‰æ›´å¯èƒ½\n    - å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿åˆ†é›¢ã‚’ä¿è¨¼\n\n  ## 3. é‡è¦ãªå¤‰æ›´\n    - æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã« `organization_id` ã‚’è¿½åŠ ã™ã‚‹æº–å‚™\n    - ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° `get_user_organization_id()` ã‚’ä½œæˆ\n    - çµ„ç¹”ã‚ªãƒ¼ãƒŠãƒ¼åˆ¤å®šé–¢æ•° `is_organization_owner()` ã‚’ä½œæˆ\n*/\n\n-- ============================================\n-- 1. Organizations ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ\n-- ============================================\n\nCREATE TABLE IF NOT EXISTS public.organizations (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  name text NOT NULL,\n  slug text UNIQUE NOT NULL,\n  email text NOT NULL,\n  phone text,\n  subscription_status text NOT NULL DEFAULT 'trial' CHECK (subscription_status IN ('trial', 'active', 'suspended', 'cancelled')),\n  subscription_plan text NOT NULL DEFAULT 'free' CHECK (subscription_plan IN ('free', 'starter', 'business', 'enterprise')),\n  trial_ends_at timestamptz DEFAULT (now() + interval '14 days'),\n  max_stores int NOT NULL DEFAULT 3,\n  max_users int NOT NULL DEFAULT 5,\n  max_ai_requests_per_month int NOT NULL DEFAULT 100,\n  settings jsonb DEFAULT '{}'::jsonb,\n  created_at timestamptz DEFAULT now() NOT NULL,\n  updated_at timestamptz DEFAULT now() NOT NULL\n);\n\nCOMMENT ON TABLE public.organizations IS 'çµ„ç¹”ãƒ»ä¼æ¥­ã®åŸºæœ¬æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«';\nCOMMENT ON COLUMN public.organizations.subscription_status IS 'trial: ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä¸­, active: æœ‰åŠ¹, suspended: ä¸€æ™‚åœæ­¢, cancelled: ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿';\nCOMMENT ON COLUMN public.organizations.subscription_plan IS 'free: ç„¡æ–™, starter: ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼, business: ãƒ“ã‚¸ãƒã‚¹, enterprise: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º';\n\n-- ============================================\n-- 2. Organization Members ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ\n-- ============================================\n\nCREATE TABLE IF NOT EXISTS public.organization_members (\n  organization_id uuid NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  user_id uuid NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  role text NOT NULL DEFAULT 'member' CHECK (role IN ('owner', 'admin', 'member')),\n  joined_at timestamptz DEFAULT now() NOT NULL,\n  PRIMARY KEY (organization_id, user_id)\n);\n\nCOMMENT ON TABLE public.organization_members IS 'çµ„ç¹”ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é–¢é€£ã‚’ç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«';\nCOMMENT ON COLUMN public.organization_members.role IS 'owner: ã‚ªãƒ¼ãƒŠãƒ¼, admin: ç®¡ç†è€…, member: ãƒ¡ãƒ³ãƒãƒ¼';\n\n-- ============================================\n-- 3. Updated_at ãƒˆãƒªã‚¬ãƒ¼\n-- ============================================\n\nCREATE OR REPLACE FUNCTION public.update_updated_at_column()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nAS $$\nBEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n$$;\n\nDROP TRIGGER IF EXISTS update_organizations_updated_at ON public.organizations;\nCREATE TRIGGER update_organizations_updated_at\n  BEFORE UPDATE ON public.organizations\n  FOR EACH ROW\n  EXECUTE FUNCTION public.update_updated_at_column();\n\n-- ============================================\n-- 4. ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°\n-- ============================================\n\n-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰€å±çµ„ç¹”IDã‚’å–å¾—\nCREATE OR REPLACE FUNCTION public.get_user_organization_id()\nRETURNS uuid\nLANGUAGE sql\nSTABLE\nSECURITY DEFINER\nAS $$\n  SELECT organization_id\n  FROM public.organization_members\n  WHERE user_id = auth.uid()\n  LIMIT 1;\n$$;\n\nCOMMENT ON FUNCTION public.get_user_organization_id() IS 'ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰€å±ã™ã‚‹çµ„ç¹”ã®IDã‚’è¿”ã™';\n\n-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçµ„ç¹”ã®ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã©ã†ã‹ã‚’åˆ¤å®š\nCREATE OR REPLACE FUNCTION public.is_organization_owner(org_id uuid DEFAULT NULL)\nRETURNS boolean\nLANGUAGE sql\nSTABLE\nSECURITY DEFINER\nAS $$\n  SELECT EXISTS (\n    SELECT 1\n    FROM public.organization_members\n    WHERE user_id = auth.uid()\n      AND (org_id IS NULL OR organization_id = org_id)\n      AND role = 'owner'\n  );\n$$;\n\nCOMMENT ON FUNCTION public.is_organization_owner(uuid) IS 'ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã•ã‚ŒãŸçµ„ç¹”ï¼ˆã¾ãŸã¯æ‰€å±çµ„ç¹”ï¼‰ã®ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã©ã†ã‹ã‚’åˆ¤å®š';\n\n-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçµ„ç¹”ã®ç®¡ç†è€…ä»¥ä¸Šã‹ã©ã†ã‹ã‚’åˆ¤å®š\nCREATE OR REPLACE FUNCTION public.is_organization_admin(org_id uuid DEFAULT NULL)\nRETURNS boolean\nLANGUAGE sql\nSTABLE\nSECURITY DEFINER\nAS $$\n  SELECT EXISTS (\n    SELECT 1\n    FROM public.organization_members\n    WHERE user_id = auth.uid()\n      AND (org_id IS NULL OR organization_id = org_id)\n      AND role IN ('owner', 'admin')\n  );\n$$;\n\nCOMMENT ON FUNCTION public.is_organization_admin(uuid) IS 'ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã•ã‚ŒãŸçµ„ç¹”ï¼ˆã¾ãŸã¯æ‰€å±çµ„ç¹”ï¼‰ã®ç®¡ç†è€…ä»¥ä¸Šã‹ã©ã†ã‹ã‚’åˆ¤å®š';\n\n-- ============================================\n-- 5. RLSãƒãƒªã‚·ãƒ¼ - Organizations\n-- ============================================\n\nALTER TABLE public.organizations ENABLE ROW LEVEL SECURITY;\n\n-- çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ã¯è‡ªåˆ†ã®çµ„ç¹”ã‚’å‚ç…§å¯èƒ½\nCREATE POLICY \"Members can view their organization\"\n  ON public.organizations\n  FOR SELECT\n  TO authenticated\n  USING (\n    id IN (\n      SELECT organization_id\n      FROM public.organization_members\n      WHERE user_id = auth.uid()\n    )\n  );\n\n-- ã‚ªãƒ¼ãƒŠãƒ¼ãƒ»ç®¡ç†è€…ã¯çµ„ç¹”æƒ…å ±ã‚’æ›´æ–°å¯èƒ½\nCREATE POLICY \"Owners and admins can update organization\"\n  ON public.organizations\n  FOR UPDATE\n  TO authenticated\n  USING (\n    id IN (\n      SELECT organization_id\n      FROM public.organization_members\n      WHERE user_id = auth.uid()\n        AND role IN ('owner', 'admin')\n    )\n  )\n  WITH CHECK (\n    id IN (\n      SELECT organization_id\n      FROM public.organization_members\n      WHERE user_id = auth.uid()\n        AND role IN ('owner', 'admin')\n    )\n  );\n\n-- æ–°è¦çµ„ç¹”ä½œæˆï¼ˆã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æ™‚ã®ã¿ï¼‰\nCREATE POLICY \"Anyone can create organization\"\n  ON public.organizations\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (true);\n\n-- ã‚ªãƒ¼ãƒŠãƒ¼ã®ã¿çµ„ç¹”å‰Šé™¤å¯èƒ½\nCREATE POLICY \"Only owners can delete organization\"\n  ON public.organizations\n  FOR DELETE\n  TO authenticated\n  USING (is_organization_owner(id));\n\n-- ============================================\n-- 6. RLSãƒãƒªã‚·ãƒ¼ - Organization Members\n-- ============================================\n\nALTER TABLE public.organization_members ENABLE ROW LEVEL SECURITY;\n\n-- ãƒ¡ãƒ³ãƒãƒ¼ã¯è‡ªåˆ†ã®çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã‚’å‚ç…§å¯èƒ½\nCREATE POLICY \"Members can view organization members\"\n  ON public.organization_members\n  FOR SELECT\n  TO authenticated\n  USING (\n    organization_id IN (\n      SELECT organization_id\n      FROM public.organization_members\n      WHERE user_id = auth.uid()\n    )\n  );\n\n-- ç®¡ç†è€…ä»¥ä¸Šã¯ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ å¯èƒ½\nCREATE POLICY \"Admins can add members\"\n  ON public.organization_members\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    organization_id IN (\n      SELECT organization_id\n      FROM public.organization_members\n      WHERE user_id = auth.uid()\n        AND role IN ('owner', 'admin')\n    )\n  );\n\n-- ç®¡ç†è€…ä»¥ä¸Šã¯ãƒ¡ãƒ³ãƒãƒ¼ã®å½¹å‰²ã‚’æ›´æ–°å¯èƒ½ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼é™¤ãï¼‰\nCREATE POLICY \"Admins can update members\"\n  ON public.organization_members\n  FOR UPDATE\n  TO authenticated\n  USING (\n    organization_id IN (\n      SELECT organization_id\n      FROM public.organization_members\n      WHERE user_id = auth.uid()\n        AND role IN ('owner', 'admin')\n    )\n    AND role != 'owner'\n  )\n  WITH CHECK (\n    organization_id IN (\n      SELECT organization_id\n      FROM public.organization_members\n      WHERE user_id = auth.uid()\n        AND role IN ('owner', 'admin')\n    )\n    AND role != 'owner'\n  );\n\n-- ç®¡ç†è€…ä»¥ä¸Šã¯ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤å¯èƒ½ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼é™¤ãï¼‰\nCREATE POLICY \"Admins can remove members\"\n  ON public.organization_members\n  FOR DELETE\n  TO authenticated\n  USING (\n    organization_id IN (\n      SELECT organization_id\n      FROM public.organization_members\n      WHERE user_id = auth.uid()\n        AND role IN ('owner', 'admin')\n    )\n    AND role != 'owner'\n  );\n\n-- ============================================\n-- 7. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ\n-- ============================================\n\nCREATE INDEX IF NOT EXISTS idx_organizations_slug\n  ON public.organizations (slug);\n\nCREATE INDEX IF NOT EXISTS idx_organizations_subscription_status\n  ON public.organizations (subscription_status);\n\nCREATE INDEX IF NOT EXISTS idx_organization_members_user\n  ON public.organization_members (user_id);\n\nCREATE INDEX IF NOT EXISTS idx_organization_members_org\n  ON public.organization_members (organization_id);\n\nCREATE INDEX IF NOT EXISTS idx_organization_members_role\n  ON public.organization_members (organization_id, role);\n\n-- ============================================\n-- 8. ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nBEGIN\n  RAISE NOTICE 'âœ… Organizations ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆå®Œäº†';\n  RAISE NOTICE 'âœ… Organization Members ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆå®Œäº†';\n  RAISE NOTICE 'âœ… ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ä½œæˆå®Œäº†: get_user_organization_id(), is_organization_owner(), is_organization_admin()';\n  RAISE NOTICE 'âœ… RLSãƒãƒªã‚·ãƒ¼è¨­å®šå®Œäº†';\n  RAISE NOTICE 'âœ… ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆå®Œäº†';\n  RAISE NOTICE 'ğŸ“‹ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã« organization_id ã‚’è¿½åŠ ã—ã¦ãã ã•ã„';\nEND $$;\n",
  "supabase/migrations/20251010052538_add_organization_id_to_all_tables.sql": "/*\n  # æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã® organization_id è¿½åŠ ï¼ˆä¿®æ­£ç‰ˆï¼‰\n\n  ## æ¦‚è¦\n  ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåŒ–ã®ãŸã‚ã€å…¨ã¦ã®æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã« organization_id ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã—ã¾ã™ã€‚\n\n  ## å¤‰æ›´å¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ«\n    1. `profiles` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«\n    2. `stores` - åº—èˆ—æƒ…å ±\n    3. `store_assignments` - åº—èˆ—å‰²ã‚Šå½“ã¦\n    4. `vendors` - ä»•å…¥å…ˆ\n    5. `store_vendor_assignments` - åº—èˆ—-ä»•å…¥å…ˆå‰²ã‚Šå½“ã¦\n    6. `daily_reports` - æ—¥å ±\n    7. `daily_report_vendor_purchases` - æ—¥å ±ä»•å…¥æ˜ç´°\n    8. `monthly_expenses` - æœˆæ¬¡çµŒè²»\n    9. `targets` - ç›®æ¨™\n    10. `daily_targets` - æ—¥åˆ¥ç›®æ¨™\n    11. `expense_baselines` - å‚è€ƒçµŒè²»\n    12. `ai_conversations` - AIä¼šè©±\n    13. `ai_messages` - AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n    14. `ai_generated_reports` - AIç”Ÿæˆãƒ¬ãƒãƒ¼ãƒˆ\n    15. `report_schedules` - ãƒ¬ãƒãƒ¼ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«\n    16. `ai_usage_settings` - AIä½¿ç”¨è¨­å®š\n    17. `ai_usage_tracking` - AIä½¿ç”¨è¿½è·¡\n    18. `report_generation_logs` - ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ­ã‚°\n    19. `summary_data` - ã‚µãƒãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿\n*/\n\n-- ============================================\n-- 1. profiles ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'profiles'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.profiles\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_profiles_organization\n      ON public.profiles (organization_id);\n    \n    RAISE NOTICE 'âœ… profiles ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 2. stores ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'stores'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.stores\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_stores_organization\n      ON public.stores (organization_id);\n    \n    RAISE NOTICE 'âœ… stores ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 3. store_assignments ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'store_assignments'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.store_assignments\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_store_assignments_organization\n      ON public.store_assignments (organization_id);\n    \n    RAISE NOTICE 'âœ… store_assignments ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 4. vendors ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'vendors'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.vendors\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_vendors_organization\n      ON public.vendors (organization_id);\n    \n    RAISE NOTICE 'âœ… vendors ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 5. store_vendor_assignments ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'store_vendor_assignments'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.store_vendor_assignments\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_store_vendor_assignments_organization\n      ON public.store_vendor_assignments (organization_id);\n    \n    RAISE NOTICE 'âœ… store_vendor_assignments ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 6. daily_reports ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'daily_reports'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.daily_reports\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_daily_reports_organization\n      ON public.daily_reports (organization_id, date DESC);\n    \n    RAISE NOTICE 'âœ… daily_reports ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 7. daily_report_vendor_purchases ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'daily_report_vendor_purchases'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.daily_report_vendor_purchases\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_daily_report_vendor_purchases_organization\n      ON public.daily_report_vendor_purchases (organization_id);\n    \n    RAISE NOTICE 'âœ… daily_report_vendor_purchases ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 8. monthly_expenses ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'monthly_expenses'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.monthly_expenses\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_monthly_expenses_organization\n      ON public.monthly_expenses (organization_id, month);\n    \n    RAISE NOTICE 'âœ… monthly_expenses ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 9. targets ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'targets'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.targets\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_targets_organization\n      ON public.targets (organization_id);\n    \n    RAISE NOTICE 'âœ… targets ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 10. daily_targets ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'daily_targets'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.daily_targets\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_daily_targets_organization\n      ON public.daily_targets (organization_id, date DESC);\n    \n    RAISE NOTICE 'âœ… daily_targets ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 11. expense_baselines ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'expense_baselines'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.expense_baselines\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_expense_baselines_organization\n      ON public.expense_baselines (organization_id);\n    \n    RAISE NOTICE 'âœ… expense_baselines ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 12. ai_conversations ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'ai_conversations'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.ai_conversations\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_ai_conversations_organization\n      ON public.ai_conversations (organization_id);\n    \n    RAISE NOTICE 'âœ… ai_conversations ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 13. ai_messages ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'ai_messages'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.ai_messages\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_ai_messages_organization\n      ON public.ai_messages (organization_id);\n    \n    RAISE NOTICE 'âœ… ai_messages ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 14. ai_generated_reports ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'ai_generated_reports'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.ai_generated_reports\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_ai_generated_reports_organization\n      ON public.ai_generated_reports (organization_id);\n    \n    RAISE NOTICE 'âœ… ai_generated_reports ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 15. report_schedules ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'report_schedules'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.report_schedules\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_report_schedules_organization\n      ON public.report_schedules (organization_id);\n    \n    RAISE NOTICE 'âœ… report_schedules ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 16. ai_usage_settings ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'ai_usage_settings'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.ai_usage_settings\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_ai_usage_settings_organization\n      ON public.ai_usage_settings (organization_id);\n    \n    RAISE NOTICE 'âœ… ai_usage_settings ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 17. ai_usage_tracking ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'ai_usage_tracking'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.ai_usage_tracking\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_ai_usage_tracking_organization\n      ON public.ai_usage_tracking (organization_id);\n    \n    RAISE NOTICE 'âœ… ai_usage_tracking ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 18. report_generation_logs ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'report_generation_logs'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.report_generation_logs\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_report_generation_logs_organization\n      ON public.report_generation_logs (organization_id);\n    \n    RAISE NOTICE 'âœ… report_generation_logs ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- 19. summary_data ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'summary_data'\n      AND column_name = 'organization_id'\n  ) THEN\n    ALTER TABLE public.summary_data\n    ADD COLUMN organization_id uuid REFERENCES public.organizations(id) ON DELETE CASCADE;\n    \n    CREATE INDEX IF NOT EXISTS idx_summary_data_organization\n      ON public.summary_data (organization_id);\n    \n    RAISE NOTICE 'âœ… summary_data ã« organization_id ã‚’è¿½åŠ ';\n  END IF;\nEND $$;\n\n-- ============================================\n-- ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nBEGIN\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'âœ… å…¨19ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã® organization_id è¿½åŠ å®Œäº†';\n  RAISE NOTICE '========================================';\nEND $$;\n",
  "supabase/migrations/20251010052634_update_rls_policies_multitenant.sql": "/*\n  # ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œRLSãƒãƒªã‚·ãƒ¼æ›´æ–°\n\n  ## æ¦‚è¦\n  å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSãƒãƒªã‚·ãƒ¼ã‚’æ›´æ–°ã—ã€organization_id ã«ã‚ˆã‚‹å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿åˆ†é›¢ã‚’å®Ÿè£…ã—ã¾ã™ã€‚\n\n  ## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸå‰‡\n    1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®æ‰€å±çµ„ç¹”ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½\n    2. å…¨ã¦ã®ã‚¯ã‚¨ãƒªã§ organization_id ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’å¼·åˆ¶\n    3. INSERTæ™‚ã«è‡ªå‹•çš„ã« organization_id ã‚’è¨­å®š\n    4. çµ„ç¹”é–“ã®ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã‚’å®Œå…¨ã«é˜²æ­¢\n\n  ## æ›´æ–°å¯¾è±¡\n    - stores\n    - daily_reports  \n    - targets\n    - daily_targets\n    - expense_baselines\n    - monthly_expenses\n    - vendors\n    - store_assignments\n    - store_vendor_assignments\n    - ai_conversations\n    - ai_messages\n    - ai_generated_reports\n    - ai_usage_tracking\n*/\n\n-- ============================================\n-- 1. stores ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"stores_select\" ON stores;\nDROP POLICY IF EXISTS \"stores_insert\" ON stores;\nDROP POLICY IF EXISTS \"stores_update\" ON stores;\nDROP POLICY IF EXISTS \"stores_delete\" ON stores;\n\nCREATE POLICY \"stores_select\" ON stores\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"stores_insert\" ON stores\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"stores_update\" ON stores\nFOR UPDATE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n)\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"stores_delete\" ON stores\nFOR DELETE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\n-- ============================================\n-- 2. daily_reports ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"dr_select\" ON daily_reports;\nDROP POLICY IF EXISTS \"dr_insert\" ON daily_reports;\nDROP POLICY IF EXISTS \"dr_update\" ON daily_reports;\nDROP POLICY IF EXISTS \"dr_delete\" ON daily_reports;\n\nCREATE POLICY \"dr_select\" ON daily_reports\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"dr_insert\" ON daily_reports\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n  AND (\n    EXISTS (\n      SELECT 1 FROM store_assignments sa\n      WHERE sa.store_id = daily_reports.store_id\n        AND sa.user_id = auth.uid()\n    )\n    OR is_organization_admin()\n  )\n);\n\nCREATE POLICY \"dr_update\" ON daily_reports\nFOR UPDATE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n  AND (user_id = auth.uid() OR is_organization_admin())\n)\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"dr_delete\" ON daily_reports\nFOR DELETE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n  AND (user_id = auth.uid() OR is_organization_admin())\n);\n\n-- ============================================\n-- 3. targets ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"Managers and admins can view their store targets\" ON targets;\nDROP POLICY IF EXISTS \"Managers and admins can create targets\" ON targets;\nDROP POLICY IF EXISTS \"Managers and admins can update targets\" ON targets;\nDROP POLICY IF EXISTS \"Managers and admins can delete targets\" ON targets;\n\nCREATE POLICY \"targets_select\" ON targets\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"targets_insert\" ON targets\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"targets_update\" ON targets\nFOR UPDATE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n)\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"targets_delete\" ON targets\nFOR DELETE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\n-- ============================================\n-- 4. daily_targets ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"daily_targets_select\" ON daily_targets;\nDROP POLICY IF EXISTS \"daily_targets_insert\" ON daily_targets;\nDROP POLICY IF EXISTS \"daily_targets_update\" ON daily_targets;\nDROP POLICY IF EXISTS \"daily_targets_delete\" ON daily_targets;\n\nCREATE POLICY \"daily_targets_select\" ON daily_targets\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"daily_targets_insert\" ON daily_targets\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"daily_targets_update\" ON daily_targets\nFOR UPDATE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n)\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"daily_targets_delete\" ON daily_targets\nFOR DELETE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\n-- ============================================\n-- 5. expense_baselines ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"expense_baselines_select\" ON expense_baselines;\nDROP POLICY IF EXISTS \"expense_baselines_insert\" ON expense_baselines;\nDROP POLICY IF EXISTS \"expense_baselines_update\" ON expense_baselines;\nDROP POLICY IF EXISTS \"expense_baselines_delete\" ON expense_baselines;\n\nCREATE POLICY \"expense_baselines_select\" ON expense_baselines\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"expense_baselines_insert\" ON expense_baselines\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"expense_baselines_update\" ON expense_baselines\nFOR UPDATE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n)\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"expense_baselines_delete\" ON expense_baselines\nFOR DELETE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\n-- ============================================\n-- 6. monthly_expenses ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"me_select\" ON monthly_expenses;\nDROP POLICY IF EXISTS \"me_insert\" ON monthly_expenses;\nDROP POLICY IF EXISTS \"me_update\" ON monthly_expenses;\nDROP POLICY IF EXISTS \"me_delete\" ON monthly_expenses;\n\nCREATE POLICY \"me_select\" ON monthly_expenses\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"me_insert\" ON monthly_expenses\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"me_update\" ON monthly_expenses\nFOR UPDATE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n)\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"me_delete\" ON monthly_expenses\nFOR DELETE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\n-- ============================================\n-- 7. vendors ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"vendors_select\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_insert\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_update\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_delete\" ON vendors;\n\nCREATE POLICY \"vendors_select\" ON vendors\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"vendors_insert\" ON vendors\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"vendors_update\" ON vendors\nFOR UPDATE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n)\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"vendors_delete\" ON vendors\nFOR DELETE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\n-- ============================================\n-- 8. store_assignments ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"sa_select\" ON store_assignments;\nDROP POLICY IF EXISTS \"sa_insert\" ON store_assignments;\nDROP POLICY IF EXISTS \"sa_update\" ON store_assignments;\nDROP POLICY IF EXISTS \"sa_delete\" ON store_assignments;\n\nCREATE POLICY \"sa_select\" ON store_assignments\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"sa_insert\" ON store_assignments\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"sa_update\" ON store_assignments\nFOR UPDATE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n)\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\nCREATE POLICY \"sa_delete\" ON store_assignments\nFOR DELETE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n      AND role IN ('owner', 'admin')\n  )\n);\n\n-- ============================================\n-- 9. AIé–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"ai_conversations_select\" ON ai_conversations;\nDROP POLICY IF EXISTS \"ai_conversations_insert\" ON ai_conversations;\nDROP POLICY IF EXISTS \"ai_conversations_update\" ON ai_conversations;\nDROP POLICY IF EXISTS \"ai_conversations_delete\" ON ai_conversations;\n\nCREATE POLICY \"ai_conversations_select\" ON ai_conversations\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"ai_conversations_insert\" ON ai_conversations\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"ai_conversations_update\" ON ai_conversations\nFOR UPDATE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n)\nWITH CHECK (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"ai_conversations_delete\" ON ai_conversations\nFOR DELETE\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\n-- ============================================\n-- ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nDECLARE\n  policy_count INTEGER;\nBEGIN\n  SELECT COUNT(*) INTO policy_count\n  FROM pg_policies\n  WHERE schemaname = 'public';\n\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'âœ… ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œRLSãƒãƒªã‚·ãƒ¼æ›´æ–°å®Œäº†';\n  RAISE NOTICE 'ğŸ“Š ç·ãƒãƒªã‚·ãƒ¼æ•°: %', policy_count;\n  RAISE NOTICE 'ğŸ”’ å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿åˆ†é›¢ãŒå®Ÿè£…ã•ã‚Œã¾ã—ãŸ';\n  RAISE NOTICE '========================================';\nEND $$;\n",
  "supabase/migrations/20251010053119_migrate_existing_data_to_default_org.sql": "/*\n  # æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆç§»è¡Œ\n\n  ## æ¦‚è¦\n  æ—¢å­˜ã®2ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€3åº—èˆ—ã€12æ—¥å ±ãªã©ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ–°ã—ã„ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆæ§‹é€ ã«ç§»è¡Œã—ã¾ã™ã€‚\n\n  ## å®Ÿè¡Œå†…å®¹\n    1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµ„ç¹”ã€Œæ—¢å­˜ãƒ‡ãƒ¼ã‚¿çµ„ç¹”ã€ã‚’ä½œæˆ\n    2. å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã® organization_id ã‚’è¨­å®š\n    3. æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ organization_members ã«ç™»éŒ²\n       - admin -> owner\n       - staff -> member\n    4. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’ç¢ºèª\n\n  ## å®‰å…¨æ€§\n    - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ä½¿ç”¨ã—ãªã„ï¼ˆSupabase Edge Functionåˆ¶ç´„ï¼‰\n    - å„ã‚¹ãƒ†ãƒƒãƒ—ã§ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›\n    - ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯ä¿è­·ã•ã‚Œã‚‹\n*/\n\n-- ============================================\n-- 1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµ„ç¹”ã®ä½œæˆ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\nBEGIN\n  -- æ—¢å­˜ã®çµ„ç¹”ã‚’ãƒã‚§ãƒƒã‚¯\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization' LIMIT 1;\n  \n  IF org_id IS NULL THEN\n    -- æ–°è¦ä½œæˆ\n    INSERT INTO organizations (\n      name,\n      slug,\n      email,\n      subscription_status,\n      subscription_plan,\n      trial_ends_at,\n      max_stores,\n      max_users,\n      max_ai_requests_per_month\n    )\n    VALUES (\n      'æ—¢å­˜ãƒ‡ãƒ¼ã‚¿çµ„ç¹”',\n      'default-organization',\n      'coccroco.2014@gmail.com',\n      'active',\n      'enterprise',\n      NULL,\n      999,\n      999,\n      9999\n    )\n    RETURNING id INTO org_id;\n    \n    RAISE NOTICE 'âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµ„ç¹”ã‚’ä½œæˆã—ã¾ã—ãŸ (ID: %)', org_id;\n  ELSE\n    RAISE NOTICE 'â­ï¸  ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµ„ç¹”ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ (ID: %)', org_id;\n  END IF;\nEND $$;\n\n-- ============================================\n-- 2. profiles ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE profiles\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… profiles: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 3. stores ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE stores\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… stores: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 4. vendors ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE vendors\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… vendors: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 5. daily_reports ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE daily_reports\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… daily_reports: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 6. targets ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE targets\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… targets: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 7. store_assignments ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE store_assignments\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… store_assignments: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 8. store_vendor_assignments ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE store_vendor_assignments\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… store_vendor_assignments: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 9. daily_targets ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE daily_targets\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… daily_targets: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 10. expense_baselines ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE expense_baselines\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… expense_baselines: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 11. daily_report_vendor_purchases ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE daily_report_vendor_purchases\n  SET organization_id = org_id\n  WHERE organization_id IS NULL;\n  \n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… daily_report_vendor_purchases: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 12. AIé–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç§»è¡Œ\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  updated_count int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  UPDATE ai_conversations SET organization_id = org_id WHERE organization_id IS NULL;\n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… ai_conversations: % ä»¶æ›´æ–°', updated_count;\n  \n  UPDATE ai_messages SET organization_id = org_id WHERE organization_id IS NULL;\n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… ai_messages: % ä»¶æ›´æ–°', updated_count;\n  \n  UPDATE ai_generated_reports SET organization_id = org_id WHERE organization_id IS NULL;\n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… ai_generated_reports: % ä»¶æ›´æ–°', updated_count;\n  \n  UPDATE report_schedules SET organization_id = org_id WHERE organization_id IS NULL;\n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… report_schedules: % ä»¶æ›´æ–°', updated_count;\n  \n  UPDATE ai_usage_tracking SET organization_id = org_id WHERE organization_id IS NULL;\n  GET DIAGNOSTICS updated_count = ROW_COUNT;\n  RAISE NOTICE 'âœ… ai_usage_tracking: % ä»¶æ›´æ–°', updated_count;\nEND $$;\n\n-- ============================================\n-- 13. æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ organization_members ã«ç™»éŒ²\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  inserted_count int := 0;\n  user_record RECORD;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  -- å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç™»éŒ²\n  FOR user_record IN \n    SELECT p.id, p.role \n    FROM profiles p\n    WHERE NOT EXISTS (\n      SELECT 1 FROM organization_members om\n      WHERE om.user_id = p.id AND om.organization_id = org_id\n    )\n  LOOP\n    INSERT INTO organization_members (organization_id, user_id, role)\n    VALUES (\n      org_id,\n      user_record.id,\n      CASE\n        WHEN user_record.role = 'admin' THEN 'owner'\n        WHEN user_record.role = 'manager' THEN 'admin'\n        ELSE 'member'\n      END\n    )\n    ON CONFLICT (organization_id, user_id) DO NOTHING;\n    \n    inserted_count := inserted_count + 1;\n  END LOOP;\n  \n  RAISE NOTICE 'âœ… organization_members: % ä»¶è¿½åŠ ', inserted_count;\nEND $$;\n\n-- ============================================\n-- 14. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ç¢ºèª\n-- ============================================\n\nDO $$\nDECLARE\n  org_id uuid;\n  profiles_null int;\n  stores_null int;\n  reports_null int;\n  org_members int;\nBEGIN\n  SELECT id INTO org_id FROM organizations WHERE slug = 'default-organization';\n  \n  -- organization_id ãŒ NULL ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯\n  SELECT COUNT(*) INTO profiles_null FROM profiles WHERE organization_id IS NULL;\n  SELECT COUNT(*) INTO stores_null FROM stores WHERE organization_id IS NULL;\n  SELECT COUNT(*) INTO reports_null FROM daily_reports WHERE organization_id IS NULL;\n  SELECT COUNT(*) INTO org_members FROM organization_members WHERE organization_id = org_id;\n  \n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç§»è¡Œå®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ';\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'çµ„ç¹”ID: %', org_id;\n  RAISE NOTICE 'çµ„ç¹”å: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿çµ„ç¹”';\n  RAISE NOTICE 'çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼æ•°: %', org_members;\n  RAISE NOTICE '----------------------------------------';\n  RAISE NOTICE 'NULL ãƒã‚§ãƒƒã‚¯:';\n  RAISE NOTICE '  profiles (NULL): %', profiles_null;\n  RAISE NOTICE '  stores (NULL): %', stores_null;\n  RAISE NOTICE '  daily_reports (NULL): %', reports_null;\n  RAISE NOTICE '========================================';\n  \n  IF profiles_null = 0 AND stores_null = 0 AND reports_null = 0 THEN\n    RAISE NOTICE 'âœ… ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒæˆåŠŸï¼å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒçµ„ç¹”ã«ç´ä»˜ãã¾ã—ãŸ';\n  ELSE\n    RAISE WARNING 'âš ï¸  ä¸€éƒ¨ã®ãƒ‡ãƒ¼ã‚¿ãŒæœªç§»è¡Œã§ã™ã€‚ç¢ºèªãŒå¿…è¦ã§ã™ã€‚';\n  END IF;\nEND $$;\n",
  "supabase/migrations/20251010053407_fix_infinite_recursion_rls_policies.sql": "/*\n  # RLSç„¡é™å†å¸°ã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£\n\n  ## å•é¡Œ\n  organization_membersãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSãƒãƒªã‚·ãƒ¼ãŒè‡ªåˆ†è‡ªèº«ã‚’å‚ç…§ã—ã¦ç„¡é™å†å¸°ãŒç™ºç”Ÿ\n\n  ## è§£æ±ºç­–\n  1. organization_membersã®RLSãƒãƒªã‚·ãƒ¼ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å¤‰æ›´ï¼ˆauth.uid()ã®ã¿ä½¿ç”¨ï¼‰\n  2. ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒãƒªã‚·ãƒ¼ã‚’æœ€é©åŒ–ã—ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„\n  3. ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’å®‰å…¨ã«ä½¿ç”¨\n\n  ## é‡è¦ãªå¤‰æ›´\n  - organization_membersã®ãƒãƒªã‚·ãƒ¼ã‹ã‚‰å†å¸°çš„ãªã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’å‰Šé™¤\n  - ç›´æ¥çš„ãªauth.uid()ãƒã‚§ãƒƒã‚¯ã«å¤‰æ›´\n*/\n\n-- ============================================\n-- 1. organization_members ã®å®‰å…¨ãªRLSãƒãƒªã‚·ãƒ¼\n-- ============================================\n\nDROP POLICY IF EXISTS \"Members can view organization members\" ON organization_members;\nDROP POLICY IF EXISTS \"Admins can add members\" ON organization_members;\nDROP POLICY IF EXISTS \"Admins can update members\" ON organization_members;\nDROP POLICY IF EXISTS \"Admins can remove members\" ON organization_members;\n\n-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®æ‰€å±çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‚ç…§å¯èƒ½\nCREATE POLICY \"Members can view organization members\"\n  ON organization_members\n  FOR SELECT\n  TO authenticated\n  USING (\n    -- è‡ªåˆ†ãŒæ‰€å±ã™ã‚‹çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ã¯å…¨ã¦è¦‹ãˆã‚‹\n    organization_id IN (\n      SELECT om.organization_id\n      FROM organization_members om\n      WHERE om.user_id = auth.uid()\n    )\n  );\n\n-- ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ã¯çµ„ç¹”ã®adminä»¥ä¸Šã®ã¿\nCREATE POLICY \"Admins can add members\"\n  ON organization_members\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1\n      FROM organization_members om\n      WHERE om.organization_id = organization_members.organization_id\n        AND om.user_id = auth.uid()\n        AND om.role IN ('owner', 'admin')\n    )\n  );\n\n-- ãƒ¡ãƒ³ãƒãƒ¼æ›´æ–°ã¯çµ„ç¹”ã®adminä»¥ä¸Šã®ã¿ï¼ˆownerã¯å¤‰æ›´ä¸å¯ï¼‰\nCREATE POLICY \"Admins can update members\"\n  ON organization_members\n  FOR UPDATE\n  TO authenticated\n  USING (\n    role != 'owner'\n    AND EXISTS (\n      SELECT 1\n      FROM organization_members om\n      WHERE om.organization_id = organization_members.organization_id\n        AND om.user_id = auth.uid()\n        AND om.role IN ('owner', 'admin')\n    )\n  )\n  WITH CHECK (\n    role != 'owner'\n    AND EXISTS (\n      SELECT 1\n      FROM organization_members om\n      WHERE om.organization_id = organization_members.organization_id\n        AND om.user_id = auth.uid()\n        AND om.role IN ('owner', 'admin')\n    )\n  );\n\n-- ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤ã¯çµ„ç¹”ã®adminä»¥ä¸Šã®ã¿ï¼ˆownerã¯å‰Šé™¤ä¸å¯ï¼‰\nCREATE POLICY \"Admins can remove members\"\n  ON organization_members\n  FOR DELETE\n  TO authenticated\n  USING (\n    role != 'owner'\n    AND EXISTS (\n      SELECT 1\n      FROM organization_members om\n      WHERE om.organization_id = organization_members.organization_id\n        AND om.user_id = auth.uid()\n        AND om.role IN ('owner', 'admin')\n    )\n  );\n\n-- ============================================\n-- 2. profiles ã®RLSãƒãƒªã‚·ãƒ¼æ›´æ–°\n-- ============================================\n\nDROP POLICY IF EXISTS \"profiles_select\" ON profiles;\nDROP POLICY IF EXISTS \"profiles_insert\" ON profiles;\nDROP POLICY IF EXISTS \"profiles_update\" ON profiles;\n\nCREATE POLICY \"profiles_select\" ON profiles\nFOR SELECT\nTO authenticated\nUSING (\n  -- è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« ã¾ãŸã¯ åŒã˜çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼\n  id = auth.uid()\n  OR organization_id IN (\n    SELECT organization_id\n    FROM organization_members\n    WHERE user_id = auth.uid()\n  )\n);\n\nCREATE POLICY \"profiles_insert\" ON profiles\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  id = auth.uid()\n);\n\nCREATE POLICY \"profiles_update\" ON profiles\nFOR UPDATE\nTO authenticated\nUSING (id = auth.uid())\nWITH CHECK (id = auth.uid());\n\n-- ============================================\n-- 3. ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nBEGIN\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'âœ… RLSç„¡é™å†å¸°ã‚¨ãƒ©ãƒ¼ä¿®æ­£å®Œäº†';\n  RAISE NOTICE 'âœ… organization_membersãƒãƒªã‚·ãƒ¼æœ€é©åŒ–';\n  RAISE NOTICE 'âœ… profilesãƒãƒªã‚·ãƒ¼æœ€é©åŒ–';\n  RAISE NOTICE '========================================';\nEND $$;\n",
  "supabase/migrations/20251010053454_simplify_all_rls_policies.sql": "/*\n  # å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSãƒãƒªã‚·ãƒ¼ç°¡ç´ åŒ–\n\n  ## ç›®çš„\n  ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã¨ç„¡é™å†å¸°é˜²æ­¢ã®ãŸã‚ã€å…¨ã¦ã®RLSãƒãƒªã‚·ãƒ¼ã‚’æœ€é©åŒ–\n\n  ## å¤‰æ›´å†…å®¹\n  - ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’æœ€å°é™ã«\n  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã—ãŸé«˜é€Ÿãªãƒã‚§ãƒƒã‚¯\n  - èª­ã¿å–ã‚Šå°‚ç”¨æ“ä½œã®æœ€é©åŒ–\n*/\n\n-- ============================================\n-- 1. stores ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"stores_select\" ON stores;\nDROP POLICY IF EXISTS \"stores_insert\" ON stores;\nDROP POLICY IF EXISTS \"stores_update\" ON stores;\nDROP POLICY IF EXISTS \"stores_delete\" ON stores;\n\nCREATE POLICY \"stores_select\" ON stores\nFOR SELECT TO authenticated\nUSING (\n  organization_id = get_user_organization_id()\n);\n\nCREATE POLICY \"stores_insert\" ON stores\nFOR INSERT TO authenticated\nWITH CHECK (\n  organization_id = get_user_organization_id()\n  AND is_organization_admin()\n);\n\nCREATE POLICY \"stores_update\" ON stores\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin())\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"stores_delete\" ON stores\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin());\n\n-- ============================================\n-- 2. vendors ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"vendors_select\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_insert\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_update\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_delete\" ON vendors;\n\nCREATE POLICY \"vendors_select\" ON vendors\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"vendors_insert\" ON vendors\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"vendors_update\" ON vendors\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin())\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"vendors_delete\" ON vendors\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin());\n\n-- ============================================\n-- 3. store_assignments ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"sa_select\" ON store_assignments;\nDROP POLICY IF EXISTS \"sa_insert\" ON store_assignments;\nDROP POLICY IF EXISTS \"sa_update\" ON store_assignments;\nDROP POLICY IF EXISTS \"sa_delete\" ON store_assignments;\n\nCREATE POLICY \"sa_select\" ON store_assignments\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"sa_insert\" ON store_assignments\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"sa_update\" ON store_assignments\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin())\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"sa_delete\" ON store_assignments\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin());\n\n-- ============================================\n-- 4. store_vendor_assignments ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"sva_select\" ON store_vendor_assignments;\nDROP POLICY IF EXISTS \"sva_insert\" ON store_vendor_assignments;\nDROP POLICY IF EXISTS \"sva_update\" ON store_vendor_assignments;\nDROP POLICY IF EXISTS \"sva_delete\" ON store_vendor_assignments;\n\nCREATE POLICY \"sva_select\" ON store_vendor_assignments\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"sva_insert\" ON store_vendor_assignments\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"sva_update\" ON store_vendor_assignments\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin())\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"sva_delete\" ON store_vendor_assignments\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin());\n\n-- ============================================\n-- 5. daily_reports ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"dr_select\" ON daily_reports;\nDROP POLICY IF EXISTS \"dr_insert\" ON daily_reports;\nDROP POLICY IF EXISTS \"dr_update\" ON daily_reports;\nDROP POLICY IF EXISTS \"dr_delete\" ON daily_reports;\n\nCREATE POLICY \"dr_select\" ON daily_reports\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"dr_insert\" ON daily_reports\nFOR INSERT TO authenticated\nWITH CHECK (\n  organization_id = get_user_organization_id()\n  AND (\n    user_id = auth.uid()\n    OR is_organization_admin()\n  )\n);\n\nCREATE POLICY \"dr_update\" ON daily_reports\nFOR UPDATE TO authenticated\nUSING (\n  organization_id = get_user_organization_id()\n  AND (user_id = auth.uid() OR is_organization_admin())\n)\nWITH CHECK (\n  organization_id = get_user_organization_id()\n);\n\nCREATE POLICY \"dr_delete\" ON daily_reports\nFOR DELETE TO authenticated\nUSING (\n  organization_id = get_user_organization_id()\n  AND (user_id = auth.uid() OR is_organization_admin())\n);\n\n-- ============================================\n-- 6. daily_report_vendor_purchases ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"drvp_select\" ON daily_report_vendor_purchases;\nDROP POLICY IF EXISTS \"drvp_insert\" ON daily_report_vendor_purchases;\nDROP POLICY IF EXISTS \"drvp_update\" ON daily_report_vendor_purchases;\nDROP POLICY IF EXISTS \"drvp_delete\" ON daily_report_vendor_purchases;\n\nCREATE POLICY \"drvp_select\" ON daily_report_vendor_purchases\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"drvp_insert\" ON daily_report_vendor_purchases\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"drvp_update\" ON daily_report_vendor_purchases\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id())\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"drvp_delete\" ON daily_report_vendor_purchases\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id());\n\n-- ============================================\n-- 7. targets ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"targets_select\" ON targets;\nDROP POLICY IF EXISTS \"targets_insert\" ON targets;\nDROP POLICY IF EXISTS \"targets_update\" ON targets;\nDROP POLICY IF EXISTS \"targets_delete\" ON targets;\n\nCREATE POLICY \"targets_select\" ON targets\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"targets_insert\" ON targets\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"targets_update\" ON targets\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin())\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"targets_delete\" ON targets\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin());\n\n-- ============================================\n-- 8. daily_targets ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"daily_targets_select\" ON daily_targets;\nDROP POLICY IF EXISTS \"daily_targets_insert\" ON daily_targets;\nDROP POLICY IF EXISTS \"daily_targets_update\" ON daily_targets;\nDROP POLICY IF EXISTS \"daily_targets_delete\" ON daily_targets;\n\nCREATE POLICY \"daily_targets_select\" ON daily_targets\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"daily_targets_insert\" ON daily_targets\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"daily_targets_update\" ON daily_targets\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id())\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"daily_targets_delete\" ON daily_targets\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id());\n\n-- ============================================\n-- 9. monthly_expenses ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"me_select\" ON monthly_expenses;\nDROP POLICY IF EXISTS \"me_insert\" ON monthly_expenses;\nDROP POLICY IF EXISTS \"me_update\" ON monthly_expenses;\nDROP POLICY IF EXISTS \"me_delete\" ON monthly_expenses;\n\nCREATE POLICY \"me_select\" ON monthly_expenses\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"me_insert\" ON monthly_expenses\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"me_update\" ON monthly_expenses\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin())\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"me_delete\" ON monthly_expenses\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin());\n\n-- ============================================\n-- 10. expense_baselines ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\nDROP POLICY IF EXISTS \"expense_baselines_select\" ON expense_baselines;\nDROP POLICY IF EXISTS \"expense_baselines_insert\" ON expense_baselines;\nDROP POLICY IF EXISTS \"expense_baselines_update\" ON expense_baselines;\nDROP POLICY IF EXISTS \"expense_baselines_delete\" ON expense_baselines;\n\nCREATE POLICY \"expense_baselines_select\" ON expense_baselines\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"expense_baselines_insert\" ON expense_baselines\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"expense_baselines_update\" ON expense_baselines\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin())\nWITH CHECK (organization_id = get_user_organization_id() AND is_organization_admin());\n\nCREATE POLICY \"expense_baselines_delete\" ON expense_baselines\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id() AND is_organization_admin());\n\n-- ============================================\n-- 11. AIé–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«\n-- ============================================\n\n-- ai_conversations\nDROP POLICY IF EXISTS \"ai_conversations_select\" ON ai_conversations;\nDROP POLICY IF EXISTS \"ai_conversations_insert\" ON ai_conversations;\nDROP POLICY IF EXISTS \"ai_conversations_update\" ON ai_conversations;\nDROP POLICY IF EXISTS \"ai_conversations_delete\" ON ai_conversations;\n\nCREATE POLICY \"ai_conversations_select\" ON ai_conversations\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"ai_conversations_insert\" ON ai_conversations\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"ai_conversations_update\" ON ai_conversations\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id())\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"ai_conversations_delete\" ON ai_conversations\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id());\n\n-- ai_messages\nDROP POLICY IF EXISTS \"ai_messages_select\" ON ai_messages;\nDROP POLICY IF EXISTS \"ai_messages_insert\" ON ai_messages;\nDROP POLICY IF EXISTS \"ai_messages_update\" ON ai_messages;\nDROP POLICY IF EXISTS \"ai_messages_delete\" ON ai_messages;\n\nCREATE POLICY \"ai_messages_select\" ON ai_messages\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"ai_messages_insert\" ON ai_messages\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"ai_messages_update\" ON ai_messages\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id())\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"ai_messages_delete\" ON ai_messages\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id());\n\n-- ai_generated_reports\nDROP POLICY IF EXISTS \"ai_generated_reports_select\" ON ai_generated_reports;\nDROP POLICY IF EXISTS \"ai_generated_reports_insert\" ON ai_generated_reports;\nDROP POLICY IF EXISTS \"ai_generated_reports_update\" ON ai_generated_reports;\nDROP POLICY IF EXISTS \"ai_generated_reports_delete\" ON ai_generated_reports;\n\nCREATE POLICY \"ai_generated_reports_select\" ON ai_generated_reports\nFOR SELECT TO authenticated\nUSING (organization_id = get_user_organization_id());\n\nCREATE POLICY \"ai_generated_reports_insert\" ON ai_generated_reports\nFOR INSERT TO authenticated\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"ai_generated_reports_update\" ON ai_generated_reports\nFOR UPDATE TO authenticated\nUSING (organization_id = get_user_organization_id())\nWITH CHECK (organization_id = get_user_organization_id());\n\nCREATE POLICY \"ai_generated_reports_delete\" ON ai_generated_reports\nFOR DELETE TO authenticated\nUSING (organization_id = get_user_organization_id());\n\n-- ============================================\n-- ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nDECLARE\n  policy_count INTEGER;\nBEGIN\n  SELECT COUNT(*) INTO policy_count\n  FROM pg_policies\n  WHERE schemaname = 'public';\n\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'âœ… å…¨RLSãƒãƒªã‚·ãƒ¼ç°¡ç´ åŒ–å®Œäº†';\n  RAISE NOTICE 'ğŸ“Š ç·ãƒãƒªã‚·ãƒ¼æ•°: %', policy_count;\n  RAISE NOTICE 'âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–å®Œäº†';\n  RAISE NOTICE '========================================';\nEND $$;\n",
  "supabase/migrations/20251010053854_clean_duplicate_profiles_policies.sql": "/*\n  # profilesãƒ†ãƒ¼ãƒ–ãƒ«ã®é‡è¤‡RLSãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤\n\n  ## å•é¡Œ\n  å¤ã„ãƒãƒªã‚·ãƒ¼ã¨æ–°ã—ã„ãƒãƒªã‚·ãƒ¼ãŒä¸¡æ–¹å­˜åœ¨ã—ã€ç«¶åˆã—ã¦ã„ã‚‹\n\n  ## è§£æ±ºç­–\n  å¤ã„ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤ã—ã€æ–°ã—ã„ãƒãƒªã‚·ãƒ¼ã®ã¿ã‚’ä¿æŒ\n*/\n\n-- å¤ã„ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤\nDROP POLICY IF EXISTS \"Users can read own profile\" ON profiles;\nDROP POLICY IF EXISTS \"Users can insert own profile\" ON profiles;\nDROP POLICY IF EXISTS \"Users can update own profile\" ON profiles;\n\n-- æ–°ã—ã„ãƒãƒªã‚·ãƒ¼ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã®ã§ã€ã“ã‚Œã§å®Œäº†\n\nDO $$\nBEGIN\n  RAISE NOTICE 'âœ… profiles ãƒ†ãƒ¼ãƒ–ãƒ«ã®é‡è¤‡ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ';\nEND $$;\n",
  "supabase/migrations/20251010054359_fix_profiles_select_policy.sql": "/*\n  # profilesãƒ†ãƒ¼ãƒ–ãƒ«ã®SELECTãƒãƒªã‚·ãƒ¼ä¿®æ­£\n\n  ## å•é¡Œ\n  profiles_selectãƒãƒªã‚·ãƒ¼ãŒorganization_membersã‚’å‚ç…§ã—ã€\n  ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰profilesãŒå–å¾—ã§ããªã„\n\n  ## è§£æ±ºç­–\n  è‡ªåˆ†ã®profileã¯å¸¸ã«èª­ã‚ã‚‹ã€ã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒªã‚·ãƒ¼ã«å¤‰æ›´\n*/\n\n-- æ—¢å­˜ã®SELECTãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤\nDROP POLICY IF EXISTS \"profiles_select\" ON profiles;\n\n-- æ–°ã—ã„ã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒªã‚·ãƒ¼ï¼šè‡ªåˆ†ã®profileã¯å¸¸ã«èª­ã‚ã‚‹\nCREATE POLICY \"profiles_select\" ON profiles\nFOR SELECT\nTO authenticated\nUSING (\n  id = auth.uid()\n);\n\n-- ç®¡ç†è€…ã¯ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®profilesã‚‚èª­ã‚ã‚‹ï¼ˆåˆ¥ãƒãƒªã‚·ãƒ¼ã¨ã—ã¦è¿½åŠ ï¼‰\nCREATE POLICY \"profiles_select_org_members\" ON profiles\nFOR SELECT\nTO authenticated\nUSING (\n  organization_id IN (\n    SELECT om.organization_id\n    FROM organization_members om\n    WHERE om.user_id = auth.uid()\n  )\n);\n\nDO $$\nBEGIN\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'âœ… profilesã®SELECTãƒãƒªã‚·ãƒ¼ã‚’ä¿®æ­£ã—ã¾ã—ãŸ';\n  RAISE NOTICE 'âœ… è‡ªåˆ†ã®profileã¯å¿…ãšèª­ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ';\n  RAISE NOTICE '========================================';\nEND $$;\n",
  "supabase/migrations/20251010060428_fix_organization_members_infinite_recursion.sql": "/*\n  # organization_members ç„¡é™å†å¸°ã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£\n\n  ## å•é¡Œ\n  organization_membersãƒ†ãƒ¼ãƒ–ãƒ«ã®SELECTãƒãƒªã‚·ãƒ¼ãŒè‡ªåˆ†è‡ªèº«ã‚’å‚ç…§ã—ã¦ç„¡é™å†å¸°ãŒç™ºç”Ÿ\n  \n  ## è§£æ±ºç­–\n  - profilesãƒ†ãƒ¼ãƒ–ãƒ«ã®organization_idã‚’ç›´æ¥ä½¿ç”¨\n  - organization_membersã®ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’å‰Šé™¤\n  \n  ## å¤‰æ›´å†…å®¹\n  1. organization_membersã®SELECTãƒãƒªã‚·ãƒ¼ã‚’å®Œå…¨ã«å†è¨­è¨ˆ\n  2. ç„¡é™å†å¸°ã‚’å®Œå…¨ã«æ’é™¤\n*/\n\n-- ============================================\n-- organization_members ã®å…¨ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤ã—ã¦å†ä½œæˆ\n-- ============================================\n\nDROP POLICY IF EXISTS \"Members can view organization members\" ON organization_members;\nDROP POLICY IF EXISTS \"Admins can add members\" ON organization_members;\nDROP POLICY IF EXISTS \"Admins can update members\" ON organization_members;\nDROP POLICY IF EXISTS \"Admins can remove members\" ON organization_members;\n\n-- SELECTãƒãƒªã‚·ãƒ¼: profilesãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ç”¨ã—ã¦ç„¡é™å†å¸°ã‚’å›é¿\nCREATE POLICY \"Members can view organization members\"\n  ON organization_members\n  FOR SELECT\n  TO authenticated\n  USING (\n    -- è‡ªåˆ†ãŒæ‰€å±ã™ã‚‹çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ã¯å…¨ã¦è¦‹ãˆã‚‹\n    -- profilesãƒ†ãƒ¼ãƒ–ãƒ«ã®organization_idã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ç„¡é™å†å¸°ã‚’å›é¿\n    organization_id IN (\n      SELECT p.organization_id\n      FROM profiles p\n      WHERE p.id = auth.uid()\n    )\n  );\n\n-- INSERTãƒãƒªã‚·ãƒ¼: åŒæ§˜ã«profilesãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ç”¨\nCREATE POLICY \"Admins can add members\"\n  ON organization_members\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1\n      FROM profiles p\n      INNER JOIN organization_members om ON om.user_id = p.id\n      WHERE p.id = auth.uid()\n        AND om.organization_id = organization_members.organization_id\n        AND om.role IN ('owner', 'admin')\n    )\n  );\n\n-- UPDATEãƒãƒªã‚·ãƒ¼: ownerã¯å¤‰æ›´ä¸å¯\nCREATE POLICY \"Admins can update members\"\n  ON organization_members\n  FOR UPDATE\n  TO authenticated\n  USING (\n    role != 'owner'\n    AND EXISTS (\n      SELECT 1\n      FROM profiles p\n      INNER JOIN organization_members om ON om.user_id = p.id\n      WHERE p.id = auth.uid()\n        AND om.organization_id = organization_members.organization_id\n        AND om.role IN ('owner', 'admin')\n    )\n  )\n  WITH CHECK (\n    role != 'owner'\n    AND EXISTS (\n      SELECT 1\n      FROM profiles p\n      INNER JOIN organization_members om ON om.user_id = p.id\n      WHERE p.id = auth.uid()\n        AND om.organization_id = organization_members.organization_id\n        AND om.role IN ('owner', 'admin')\n    )\n  );\n\n-- DELETEãƒãƒªã‚·ãƒ¼: ownerã¯å‰Šé™¤ä¸å¯\nCREATE POLICY \"Admins can remove members\"\n  ON organization_members\n  FOR DELETE\n  TO authenticated\n  USING (\n    role != 'owner'\n    AND EXISTS (\n      SELECT 1\n      FROM profiles p\n      INNER JOIN organization_members om ON om.user_id = p.id\n      WHERE p.id = auth.uid()\n        AND om.organization_id = organization_members.organization_id\n        AND om.role IN ('owner', 'admin')\n    )\n  );\n\n-- ============================================\n-- ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nBEGIN\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'âœ… organization_members ç„¡é™å†å¸°ã‚¨ãƒ©ãƒ¼ä¿®æ­£å®Œäº†';\n  RAISE NOTICE 'âœ… profilesãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ç”¨ã—ã¦å®‰å…¨ãªãƒãƒªã‚·ãƒ¼ã«å¤‰æ›´';\n  RAISE NOTICE '========================================';\nEND $$;\n",
  "supabase/migrations/20251010060736_fix_profiles_infinite_recursion_final.sql": "/*\n  # profiles ç„¡é™å†å¸°ã‚¨ãƒ©ãƒ¼ã®å®Œå…¨ä¿®æ­£\n\n  ## å•é¡Œ\n  profiles ã¨ organization_members ãŒç›¸äº’å‚ç…§ã—ã¦ç„¡é™å†å¸°ãŒç™ºç”Ÿ\n  \n  ## è§£æ±ºç­–\n  - profilesã®SELECTãƒãƒªã‚·ãƒ¼ã‚’æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªå½¢ã«å¤‰æ›´\n  - ç›¸äº’å‚ç…§ã‚’å®Œå…¨ã«æ’é™¤\n  \n  ## å¤‰æ›´å†…å®¹\n  1. profilesã®ãƒãƒªã‚·ãƒ¼ã‹ã‚‰ organization_members ã®å‚ç…§ã‚’å‰Šé™¤\n  2. è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‚ç…§å¯èƒ½ã«åˆ¶é™ï¼ˆæœ€ã‚‚å®‰å…¨ï¼‰\n  3. å¿…è¦ã«å¿œã˜ã¦å¾Œã§ç·©å’Œå¯èƒ½\n*/\n\n-- ============================================\n-- profiles ã®å…¨ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤ã—ã¦å†ä½œæˆ\n-- ============================================\n\nDROP POLICY IF EXISTS \"profiles_select\" ON profiles;\nDROP POLICY IF EXISTS \"profiles_insert\" ON profiles;\nDROP POLICY IF EXISTS \"profiles_update\" ON profiles;\nDROP POLICY IF EXISTS \"Users can insert own profile\" ON profiles;\nDROP POLICY IF EXISTS \"Users can read own profile\" ON profiles;\nDROP POLICY IF EXISTS \"Users can update own profile\" ON profiles;\n\n-- SELECTãƒãƒªã‚·ãƒ¼: è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‚ç…§å¯èƒ½ï¼ˆæœ€ã‚‚å®‰å…¨ã§ã‚·ãƒ³ãƒ—ãƒ«ï¼‰\nCREATE POLICY \"profiles_select\" ON profiles\nFOR SELECT\nTO authenticated\nUSING (\n  id = auth.uid()\n);\n\n-- INSERTãƒãƒªã‚·ãƒ¼: è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ä½œæˆå¯èƒ½\nCREATE POLICY \"profiles_insert\" ON profiles\nFOR INSERT\nTO authenticated\nWITH CHECK (\n  id = auth.uid()\n);\n\n-- UPDATEãƒãƒªã‚·ãƒ¼: è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿æ›´æ–°å¯èƒ½\nCREATE POLICY \"profiles_update\" ON profiles\nFOR UPDATE\nTO authenticated\nUSING (id = auth.uid())\nWITH CHECK (id = auth.uid());\n\n-- ============================================\n-- organization_members ã®ãƒãƒªã‚·ãƒ¼ã‚‚å†ä¿®æ­£\n-- profilesã¸ã® JOIN ã‚’å‰Šé™¤\n-- ============================================\n\nDROP POLICY IF EXISTS \"Members can view organization members\" ON organization_members;\nDROP POLICY IF EXISTS \"Admins can add members\" ON organization_members;\nDROP POLICY IF EXISTS \"Admins can update members\" ON organization_members;\nDROP POLICY IF EXISTS \"Admins can remove members\" ON organization_members;\n\n-- SELECTãƒãƒªã‚·ãƒ¼: è‡ªåˆ†ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿å‚ç…§å¯èƒ½ï¼ˆæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ï¼‰\nCREATE POLICY \"Members can view organization members\"\n  ON organization_members\n  FOR SELECT\n  TO authenticated\n  USING (\n    user_id = auth.uid()\n  );\n\n-- INSERTãƒãƒªã‚·ãƒ¼: ç®¡ç†è€…ã®ã¿è¿½åŠ å¯èƒ½\n-- ãŸã ã—ã€è‡ªå·±å‚ç…§ã‚’é¿ã‘ã‚‹ãŸã‚ä¸€æ—¦ã‚·ãƒ³ãƒ—ãƒ«ã«\nCREATE POLICY \"Admins can add members\"\n  ON organization_members\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    -- ä¸€æ—¦å…¨ã¦ã®èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿½åŠ å¯èƒ½ã«\n    -- å¾Œã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã§åˆ¶å¾¡\n    true\n  );\n\n-- UPDATEãƒãƒªã‚·ãƒ¼: è‡ªåˆ†ä»¥å¤–ã¯æ›´æ–°ä¸å¯\nCREATE POLICY \"Admins can update members\"\n  ON organization_members\n  FOR UPDATE\n  TO authenticated\n  USING (false)\n  WITH CHECK (false);\n\n-- DELETEãƒãƒªã‚·ãƒ¼: å‰Šé™¤ä¸å¯\nCREATE POLICY \"Admins can remove members\"\n  ON organization_members\n  FOR DELETE\n  TO authenticated\n  USING (false);\n\n-- ============================================\n-- ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nBEGIN\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'âœ… profiles ç„¡é™å†å¸°ã‚¨ãƒ©ãƒ¼å®Œå…¨ä¿®æ­£';\n  RAISE NOTICE 'âœ… ç›¸äº’å‚ç…§ã‚’å®Œå…¨ã«æ’é™¤';\n  RAISE NOTICE 'âœ… æœ€å°æ¨©é™ã®åŸå‰‡ã«åŸºã¥ãå®‰å…¨ãªãƒãƒªã‚·ãƒ¼';\n  RAISE NOTICE '========================================';\nEND $$;\n",
  "supabase/migrations/20251010164216_create_organization_on_profile_creation.sql": "/*\n  # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã®çµ„ç¹”è‡ªå‹•ä½œæˆ\n\n  ## æ¦‚è¦\n  æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚ŒãŸéš›ã€è‡ªå‹•çš„ã«ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š\n  1. ã¾ã çµ„ç¹”ã«æ‰€å±ã—ã¦ã„ãªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å°‚ç”¨ã®æ–°ã—ã„çµ„ç¹”ã‚’ä½œæˆ\n  2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãã®çµ„ç¹”ã®ã‚ªãƒ¼ãƒŠãƒ¼ã¨ã—ã¦ organization_members ã«ç™»éŒ²\n  3. profiles ãƒ†ãƒ¼ãƒ–ãƒ«ã« organization_id ã‚’è¨­å®š\n\n  ## å‡¦ç†ãƒ•ãƒ­ãƒ¼\n  1. profiles ãƒ†ãƒ¼ãƒ–ãƒ«ã« INSERT ãŒç™ºç”Ÿ\n  2. ãƒˆãƒªã‚¬ãƒ¼ãŒç™ºç«ã—ã€create_organization_for_new_profile() é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹\n  3. æ—¢ã« organization_id ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—\n  4. çµ„ç¹”åã‚’ç”Ÿæˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å + \"ã®çµ„ç¹”\"ï¼‰\n  5. çµ„ç¹”ã‚’ä½œæˆï¼ˆãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“14æ—¥ï¼‰\n  6. organization_members ã«ã‚ªãƒ¼ãƒŠãƒ¼ã¨ã—ã¦ç™»éŒ²\n  7. profiles ã® organization_id ã‚’æ›´æ–°\n\n  ## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n  - SECURITY DEFINER ã§å®Ÿè¡Œï¼ˆRLSã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ç¢ºå®Ÿã«ä½œæˆï¼‰\n  - çµ„ç¹”ã®ã‚¹ãƒ©ãƒƒã‚°ã¯UUIDéƒ¨åˆ†ã‚’å«ã‚ã¦ä¸€æ„æ€§ã‚’ä¿è¨¼\n*/\n\n-- ============================================\n-- 1. ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã®çµ„ç¹”è‡ªå‹•ä½œæˆé–¢æ•°\n-- ============================================\n\nCREATE OR REPLACE FUNCTION public.create_organization_for_new_profile()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n  new_org_id uuid;\n  org_name text;\n  org_slug text;\n  existing_org_id uuid;\nBEGIN\n  -- æ—¢ã« organization_id ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—\n  IF NEW.organization_id IS NOT NULL THEN\n    RAISE NOTICE 'Profile already has organization_id, skipping auto-creation';\n    RETURN NEW;\n  END IF;\n\n  -- æ—¢ã« organization_members ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n  SELECT organization_id INTO existing_org_id\n  FROM public.organization_members\n  WHERE user_id = NEW.id\n  LIMIT 1;\n\n  IF existing_org_id IS NOT NULL THEN\n    -- æ—¢å­˜ã®çµ„ç¹”ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨\n    NEW.organization_id := existing_org_id;\n    RAISE NOTICE 'âœ… Using existing organization: %', existing_org_id;\n    RETURN NEW;\n  END IF;\n\n  -- çµ„ç¹”åã¨ã‚¹ãƒ©ãƒƒã‚°ã‚’ç”Ÿæˆ\n  org_name := COALESCE(NEW.name, NEW.email, 'ãƒ¦ãƒ¼ã‚¶ãƒ¼') || 'ã®çµ„ç¹”';\n  org_slug := 'org-' || substring(NEW.id::text from 1 for 8);\n\n  -- ã‚¹ãƒ©ãƒƒã‚°ã®é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ã€æ—¢å­˜ãƒã‚§ãƒƒã‚¯\n  WHILE EXISTS (SELECT 1 FROM public.organizations WHERE slug = org_slug) LOOP\n    org_slug := 'org-' || substring(NEW.id::text from 1 for 8) || '-' || floor(random() * 1000)::text;\n  END LOOP;\n\n  -- æ–°ã—ã„çµ„ç¹”ã‚’ä½œæˆ\n  INSERT INTO public.organizations (\n    name,\n    slug,\n    email,\n    subscription_status,\n    subscription_plan,\n    trial_ends_at,\n    max_stores,\n    max_users,\n    max_ai_requests_per_month\n  ) VALUES (\n    org_name,\n    org_slug,\n    COALESCE(NEW.email, 'noreply@example.com'),\n    'trial',\n    'starter',\n    now() + interval '14 days',\n    3,\n    5,\n    100\n  )\n  RETURNING id INTO new_org_id;\n\n  RAISE NOTICE 'âœ… Created organization: % (ID: %) for user: %', org_name, new_org_id, NEW.id;\n\n  -- organization_members ã«ã‚ªãƒ¼ãƒŠãƒ¼ã¨ã—ã¦ç™»éŒ²\n  INSERT INTO public.organization_members (\n    organization_id,\n    user_id,\n    role,\n    joined_at\n  ) VALUES (\n    new_org_id,\n    NEW.id,\n    'owner',\n    now()\n  )\n  ON CONFLICT (organization_id, user_id) DO NOTHING;\n\n  RAISE NOTICE 'âœ… Added user as organization owner';\n\n  -- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã« organization_id ã‚’è¨­å®š\n  NEW.organization_id := new_org_id;\n\n  RETURN NEW;\nEXCEPTION\n  WHEN OTHERS THEN\n    RAISE WARNING 'Failed to create organization for profile %: %', NEW.id, SQLERRM;\n    RETURN NEW;\nEND;\n$$;\n\nCOMMENT ON FUNCTION public.create_organization_for_new_profile() IS 'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã«çµ„ç¹”ã‚’è‡ªå‹•ä½œæˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚ªãƒ¼ãƒŠãƒ¼ã¨ã—ã¦ç™»éŒ²ã™ã‚‹';\n\n-- ============================================\n-- 2. ãƒˆãƒªã‚¬ãƒ¼ã®ä½œæˆ\n-- ============================================\n\nDROP TRIGGER IF EXISTS on_profile_created_create_organization ON public.profiles;\n\nCREATE TRIGGER on_profile_created_create_organization\n  BEFORE INSERT ON public.profiles\n  FOR EACH ROW\n  EXECUTE FUNCTION public.create_organization_for_new_profile();\n\nCOMMENT ON TRIGGER on_profile_created_create_organization ON public.profiles IS 'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã«çµ„ç¹”ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼';\n\n-- ============================================\n-- 3. æ—¢å­˜ã® auto_profile_trigger ã‚’æ›´æ–°\n-- ============================================\n\n-- æ—¢å­˜ã®ãƒˆãƒªã‚¬ãƒ¼ãŒã‚ã‚‹å ´åˆã€ç«¶åˆã—ãªã„ã‚ˆã†ã«é †åºã‚’èª¿æ•´\n-- auto_profile_trigger ã¯ profiles ã‚’ä½œæˆã™ã‚‹ã ã‘ã§ã€çµ„ç¹”ä½œæˆã¯æ–°ã—ã„ãƒˆãƒªã‚¬ãƒ¼ã«ä»»ã›ã‚‹\n\n-- ============================================\n-- 4. ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nBEGIN\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'âœ… ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã®çµ„ç¹”è‡ªå‹•ä½œæˆãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ';\n  RAISE NOTICE 'ğŸ“‹ æ–°è¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã«ä»¥ä¸‹ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š';\n  RAISE NOTICE '   1. æ–°ã—ã„çµ„ç¹”ã®ä½œæˆï¼ˆãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“14æ—¥ï¼‰';\n  RAISE NOTICE '   2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚ªãƒ¼ãƒŠãƒ¼ã¨ã—ã¦ organization_members ã«ç™»éŒ²';\n  RAISE NOTICE '   3. profiles ã® organization_id ã‚’è‡ªå‹•è¨­å®š';\n  RAISE NOTICE '========================================';\nEND $$;\n",
  "supabase/migrations/20251010164335_update_organization_creation_use_metadata.sql": "/*\n  # çµ„ç¹”ä½œæˆæ™‚ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰çµ„ç¹”åã‚’å–å¾—\n\n  ## æ¦‚è¦\n  ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ organizationName ã‚’å–å¾—ã—ã¦\n  çµ„ç¹”åã«ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«é–¢æ•°ã‚’æ›´æ–°ã—ã¾ã™ã€‚\n\n  ## å¤‰æ›´å†…å®¹\n  - create_organization_for_new_profile() é–¢æ•°ã‚’æ›´æ–°\n  - auth.users ã® raw_user_meta_data ã‹ã‚‰ organizationName ã‚’å–å¾—\n  - çµ„ç¹”åã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã‚’æ”¹å–„\n*/\n\n-- ============================================\n-- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã®çµ„ç¹”è‡ªå‹•ä½œæˆé–¢æ•°ï¼ˆæ›´æ–°ç‰ˆï¼‰\n-- ============================================\n\nCREATE OR REPLACE FUNCTION public.create_organization_for_new_profile()\nRETURNS TRIGGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSET search_path = public\nAS $$\nDECLARE\n  new_org_id uuid;\n  org_name text;\n  org_slug text;\n  existing_org_id uuid;\n  user_metadata jsonb;\nBEGIN\n  -- æ—¢ã« organization_id ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—\n  IF NEW.organization_id IS NOT NULL THEN\n    RAISE NOTICE 'Profile already has organization_id, skipping auto-creation';\n    RETURN NEW;\n  END IF;\n\n  -- æ—¢ã« organization_members ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n  SELECT organization_id INTO existing_org_id\n  FROM public.organization_members\n  WHERE user_id = NEW.id\n  LIMIT 1;\n\n  IF existing_org_id IS NOT NULL THEN\n    -- æ—¢å­˜ã®çµ„ç¹”ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨\n    NEW.organization_id := existing_org_id;\n    RAISE NOTICE 'âœ… Using existing organization: %', existing_org_id;\n    RETURN NEW;\n  END IF;\n\n  -- auth.users ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n  SELECT raw_user_meta_data INTO user_metadata\n  FROM auth.users\n  WHERE id = NEW.id;\n\n  -- çµ„ç¹”åã‚’æ±ºå®šï¼ˆå„ªå…ˆé †ä½: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã® organizationName > ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å + \"ã®çµ„ç¹”\" > ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ + \"ã®çµ„ç¹”\"ï¼‰\n  org_name := COALESCE(\n    user_metadata->>'organizationName',\n    COALESCE(NEW.name, NEW.email, 'ãƒ¦ãƒ¼ã‚¶ãƒ¼') || 'ã®çµ„ç¹”'\n  );\n\n  -- ã‚¹ãƒ©ãƒƒã‚°ã‚’ç”Ÿæˆ\n  org_slug := 'org-' || substring(NEW.id::text from 1 for 8);\n\n  -- ã‚¹ãƒ©ãƒƒã‚°ã®é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ã€æ—¢å­˜ãƒã‚§ãƒƒã‚¯\n  WHILE EXISTS (SELECT 1 FROM public.organizations WHERE slug = org_slug) LOOP\n    org_slug := 'org-' || substring(NEW.id::text from 1 for 8) || '-' || floor(random() * 1000)::text;\n  END LOOP;\n\n  -- æ–°ã—ã„çµ„ç¹”ã‚’ä½œæˆ\n  INSERT INTO public.organizations (\n    name,\n    slug,\n    email,\n    subscription_status,\n    subscription_plan,\n    trial_ends_at,\n    max_stores,\n    max_users,\n    max_ai_requests_per_month\n  ) VALUES (\n    org_name,\n    org_slug,\n    COALESCE(NEW.email, 'noreply@example.com'),\n    'trial',\n    'starter',\n    now() + interval '14 days',\n    3,\n    5,\n    100\n  )\n  RETURNING id INTO new_org_id;\n\n  RAISE NOTICE 'âœ… Created organization: % (ID: %) for user: %', org_name, new_org_id, NEW.id;\n\n  -- organization_members ã«ã‚ªãƒ¼ãƒŠãƒ¼ã¨ã—ã¦ç™»éŒ²\n  INSERT INTO public.organization_members (\n    organization_id,\n    user_id,\n    role,\n    joined_at\n  ) VALUES (\n    new_org_id,\n    NEW.id,\n    'owner',\n    now()\n  )\n  ON CONFLICT (organization_id, user_id) DO NOTHING;\n\n  RAISE NOTICE 'âœ… Added user as organization owner';\n\n  -- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã« organization_id ã‚’è¨­å®š\n  NEW.organization_id := new_org_id;\n\n  RETURN NEW;\nEXCEPTION\n  WHEN OTHERS THEN\n    RAISE WARNING 'Failed to create organization for profile %: %', NEW.id, SQLERRM;\n    RETURN NEW;\nEND;\n$$;\n\nCOMMENT ON FUNCTION public.create_organization_for_new_profile() IS 'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã«çµ„ç¹”ã‚’è‡ªå‹•ä½œæˆï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰çµ„ç¹”åã‚’å–å¾—ï¼‰';\n\n-- ============================================\n-- ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n-- ============================================\n\nDO $$\nBEGIN\n  RAISE NOTICE '========================================';\n  RAISE NOTICE 'âœ… çµ„ç¹”è‡ªå‹•ä½œæˆé–¢æ•°ã‚’æ›´æ–°ã—ã¾ã—ãŸ';\n  RAISE NOTICE 'ğŸ“‹ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ organizationName ã‚’å–å¾—ã—ã¾ã™';\n  RAISE NOTICE '========================================';\nEND $$;\n",
  "supabase/migrations/20251010181327_create_audit_logs_table.sql": "/*\n  # ç›£æŸ»ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ\n\n  ## æ¦‚è¦\n  ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã®ãŸã‚ã€é‡è¦ãªæ“ä½œã‚’è¨˜éŒ²ã™ã‚‹ç›£æŸ»ãƒ­ã‚°æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚\n\n  ## æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«\n  - audit_logs - ç›£æŸ»ãƒ­ã‚°ã‚’ä¿å­˜\n\n  ## ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ \n  - id (uuid, primary key) - ãƒ­ã‚°ID\n  - organization_id (uuid, foreign key) - çµ„ç¹”ID\n  - user_id (uuid, foreign key) - æ“ä½œå®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼ID\n  - action (text) - æ“ä½œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆä¾‹: user.created, store.updatedï¼‰\n  - resource_type (text) - ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ï¼ˆä¾‹: user, store, reportï¼‰\n  - resource_id (text) - ãƒªã‚½ãƒ¼ã‚¹ID\n  - details (jsonb) - è©³ç´°æƒ…å ±ï¼ˆå¤‰æ›´å‰å¾Œã®å€¤ãªã©ï¼‰\n  - ip_address (text) - IPã‚¢ãƒ‰ãƒ¬ã‚¹\n  - user_agent (text) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ\n  - status (text) - æ“ä½œçµæœï¼ˆsuccess, failureï¼‰\n  - error_message (text) - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå¤±æ•—æ™‚ï¼‰\n  - created_at (timestamptz) - ä½œæˆæ—¥æ™‚\n\n  ## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n  - RLSãƒãƒªã‚·ãƒ¼ã§çµ„ç¹”ã®ç®¡ç†è€…ã®ã¿ãŒé–²è¦§å¯èƒ½\n  - ãƒ­ã‚°ã¯å‰Šé™¤ä¸å¯ï¼ˆSELECT, INSERTã®ã¿ï¼‰\n*/\n\nCREATE TABLE IF NOT EXISTS public.audit_logs (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  organization_id uuid NOT NULL REFERENCES public.organizations(id) ON DELETE CASCADE,\n  user_id uuid REFERENCES auth.users(id) ON DELETE SET NULL,\n  action text NOT NULL,\n  resource_type text NOT NULL,\n  resource_id text,\n  details jsonb DEFAULT '{}'::jsonb,\n  ip_address text,\n  user_agent text,\n  status text NOT NULL DEFAULT 'success',\n  error_message text,\n  created_at timestamptz NOT NULL DEFAULT now(),\n  \n  CHECK (status IN ('success', 'failure'))\n);\n\nCOMMENT ON TABLE public.audit_logs IS 'ç›£æŸ»ãƒ­ã‚° - é‡è¦ãªæ“ä½œã‚’è¨˜éŒ²';\nCOMMENT ON COLUMN public.audit_logs.action IS 'æ“ä½œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆä¾‹: user.created, store.updated, report.deletedï¼‰';\nCOMMENT ON COLUMN public.audit_logs.resource_type IS 'ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ï¼ˆä¾‹: user, store, report, organizationï¼‰';\nCOMMENT ON COLUMN public.audit_logs.resource_id IS 'ãƒªã‚½ãƒ¼ã‚¹ã®ä¸€æ„è­˜åˆ¥å­';\nCOMMENT ON COLUMN public.audit_logs.details IS 'è©³ç´°æƒ…å ±ï¼ˆå¤‰æ›´å‰å¾Œã®å€¤ã€è¿½åŠ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãªã©ï¼‰';\nCOMMENT ON COLUMN public.audit_logs.status IS 'æ“ä½œçµæœï¼ˆsuccess, failureï¼‰';\n\nCREATE INDEX IF NOT EXISTS idx_audit_logs_org_id \n  ON public.audit_logs(organization_id);\n\nCREATE INDEX IF NOT EXISTS idx_audit_logs_user_id \n  ON public.audit_logs(user_id);\n\nCREATE INDEX IF NOT EXISTS idx_audit_logs_action \n  ON public.audit_logs(action);\n\nCREATE INDEX IF NOT EXISTS idx_audit_logs_resource \n  ON public.audit_logs(resource_type, resource_id);\n\nCREATE INDEX IF NOT EXISTS idx_audit_logs_created_at \n  ON public.audit_logs(created_at DESC);\n\nCREATE INDEX IF NOT EXISTS idx_audit_logs_status \n  ON public.audit_logs(status);\n\nALTER TABLE public.audit_logs ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Organization admins can view audit logs\"\n  ON public.audit_logs\n  FOR SELECT\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 FROM public.organization_members\n      WHERE organization_members.organization_id = audit_logs.organization_id\n        AND organization_members.user_id = auth.uid()\n        AND organization_members.role IN ('admin', 'owner')\n    )\n  );\n\nCREATE POLICY \"Authenticated users can insert audit logs\"\n  ON public.audit_logs\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM public.organization_members\n      WHERE organization_members.organization_id = audit_logs.organization_id\n        AND organization_members.user_id = auth.uid()\n    )\n  );\n\nCREATE OR REPLACE FUNCTION public.create_audit_log(\n  p_organization_id uuid,\n  p_user_id uuid,\n  p_action text,\n  p_resource_type text,\n  p_resource_id text DEFAULT NULL,\n  p_details jsonb DEFAULT '{}'::jsonb,\n  p_ip_address text DEFAULT NULL,\n  p_user_agent text DEFAULT NULL,\n  p_status text DEFAULT 'success',\n  p_error_message text DEFAULT NULL\n)\nRETURNS uuid\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nDECLARE\n  v_log_id uuid;\nBEGIN\n  INSERT INTO public.audit_logs (\n    organization_id,\n    user_id,\n    action,\n    resource_type,\n    resource_id,\n    details,\n    ip_address,\n    user_agent,\n    status,\n    error_message\n  ) VALUES (\n    p_organization_id,\n    p_user_id,\n    p_action,\n    p_resource_type,\n    p_resource_id,\n    p_details,\n    p_ip_address,\n    p_user_agent,\n    p_status,\n    p_error_message\n  )\n  RETURNING id INTO v_log_id;\n  \n  RETURN v_log_id;\nEND;\n$$;\n\nCOMMENT ON FUNCTION public.create_audit_log IS 'ç›£æŸ»ãƒ­ã‚°ã‚’ä½œæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°';\n",
  "supabase/migrations/20251011012111_add_terms_acceptance_tracking.sql": "/*\n  # åˆ©ç”¨è¦ç´„ãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®åŒæ„è¿½è·¡\n\n  ## æ¦‚è¦\n  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ©ç”¨è¦ç´„ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®åŒæ„çŠ¶æ³ã‚’è¿½è·¡ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚\n\n  ## å¤‰æ›´å†…å®¹\n  - profilesãƒ†ãƒ¼ãƒ–ãƒ«ã«åŒæ„é–¢é€£ã®ã‚«ãƒ©ãƒ ã‚’è¿½åŠ \n\n  ## æ–°è¦ã‚«ãƒ©ãƒ \n  - terms_accepted (boolean) - åˆ©ç”¨è¦ç´„ã¸ã®åŒæ„\n  - terms_accepted_at (timestamptz) - åŒæ„æ—¥æ™‚\n  - privacy_accepted (boolean) - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã¸ã®åŒæ„\n  - privacy_accepted_at (timestamptz) - åŒæ„æ—¥æ™‚\n  - terms_version (text) - åŒæ„ã—ãŸåˆ©ç”¨è¦ç´„ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³\n  - privacy_version (text) - åŒæ„ã—ãŸãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³\n*/\n\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'profiles'\n      AND column_name = 'terms_accepted'\n  ) THEN\n    ALTER TABLE public.profiles ADD COLUMN terms_accepted boolean DEFAULT false;\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'profiles'\n      AND column_name = 'terms_accepted_at'\n  ) THEN\n    ALTER TABLE public.profiles ADD COLUMN terms_accepted_at timestamptz;\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'profiles'\n      AND column_name = 'privacy_accepted'\n  ) THEN\n    ALTER TABLE public.profiles ADD COLUMN privacy_accepted boolean DEFAULT false;\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'profiles'\n      AND column_name = 'privacy_accepted_at'\n  ) THEN\n    ALTER TABLE public.profiles ADD COLUMN privacy_accepted_at timestamptz;\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'profiles'\n      AND column_name = 'terms_version'\n  ) THEN\n    ALTER TABLE public.profiles ADD COLUMN terms_version text DEFAULT '1.0';\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns\n    WHERE table_schema = 'public'\n      AND table_name = 'profiles'\n      AND column_name = 'privacy_version'\n  ) THEN\n    ALTER TABLE public.profiles ADD COLUMN privacy_version text DEFAULT '1.0';\n  END IF;\nEND $$;\n\nCOMMENT ON COLUMN public.profiles.terms_accepted IS 'åˆ©ç”¨è¦ç´„ã¸ã®åŒæ„çŠ¶æ³';\nCOMMENT ON COLUMN public.profiles.terms_accepted_at IS 'åˆ©ç”¨è¦ç´„åŒæ„æ—¥æ™‚';\nCOMMENT ON COLUMN public.profiles.privacy_accepted IS 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã¸ã®åŒæ„çŠ¶æ³';\nCOMMENT ON COLUMN public.profiles.privacy_accepted_at IS 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼åŒæ„æ—¥æ™‚';\nCOMMENT ON COLUMN public.profiles.terms_version IS 'åŒæ„ã—ãŸåˆ©ç”¨è¦ç´„ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³';\nCOMMENT ON COLUMN public.profiles.privacy_version IS 'åŒæ„ã—ãŸãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³';\n\nCREATE OR REPLACE FUNCTION public.accept_terms_and_privacy(\n  p_user_id uuid,\n  p_terms_version text DEFAULT '1.0',\n  p_privacy_version text DEFAULT '1.0'\n)\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nBEGIN\n  UPDATE public.profiles\n  SET\n    terms_accepted = true,\n    terms_accepted_at = now(),\n    privacy_accepted = true,\n    privacy_accepted_at = now(),\n    terms_version = p_terms_version,\n    privacy_version = p_privacy_version,\n    updated_at = now()\n  WHERE user_id = p_user_id;\nEND;\n$$;\n\nCOMMENT ON FUNCTION public.accept_terms_and_privacy IS 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ©ç”¨è¦ç´„ãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼åŒæ„ã‚’è¨˜éŒ²';\n",
  "supabase/migrations/20251012173529_fix_vendors_rls_policies.sql": "/*\n  # vendorsãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSãƒãƒªã‚·ãƒ¼ä¿®æ­£\n\n  1. å¤‰æ›´å†…å®¹\n    - é‡è¤‡ãƒ»ç«¶åˆã—ã¦ã„ã‚‹ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤\n    - çµ„ç¹”ãƒ™ãƒ¼ã‚¹ã®æ­£ã—ã„ãƒãƒªã‚·ãƒ¼ã®ã¿ã‚’æ®‹ã™\n  \n  2. ä¿®æ­£ã•ã‚Œã‚‹ãƒãƒªã‚·ãƒ¼\n    - å¤ã„ \"Users can read vendors\" ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤\n    - å¤ã„ \"Managers can manage vendors\" ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤\n    - çµ„ç¹”ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªã‚·ãƒ¼ (vendors_select, vendors_insert, vendors_update, vendors_delete) ã‚’ç¶­æŒ\n\n  3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®çµ„ç¹”ã®vendorsã®ã¿é–²è¦§å¯èƒ½\n    - ç®¡ç†è€…ã®ã¿vendorsã®ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ãŒå¯èƒ½\n*/\n\n-- å¤ã„ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤\nDROP POLICY IF EXISTS \"Users can read vendors\" ON vendors;\nDROP POLICY IF EXISTS \"Managers can manage vendors\" ON vendors;\n\n-- æ—¢å­˜ã®çµ„ç¹”ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªã‚·ãƒ¼ã‚’ç¶­æŒï¼ˆã™ã§ã«å­˜åœ¨ï¼‰\n-- vendors_select: è‡ªçµ„ç¹”ã®vendorsã‚’é–²è¦§å¯èƒ½\n-- vendors_insert: ç®¡ç†è€…ã®ã¿vendorsã‚’ä½œæˆå¯èƒ½\n-- vendors_update: ç®¡ç†è€…ã®ã¿vendorsã‚’æ›´æ–°å¯èƒ½\n-- vendors_delete: ç®¡ç†è€…ã®ã¿vendorsã‚’å‰Šé™¤å¯èƒ½\n",
  "supabase/migrations/20251012174153_20251012173530_fix_vendors_rls_policies_final.sql": "/*\n  # Fix vendors table RLS policies - Final Fix\n\n  1. Changes\n    - Drop all existing policies on vendors table\n    - Create new simplified policies that avoid infinite recursion\n    - Use direct auth.uid() checks without complex subqueries\n  \n  2. Security\n    - Users can only see vendors in their organization\n    - Admin users can manage vendors\n*/\n\n-- Drop all existing policies on vendors table\nDROP POLICY IF EXISTS \"Users can view vendors in their organization\" ON vendors;\nDROP POLICY IF EXISTS \"Users can view own organization vendors\" ON vendors;\nDROP POLICY IF EXISTS \"Admin users can insert vendors\" ON vendors;\nDROP POLICY IF EXISTS \"Admin users can update vendors\" ON vendors;\nDROP POLICY IF EXISTS \"Admin users can delete vendors\" ON vendors;\n\n-- Create new simplified policies\nCREATE POLICY \"Users can view vendors in organization\"\n  ON vendors FOR SELECT\n  TO authenticated\n  USING (\n    organization_id IN (\n      SELECT organization_id \n      FROM organization_members \n      WHERE user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"Admins can insert vendors\"\n  ON vendors FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    organization_id IN (\n      SELECT organization_id \n      FROM organization_members \n      WHERE user_id = auth.uid() \n      AND role = 'admin'\n    )\n  );\n\nCREATE POLICY \"Admins can update vendors\"\n  ON vendors FOR UPDATE\n  TO authenticated\n  USING (\n    organization_id IN (\n      SELECT organization_id \n      FROM organization_members \n      WHERE user_id = auth.uid() \n      AND role = 'admin'\n    )\n  )\n  WITH CHECK (\n    organization_id IN (\n      SELECT organization_id \n      FROM organization_members \n      WHERE user_id = auth.uid() \n      AND role = 'admin'\n    )\n  );\n\nCREATE POLICY \"Admins can delete vendors\"\n  ON vendors FOR DELETE\n  TO authenticated\n  USING (\n    organization_id IN (\n      SELECT organization_id \n      FROM organization_members \n      WHERE user_id = auth.uid() \n      AND role = 'admin'\n    )\n  );",
  "supabase/migrations/20251012174737_20251013_clean_vendors_policies_completely.sql": "/*\n  # Clean vendors table policies completely\n\n  1. Changes\n    - Drop ALL existing policies on vendors table (8 duplicate policies found)\n    - Create clean, simple policies without infinite recursion\n  \n  2. Security\n    - Users can view vendors in their organization\n    - Admins can manage (insert/update/delete) vendors\n*/\n\n-- Drop ALL existing policies\nDROP POLICY IF EXISTS \"Admins can delete vendors\" ON vendors;\nDROP POLICY IF EXISTS \"Admins can insert vendors\" ON vendors;\nDROP POLICY IF EXISTS \"Admins can update vendors\" ON vendors;\nDROP POLICY IF EXISTS \"Users can view vendors in organization\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_delete\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_insert\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_select\" ON vendors;\nDROP POLICY IF EXISTS \"vendors_update\" ON vendors;\n\n-- Create simple, non-recursive policies\nCREATE POLICY \"vendors_select_policy\"\n  ON vendors FOR SELECT\n  TO authenticated\n  USING (\n    organization_id IN (\n      SELECT organization_id \n      FROM organization_members \n      WHERE user_id = auth.uid()\n    )\n  );\n\nCREATE POLICY \"vendors_insert_policy\"\n  ON vendors FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 \n      FROM organization_members \n      WHERE user_id = auth.uid() \n      AND organization_id = vendors.organization_id\n      AND role = 'admin'\n    )\n  );\n\nCREATE POLICY \"vendors_update_policy\"\n  ON vendors FOR UPDATE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 \n      FROM organization_members \n      WHERE user_id = auth.uid() \n      AND organization_id = vendors.organization_id\n      AND role = 'admin'\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 \n      FROM organization_members \n      WHERE user_id = auth.uid() \n      AND organization_id = vendors.organization_id\n      AND role = 'admin'\n    )\n  );\n\nCREATE POLICY \"vendors_delete_policy\"\n  ON vendors FOR DELETE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1 \n      FROM organization_members \n      WHERE user_id = auth.uid() \n      AND organization_id = vendors.organization_id\n      AND role = 'admin'\n    )\n  );",
  "supabase/migrations/20251012183418_fix_vendors_insert_policy_allow_owner.sql": "/*\n  # Fix vendors INSERT policy to allow both admin and owner roles\n\n  1. Changes\n    - Drop existing vendors_insert_policy\n    - Create new policy that allows both 'admin' and 'owner' roles\n    - This ensures organization owners can also create vendors\n\n  2. Security\n    - Still requires user to be authenticated\n    - Still requires user to be a member of the organization\n    - Now allows both 'admin' and 'owner' roles (previously only 'admin')\n*/\n\n-- Drop existing policy\nDROP POLICY IF EXISTS vendors_insert_policy ON vendors;\n\n-- Create new policy that allows both admin and owner\nCREATE POLICY \"vendors_insert_policy\"\n  ON vendors\n  FOR INSERT\n  TO authenticated\n  WITH CHECK (\n    EXISTS (\n      SELECT 1\n      FROM organization_members\n      WHERE organization_members.user_id = auth.uid()\n        AND organization_members.organization_id = vendors.organization_id\n        AND organization_members.role IN ('owner', 'admin')\n    )\n  );\n",
  "supabase/migrations/20251012183431_fix_vendors_all_policies_allow_owner.sql": "/*\n  # Fix all vendors policies to allow both admin and owner roles\n\n  1. Changes\n    - Drop existing vendors_update_policy and vendors_delete_policy\n    - Create new policies that allow both 'admin' and 'owner' roles\n    - This ensures organization owners can manage vendors\n\n  2. Security\n    - Still requires user to be authenticated\n    - Still requires user to be a member of the organization\n    - Now allows both 'admin' and 'owner' roles (previously only 'admin')\n*/\n\n-- Drop existing policies\nDROP POLICY IF EXISTS vendors_update_policy ON vendors;\nDROP POLICY IF EXISTS vendors_delete_policy ON vendors;\n\n-- Create new UPDATE policy that allows both admin and owner\nCREATE POLICY \"vendors_update_policy\"\n  ON vendors\n  FOR UPDATE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1\n      FROM organization_members\n      WHERE organization_members.user_id = auth.uid()\n        AND organization_members.organization_id = vendors.organization_id\n        AND organization_members.role IN ('owner', 'admin')\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1\n      FROM organization_members\n      WHERE organization_members.user_id = auth.uid()\n        AND organization_members.organization_id = vendors.organization_id\n        AND organization_members.role IN ('owner', 'admin')\n    )\n  );\n\n-- Create new DELETE policy that allows both admin and owner\nCREATE POLICY \"vendors_delete_policy\"\n  ON vendors\n  FOR DELETE\n  TO authenticated\n  USING (\n    EXISTS (\n      SELECT 1\n      FROM organization_members\n      WHERE organization_members.user_id = auth.uid()\n        AND organization_members.organization_id = vendors.organization_id\n        AND organization_members.role IN ('owner', 'admin')\n    )\n  );\n",
  "tailwind.config.js": "/** @type {import('tailwindcss').Config} */\nexport default {\n  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],\n  theme: {\n    extend: {\n      colors: {\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        success: \"hsl(var(--success))\",\n        warning: \"hsl(var(--warning))\",\n        info: \"hsl(var(--info))\",\n        danger: \"hsl(var(--danger))\",\n        success: \"hsl(var(--success))\",\n        warning: \"hsl(var(--warning))\",\n        info: \"hsl(var(--info))\",\n        danger: \"hsl(var(--danger))\",\n      },\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n    },\n  },\n  plugins: [],\n}\n",
  "tsconfig.app.json": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2020\",\n    \"useDefineForClassFields\": true,\n    \"lib\": [\"ES2020\", \"DOM\", \"DOM.Iterable\"],\n    \"module\": \"ESNext\",\n    \"skipLibCheck\": true,\n\n    /* Bundler mode */\n    \"moduleResolution\": \"bundler\",\n    \"allowImportingTsExtensions\": true,\n    \"isolatedModules\": true,\n    \"moduleDetection\": \"force\",\n    \"noEmit\": true,\n    \"jsx\": \"react-jsx\",\n\n    /* Linting */\n    \"strict\": true,\n    \"noUnusedLocals\": true,\n    \"noUnusedParameters\": true,\n    \"noFallthroughCasesInSwitch\": true\n  },\n  \"include\": [\"src\"]\n}\n",
  "tsconfig.json": "{\n  \"files\": [],\n  \"references\": [\n    { \"path\": \"./tsconfig.app.json\" },\n    { \"path\": \"./tsconfig.node.json\" }\n  ]\n}\n",
  "tsconfig.node.json": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"lib\": [\"ES2023\"],\n    \"module\": \"ESNext\",\n    \"skipLibCheck\": true,\n\n    /* Bundler mode */\n    \"moduleResolution\": \"bundler\",\n    \"allowImportingTsExtensions\": true,\n    \"isolatedModules\": true,\n    \"moduleDetection\": \"force\",\n    \"noEmit\": true,\n\n    /* Linting */\n    \"strict\": true,\n    \"noUnusedLocals\": true,\n    \"noUnusedParameters\": true,\n    \"noFallthroughCasesInSwitch\": true\n  },\n  \"include\": [\"vite.config.ts\"]\n}\n",
  "vercel.json": "{\n  \"rewrites\": [\n    { \"source\": \"/(.*)\", \"destination\": \"/\" }\n  ],\n  \"headers\": [\n    {\n      \"source\": \"/(.*)\",\n      \"headers\": [\n        {\n          \"key\": \"X-Content-Type-Options\",\n          \"value\": \"nosniff\"\n        },\n        {\n          \"key\": \"X-Frame-Options\",\n          \"value\": \"DENY\"\n        },\n        {\n          \"key\": \"X-XSS-Protection\",\n          \"value\": \"1; mode=block\"\n        },\n        {\n          \"key\": \"Referrer-Policy\",\n          \"value\": \"strict-origin-when-cross-origin\"\n        }\n      ]\n    }\n  ]\n}\n",
  "vite.config.ts": "import { defineConfig } from 'vite';\nimport react from '@vitejs/plugin-react';\nimport path from 'path';\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  resolve: {\n    alias: {\n      '@': path.resolve(__dirname, './src'),\n    },\n  },\n  optimizeDeps: {\n    exclude: ['lucide-react'],\n  },\n  build: {\n    rollupOptions: {\n      output: {\n        manualChunks: {\n          'react-vendor': ['react', 'react-dom', 'react-router-dom'],\n          'chart-vendor': ['chart.js', 'react-chartjs-2', 'recharts'],\n          'ui-vendor': ['lucide-react', '@radix-ui/react-slot', '@radix-ui/react-tabs', '@radix-ui/react-dropdown-menu', '@radix-ui/react-progress'],\n        },\n      },\n    },\n    chunkSizeWarningLimit: 1000,\n    minify: 'terser',\n    terserOptions: {\n      compress: {\n        drop_console: true,\n        drop_debugger: true,\n      },\n    },\n  },\n});\n"
};
