# CSVインポート機能 - ユーザーマニュアル

**最終更新日:** 2025-11-25
**対象バージョン:** 1.0.0

---

## 📖 目次

1. [概要](#概要)
2. [対応POSレジ](#対応posレジ)
3. [基本的な使い方](#基本的な使い方)
4. [詳細手順](#詳細手順)
5. [トラブルシューティング](#トラブルシューティング)
6. [よくある質問（FAQ）](#よくある質問faq)
7. [サポート](#サポート)

---

## 概要

### CSVインポート機能とは？

POSレジや他のシステムからエクスポートしたCSVファイルを、本システムに一括インポートする機能です。

### 主な特徴

✅ **主要POSレジ5種類に対応**
- Airレジ
- スマレジ
- ユビレジ
- Square
- その他汎用フォーマット

✅ **簡単な操作**
- ドラッグ&ドロップでアップロード
- 自動フォーマット検出
- 詳細なエラー表示

✅ **高速処理**
- 100件: 約2秒
- 1,000件: 約10秒
- 10,000件: 約90秒

---

## 対応POSレジ

### 完全対応

| POSレジ | 対応状況 | 推奨エクスポート形式 |
|---------|---------|---------------------|
| **Airレジ** | ✅ 完全対応 | 売上日報CSV |
| **スマレジ** | ✅ 完全対応 | 日別売上CSV |
| **ユビレジ** | ✅ 完全対応 | 日次レポートCSV |
| **Square** | ✅ 完全対応 | 売上レポートCSV |
| **その他** | ✅ 汎用対応 | テンプレート利用 |

### インポート可能なデータ

1. **日次レポート**
   - 日付
   - 売上
   - 客数
   - 仕入
   - 各種経費

2. **月次経費**
   - 年月
   - 人件費
   - 家賃
   - 水道光熱費
   - 広告宣伝費
   - 消耗品費
   - その他経費

---

## 基本的な使い方

### クイックスタート（3分）

```
1. ログイン
   ↓
2. 「データ管理」→「CSVインポート」をクリック
   ↓
3. インポート種別を選択（日次レポート/月次経費）
   ↓
4. CSVファイルをドラッグ&ドロップ
   ↓
5. 「インポート実行」ボタンをクリック
   ↓
6. 完了！（自動でダッシュボードに反映）
```

### 推奨ワークフロー

#### 毎日の運用

```
営業終了後（22:00-23:00）
  ↓
POSレジで締め処理
  ↓
CSVエクスポート（1分）
  ↓
本システムにインポート（1分）
  ↓
完了（合計2分）
```

#### 月末の運用

```
月末締め処理
  ↓
月次経費データをエクスポート
  ↓
本システムにインポート
  ↓
月次レポート確認
```

---

## 詳細手順

### ステップ1: CSVテンプレートのダウンロード

#### 新規ユーザーの場合

1. CSVインポートページを開く
2. 「テンプレートダウンロード」セクションで該当するボタンをクリック
   - 📥 日次レポート テンプレート
   - 📥 月次経費 テンプレート
3. テンプレートファイルがダウンロードされます

#### テンプレートの構成

**日次レポートテンプレート:**
```csv
日付,店舗ID,営業区分,売上,客数,仕入,人件費,家賃,水道光熱費,広告宣伝費,消耗品費,その他経費,備考
2025-11-25,uuid,full_day,150000,85,45000,30000,20000,5000,3000,2000,1000,メモ
必須,必須,任意,任意,任意,任意,任意,任意,任意,任意,任意,任意,任意
```

**月次経費テンプレート:**
```csv
年月,店舗ID,人件費,家賃,水道光熱費,広告宣伝費,消耗品費,その他経費,備考
2025-11,uuid,900000,300000,150000,100000,50000,80000,メモ
必須,必須,必須,必須,必須,必須,必須,必須,任意
```

---

### ステップ2: データの準備

#### POSレジからのエクスポート

各POSレジの詳細な手順は「[POS別設定ガイド](#pos別設定ガイド)」を参照してください。

#### データ整形のポイント

✅ **推奨事項:**
- 日付は`YYYY-MM-DD`形式（例: 2025-11-25）
- 数値にカンマを含む場合は引用符で囲む（例: "150,000"）
- 通貨記号（¥）は自動削除されます
- 空のセルはそのままでOK

⚠️ **注意事項:**
- Excelで編集後は「CSV UTF-8（カンマ区切り）」形式で保存
- 文字コードはUTF-8を推奨
- 1行目は必ずヘッダー行

---

### ステップ3: インポート設定

1. **インポート種別の選択**
   ```
   日次レポート: 毎日の売上・経費データ
   月次経費: 月ごとの固定費データ
   ```

2. **デフォルト店舗の選択（任意）**
   ```
   CSVに店舗IDが含まれていない場合のみ設定
   複数店舗のデータが混在する場合は空欄
   ```

---

### ステップ4: ファイルのアップロード

#### 方法1: ドラッグ&ドロップ

1. CSVファイルをデスクトップから選択
2. 点線の枠内にドラッグ
3. ファイル名と容量が表示されます

#### 方法2: ファイル選択

1. 「ファイルを選択」ボタンをクリック
2. ダイアログからCSVファイルを選択
3. 「開く」をクリック

---

### ステップ5: インポート実行

1. 選択したファイルが正しいか確認
2. 「インポート実行」ボタンをクリック
3. 処理中は「インポート中...」と表示されます
4. 完了するまでお待ちください

---

### ステップ6: 結果の確認

#### 成功時

```
✅ インポート結果
━━━━━━━━━━━━━━━━━━━━━━
  成功: 150件
  失敗: 0件
  スキップ: 0件
  合計: 150件

✓ インポートが完了しました
  2秒後にページを更新します...
```

#### 一部失敗時

```
⚠️ インポート結果
━━━━━━━━━━━━━━━━━━━━━━
  成功: 148件
  失敗: 2件
  スキップ: 0件
  合計: 150件

❌ エラー詳細:
  行 5: 日付が必須です
  行 23: 店舗IDが必須です
```

#### エラー対処

1. エラー詳細を確認
2. CSVファイルの該当行を修正
3. 再度インポート実行

---

## トラブルシューティング

### よくあるエラーと対処法

#### エラー1: 「CSVファイルを選択してください」

**原因:** CSV以外のファイルを選択している

**対処法:**
```
1. ファイルの拡張子が .csv であることを確認
2. Excelファイル（.xlsx）の場合は、CSV形式で保存し直す
   Excel → ファイル → 名前を付けて保存 →
   形式: CSV UTF-8（カンマ区切り）
```

#### エラー2: 「必須カラムが見つかりません」

**原因:** 必須項目のヘッダーが不足している

**対処法:**
```
日次レポート: 「日付」と「店舗ID」が必須
月次経費: 「年月」「店舗ID」「人件費」「家賃」等が必須

→ テンプレートをダウンロードして確認
```

#### エラー3: 「日付が必須です」（行ごと）

**原因:** 日付列が空白、または形式が不正

**対処法:**
```
正しい形式: 2025-11-25
間違い例: 11/25/2025, 2025年11月25日

→ YYYY-MM-DD形式に統一
```

#### エラー4: 「店舗IDが必須です」

**原因:** 店舗IDが指定されていない

**対処法:**
```
方法1: CSV内に店舗IDを追加
方法2: インポート設定で「デフォルト店舗」を選択
```

#### エラー5: 文字化けする

**原因:** 文字コードがUTF-8でない

**対処法:**
```
Excelの場合:
  ファイル → 名前を付けて保存 →
  形式: CSV UTF-8（カンマ区切り）を選択

テキストエディタの場合:
  文字コードをUTF-8に指定して保存
```

---

### パフォーマンスに関する問題

#### インポートが遅い

**大量データの場合:**
```
推奨: 1回あたり1,000件以下に分割
理由: メモリ使用量とエラー追跡の容易さ

例: 10,000件のデータ
  → 1,000件 × 10回に分割してインポート
```

#### ブラウザが固まる

**原因:** データ量が多すぎる

**対処法:**
```
1. データを分割
2. 別のブラウザを試す（Chrome推奨）
3. ページをリロードして再実行
```

---

## よくある質問（FAQ）

### Q1. 複数店舗のデータを一度にインポートできますか？

**A:** はい、可能です。

```
方法1: CSV内に店舗IDを含める
  日付,店舗ID,売上
  2025-11-25,店舗A_ID,150000
  2025-11-25,店舗B_ID,180000

方法2: 店舗ごとに分けてインポート
  店舗Aのデータ → インポート → デフォルト店舗: A
  店舗Bのデータ → インポート → デフォルト店舗: B
```

---

### Q2. 過去のデータをまとめてインポートできますか？

**A:** はい、何年分でもインポート可能です。

```
推奨: 月単位または年単位で分割
  2023年のデータ → インポート
  2024年のデータ → インポート
  2025年のデータ → インポート

理由: エラーが発生した場合の対処が容易
```

---

### Q3. 同じ日付のデータを再インポートするとどうなりますか？

**A:** データの種類により異なります。

```
日次レポート: 重複エラーが発生（再インポート不可）
  → 既存データを削除してから再インポート

月次経費: 上書き（更新）される
  → 最新データで更新されます
```

---

### Q4. POSレジのフォーマットと違う場合は？

**A:** 柔軟にマッピングされます。

```
自動認識される例:
  「売上金額」→ 売上
  「sales」→ 売上
  「SALES」→ 売上
  「sales_amount」→ 売上

認識されない場合:
  → テンプレートに合わせて整形
```

---

### Q5. エクスポートしたCSVをそのまま使えますか？

**A:** 多くの場合、そのまま使えます。

```
✅ そのまま使えるPOSレジ:
  - スマレジ（日別売上）
  - ユビレジ（日次レポート）
  - Square（売上レポート）

⚠️ 整形が必要な場合:
  - Airレジ（店舗IDを追加）
  - カスタムフォーマット
```

---

### Q6. インポート後にデータを修正できますか？

**A:** はい、通常の編集機能で修正可能です。

```
修正方法:
  1. ダッシュボード → 日次レポート一覧
  2. 該当データを選択
  3. 編集ボタンをクリック
  4. 内容を修正して保存
```

---

### Q7. インポートしたデータを削除できますか？

**A:** はい、個別または一括削除が可能です。

```
個別削除:
  レポート一覧 → 該当データ → 削除ボタン

一括削除:
  管理者設定 → データ管理 → 期間指定削除
```

---

### Q8. エラーログを保存できますか？

**A:** 画面をスクリーンショットで保存してください。

```
今後の機能追加予定:
  - エラーログのCSVダウンロード
  - インポート履歴の確認
```

---

### Q9. どのブラウザが推奨ですか？

**A:** Google Chromeを推奨します。

```
動作確認済みブラウザ:
  ✅ Google Chrome（推奨）
  ✅ Microsoft Edge
  ✅ Safari
  ⚠️ Firefox（一部機能制限あり）
  ❌ Internet Explorer（非対応）
```

---

### Q10. スマホからインポートできますか？

**A:** 可能ですが、PCでの操作を推奨します。

```
理由:
  - ファイル選択がしやすい
  - エラー確認がしやすい
  - 大量データに対応

スマホでの利用:
  → 小規模データ（10件程度）のみ推奨
```

---

## サポート

### 問い合わせ方法

#### メールサポート
```
📧 support@example.com
対応時間: 平日 9:00-18:00
返信目安: 24時間以内
```

#### チャットサポート
```
💬 画面右下のチャットアイコン
対応時間: 平日 9:00-18:00
即時対応
```

#### 電話サポート
```
📞 03-XXXX-XXXX
対応時間: 平日 10:00-17:00
緊急時のみ
```

---

### 問い合わせ時の情報

以下の情報を提供いただくとスムーズです：

1. **環境情報**
   - ブラウザ名とバージョン
   - OS（Windows/Mac）
   - POSレジの種類

2. **エラー情報**
   - エラーメッセージ
   - 該当するCSVファイル（個人情報削除後）
   - スクリーンショット

3. **操作内容**
   - いつ発生したか
   - どの画面で発生したか
   - どのような操作をしたか

---

## 付録

### 対応カラム一覧

#### 日次レポート

| カラム名 | 型 | 必須 | 説明 | 例 |
|---------|-----|------|------|-----|
| 日付 (report_date) | 日付 | ✅ | レポート日付 | 2025-11-25 |
| 店舗ID (store_id) | 文字列 | ✅* | 店舗の識別子 | uuid |
| 営業区分 (operation_type) | 文字列 | ❌ | lunch/dinner/full_day | full_day |
| 売上 (sales) | 数値 | ❌ | 売上金額 | 150000 |
| 客数 (customers) | 数値 | ❌ | 来店客数 | 85 |
| 仕入 (purchases) | 数値 | ❌ | 仕入金額 | 45000 |
| 人件費 (labor_cost) | 数値 | ❌ | 人件費 | 30000 |
| 家賃 (rent) | 数値 | ❌ | 家賃 | 20000 |
| 水道光熱費 (utilities) | 数値 | ❌ | 水道光熱費 | 5000 |
| 広告宣伝費 (advertising) | 数値 | ❌ | 広告宣伝費 | 3000 |
| 消耗品費 (consumables) | 数値 | ❌ | 消耗品費 | 2000 |
| その他経費 (other_expenses) | 数値 | ❌ | その他経費 | 1000 |
| 備考 (notes) | 文字列 | ❌ | メモ | 特記事項 |

*デフォルト店舗を設定した場合は省略可

#### 月次経費

| カラム名 | 型 | 必須 | 説明 | 例 |
|---------|-----|------|------|-----|
| 年月 (month) | 文字列 | ✅ | 対象年月 | 2025-11 |
| 店舗ID (store_id) | 文字列 | ✅* | 店舗の識別子 | uuid |
| 人件費 (labor_cost) | 数値 | ✅ | 人件費 | 900000 |
| 家賃 (rent) | 数値 | ✅ | 家賃 | 300000 |
| 水道光熱費 (utilities) | 数値 | ✅ | 水道光熱費 | 150000 |
| 広告宣伝費 (advertising) | 数値 | ✅ | 広告宣伝費 | 100000 |
| 消耗品費 (consumables) | 数値 | ✅ | 消耗品費 | 50000 |
| その他経費 (other_expenses) | 数値 | ✅ | その他経費 | 80000 |
| 備考 (notes) | 文字列 | ❌ | メモ | 特記事項 |

---

### バージョン履歴

| バージョン | 日付 | 変更内容 |
|----------|------|---------|
| 1.0.0 | 2025-11-25 | 初版リリース |

---

**© 2025 飲食店経営管理システム. All rights reserved.**
